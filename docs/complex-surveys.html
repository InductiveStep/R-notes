<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Complex surveys | Using R for social research</title>
  <meta name="description" content="These are some notes on using R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Complex surveys | Using R for social research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are some notes on using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Complex surveys | Using R for social research" />
  
  <meta name="twitter:description" content="These are some notes on using R" />
  

<meta name="author" content="Andi Fugard (they/them)  (almost@gmail.com, @InductiveStep)" />


<meta name="date" content="2020-12-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="logistic-regression.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="libs/table1-1.0/table1_defaults.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="starting-rstudio.html"><a href="starting-rstudio.html"><i class="fa fa-check"></i><b>1</b> Starting RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="starting-rstudio.html"><a href="starting-rstudio.html#download-install-and-run"><i class="fa fa-check"></i><b>1.1</b> Download, install, and run</a></li>
<li class="chapter" data-level="1.2" data-path="starting-rstudio.html"><a href="starting-rstudio.html#make-a-new-r-notebook-file"><i class="fa fa-check"></i><b>1.2</b> Make a new R Notebook file</a></li>
<li class="chapter" data-level="1.3" data-path="starting-rstudio.html"><a href="starting-rstudio.html#read-the-clues-it-provides"><i class="fa fa-check"></i><b>1.3</b> Read the clues it provides</a></li>
<li class="chapter" data-level="1.4" data-path="starting-rstudio.html"><a href="starting-rstudio.html#save-the-file"><i class="fa fa-check"></i><b>1.4</b> Save the file</a></li>
<li class="chapter" data-level="1.5" data-path="starting-rstudio.html"><a href="starting-rstudio.html#run-the-example-r-command"><i class="fa fa-check"></i><b>1.5</b> Run the example R command</a></li>
<li class="chapter" data-level="1.6" data-path="starting-rstudio.html"><a href="starting-rstudio.html#clear-it-and-try-a-sum"><i class="fa fa-check"></i><b>1.6</b> Clear it and try a sum</a></li>
<li class="chapter" data-level="1.7" data-path="starting-rstudio.html"><a href="starting-rstudio.html#did-that-help"><i class="fa fa-check"></i><b>1.7</b> Did that help?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="starting-r.html"><a href="starting-r.html"><i class="fa fa-check"></i><b>2</b> Starting R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="starting-r.html"><a href="starting-r.html#arithmetic"><i class="fa fa-check"></i><b>2.1</b> Arithmetic</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="starting-r.html"><a href="starting-r.html#activities"><i class="fa fa-check"></i><b>2.1.1</b> Activities</a></li>
<li class="chapter" data-level="2.1.2" data-path="starting-r.html"><a href="starting-r.html#answers"><i class="fa fa-check"></i><b>2.1.2</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="starting-r.html"><a href="starting-r.html#variables"><i class="fa fa-check"></i><b>2.2</b> Variables</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="starting-r.html"><a href="starting-r.html#activity"><i class="fa fa-check"></i><b>2.2.1</b> Activity</a></li>
<li class="chapter" data-level="2.2.2" data-path="starting-r.html"><a href="starting-r.html#answer"><i class="fa fa-check"></i><b>2.2.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="starting-r.html"><a href="starting-r.html#a-note-on-variable-names"><i class="fa fa-check"></i><b>2.3</b> A note on variable names</a></li>
<li class="chapter" data-level="2.4" data-path="starting-r.html"><a href="starting-r.html#vectors"><i class="fa fa-check"></i><b>2.4</b> Vectors</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="starting-r.html"><a href="starting-r.html#activity-1"><i class="fa fa-check"></i><b>2.4.1</b> Activity</a></li>
<li class="chapter" data-level="2.4.2" data-path="starting-r.html"><a href="starting-r.html#answer-1"><i class="fa fa-check"></i><b>2.4.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="starting-r.html"><a href="starting-r.html#functions"><i class="fa fa-check"></i><b>2.5</b> Functions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="starting-r.html"><a href="starting-r.html#activity-2"><i class="fa fa-check"></i><b>2.5.1</b> Activity</a></li>
<li class="chapter" data-level="2.5.2" data-path="starting-r.html"><a href="starting-r.html#answer-2"><i class="fa fa-check"></i><b>2.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="starting-r.html"><a href="starting-r.html#more-functions"><i class="fa fa-check"></i><b>2.6</b> More functions</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="starting-r.html"><a href="starting-r.html#activity-3"><i class="fa fa-check"></i><b>2.6.1</b> Activity</a></li>
<li class="chapter" data-level="2.6.2" data-path="starting-r.html"><a href="starting-r.html#answer-3"><i class="fa fa-check"></i><b>2.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="starting-r.html"><a href="starting-r.html#data-frames"><i class="fa fa-check"></i><b>2.7</b> Data frames</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="starting-r.html"><a href="starting-r.html#activity-4"><i class="fa fa-check"></i><b>2.7.1</b> Activity</a></li>
<li class="chapter" data-level="2.7.2" data-path="starting-r.html"><a href="starting-r.html#answer-4"><i class="fa fa-check"></i><b>2.7.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="starting-r.html"><a href="starting-r.html#loading-data-frames-from-a-file"><i class="fa fa-check"></i><b>2.8</b> Loading data frames from a file</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="starting-r.html"><a href="starting-r.html#activity-5"><i class="fa fa-check"></i><b>2.8.1</b> Activity</a></li>
<li class="chapter" data-level="2.8.2" data-path="starting-r.html"><a href="starting-r.html#answer-5"><i class="fa fa-check"></i><b>2.8.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="starting-r.html"><a href="starting-r.html#packages"><i class="fa fa-check"></i><b>2.9</b> Packages</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="starting-r.html"><a href="starting-r.html#activity-6"><i class="fa fa-check"></i><b>2.9.1</b> Activity</a></li>
<li class="chapter" data-level="2.9.2" data-path="starting-r.html"><a href="starting-r.html#answer-6"><i class="fa fa-check"></i><b>2.9.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="starting-r.html"><a href="starting-r.html#the-end"><i class="fa fa-check"></i><b>2.10</b> The end!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Visualising data in the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#getting-setup"><i class="fa fa-check"></i><b>3.1</b> Getting setup</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#an-interlude-on-functions"><i class="fa fa-check"></i><b>3.2</b> An interlude on functions</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#a-scatterplot-in-ggplot"><i class="fa fa-check"></i><b>3.3</b> A scatterplot in ggplot</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#warm-up-activity"><i class="fa fa-check"></i><b>3.3.1</b> Warm-up activity</a></li>
<li class="chapter" data-level="3.3.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-7"><i class="fa fa-check"></i><b>3.3.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#another-aesthetic-colour"><i class="fa fa-check"></i><b>3.4</b> Another aesthetic: colour</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#another-geom-jitter"><i class="fa fa-check"></i><b>3.5</b> Another geom: jitter</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-to-develop-your-help-searching-skill"><i class="fa fa-check"></i><b>3.5.1</b> Activity to develop your help-searching skill!</a></li>
<li class="chapter" data-level="3.5.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-8"><i class="fa fa-check"></i><b>3.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#aggregatingsummarising-data-by-group"><i class="fa fa-check"></i><b>3.6</b> Aggregating/summarising data by group</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-7"><i class="fa fa-check"></i><b>3.6.1</b> Activity</a></li>
<li class="chapter" data-level="3.6.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-9"><i class="fa fa-check"></i><b>3.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#pipes"><i class="fa fa-check"></i><b>3.7</b> Pipes</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#plot-the-mean-life-expectancy-by-continent"><i class="fa fa-check"></i><b>3.8</b> Plot the mean life expectancy by continent</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#actvity"><i class="fa fa-check"></i><b>3.8.1</b> Actvity</a></li>
<li class="chapter" data-level="3.8.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-10"><i class="fa fa-check"></i><b>3.8.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#yet-another-geom-line"><i class="fa fa-check"></i><b>3.9</b> Yet another geom: line</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-8"><i class="fa fa-check"></i><b>3.9.1</b> Activity</a></li>
<li class="chapter" data-level="3.9.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-11"><i class="fa fa-check"></i><b>3.9.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#filtering-data-along-the-pipeline"><i class="fa fa-check"></i><b>3.10</b> Filtering data along the pipeline</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-9"><i class="fa fa-check"></i><b>3.10.1</b> Activity</a></li>
<li class="chapter" data-level="3.10.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-12"><i class="fa fa-check"></i><b>3.10.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#other-handy-tools-select-slice-bind-and-arrange"><i class="fa fa-check"></i><b>3.11</b> Other handy tools: select, slice, bind, and arrange</a></li>
<li class="chapter" data-level="3.12" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#filtering-for-members-of-a-vector"><i class="fa fa-check"></i><b>3.12</b> Filtering for members of a vector</a></li>
<li class="chapter" data-level="3.13" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#final-challenge"><i class="fa fa-check"></i><b>3.13</b> Final challenge</a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-10"><i class="fa fa-check"></i><b>3.13.1</b> Activity</a></li>
<li class="chapter" data-level="3.13.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-13"><i class="fa fa-check"></i><b>3.13.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#more-ideas-for-visualisations"><i class="fa fa-check"></i><b>3.14</b> More ideas for visualisations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html"><i class="fa fa-check"></i><b>4</b> P-values and confidence intervals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#correlation-recap"><i class="fa fa-check"></i><b>4.1</b> Correlation recap</a></li>
<li class="chapter" data-level="4.2" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#testing-null-hypotheses"><i class="fa fa-check"></i><b>4.2</b> Testing null-hypotheses</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#what-can-samples-look-like-when-the-true-correlation-is-0"><i class="fa fa-check"></i><b>4.2.1</b> What can samples look like when the true correlation is 0?</a></li>
<li class="chapter" data-level="4.2.2" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#understanding-actual-data-in-relation-to-these-simulations"><i class="fa fa-check"></i><b>4.2.2</b> Understanding actual data in relation to these simulations</a></li>
<li class="chapter" data-level="4.2.3" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#so-what-is-a-p-value"><i class="fa fa-check"></i><b>4.2.3</b> So, what is a p-value?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#confidence-intervals"><i class="fa fa-check"></i><b>4.3</b> Confidence intervals</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#simulating-confidence"><i class="fa fa-check"></i><b>4.3.1</b> Simulating confidence</a></li>
<li class="chapter" data-level="4.3.2" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#what-is-a-confidence-interval-then"><i class="fa fa-check"></i><b>4.3.2</b> What is a confidence interval, then?</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#optional-extra-s-values"><i class="fa fa-check"></i><b>4.4</b> Optional extra: s-values</a></li>
<li class="chapter" data-level="4.5" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#further-reading"><i class="fa fa-check"></i><b>4.5</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#before-we-begin"><i class="fa fa-check"></i><b>5.1</b> Before we begin</a></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#the-dataset"><i class="fa fa-check"></i><b>5.2</b> The dataset</a></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#interlude-on-methodology"><i class="fa fa-check"></i><b>5.3</b> Interlude on methodology</a></li>
<li class="chapter" data-level="5.4" data-path="linear-regression.html"><a href="linear-regression.html#descriptives"><i class="fa fa-check"></i><b>5.4</b> Descriptives</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-11"><i class="fa fa-check"></i><b>5.4.1</b> Activity</a></li>
<li class="chapter" data-level="5.4.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-14"><i class="fa fa-check"></i><b>5.4.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="linear-regression.html"><a href="linear-regression.html#prep-to-understand-the-simplest-regression-model"><i class="fa fa-check"></i><b>5.5</b> Prep to understand the simplest regression model</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-12"><i class="fa fa-check"></i><b>5.5.1</b> Activity</a></li>
<li class="chapter" data-level="5.5.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-15"><i class="fa fa-check"></i><b>5.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="linear-regression.html"><a href="linear-regression.html#the-simplest-regression-model-intercept-only-model"><i class="fa fa-check"></i><b>5.6</b> The simplest regression model: intercept-only model</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-13"><i class="fa fa-check"></i><b>5.6.1</b> Activity</a></li>
<li class="chapter" data-level="5.6.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-16"><i class="fa fa-check"></i><b>5.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="linear-regression.html"><a href="linear-regression.html#adding-a-slope-to-the-regression-model"><i class="fa fa-check"></i><b>5.7</b> Adding a slope to the regression model</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-14"><i class="fa fa-check"></i><b>5.7.1</b> Activity</a></li>
<li class="chapter" data-level="5.7.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-17"><i class="fa fa-check"></i><b>5.7.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="linear-regression.html"><a href="linear-regression.html#residuals"><i class="fa fa-check"></i><b>5.8</b> Residuals</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-15"><i class="fa fa-check"></i><b>5.8.1</b> Activity</a></li>
<li class="chapter" data-level="5.8.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-18"><i class="fa fa-check"></i><b>5.8.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="linear-regression.html"><a href="linear-regression.html#comparing-models"><i class="fa fa-check"></i><b>5.9</b> Comparing models</a></li>
<li class="chapter" data-level="5.10" data-path="linear-regression.html"><a href="linear-regression.html#regression-with-two-or-more-predictors"><i class="fa fa-check"></i><b>5.10</b> Regression with two or more predictors</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-16"><i class="fa fa-check"></i><b>5.10.1</b> Activity</a></li>
<li class="chapter" data-level="5.10.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-19"><i class="fa fa-check"></i><b>5.10.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="linear-regression.html"><a href="linear-regression.html#interpreting-regression-models-with-two-or-more-predictors"><i class="fa fa-check"></i><b>5.11</b> Interpreting regression models with two or more predictors</a></li>
<li class="chapter" data-level="5.12" data-path="linear-regression.html"><a href="linear-regression.html#optional-that-pesky-negative-intercept"><i class="fa fa-check"></i><b>5.12</b> Optional: that pesky negative intercept</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-17"><i class="fa fa-check"></i><b>5.12.1</b> Activity</a></li>
<li class="chapter" data-level="5.12.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-20"><i class="fa fa-check"></i><b>5.12.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="linear-regression.html"><a href="linear-regression.html#finally-confidence-intervals"><i class="fa fa-check"></i><b>5.13</b> Finally: confidence intervals</a></li>
<li class="chapter" data-level="5.14" data-path="linear-regression.html"><a href="linear-regression.html#very-optional-extras"><i class="fa fa-check"></i><b>5.14</b> Very optional extras</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="linear-regression.html"><a href="linear-regression.html#making-functions"><i class="fa fa-check"></i><b>5.14.1</b> Making functions</a></li>
<li class="chapter" data-level="5.14.2" data-path="linear-regression.html"><a href="linear-regression.html#another-way-to-make-scatterplots-ggally"><i class="fa fa-check"></i><b>5.14.2</b> Another way to make scatterplots: GGally</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html"><i class="fa fa-check"></i><b>6</b> Linear regression diagnostics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#before-we-begin-1"><i class="fa fa-check"></i><b>6.1</b> Before we begin</a></li>
<li class="chapter" data-level="6.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#the-dataset-1"><i class="fa fa-check"></i><b>6.2</b> The dataset</a></li>
<li class="chapter" data-level="6.3" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#fit-a-regression-model"><i class="fa fa-check"></i><b>6.3</b> Fit a regression model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-18"><i class="fa fa-check"></i><b>6.3.1</b> Activity</a></li>
<li class="chapter" data-level="6.3.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-21"><i class="fa fa-check"></i><b>6.3.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-for-normally-distributed-residuals"><i class="fa fa-check"></i><b>6.4</b> Checking for normally distributed residuals</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#base-r-histogram"><i class="fa fa-check"></i><b>6.4.1</b> Base R histogram</a></li>
<li class="chapter" data-level="6.4.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#quantile-comparison-plot"><i class="fa fa-check"></i><b>6.4.2</b> Quantile-comparison plot</a></li>
<li class="chapter" data-level="6.4.3" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#statistical-test-of-normality"><i class="fa fa-check"></i><b>6.4.3</b> Statistical test of normality</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-constant-residual-variance"><i class="fa fa-check"></i><b>6.5</b> Checking constant residual variance</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-20"><i class="fa fa-check"></i><b>6.5.1</b> Activity</a></li>
<li class="chapter" data-level="6.5.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-23"><i class="fa fa-check"></i><b>6.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-for-relationships-between-residuals-and-predicted-outcome-or-predictors"><i class="fa fa-check"></i><b>6.6</b> Checking for relationships between residuals and predicted outcome or predictors</a></li>
<li class="chapter" data-level="6.7" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-linearity"><i class="fa fa-check"></i><b>6.7</b> Checking linearity</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#what-should-be-linear-in-a-linear-model"><i class="fa fa-check"></i><b>6.7.1</b> What should be linear in a linear model?</a></li>
<li class="chapter" data-level="6.7.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-for-linearity"><i class="fa fa-check"></i><b>6.7.2</b> Checking for linearity</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-influence-leave-one-out-analyses"><i class="fa fa-check"></i><b>6.8</b> Checking influence: leave-one-out analyses</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#residual-outliers"><i class="fa fa-check"></i><b>6.8.1</b> Residual outliers</a></li>
<li class="chapter" data-level="6.8.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#cooks-distance"><i class="fa fa-check"></i><b>6.8.2</b> Cook’s distance</a></li>
<li class="chapter" data-level="6.8.3" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#dfbeta-and-close-sibling-dfbetas"><i class="fa fa-check"></i><b>6.8.3</b> DFBETA and (close sibling) DFBETAS</a></li>
<li class="chapter" data-level="6.8.4" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#view-them-all"><i class="fa fa-check"></i><b>6.8.4</b> View them all</a></li>
<li class="chapter" data-level="6.8.5" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#so-er-what-should-we-do-with-potentially-influential-observations"><i class="fa fa-check"></i><b>6.8.5</b> So, er, what should we do with “potentially influential” observations…?</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-the-variance-inflation-factors-vifs"><i class="fa fa-check"></i><b>6.9</b> Checking the variance inflation factors (VIFs)</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-22"><i class="fa fa-check"></i><b>6.9.1</b> Activity</a></li>
<li class="chapter" data-level="6.9.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-25"><i class="fa fa-check"></i><b>6.9.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#the-challenge"><i class="fa fa-check"></i><b>6.10</b> The challenge</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-23"><i class="fa fa-check"></i><b>6.10.1</b> Activity</a></li>
<li class="chapter" data-level="6.10.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-26"><i class="fa fa-check"></i><b>6.10.2</b> Answer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html"><i class="fa fa-check"></i><b>7</b> Categorical predictors and interactions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#before-we-begin-2"><i class="fa fa-check"></i><b>7.1</b> Before we begin</a></li>
<li class="chapter" data-level="7.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#the-dataset-2"><i class="fa fa-check"></i><b>7.2</b> The dataset</a></li>
<li class="chapter" data-level="7.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#factors"><i class="fa fa-check"></i><b>7.3</b> Factors</a></li>
<li class="chapter" data-level="7.4" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#visualising-the-data"><i class="fa fa-check"></i><b>7.4</b> Visualising the data</a></li>
<li class="chapter" data-level="7.5" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#the-punchline-occupation-type-does-predict-prestige"><i class="fa fa-check"></i><b>7.5</b> The punchline: occupation type does predict prestige</a></li>
<li class="chapter" data-level="7.6" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#understanding-factors-in-regression-models"><i class="fa fa-check"></i><b>7.6</b> Understanding factors in regression models</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#how-are-categorical-variables-encoded"><i class="fa fa-check"></i><b>7.6.1</b> How are categorical variables encoded?</a></li>
<li class="chapter" data-level="7.6.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#how-are-binary-two-level-categorical-predictors-encoded"><i class="fa fa-check"></i><b>7.6.2</b> How are binary (two-level) categorical predictors encoded?</a></li>
<li class="chapter" data-level="7.6.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#categorical-predictors-with-3-or-more-levels"><i class="fa fa-check"></i><b>7.6.3</b> Categorical predictors with 3 or more levels</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#interpreting-the-coefficients"><i class="fa fa-check"></i><b>7.7</b> Interpreting the coefficients</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#activity-25"><i class="fa fa-check"></i><b>7.7.1</b> Activity</a></li>
<li class="chapter" data-level="7.7.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#answer-28"><i class="fa fa-check"></i><b>7.7.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#checking-all-combinations"><i class="fa fa-check"></i><b>7.8</b> Checking all combinations</a></li>
<li class="chapter" data-level="7.9" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#the-intercept-is-not-always-the-mean-of-the-comparison-group"><i class="fa fa-check"></i><b>7.9</b> The intercept is not always the mean of the comparison group</a></li>
<li class="chapter" data-level="7.10" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#recap"><i class="fa fa-check"></i><b>7.10</b> Recap</a></li>
<li class="chapter" data-level="7.11" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#challenge"><i class="fa fa-check"></i><b>7.11</b> Challenge</a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#activity-26"><i class="fa fa-check"></i><b>7.11.1</b> Activity</a></li>
<li class="chapter" data-level="7.11.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#answers-1"><i class="fa fa-check"></i><b>7.11.2</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#brief-introduction-to-interactions"><i class="fa fa-check"></i><b>7.12</b> Brief introduction to interactions</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#what-is-an-interaction"><i class="fa fa-check"></i><b>7.12.1</b> What is an interaction?</a></li>
<li class="chapter" data-level="7.12.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#how-to-test-for-interactions-in-r"><i class="fa fa-check"></i><b>7.12.2</b> How to test for interactions in R</a></li>
<li class="chapter" data-level="7.12.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#understanding-interactions"><i class="fa fa-check"></i><b>7.12.3</b> Understanding interactions</a></li>
<li class="chapter" data-level="7.12.4" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#further-reading-1"><i class="fa fa-check"></i><b>7.12.4</b> Further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>8</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="8.1" data-path="logistic-regression.html"><a href="logistic-regression.html#setup"><i class="fa fa-check"></i><b>8.1</b> Setup</a></li>
<li class="chapter" data-level="8.2" data-path="logistic-regression.html"><a href="logistic-regression.html#the-dataset-3"><i class="fa fa-check"></i><b>8.2</b> The dataset</a></li>
<li class="chapter" data-level="8.3" data-path="logistic-regression.html"><a href="logistic-regression.html#warmup-activity"><i class="fa fa-check"></i><b>8.3</b> Warmup activity</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#activity-27"><i class="fa fa-check"></i><b>8.3.1</b> Activity</a></li>
<li class="chapter" data-level="8.3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#answer-29"><i class="fa fa-check"></i><b>8.3.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="logistic-regression.html"><a href="logistic-regression.html#the-punchline"><i class="fa fa-check"></i><b>8.4</b> The punchline</a></li>
<li class="chapter" data-level="8.5" data-path="logistic-regression.html"><a href="logistic-regression.html#intermezzo-parametric-versus-nonparametric"><i class="fa fa-check"></i><b>8.5</b> Intermezzo: parametric versus nonparametric</a></li>
<li class="chapter" data-level="8.6" data-path="logistic-regression.html"><a href="logistic-regression.html#glms"><i class="fa fa-check"></i><b>8.6</b> What is a generalised linear model?</a></li>
<li class="chapter" data-level="8.7" data-path="logistic-regression.html"><a href="logistic-regression.html#what-is-the-log-function-again"><i class="fa fa-check"></i><b>8.7</b> What is the log function again…?</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="logistic-regression.html"><a href="logistic-regression.html#log-arithmetic"><i class="fa fa-check"></i><b>8.7.1</b> The arithmetic</a></li>
<li class="chapter" data-level="8.7.2" data-path="logistic-regression.html"><a href="logistic-regression.html#why-log"><i class="fa fa-check"></i><b>8.7.2</b> Why log?</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="logistic-regression.html"><a href="logistic-regression.html#intercept-only-models-again"><i class="fa fa-check"></i><b>8.8</b> Intercept-only models again</a></li>
<li class="chapter" data-level="8.9" data-path="logistic-regression.html"><a href="logistic-regression.html#odds-and-log-odds"><i class="fa fa-check"></i><b>8.9</b> Odds and log odds</a></li>
<li class="chapter" data-level="8.10" data-path="logistic-regression.html"><a href="logistic-regression.html#back-to-that-intercept"><i class="fa fa-check"></i><b>8.10</b> Back to that intercept</a></li>
<li class="chapter" data-level="8.11" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-slopes"><i class="fa fa-check"></i><b>8.11</b> Interpreting model slopes</a>
<ul>
<li class="chapter" data-level="8.11.1" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-on-the-log-odds-scale"><i class="fa fa-check"></i><b>8.11.1</b> Interpret on the log-odds scale</a></li>
<li class="chapter" data-level="8.11.2" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-using-the-divide-by-4-approximation"><i class="fa fa-check"></i><b>8.11.2</b> Interpret using the “divide-by-4” approximation</a></li>
<li class="chapter" data-level="8.11.3" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-using-odds"><i class="fa fa-check"></i><b>8.11.3</b> Interpret using odds</a></li>
<li class="chapter" data-level="8.11.4" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-using-predicted-probabilities"><i class="fa fa-check"></i><b>8.11.4</b> Interpret using predicted probabilities</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="logistic-regression.html"><a href="logistic-regression.html#diagnostics"><i class="fa fa-check"></i><b>8.12</b> Diagnostics</a>
<ul>
<li class="chapter" data-level="8.12.1" data-path="logistic-regression.html"><a href="logistic-regression.html#check-the-residual-distribution"><i class="fa fa-check"></i><b>8.12.1</b> Check the residual distribution</a></li>
<li class="chapter" data-level="8.12.2" data-path="logistic-regression.html"><a href="logistic-regression.html#check-that-the-residual-mean-is-constant"><i class="fa fa-check"></i><b>8.12.2</b> Check that the residual mean is constant</a></li>
<li class="chapter" data-level="8.12.3" data-path="logistic-regression.html"><a href="logistic-regression.html#linearity-of-predictors"><i class="fa fa-check"></i><b>8.12.3</b> Linearity of predictors</a></li>
<li class="chapter" data-level="8.12.4" data-path="logistic-regression.html"><a href="logistic-regression.html#influence"><i class="fa fa-check"></i><b>8.12.4</b> Influence</a></li>
<li class="chapter" data-level="8.12.5" data-path="logistic-regression.html"><a href="logistic-regression.html#multicolinearity"><i class="fa fa-check"></i><b>8.12.5</b> Multicolinearity</a></li>
</ul></li>
<li class="chapter" data-level="8.13" data-path="logistic-regression.html"><a href="logistic-regression.html#a-challenge"><i class="fa fa-check"></i><b>8.13</b> A challenge</a>
<ul>
<li class="chapter" data-level="8.13.1" data-path="logistic-regression.html"><a href="logistic-regression.html#activity-31"><i class="fa fa-check"></i><b>8.13.1</b> Activity</a></li>
<li class="chapter" data-level="8.13.2" data-path="logistic-regression.html"><a href="logistic-regression.html#an-answer"><i class="fa fa-check"></i><b>8.13.2</b> (An) Answer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="complex-surveys.html"><a href="complex-surveys.html"><i class="fa fa-check"></i><b>9</b> Complex surveys</a>
<ul>
<li class="chapter" data-level="9.1" data-path="complex-surveys.html"><a href="complex-surveys.html#readings"><i class="fa fa-check"></i><b>9.1</b> Readings</a></li>
<li class="chapter" data-level="9.2" data-path="complex-surveys.html"><a href="complex-surveys.html#the-dataset-4"><i class="fa fa-check"></i><b>9.2</b> The dataset</a></li>
<li class="chapter" data-level="9.3" data-path="complex-surveys.html"><a href="complex-surveys.html#the-components-of-a-survey-design"><i class="fa fa-check"></i><b>9.3</b> The components of a survey design</a></li>
<li class="chapter" data-level="9.4" data-path="complex-surveys.html"><a href="complex-surveys.html#describing-the-data"><i class="fa fa-check"></i><b>9.4</b> Describing the data</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="complex-surveys.html"><a href="complex-surveys.html#activity-32"><i class="fa fa-check"></i><b>9.4.1</b> Activity</a></li>
<li class="chapter" data-level="9.4.2" data-path="complex-surveys.html"><a href="complex-surveys.html#answer-33"><i class="fa fa-check"></i><b>9.4.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="complex-surveys.html"><a href="complex-surveys.html#fitting-a-glm"><i class="fa fa-check"></i><b>9.5</b> Fitting a GLM</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="complex-surveys.html"><a href="complex-surveys.html#activity-33"><i class="fa fa-check"></i><b>9.5.1</b> Activity</a></li>
<li class="chapter" data-level="9.5.2" data-path="complex-surveys.html"><a href="complex-surveys.html#answer-34"><i class="fa fa-check"></i><b>9.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="complex-surveys.html"><a href="complex-surveys.html#slopes"><i class="fa fa-check"></i><b>9.6</b> Slopes</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="complex-surveys.html"><a href="complex-surveys.html#activity-34"><i class="fa fa-check"></i><b>9.6.1</b> Activity</a></li>
<li class="chapter" data-level="9.6.2" data-path="complex-surveys.html"><a href="complex-surveys.html#answer-35"><i class="fa fa-check"></i><b>9.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="complex-surveys.html"><a href="complex-surveys.html#diagnostics-1"><i class="fa fa-check"></i><b>9.7</b> Diagnostics</a></li>
<li class="chapter" data-level="9.8" data-path="complex-surveys.html"><a href="complex-surveys.html#another-worked-example-the-european-social-survey"><i class="fa fa-check"></i><b>9.8</b> Another worked example: the European Social Survey</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="complex-surveys.html"><a href="complex-surveys.html#set-up-the-survey-object"><i class="fa fa-check"></i><b>9.8.1</b> Set up the survey object</a></li>
<li class="chapter" data-level="9.8.2" data-path="complex-surveys.html"><a href="complex-surveys.html#try-the-analysis"><i class="fa fa-check"></i><b>9.8.2</b> Try the analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>10</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R for social research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="complex-surveys" class="section level1" number="9">
<h1><span class="header-section-number">Chapter 9</span> Complex surveys</h1>
<p>By the end of this chapter you will know how to:</p>
<ul>
<li>Setup a survey object using complex survey information such as sampling weight and stratification variables.</li>
<li>Use a tidyverse-esq approach for descriptive statistics.</li>
<li>Fit a GLM (logistic).</li>
</ul>
<p>We will use the <code>survey</code> package and a tidyverse-style wrapper called <code>srvyr</code>.</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="complex-surveys.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb576-2"><a href="complex-surveys.html#cb576-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(srvyr)</span></code></pre></div>
<div id="readings" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Readings</h2>
<p>These are handy:</p>
<ul>
<li><a href="https://cran.r-project.org/web/packages/srvyr/vignettes/srvyr-vs-survey.html"><code>srvyr</code> compared to the <code>survey</code> package</a> explains a way to use survey data in the tidyverse.</li>
<li>Fox and Weisberg’s online appendix, <a href="https://socialsciences.mcmaster.ca/jfox/Books/Companion/appendices/Appendix-Surveys.pdf">Fitting Regression Models to Data From Complex Surveys</a>.</li>
<li>The main reference for the models implemented by <code>survey</code> is the (expensive) book by Lumley (2010).</li>
<li>UCLA has <a href="https://stats.idre.ucla.edu/r/seminars/survey-data-analysis-with-r/">extensive notes</a> from a 2020 seminar on survey analysis.</li>
<li><a href="https://medium.com/pew-research-center-decoded/analyzing-international-survey-data-with-the-pewmethods-r-package-3b0b21cba607">Analyzing international survey data with the pewmethods R package</a>, by Kat Devlin, explains an alternative way to use weights for descriptive stats.</li>
</ul>
</div>
<div id="the-dataset-4" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> The dataset</h2>
<p>This chapter’s dataset is drawn from the 2011 Canadian National Election Study – taken from the <code>carData</code> package and described by the Fox and Weisberg appendix cited above. <a href="./ces11.csv">Download it here</a>.</p>
<p>There are 2231 observations on the following 9 variables:</p>
<table>
<colgroup>
<col width="53%" />
<col width="46%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>id</td>
<td>Household ID number.</td>
</tr>
<tr class="even">
<td>province</td>
<td>a factor with (alphabetical) levels <code>AB</code>, <code>BC</code>, <code>MB</code>, <code>NB</code>, <code>NL</code>, <code>NS</code>, <code>ON</code>, <code>PE</code>, <code>QC</code>, <code>SK</code>; the sample was stratified by province.</td>
</tr>
<tr class="odd">
<td>population</td>
<td>population of the respondent’s province, number over age 17.</td>
</tr>
<tr class="even">
<td>weight</td>
<td>weight sample to size of population, taking into account unequal sampling probabilities by province and household size.</td>
</tr>
<tr class="odd">
<td>gender</td>
<td>a factor with levels <code>Female</code>, <code>Male</code>.</td>
</tr>
<tr class="even">
<td>abortion</td>
<td>attitude toward abortion, a factor with levels <code>No</code>, <code>Yes</code>; answer to the question “Should abortion be banned?”</td>
</tr>
<tr class="odd">
<td>importance</td>
<td>importance of religion, a factor with (alphabetical) levels <code>not</code>, <code>notvery</code>, <code>somewhat</code>, <code>very</code>; answer to the question, “In your life, would you say that religion is very important, somewhat important, not very important, or not important at all?”</td>
</tr>
<tr class="even">
<td>education</td>
<td>a factor with (alphabetical) levels <code>bachelors</code> (Bachelors degree), <code>college</code> (community college or technical school), <code>higher</code> (graduate degree), <code>HS</code> (high-school graduate), <code>lessHS</code> (less than high-school graduate), <code>somePS</code> (some post-secondary).</td>
</tr>
<tr class="odd">
<td>urban</td>
<td>place of residence, a factor with levels rural, urban.</td>
</tr>
</tbody>
</table>
<p>Read in the data.</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="complex-surveys.html#cb577-1" aria-hidden="true" tabindex="-1"></a>ces <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;ces11.csv&quot;</span>, <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>I’m setting <code>stringsAsFactors</code> to <code>TRUE</code> so that the variables which are obviously factors are setup accordingly (R used to this by default; sometimes it had irritating side-effects).</p>
</div>
<div id="the-components-of-a-survey-design" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> The components of a survey design</h2>
<p>The key parts of the dataset which describe the survey design are as follows:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="complex-surveys.html#cb578-1" aria-hidden="true" tabindex="-1"></a>ces <span class="sc">%&gt;%</span> <span class="fu">select</span>(id, province, population, weight) <span class="sc">%&gt;%</span></span>
<span id="cb578-2"><a href="complex-surveys.html#cb578-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">6</span>)</span></code></pre></div>
<pre><code>##     id province population  weight
## 1 2851       BC    3267345 4287.85
## 2  521       QC    5996930 9230.78
## 3 2118       QC    5996930 6153.85
## 4 1815       NL     406455 3430.00
## 5 1799       ON    9439960 8977.61
## 6 1103       ON    9439960 8977.61</code></pre>
<ul>
<li><code>id</code> is a unique identifier for each individual, which is particularly important when there is more than one data point per person, e.g., for multilevel modelling (not in this dataset).</li>
<li><code>province</code> the data were stratified by province – random sampling by landline numbers was done within province.</li>
<li><code>population</code> provides the population by province.</li>
<li><code>weight</code> is the sampling weight, in this dataset calculated based on differences in province population, the study sample size therein, and household size.</li>
</ul>
<p>Here is how to setup a survey object using <code>srvyr</code>:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="complex-surveys.html#cb580-1" aria-hidden="true" tabindex="-1"></a>ces_s <span class="ot">&lt;-</span> ces <span class="sc">%&gt;%</span></span>
<span id="cb580-2"><a href="complex-surveys.html#cb580-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey</span>(<span class="at">ids =</span> id,</span>
<span id="cb580-3"><a href="complex-surveys.html#cb580-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">strata =</span> province,</span>
<span id="cb580-4"><a href="complex-surveys.html#cb580-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">fpc =</span> population,</span>
<span id="cb580-5"><a href="complex-surveys.html#cb580-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">weights =</span> weight)</span></code></pre></div>
</div>
<div id="describing-the-data" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Describing the data</h2>
<p>We will sometimes want to compare weighted and unweighted analyses. Here is a warmup activity to show how using the tidyverse.</p>
<div id="activity-32" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Activity</h3>
<ol style="list-style-type: lower-alpha">
<li>use the <code>ces</code> data frame and <code>tidyverse</code> to calculate the number of people who think abortion should be banned</li>
<li>do the same again, but this time use the <code>ces_s</code> survey object created above – what do you notice?</li>
<li>compare the proportions saying <code>yes</code> by group</li>
</ol>
<p><strong>Hint:</strong> you will want to use <code>group_by</code>.</p>
<p><strong>Another hint:</strong> to count, use the function <code>n</code>. The version for survey objects is called <code>survey_total</code>.</p>
</div>
<div id="answer-33" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Answer</h3>
<p><strong>a. use the <code>ces</code> data frame and <code>tidyverse</code> to calculate the number of people who think abortion should be banned</strong></p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="complex-surveys.html#cb581-1" aria-hidden="true" tabindex="-1"></a>ces <span class="sc">%&gt;%</span></span>
<span id="cb581-2"><a href="complex-surveys.html#cb581-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(abortion) <span class="sc">%&gt;%</span></span>
<span id="cb581-3"><a href="complex-surveys.html#cb581-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   abortion     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 No        1818
## 2 Yes        413</code></pre>
<p><strong>b. do the same again, but this time use the <code>ces_s</code> survey object created above – what do you notice?</strong></p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb584-1"><a href="complex-surveys.html#cb584-1" aria-hidden="true" tabindex="-1"></a>ces_s <span class="sc">%&gt;%</span></span>
<span id="cb584-2"><a href="complex-surveys.html#cb584-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(abortion) <span class="sc">%&gt;%</span></span>
<span id="cb584-3"><a href="complex-surveys.html#cb584-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">survey_total</span>())</span></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   abortion         n    n_se
##   &lt;fct&gt;        &lt;dbl&gt;   &lt;dbl&gt;
## 1 No       13059520. 196984.
## 2 Yes       2964018. 162360.</code></pre>
<p>The counts are much bigger than the number of rows in the dataset due to the sampling weights.</p>
<p><strong>c. compare the proportions saying <code>yes</code> by group</strong></p>
<p>One way to do this is by copy and paste!</p>
<p>Unweighted:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="complex-surveys.html#cb586-1" aria-hidden="true" tabindex="-1"></a>prop_unweighted <span class="ot">&lt;-</span> <span class="dv">413</span> <span class="sc">/</span> (<span class="dv">413</span> <span class="sc">+</span> <span class="dv">1818</span>)</span>
<span id="cb586-2"><a href="complex-surveys.html#cb586-2" aria-hidden="true" tabindex="-1"></a>prop_unweighted</span></code></pre></div>
<pre><code>## [1] 0.1851188</code></pre>
<p>Weighted:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="complex-surveys.html#cb588-1" aria-hidden="true" tabindex="-1"></a>prop_weighted <span class="ot">&lt;-</span> <span class="dv">2964018</span> <span class="sc">/</span> (<span class="dv">2964018</span> <span class="sc">+</span>   <span class="dv">13059520</span>)</span>
<span id="cb588-2"><a href="complex-surveys.html#cb588-2" aria-hidden="true" tabindex="-1"></a>prop_weighted</span></code></pre></div>
<pre><code>## [1] 0.184979</code></pre>
<p>The unweighted proportion of “yes” is only a little different in this case: 0.1851188 (unweighted) v 0.184979 (weighted).</p>
<p>Here’s how to answer the questions in one go:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="complex-surveys.html#cb590-1" aria-hidden="true" tabindex="-1"></a>ces_s <span class="sc">%&gt;%</span></span>
<span id="cb590-2"><a href="complex-surveys.html#cb590-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(abortion) <span class="sc">%&gt;%</span></span>
<span id="cb590-3"><a href="complex-surveys.html#cb590-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_raw =</span> <span class="fu">unweighted</span>(<span class="fu">n</span>()),</span>
<span id="cb590-4"><a href="complex-surveys.html#cb590-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_weighted =</span> <span class="fu">survey_total</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb590-5"><a href="complex-surveys.html#cb590-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_raw =</span> n_raw <span class="sc">/</span> <span class="fu">sum</span>(n_raw),</span>
<span id="cb590-6"><a href="complex-surveys.html#cb590-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">prop_weighted =</span> n_weighted <span class="sc">/</span> <span class="fu">sum</span>(n_weighted)) <span class="sc">%&gt;%</span></span>
<span id="cb590-7"><a href="complex-surveys.html#cb590-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>n_weighted_se)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   abortion n_raw n_weighted prop_raw prop_weighted
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
## 1 No        1818  13059520.    0.815         0.815
## 2 Yes        413   2964018.    0.185         0.185</code></pre>
</div>
</div>
<div id="fitting-a-glm" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Fitting a GLM</h2>
<p>The <code>survey</code> package makes this very easy. There is a command called <code>svyglm</code> which is identical to <code>glm</code> except it has parameter called <code>design</code> instead of <code>data</code>.</p>
<p>See <code>?svyglm</code></p>
<div id="activity-33" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> Activity</h3>
<ol style="list-style-type: lower-alpha">
<li><code>mutate</code> the survey object to add a binary variable called <code>againstAbortion</code> which is 1 if the participant is against abortion and 0 if not.</li>
<li>fit an intercept-only logistic regression model without using weights (you can use <code>as_tibble</code> to get the “raw” data frame hidden within the survey object).</li>
<li>Do the same again, this time using the survey structure.</li>
<li>compare the predicted proportions with the “raw” proportions we calculated earlier</li>
</ol>
</div>
<div id="answer-34" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> Answer</h3>
<p><strong>a. <code>mutate</code> the survey object to add a binary variable called <code>againstAbortion</code> which is 1 if the participant is against abortion and 0 if not.</strong></p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="complex-surveys.html#cb592-1" aria-hidden="true" tabindex="-1"></a>ces_s <span class="ot">&lt;-</span> ces_s <span class="sc">%&gt;%</span></span>
<span id="cb592-2"><a href="complex-surveys.html#cb592-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">againstAbortion =</span> <span class="fu">as.numeric</span>(ces<span class="sc">$</span>abortion <span class="sc">==</span> <span class="st">&quot;Yes&quot;</span>))</span></code></pre></div>
<p><strong>b. fit an intercept-only logistic regression model without using weights (you can use <code>as_tibble</code> to get the “raw” data frame hidden within the survey object).</strong></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="complex-surveys.html#cb593-1" aria-hidden="true" tabindex="-1"></a>m0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(againstAbortion <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb593-2"><a href="complex-surveys.html#cb593-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> <span class="fu">as_tibble</span>(ces_s),</span>
<span id="cb593-3"><a href="complex-surveys.html#cb593-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> binomial)</span>
<span id="cb593-4"><a href="complex-surveys.html#cb593-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m0)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = againstAbortion ~ 1, family = binomial, data = as_tibble(ces_s))
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -0.6399  -0.6399  -0.6399  -0.6399   1.8367  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) -1.48204    0.05451  -27.19   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 2137.6  on 2230  degrees of freedom
## Residual deviance: 2137.6  on 2230  degrees of freedom
## AIC: 2139.6
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><strong>c. Do the same again, this time using the survey structure.</strong></p>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb595-1"><a href="complex-surveys.html#cb595-1" aria-hidden="true" tabindex="-1"></a>sm0 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(againstAbortion <span class="sc">~</span> <span class="dv">1</span>, <span class="at">design =</span> ces_s,</span>
<span id="cb595-2"><a href="complex-surveys.html#cb595-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial)</span></code></pre></div>
<pre><code>## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="complex-surveys.html#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sm0)</span></code></pre></div>
<pre><code>## 
## Call:
## svyglm(formula = againstAbortion ~ 1, design = ces_s, family = binomial)
## 
## Survey design:
## Called via srvyr
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -1.48297    0.06534   -22.7   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1.000448)
## 
## Number of Fisher Scoring iterations: 4</code></pre>
<p><strong>d. compare the predicted proportions with the “raw” proportions we calculated earlier</strong></p>
<p>This undoes the log-odds (logit) transform:</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="complex-surveys.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(m0)) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fu">coef</span>(m0)))</span></code></pre></div>
<pre><code>## (Intercept) 
##   0.1851188</code></pre>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="complex-surveys.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(sm0)) <span class="sc">/</span> (<span class="dv">1</span><span class="sc">+</span><span class="fu">exp</span>(<span class="fu">coef</span>(sm0)))</span></code></pre></div>
<pre><code>## (Intercept) 
##    0.184979</code></pre>
<p>The answer is the same as for the simple unweighted and weighted proportions, respectively.</p>
</div>
</div>
<div id="slopes" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Slopes</h2>
<p>Now, having completed the traditional step of fitting an intercept-only model, we can give the slopes a go.</p>
<p>The <code>Anova</code> command in the <code>car</code> package works for <code>svyglm</code> models as before.</p>
<div id="activity-34" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> Activity</h3>
<p>Regress <code>againstAbortion</code> on <code>importance</code>, <code>education</code>, and <code>gender</code>, and interpret what you find.</p>
</div>
<div id="answer-35" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Answer</h3>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="complex-surveys.html#cb603-1" aria-hidden="true" tabindex="-1"></a>sm1 <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(againstAbortion <span class="sc">~</span> importance <span class="sc">+</span> education <span class="sc">+</span> gender,</span>
<span id="cb603-2"><a href="complex-surveys.html#cb603-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">design =</span> ces_s,</span>
<span id="cb603-3"><a href="complex-surveys.html#cb603-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> binomial)</span></code></pre></div>
<pre><code>## Warning in eval(family$initialize): non-integer #successes in a binomial glm!</code></pre>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="complex-surveys.html#cb605-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sm1)</span></code></pre></div>
<pre><code>## 
## Call:
## svyglm(formula = againstAbortion ~ importance + education + gender, 
##     design = ces_s, family = binomial)
## 
## Survey design:
## Called via srvyr
## 
## Coefficients:
##                    Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)         -3.8204     0.2962 -12.897  &lt; 2e-16 ***
## importancenotvery    0.4606     0.3481   1.323   0.1858    
## importancesomewhat   1.3287     0.2715   4.894 1.06e-06 ***
## importancevery       3.1405     0.2619  11.993  &lt; 2e-16 ***
## educationcollege     0.4452     0.2278   1.954   0.0508 .  
## educationhigher      0.3301     0.3046   1.084   0.2786    
## educationHS          0.5692     0.2269   2.508   0.0122 *  
## educationlessHS      1.0307     0.2468   4.177 3.07e-05 ***
## educationsomePS      0.1439     0.2806   0.513   0.6081    
## genderMale           0.3299     0.1482   2.225   0.0261 *  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 0.973961)
## 
## Number of Fisher Scoring iterations: 5</code></pre>
<p>To interpret those categorical predictors, it will help to check what the levels are:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="complex-surveys.html#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ces<span class="sc">$</span>importance)</span></code></pre></div>
<pre><code>## [1] &quot;not&quot;      &quot;notvery&quot;  &quot;somewhat&quot; &quot;very&quot;</code></pre>
<p>So “not” is the comparison level.</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="complex-surveys.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(ces<span class="sc">$</span>education) </span></code></pre></div>
<pre><code>## [1] &quot;bachelors&quot; &quot;college&quot;   &quot;higher&quot;    &quot;HS&quot;        &quot;lessHS&quot;    &quot;somePS&quot;</code></pre>
<p>“bachelors” is the comparison level.</p>
<p>Gender is just a binary.</p>
<p>Example interpretations:</p>
<ul>
<li><p>Men were more likely to be against abortion (log-odds 0.33 more)</p></li>
<li><p>People for whom religion was very important were more likely than those who said “not important at all” to be against abortion (log-odds 3.14)</p></li>
</ul>
<p>You could get the odds ratios like so:</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="complex-surveys.html#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(sm1)) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##        (Intercept)  importancenotvery importancesomewhat     importancevery 
##               0.02               1.59               3.78              23.12 
##   educationcollege    educationhigher        educationHS    educationlessHS 
##               1.56               1.39               1.77               2.80 
##    educationsomePS         genderMale 
##               1.15               1.39</code></pre>
<p>So the odds ratio of “very” versus “not” important is 23.1.</p>
<p>The <code>ggeffects</code> package also works with <code>survey</code> models (hurrah):</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb613-1"><a href="complex-surveys.html#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span>
<span id="cb613-2"><a href="complex-surveys.html#cb613-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggeffect</span>(sm1, <span class="at">terms =</span> <span class="fu">c</span>(<span class="st">&quot;education&quot;</span>, <span class="st">&quot;importance&quot;</span>))  <span class="sc">%&gt;%</span></span>
<span id="cb613-3"><a href="complex-surveys.html#cb613-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>() <span class="sc">+</span></span>
<span id="cb613-4"><a href="complex-surveys.html#cb613-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-406-1.png" width="672" /></p>
</div>
</div>
<div id="diagnostics-1" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Diagnostics</h2>
<p>Many of the diagnostic checks we previously encountered work here too.</p>
<p>Here are the VIFs:</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="complex-surveys.html#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(sm1)</span></code></pre></div>
<pre><code>##                GVIF Df GVIF^(1/(2*Df))
## importance 1.052799  3        1.008612
## education  1.066741  5        1.006482
## gender     1.039299  1        1.019460</code></pre>
<p>My favorite, the DFBETA plots:</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="complex-surveys.html#cb616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dfbetaPlots</span>(sm1)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-408-1.png" width="576" /></p>
<p>Try also:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="complex-surveys.html#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="fu">influence.measures</span>(sm1)</span></code></pre></div>
</div>
<div id="another-worked-example-the-european-social-survey" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> Another worked example: the European Social Survey</h2>
<p>NatCen recently <a href="https://www.bsa.natcen.ac.uk/latest-report/british-social-attitudes-37/fairness-and-justice-in-britain.aspx">published</a> analyses of views on fairness and justice in Britain (Curtice, Hudson, &amp; Montagu, 2020), using data from the ninth wave of the 2019 European Social Survey (European Social Survey Round 9 Data, 2018).</p>
<p>Let’s see if we can replicate the results.</p>
<p>Firstly, you will have to download the data from <a href="https://www.europeansocialsurvey.org/data/download.html?r=9">the ESS website</a>. Go for the SPSS version. (You will have to register but it is a very quick process.) It will arrive as a zip file (<code>ESS9e02.spss.zip</code>). Simply extract the SPSS file therein (<code>ESS9e02.sav</code>) and move it to the same folder as your Markdown file.</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="complex-surveys.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb618-2"><a href="complex-surveys.html#cb618-2" aria-hidden="true" tabindex="-1"></a>ess9 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">&quot;ESS9e02.sav&quot;</span>)</span></code></pre></div>
<p>Try having a look:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb619-1"><a href="complex-surveys.html#cb619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(ess9)</span></code></pre></div>
<p>Okay, if that has worked then the next problem is finding the variables we want to analyse!</p>
<p>The report opens with a spotlight figure:</p>
<blockquote>
<p>Only 20% of the British public think that differences in wealth in Britain are fair, whilst a majority (59%) think that wealth differences in Britain are unfairly large and a further 16% think that differences in wealth are unfairly small.</p>
</blockquote>
<p>The question asked was:</p>
<blockquote>
<p>In your opinion, are differences in wealth in Britain unfairly small, fair, or unfairly large?</p>
</blockquote>
<p>It’s a good exercise to spend some time wading through the documentation on the ESS website to find the variable name, before looking at the answer below…</p>
<p>We will also need the variable for country (easier to spot) and any information required for setting up the survey object. The ESS website helpfully advises:</p>
<blockquote>
<p>In general, you must weight tables before quoting percentages from them. The Design weights (DWEIGHT) adjust for different selection probabilities, while the Post-stratification weights (PSPWGHT) adjust for sampling error and non-response bias as well as different selection probabilities. Either DWEIGHT or PSPWGHT must always be used. In addition, the Population size weights (PWEIGHT) should be applied if you are looking at aggregates or averages for two or more countries combined. See the guide Weighting European Social Survey Data for fuller details about which weights to use.</p>
</blockquote>
<p>This also links to a guide to <a href="https://www.europeansocialsurvey.org/docs/methodology/ESS_weighting_data_1_1.pdf">weighting the data</a>.</p>
<p>It’s also worth printing all the variable names – if only to spot that they have ended up in lower case.</p>
<div id="set-up-the-survey-object" class="section level3" number="9.8.1">
<h3><span class="header-section-number">9.8.1</span> Set up the survey object</h3>
<p>First, I’m going to fix the country variable. It currently looks like:</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="complex-surveys.html#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ess9<span class="sc">$</span>cntry)</span></code></pre></div>
<pre><code>## 
##   AT   BE   BG   CH   CY   CZ   DE   EE   ES   FI   FR   GB   HR   HU   IE   IT 
## 2499 1767 2198 1542  781 2398 2358 1904 1668 1755 2010 2204 1810 1661 2216 2745 
##   LT   LV   ME   NL   NO   PL   PT   RS   SE   SI   SK 
## 1835  918 1200 1673 1406 1500 1055 2043 1539 1318 1083</code></pre>
<p>But the dataset also has nicer labels included, which we can get like this using the <code>as_factor</code> function (note the underscore). This function is in the <code>haven</code> package.</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="complex-surveys.html#cb622-1" aria-hidden="true" tabindex="-1"></a>ess9<span class="sc">$</span>cntry <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(ess9<span class="sc">$</span>cntry, <span class="at">levels =</span> <span class="st">&quot;labels&quot;</span>)</span>
<span id="cb622-2"><a href="complex-surveys.html#cb622-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(ess9<span class="sc">$</span>cntry)</span></code></pre></div>
<pre><code>## 
## United Kingdom        Belgium        Germany        Estonia        Ireland 
##           2204           1767           2358           1904           2216 
##     Montenegro         Sweden       Bulgaria    Switzerland        Finland 
##           1200           1539           2198           1542           1755 
##       Slovenia       Slovakia    Netherlands         Poland         Norway 
##           1318           1083           1673           1500           1406 
##         France        Croatia          Spain         Serbia        Austria 
##           2010           1810           1668           2043           2499 
##          Italy      Lithuania       Portugal        Hungary         Latvia 
##           2745           1835           1055           1661            918 
##         Cyprus        Czechia 
##            781           2398</code></pre>
<p>Now let’s setup the survey object:</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="complex-surveys.html#cb624-1" aria-hidden="true" tabindex="-1"></a>ess9_survey <span class="ot">&lt;-</span> ess9 <span class="sc">%&gt;%</span></span>
<span id="cb624-2"><a href="complex-surveys.html#cb624-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_survey_design</span>(<span class="at">ids =</span> idno,</span>
<span id="cb624-3"><a href="complex-surveys.html#cb624-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">strata =</span> cntry,</span>
<span id="cb624-4"><a href="complex-surveys.html#cb624-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nest =</span> <span class="cn">TRUE</span>,</span>
<span id="cb624-5"><a href="complex-surveys.html#cb624-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">weights =</span> pspwght)</span></code></pre></div>
<p>The <code>nest</code> option takes account of the <code>ids</code> being nested within strata: in other words the same ID is used more than once across the dataset but only once in a country.</p>
</div>
<div id="try-the-analysis" class="section level3" number="9.8.2">
<h3><span class="header-section-number">9.8.2</span> Try the analysis</h3>
<p>The country variable is <code>cntry</code> and the wealth variable is <code>wltdffr</code>, which I spotted with the help of the <a href="https://www.europeansocialsurvey.org/docs/round9/survey/ESS9_appendix_a7_e02_0.pdf">code book</a>.</p>
<p>The first thing you will spot is that the original variable is coded from -4 to 4:</p>
<table>
<thead>
<tr class="header">
<th>Code</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-4</td>
<td>Small, extremely unfair</td>
</tr>
<tr class="even">
<td>-3</td>
<td>Small, very unfair</td>
</tr>
<tr class="odd">
<td>-2</td>
<td>Small, somewhat unfair</td>
</tr>
<tr class="even">
<td>-1</td>
<td>Small, slightly unfair</td>
</tr>
<tr class="odd">
<td>0</td>
<td>Fair</td>
</tr>
<tr class="even">
<td>1</td>
<td>Large, slightly unfair</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Large, somewhat unfair</td>
</tr>
<tr class="even">
<td>3</td>
<td>Large, very unfair</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Large, extremely unfair</td>
</tr>
</tbody>
</table>
<p>So let’s create another variable which is grouped as per the NatCen report:</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="complex-surveys.html#cb625-1" aria-hidden="true" tabindex="-1"></a>ess9_survey <span class="ot">&lt;-</span> ess9_survey <span class="sc">%&gt;%</span></span>
<span id="cb625-2"><a href="complex-surveys.html#cb625-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wltdffr_group =</span></span>
<span id="cb625-3"><a href="complex-surveys.html#cb625-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">case_when</span>(</span>
<span id="cb625-4"><a href="complex-surveys.html#cb625-4" aria-hidden="true" tabindex="-1"></a>             wltdffr <span class="sc">&gt;=</span> <span class="sc">-</span><span class="dv">4</span> <span class="sc">&amp;</span></span>
<span id="cb625-5"><a href="complex-surveys.html#cb625-5" aria-hidden="true" tabindex="-1"></a>               wltdffr <span class="sc">&lt;=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;Unfairly small&quot;</span>,</span>
<span id="cb625-6"><a href="complex-surveys.html#cb625-6" aria-hidden="true" tabindex="-1"></a>             wltdffr <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Fair&quot;</span>,</span>
<span id="cb625-7"><a href="complex-surveys.html#cb625-7" aria-hidden="true" tabindex="-1"></a>             wltdffr <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> wltdffr <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">&quot;Unfairly large&quot;</span></span>
<span id="cb625-8"><a href="complex-surveys.html#cb625-8" aria-hidden="true" tabindex="-1"></a>           ),</span>
<span id="cb625-9"><a href="complex-surveys.html#cb625-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">wltdffr_group =</span> <span class="fu">factor</span>(wltdffr_group,</span>
<span id="cb625-10"><a href="complex-surveys.html#cb625-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Unfairly small&quot;</span>,</span>
<span id="cb625-11"><a href="complex-surveys.html#cb625-11" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Fair&quot;</span>,</span>
<span id="cb625-12"><a href="complex-surveys.html#cb625-12" aria-hidden="true" tabindex="-1"></a>                                             <span class="st">&quot;Unfairly large&quot;</span>))</span>
<span id="cb625-13"><a href="complex-surveys.html#cb625-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="complex-surveys.html#cb626-1" aria-hidden="true" tabindex="-1"></a>gb_wealth <span class="ot">&lt;-</span> ess9_survey <span class="sc">%&gt;%</span></span>
<span id="cb626-2"><a href="complex-surveys.html#cb626-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cntry <span class="sc">==</span> <span class="st">&quot;United Kingdom&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb626-3"><a href="complex-surveys.html#cb626-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wltdffr_group) <span class="sc">%&gt;%</span></span>
<span id="cb626-4"><a href="complex-surveys.html#cb626-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>))</span>
<span id="cb626-5"><a href="complex-surveys.html#cb626-5" aria-hidden="true" tabindex="-1"></a>gb_wealth </span></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   wltdffr_group    prop prop_low prop_upp
##   &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 Unfairly small 0.164    0.146    0.181 
## 2 Fair           0.196    0.176    0.216 
## 3 Unfairly large 0.589    0.565    0.613 
## 4 &lt;NA&gt;           0.0508   0.0401   0.0615</code></pre>
<p>The results are the same as per the report. Let’s round to show this more clearly:</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="complex-surveys.html#cb628-1" aria-hidden="true" tabindex="-1"></a>gb_wealth <span class="sc">%&gt;%</span></span>
<span id="cb628-2"><a href="complex-surveys.html#cb628-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> (prop<span class="sc">*</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb628-3"><a href="complex-surveys.html#cb628-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(wltdffr_group, perc)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   wltdffr_group   perc
##   &lt;fct&gt;          &lt;dbl&gt;
## 1 Unfairly small    16
## 2 Fair              20
## 3 Unfairly large    59
## 4 &lt;NA&gt;               5</code></pre>
<p>We can also plot the results:</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="complex-surveys.html#cb630-1" aria-hidden="true" tabindex="-1"></a>gb_wealth <span class="sc">%&gt;%</span></span>
<span id="cb630-2"><a href="complex-surveys.html#cb630-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(wltdffr_group)) <span class="sc">%&gt;%</span></span>
<span id="cb630-3"><a href="complex-surveys.html#cb630-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wltdffr_group, <span class="at">y =</span> prop<span class="sc">*</span><span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb630-4"><a href="complex-surveys.html#cb630-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">&quot;#B053A1&quot;</span>) <span class="sc">+</span></span>
<span id="cb630-5"><a href="complex-surveys.html#cb630-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> prop_low<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb630-6"><a href="complex-surveys.html#cb630-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> prop_upp<span class="sc">*</span><span class="dv">100</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb630-7"><a href="complex-surveys.html#cb630-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb630-8"><a href="complex-surveys.html#cb630-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;%&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb630-9"><a href="complex-surveys.html#cb630-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;In your opinion, are differences in wealth in Britain</span><span class="sc">\n</span><span class="st">unfairly small, fair, or unfairly large?&quot;</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-418-1.png" width="480" /></p>
<p>Let’s do it again for a selection of countries. First, make a function which carries out the analysis for one country:</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="complex-surveys.html#cb631-1" aria-hidden="true" tabindex="-1"></a>gimme_country_results <span class="ot">&lt;-</span> <span class="cf">function</span>(the_cntry) {</span>
<span id="cb631-2"><a href="complex-surveys.html#cb631-2" aria-hidden="true" tabindex="-1"></a>  ess9_survey <span class="sc">%&gt;%</span></span>
<span id="cb631-3"><a href="complex-surveys.html#cb631-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(cntry <span class="sc">==</span> the_cntry) <span class="sc">%&gt;%</span></span>
<span id="cb631-4"><a href="complex-surveys.html#cb631-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(wltdffr_group) <span class="sc">%&gt;%</span></span>
<span id="cb631-5"><a href="complex-surveys.html#cb631-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prop =</span> <span class="fu">survey_mean</span>(<span class="at">vartype =</span> <span class="st">&quot;ci&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb631-6"><a href="complex-surveys.html#cb631-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cntry =</span> the_cntry)</span>
<span id="cb631-7"><a href="complex-surveys.html#cb631-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Check it works for the UK:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="complex-surveys.html#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gimme_country_results</span>(<span class="st">&quot;United Kingdom&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 5
##   wltdffr_group    prop prop_low prop_upp cntry         
##   &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;         
## 1 Unfairly small 0.164    0.146    0.181  United Kingdom
## 2 Fair           0.196    0.176    0.216  United Kingdom
## 3 Unfairly large 0.589    0.565    0.613  United Kingdom
## 4 &lt;NA&gt;           0.0508   0.0401   0.0615 United Kingdom</code></pre>
<p>Run it for all the countries of interest:</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="complex-surveys.html#cb634-1" aria-hidden="true" tabindex="-1"></a>conts <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Germany&quot;</span>, <span class="st">&quot;Spain&quot;</span>, <span class="st">&quot;France&quot;</span>, <span class="st">&quot;United Kingdom&quot;</span>, <span class="st">&quot;Italy&quot;</span>)</span>
<span id="cb634-2"><a href="complex-surveys.html#cb634-2" aria-hidden="true" tabindex="-1"></a>euro_wealth <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(conts, gimme_country_results)</span>
<span id="cb634-3"><a href="complex-surveys.html#cb634-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(euro_wealth)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   wltdffr_group    prop prop_low prop_upp cntry  
##   &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;  
## 1 Unfairly small 0.261    0.241    0.281  Germany
## 2 Fair           0.121    0.106    0.135  Germany
## 3 Unfairly large 0.557    0.535    0.579  Germany
## 4 &lt;NA&gt;           0.0619   0.0508   0.0730 Germany
## 5 Unfairly small 0.212    0.192    0.232  Spain  
## 6 Fair           0.0698   0.0575   0.0822 Spain</code></pre>
<p>Next, try a plot:</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="complex-surveys.html#cb636-1" aria-hidden="true" tabindex="-1"></a>euro_wealth <span class="sc">%&gt;%</span></span>
<span id="cb636-2"><a href="complex-surveys.html#cb636-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(wltdffr_group)) <span class="sc">%&gt;%</span></span>
<span id="cb636-3"><a href="complex-surveys.html#cb636-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cntry,</span>
<span id="cb636-4"><a href="complex-surveys.html#cb636-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> prop<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb636-5"><a href="complex-surveys.html#cb636-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> prop_low<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb636-6"><a href="complex-surveys.html#cb636-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymax =</span> prop_upp<span class="sc">*</span><span class="dv">100</span>,</span>
<span id="cb636-7"><a href="complex-surveys.html#cb636-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> wltdffr_group)) <span class="sc">+</span></span>
<span id="cb636-8"><a href="complex-surveys.html#cb636-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">8</span>), <span class="at">width =</span> <span class="fl">0.6</span>) <span class="sc">+</span> </span>
<span id="cb636-9"><a href="complex-surveys.html#cb636-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">8</span>),</span>
<span id="cb636-10"><a href="complex-surveys.html#cb636-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour=</span><span class="st">&quot;black&quot;</span>,</span>
<span id="cb636-11"><a href="complex-surveys.html#cb636-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb636-12"><a href="complex-surveys.html#cb636-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>,<span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb636-13"><a href="complex-surveys.html#cb636-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;%&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb636-14"><a href="complex-surveys.html#cb636-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;In your opinion, are differences in wealth</span><span class="sc">\n</span><span class="st">unfairly small, fair, or unfairly large?&quot;</span>,</span>
<span id="cb636-15"><a href="complex-surveys.html#cb636-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-422-1.png" width="576" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="logistic-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R-notes.pdf", "R-notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
