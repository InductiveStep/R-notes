<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Linear regression | Using R for social research</title>
  <meta name="description" content="These are some notes on using R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Linear regression | Using R for social research" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="These are some notes on using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Linear regression | Using R for social research" />
  
  <meta name="twitter:description" content="These are some notes on using R" />
  

<meta name="author" content="Andi Fugard (they/them)  (almost@gmail.com, @InductiveStep)" />


<meta name="date" content="2020-11-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="p-values-and-confidence-intervals.html"/>
<link rel="next" href="linear-regression-diagnostics.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>
<link href="libs/table1-1.0/table1_defaults.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="starting-rstudio.html"><a href="starting-rstudio.html"><i class="fa fa-check"></i><b>1</b> Starting RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="starting-rstudio.html"><a href="starting-rstudio.html#download-install-and-run"><i class="fa fa-check"></i><b>1.1</b> Download, install, and run</a></li>
<li class="chapter" data-level="1.2" data-path="starting-rstudio.html"><a href="starting-rstudio.html#make-a-new-r-notebook-file"><i class="fa fa-check"></i><b>1.2</b> Make a new R Notebook file</a></li>
<li class="chapter" data-level="1.3" data-path="starting-rstudio.html"><a href="starting-rstudio.html#save-the-file"><i class="fa fa-check"></i><b>1.3</b> Save the file</a></li>
<li class="chapter" data-level="1.4" data-path="starting-rstudio.html"><a href="starting-rstudio.html#run-the-example-r-command"><i class="fa fa-check"></i><b>1.4</b> Run the example R command</a></li>
<li class="chapter" data-level="1.5" data-path="starting-rstudio.html"><a href="starting-rstudio.html#clear-it-and-try-a-sum"><i class="fa fa-check"></i><b>1.5</b> Clear it and try a sum</a></li>
<li class="chapter" data-level="1.6" data-path="starting-rstudio.html"><a href="starting-rstudio.html#did-that-help"><i class="fa fa-check"></i><b>1.6</b> Did that help?</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="starting-r.html"><a href="starting-r.html"><i class="fa fa-check"></i><b>2</b> Starting R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="starting-r.html"><a href="starting-r.html#arithmetic"><i class="fa fa-check"></i><b>2.1</b> Arithmetic</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="starting-r.html"><a href="starting-r.html#activities"><i class="fa fa-check"></i><b>2.1.1</b> Activities</a></li>
<li class="chapter" data-level="2.1.2" data-path="starting-r.html"><a href="starting-r.html#answers"><i class="fa fa-check"></i><b>2.1.2</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="starting-r.html"><a href="starting-r.html#variables"><i class="fa fa-check"></i><b>2.2</b> Variables</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="starting-r.html"><a href="starting-r.html#activity"><i class="fa fa-check"></i><b>2.2.1</b> Activity</a></li>
<li class="chapter" data-level="2.2.2" data-path="starting-r.html"><a href="starting-r.html#answer"><i class="fa fa-check"></i><b>2.2.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="starting-r.html"><a href="starting-r.html#a-note-on-variable-names"><i class="fa fa-check"></i><b>2.3</b> A note on variable names</a></li>
<li class="chapter" data-level="2.4" data-path="starting-r.html"><a href="starting-r.html#vectors"><i class="fa fa-check"></i><b>2.4</b> Vectors</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="starting-r.html"><a href="starting-r.html#activity-1"><i class="fa fa-check"></i><b>2.4.1</b> Activity</a></li>
<li class="chapter" data-level="2.4.2" data-path="starting-r.html"><a href="starting-r.html#answer-1"><i class="fa fa-check"></i><b>2.4.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="starting-r.html"><a href="starting-r.html#functions"><i class="fa fa-check"></i><b>2.5</b> Functions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="starting-r.html"><a href="starting-r.html#activity-2"><i class="fa fa-check"></i><b>2.5.1</b> Activity</a></li>
<li class="chapter" data-level="2.5.2" data-path="starting-r.html"><a href="starting-r.html#answer-2"><i class="fa fa-check"></i><b>2.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="starting-r.html"><a href="starting-r.html#more-functions"><i class="fa fa-check"></i><b>2.6</b> More functions</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="starting-r.html"><a href="starting-r.html#activity-3"><i class="fa fa-check"></i><b>2.6.1</b> Activity</a></li>
<li class="chapter" data-level="2.6.2" data-path="starting-r.html"><a href="starting-r.html#answer-3"><i class="fa fa-check"></i><b>2.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="starting-r.html"><a href="starting-r.html#data-frames"><i class="fa fa-check"></i><b>2.7</b> Data frames</a>
<ul>
<li class="chapter" data-level="2.7.1" data-path="starting-r.html"><a href="starting-r.html#activity-4"><i class="fa fa-check"></i><b>2.7.1</b> Activity</a></li>
<li class="chapter" data-level="2.7.2" data-path="starting-r.html"><a href="starting-r.html#answer-4"><i class="fa fa-check"></i><b>2.7.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="starting-r.html"><a href="starting-r.html#loading-data-frames-from-a-file"><i class="fa fa-check"></i><b>2.8</b> Loading data frames from a file</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="starting-r.html"><a href="starting-r.html#activity-5"><i class="fa fa-check"></i><b>2.8.1</b> Activity</a></li>
<li class="chapter" data-level="2.8.2" data-path="starting-r.html"><a href="starting-r.html#answer-5"><i class="fa fa-check"></i><b>2.8.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="starting-r.html"><a href="starting-r.html#packages"><i class="fa fa-check"></i><b>2.9</b> Packages</a>
<ul>
<li class="chapter" data-level="2.9.1" data-path="starting-r.html"><a href="starting-r.html#activity-6"><i class="fa fa-check"></i><b>2.9.1</b> Activity</a></li>
<li class="chapter" data-level="2.9.2" data-path="starting-r.html"><a href="starting-r.html#answer-6"><i class="fa fa-check"></i><b>2.9.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="starting-r.html"><a href="starting-r.html#the-end"><i class="fa fa-check"></i><b>2.10</b> The end!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Visualising data in the tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#getting-setup"><i class="fa fa-check"></i><b>3.1</b> Getting setup</a></li>
<li class="chapter" data-level="3.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#an-interlude-on-functions"><i class="fa fa-check"></i><b>3.2</b> An interlude on functions</a></li>
<li class="chapter" data-level="3.3" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#a-scatterplot-in-ggplot"><i class="fa fa-check"></i><b>3.3</b> A scatterplot in ggplot</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#warm-up-activity"><i class="fa fa-check"></i><b>3.3.1</b> Warm-up activity</a></li>
<li class="chapter" data-level="3.3.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-7"><i class="fa fa-check"></i><b>3.3.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#another-aesthetic-colour"><i class="fa fa-check"></i><b>3.4</b> Another aesthetic: colour</a></li>
<li class="chapter" data-level="3.5" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#another-geom-jitter"><i class="fa fa-check"></i><b>3.5</b> Another geom: jitter</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-to-develop-your-help-searching-skill"><i class="fa fa-check"></i><b>3.5.1</b> Activity to develop your help-searching skill!</a></li>
<li class="chapter" data-level="3.5.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-8"><i class="fa fa-check"></i><b>3.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#aggregatingsummarising-data-by-group"><i class="fa fa-check"></i><b>3.6</b> Aggregating/summarising data by group</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-7"><i class="fa fa-check"></i><b>3.6.1</b> Activity</a></li>
<li class="chapter" data-level="3.6.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-9"><i class="fa fa-check"></i><b>3.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#pipes"><i class="fa fa-check"></i><b>3.7</b> Pipes</a></li>
<li class="chapter" data-level="3.8" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#plot-the-mean-life-expectancy-by-continent"><i class="fa fa-check"></i><b>3.8</b> Plot the mean life expectancy by continent</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#actvity"><i class="fa fa-check"></i><b>3.8.1</b> Actvity</a></li>
<li class="chapter" data-level="3.8.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-10"><i class="fa fa-check"></i><b>3.8.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#yet-another-geom-line"><i class="fa fa-check"></i><b>3.9</b> Yet another geom: line</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-8"><i class="fa fa-check"></i><b>3.9.1</b> Activity</a></li>
<li class="chapter" data-level="3.9.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-11"><i class="fa fa-check"></i><b>3.9.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#filtering-data-along-the-pipeline"><i class="fa fa-check"></i><b>3.10</b> Filtering data along the pipeline</a>
<ul>
<li class="chapter" data-level="3.10.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-9"><i class="fa fa-check"></i><b>3.10.1</b> Activity</a></li>
<li class="chapter" data-level="3.10.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-12"><i class="fa fa-check"></i><b>3.10.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#other-handy-tools-select-slice-bind-and-arrange"><i class="fa fa-check"></i><b>3.11</b> Other handy tools: select, slice, bind, and arrange</a></li>
<li class="chapter" data-level="3.12" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#filtering-for-members-of-a-vector"><i class="fa fa-check"></i><b>3.12</b> Filtering for members of a vector</a></li>
<li class="chapter" data-level="3.13" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#final-challenge"><i class="fa fa-check"></i><b>3.13</b> Final challenge</a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#activity-10"><i class="fa fa-check"></i><b>3.13.1</b> Activity</a></li>
<li class="chapter" data-level="3.13.2" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#answer-13"><i class="fa fa-check"></i><b>3.13.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="3.14" data-path="visualising-data-in-the-tidyverse.html"><a href="visualising-data-in-the-tidyverse.html#more-ideas-for-visualisations"><i class="fa fa-check"></i><b>3.14</b> More ideas for visualisations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html"><i class="fa fa-check"></i><b>4</b> P-values and confidence intervals</a>
<ul>
<li class="chapter" data-level="4.1" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#correlation-recap"><i class="fa fa-check"></i><b>4.1</b> Correlation recap</a></li>
<li class="chapter" data-level="4.2" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#testing-null-hypotheses"><i class="fa fa-check"></i><b>4.2</b> Testing null-hypotheses</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#what-can-samples-look-like-when-the-true-correlation-is-0"><i class="fa fa-check"></i><b>4.2.1</b> What can samples look like when the true correlation is 0?</a></li>
<li class="chapter" data-level="4.2.2" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#understanding-actual-data-in-relation-to-these-simulations"><i class="fa fa-check"></i><b>4.2.2</b> Understanding actual data in relation to these simulations</a></li>
<li class="chapter" data-level="4.2.3" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#so-what-is-a-p-value"><i class="fa fa-check"></i><b>4.2.3</b> So, what is a p-value?</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#confidence-intervals"><i class="fa fa-check"></i><b>4.3</b> Confidence intervals</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#simulating-confidence"><i class="fa fa-check"></i><b>4.3.1</b> Simulating confidence</a></li>
<li class="chapter" data-level="4.3.2" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#what-is-a-confidence-interval-then"><i class="fa fa-check"></i><b>4.3.2</b> What is a confidence interval, then?</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="p-values-and-confidence-intervals.html"><a href="p-values-and-confidence-intervals.html#further-reading"><i class="fa fa-check"></i><b>4.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="linear-regression.html"><a href="linear-regression.html"><i class="fa fa-check"></i><b>5</b> Linear regression</a>
<ul>
<li class="chapter" data-level="5.1" data-path="linear-regression.html"><a href="linear-regression.html#before-we-begin"><i class="fa fa-check"></i><b>5.1</b> Before we begin</a></li>
<li class="chapter" data-level="5.2" data-path="linear-regression.html"><a href="linear-regression.html#the-dataset"><i class="fa fa-check"></i><b>5.2</b> The dataset</a></li>
<li class="chapter" data-level="5.3" data-path="linear-regression.html"><a href="linear-regression.html#interlude-on-methodology"><i class="fa fa-check"></i><b>5.3</b> Interlude on methodology</a></li>
<li class="chapter" data-level="5.4" data-path="linear-regression.html"><a href="linear-regression.html#descriptives"><i class="fa fa-check"></i><b>5.4</b> Descriptives</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-11"><i class="fa fa-check"></i><b>5.4.1</b> Activity</a></li>
<li class="chapter" data-level="5.4.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-14"><i class="fa fa-check"></i><b>5.4.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="linear-regression.html"><a href="linear-regression.html#prep-to-understand-the-simplest-regression-model"><i class="fa fa-check"></i><b>5.5</b> Prep to understand the simplest regression model</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-12"><i class="fa fa-check"></i><b>5.5.1</b> Activity</a></li>
<li class="chapter" data-level="5.5.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-15"><i class="fa fa-check"></i><b>5.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="linear-regression.html"><a href="linear-regression.html#the-simplest-regression-model-intercept-only-model"><i class="fa fa-check"></i><b>5.6</b> The simplest regression model: intercept-only model</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-13"><i class="fa fa-check"></i><b>5.6.1</b> Activity</a></li>
<li class="chapter" data-level="5.6.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-16"><i class="fa fa-check"></i><b>5.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="linear-regression.html"><a href="linear-regression.html#adding-a-slope-to-the-regression-model"><i class="fa fa-check"></i><b>5.7</b> Adding a slope to the regression model</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-14"><i class="fa fa-check"></i><b>5.7.1</b> Activity</a></li>
<li class="chapter" data-level="5.7.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-17"><i class="fa fa-check"></i><b>5.7.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="linear-regression.html"><a href="linear-regression.html#residuals"><i class="fa fa-check"></i><b>5.8</b> Residuals</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-15"><i class="fa fa-check"></i><b>5.8.1</b> Activity</a></li>
<li class="chapter" data-level="5.8.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-18"><i class="fa fa-check"></i><b>5.8.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="linear-regression.html"><a href="linear-regression.html#comparing-models"><i class="fa fa-check"></i><b>5.9</b> Comparing models</a></li>
<li class="chapter" data-level="5.10" data-path="linear-regression.html"><a href="linear-regression.html#regression-with-two-or-more-predictors"><i class="fa fa-check"></i><b>5.10</b> Regression with two or more predictors</a>
<ul>
<li class="chapter" data-level="5.10.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-16"><i class="fa fa-check"></i><b>5.10.1</b> Activity</a></li>
<li class="chapter" data-level="5.10.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-19"><i class="fa fa-check"></i><b>5.10.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.11" data-path="linear-regression.html"><a href="linear-regression.html#interpreting-regression-models-with-two-or-more-predictors"><i class="fa fa-check"></i><b>5.11</b> Interpreting regression models with two or more predictors</a></li>
<li class="chapter" data-level="5.12" data-path="linear-regression.html"><a href="linear-regression.html#optional-that-pesky-negative-intercept"><i class="fa fa-check"></i><b>5.12</b> Optional: that pesky negative intercept</a>
<ul>
<li class="chapter" data-level="5.12.1" data-path="linear-regression.html"><a href="linear-regression.html#activity-17"><i class="fa fa-check"></i><b>5.12.1</b> Activity</a></li>
<li class="chapter" data-level="5.12.2" data-path="linear-regression.html"><a href="linear-regression.html#answer-20"><i class="fa fa-check"></i><b>5.12.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="5.13" data-path="linear-regression.html"><a href="linear-regression.html#finally-confidence-intervals"><i class="fa fa-check"></i><b>5.13</b> Finally: confidence intervals</a></li>
<li class="chapter" data-level="5.14" data-path="linear-regression.html"><a href="linear-regression.html#very-optional-extras"><i class="fa fa-check"></i><b>5.14</b> Very optional extras</a>
<ul>
<li class="chapter" data-level="5.14.1" data-path="linear-regression.html"><a href="linear-regression.html#making-functions"><i class="fa fa-check"></i><b>5.14.1</b> Making functions</a></li>
<li class="chapter" data-level="5.14.2" data-path="linear-regression.html"><a href="linear-regression.html#another-way-to-make-scatterplots-ggally"><i class="fa fa-check"></i><b>5.14.2</b> Another way to make scatterplots: GGally</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html"><i class="fa fa-check"></i><b>6</b> Linear regression diagnostics</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#before-we-begin-1"><i class="fa fa-check"></i><b>6.1</b> Before we begin</a></li>
<li class="chapter" data-level="6.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#the-dataset-1"><i class="fa fa-check"></i><b>6.2</b> The dataset</a></li>
<li class="chapter" data-level="6.3" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#fit-a-regression-model"><i class="fa fa-check"></i><b>6.3</b> Fit a regression model</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-18"><i class="fa fa-check"></i><b>6.3.1</b> Activity</a></li>
<li class="chapter" data-level="6.3.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-21"><i class="fa fa-check"></i><b>6.3.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-for-normally-distributed-residuals"><i class="fa fa-check"></i><b>6.4</b> Checking for normally distributed residuals</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#base-r-histogram"><i class="fa fa-check"></i><b>6.4.1</b> Base R histogram</a></li>
<li class="chapter" data-level="6.4.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#quantile-comparison-plot"><i class="fa fa-check"></i><b>6.4.2</b> Quantile-comparison plot</a></li>
<li class="chapter" data-level="6.4.3" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#statistical-test-of-normality"><i class="fa fa-check"></i><b>6.4.3</b> Statistical test of normality</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-constant-residual-variance"><i class="fa fa-check"></i><b>6.5</b> Checking constant residual variance</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-20"><i class="fa fa-check"></i><b>6.5.1</b> Activity</a></li>
<li class="chapter" data-level="6.5.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-23"><i class="fa fa-check"></i><b>6.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-for-relationships-between-residuals-and-predicted-outcome-or-predictors"><i class="fa fa-check"></i><b>6.6</b> Checking for relationships between residuals and predicted outcome or predictors</a></li>
<li class="chapter" data-level="6.7" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-linearity"><i class="fa fa-check"></i><b>6.7</b> Checking linearity</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#what-should-be-linear-in-a-linear-model"><i class="fa fa-check"></i><b>6.7.1</b> What should be linear in a linear model?</a></li>
<li class="chapter" data-level="6.7.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-for-linearity"><i class="fa fa-check"></i><b>6.7.2</b> Checking for linearity</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-influence-leave-one-out-analyses"><i class="fa fa-check"></i><b>6.8</b> Checking influence: leave-one-out analyses</a>
<ul>
<li class="chapter" data-level="6.8.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#residual-outliers"><i class="fa fa-check"></i><b>6.8.1</b> Residual outliers</a></li>
<li class="chapter" data-level="6.8.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#cooks-distance"><i class="fa fa-check"></i><b>6.8.2</b> Cook’s distance</a></li>
<li class="chapter" data-level="6.8.3" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#dfbeta-and-close-sibling-dfbetas"><i class="fa fa-check"></i><b>6.8.3</b> DFBETA and (close sibling) DFBETAS</a></li>
<li class="chapter" data-level="6.8.4" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#view-them-all"><i class="fa fa-check"></i><b>6.8.4</b> View them all</a></li>
<li class="chapter" data-level="6.8.5" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#so-er-what-should-we-do-with-potentially-influential-observations"><i class="fa fa-check"></i><b>6.8.5</b> So, er, what should we do with “potentially influential” observations…?</a></li>
</ul></li>
<li class="chapter" data-level="6.9" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#checking-the-variance-inflation-factors-vifs"><i class="fa fa-check"></i><b>6.9</b> Checking the variance inflation factors (VIFs)</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-22"><i class="fa fa-check"></i><b>6.9.1</b> Activity</a></li>
<li class="chapter" data-level="6.9.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-25"><i class="fa fa-check"></i><b>6.9.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#the-challenge"><i class="fa fa-check"></i><b>6.10</b> The challenge</a>
<ul>
<li class="chapter" data-level="6.10.1" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#activity-23"><i class="fa fa-check"></i><b>6.10.1</b> Activity</a></li>
<li class="chapter" data-level="6.10.2" data-path="linear-regression-diagnostics.html"><a href="linear-regression-diagnostics.html#answer-26"><i class="fa fa-check"></i><b>6.10.2</b> Answer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html"><i class="fa fa-check"></i><b>7</b> Categorical predictors and interactions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#before-we-begin-2"><i class="fa fa-check"></i><b>7.1</b> Before we begin</a></li>
<li class="chapter" data-level="7.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#the-dataset-2"><i class="fa fa-check"></i><b>7.2</b> The dataset</a></li>
<li class="chapter" data-level="7.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#factors"><i class="fa fa-check"></i><b>7.3</b> Factors</a></li>
<li class="chapter" data-level="7.4" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#visualising-the-data"><i class="fa fa-check"></i><b>7.4</b> Visualising the data</a></li>
<li class="chapter" data-level="7.5" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#the-punchline-occupation-type-does-predict-prestige"><i class="fa fa-check"></i><b>7.5</b> The punchline: occupation type does predict prestige</a></li>
<li class="chapter" data-level="7.6" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#understanding-factors-in-regression-models"><i class="fa fa-check"></i><b>7.6</b> Understanding factors in regression models</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#how-are-categorical-variables-encoded"><i class="fa fa-check"></i><b>7.6.1</b> How are categorical variables encoded?</a></li>
<li class="chapter" data-level="7.6.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#how-are-binary-two-level-categorical-predictors-encoded"><i class="fa fa-check"></i><b>7.6.2</b> How are binary (two-level) categorical predictors encoded?</a></li>
<li class="chapter" data-level="7.6.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#categorical-predictors-with-3-or-more-levels"><i class="fa fa-check"></i><b>7.6.3</b> Categorical predictors with 3 or more levels</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#interpreting-the-coefficients"><i class="fa fa-check"></i><b>7.7</b> Interpreting the coefficients</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#activity-25"><i class="fa fa-check"></i><b>7.7.1</b> Activity</a></li>
<li class="chapter" data-level="7.7.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#answer-28"><i class="fa fa-check"></i><b>7.7.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#checking-all-combinations"><i class="fa fa-check"></i><b>7.8</b> Checking all combinations</a></li>
<li class="chapter" data-level="7.9" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#the-intercept-is-not-always-the-mean-of-the-comparison-group"><i class="fa fa-check"></i><b>7.9</b> The intercept is not always the mean of the comparison group</a></li>
<li class="chapter" data-level="7.10" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#recap"><i class="fa fa-check"></i><b>7.10</b> Recap</a></li>
<li class="chapter" data-level="7.11" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#challenge"><i class="fa fa-check"></i><b>7.11</b> Challenge</a>
<ul>
<li class="chapter" data-level="7.11.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#activity-26"><i class="fa fa-check"></i><b>7.11.1</b> Activity</a></li>
<li class="chapter" data-level="7.11.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#answers-1"><i class="fa fa-check"></i><b>7.11.2</b> Answers</a></li>
</ul></li>
<li class="chapter" data-level="7.12" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#brief-introduction-to-interactions"><i class="fa fa-check"></i><b>7.12</b> Brief introduction to interactions</a>
<ul>
<li class="chapter" data-level="7.12.1" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#what-is-an-interaction"><i class="fa fa-check"></i><b>7.12.1</b> What is an interaction?</a></li>
<li class="chapter" data-level="7.12.2" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#how-to-test-for-interactions-in-r"><i class="fa fa-check"></i><b>7.12.2</b> How to test for interactions in R</a></li>
<li class="chapter" data-level="7.12.3" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#understanding-interactions"><i class="fa fa-check"></i><b>7.12.3</b> Understanding interactions</a></li>
<li class="chapter" data-level="7.12.4" data-path="categorical-predictors-and-interactions.html"><a href="categorical-predictors-and-interactions.html#further-reading-1"><i class="fa fa-check"></i><b>7.12.4</b> Further reading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>8</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="8.1" data-path="logistic-regression.html"><a href="logistic-regression.html#setup"><i class="fa fa-check"></i><b>8.1</b> Setup</a></li>
<li class="chapter" data-level="8.2" data-path="logistic-regression.html"><a href="logistic-regression.html#the-dataset-3"><i class="fa fa-check"></i><b>8.2</b> The dataset</a></li>
<li class="chapter" data-level="8.3" data-path="logistic-regression.html"><a href="logistic-regression.html#warmup-activity"><i class="fa fa-check"></i><b>8.3</b> Warmup activity</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="logistic-regression.html"><a href="logistic-regression.html#activity-27"><i class="fa fa-check"></i><b>8.3.1</b> Activity</a></li>
<li class="chapter" data-level="8.3.2" data-path="logistic-regression.html"><a href="logistic-regression.html#answer-29"><i class="fa fa-check"></i><b>8.3.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="logistic-regression.html"><a href="logistic-regression.html#the-punchline"><i class="fa fa-check"></i><b>8.4</b> The punchline</a></li>
<li class="chapter" data-level="8.5" data-path="logistic-regression.html"><a href="logistic-regression.html#intermezzo-parametric-versus-nonparametric"><i class="fa fa-check"></i><b>8.5</b> Intermezzo: parametric versus nonparametric</a></li>
<li class="chapter" data-level="8.6" data-path="logistic-regression.html"><a href="logistic-regression.html#glms"><i class="fa fa-check"></i><b>8.6</b> What is a generalised linear model?</a></li>
<li class="chapter" data-level="8.7" data-path="logistic-regression.html"><a href="logistic-regression.html#what-is-the-log-function-again"><i class="fa fa-check"></i><b>8.7</b> What is the log function again…?</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="logistic-regression.html"><a href="logistic-regression.html#log-arithmetic"><i class="fa fa-check"></i><b>8.7.1</b> The arithmetic</a></li>
<li class="chapter" data-level="8.7.2" data-path="logistic-regression.html"><a href="logistic-regression.html#why-log"><i class="fa fa-check"></i><b>8.7.2</b> Why log?</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="logistic-regression.html"><a href="logistic-regression.html#intercept-only-models-again"><i class="fa fa-check"></i><b>8.8</b> Intercept-only models again</a></li>
<li class="chapter" data-level="8.9" data-path="logistic-regression.html"><a href="logistic-regression.html#odds-and-log-odds"><i class="fa fa-check"></i><b>8.9</b> Odds and log odds</a></li>
<li class="chapter" data-level="8.10" data-path="logistic-regression.html"><a href="logistic-regression.html#back-to-that-intercept"><i class="fa fa-check"></i><b>8.10</b> Back to that intercept</a></li>
<li class="chapter" data-level="8.11" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-slopes"><i class="fa fa-check"></i><b>8.11</b> Interpreting model slopes</a>
<ul>
<li class="chapter" data-level="8.11.1" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-on-the-log-odds-scale"><i class="fa fa-check"></i><b>8.11.1</b> Interpret on the log-odds scale</a></li>
<li class="chapter" data-level="8.11.2" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-using-the-divide-by-4-approximation"><i class="fa fa-check"></i><b>8.11.2</b> Interpret using the “divide-by-4” approximation</a></li>
<li class="chapter" data-level="8.11.3" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-using-odds"><i class="fa fa-check"></i><b>8.11.3</b> Interpret using odds</a></li>
<li class="chapter" data-level="8.11.4" data-path="logistic-regression.html"><a href="logistic-regression.html#interpret-using-predicted-probabilities"><i class="fa fa-check"></i><b>8.11.4</b> Interpret using predicted probabilities</a></li>
</ul></li>
<li class="chapter" data-level="8.12" data-path="logistic-regression.html"><a href="logistic-regression.html#diagnostics"><i class="fa fa-check"></i><b>8.12</b> Diagnostics</a>
<ul>
<li class="chapter" data-level="8.12.1" data-path="logistic-regression.html"><a href="logistic-regression.html#check-the-residual-distribution"><i class="fa fa-check"></i><b>8.12.1</b> Check the residual distribution</a></li>
<li class="chapter" data-level="8.12.2" data-path="logistic-regression.html"><a href="logistic-regression.html#check-that-the-residual-mean-is-constant"><i class="fa fa-check"></i><b>8.12.2</b> Check that the residual mean is constant</a></li>
<li class="chapter" data-level="8.12.3" data-path="logistic-regression.html"><a href="logistic-regression.html#linearity-of-predictors"><i class="fa fa-check"></i><b>8.12.3</b> Linearity of predictors</a></li>
<li class="chapter" data-level="8.12.4" data-path="logistic-regression.html"><a href="logistic-regression.html#influence"><i class="fa fa-check"></i><b>8.12.4</b> Influence</a></li>
<li class="chapter" data-level="8.12.5" data-path="logistic-regression.html"><a href="logistic-regression.html#multicolinearity"><i class="fa fa-check"></i><b>8.12.5</b> Multicolinearity</a></li>
</ul></li>
<li class="chapter" data-level="8.13" data-path="logistic-regression.html"><a href="logistic-regression.html#a-challenge"><i class="fa fa-check"></i><b>8.13</b> A challenge</a>
<ul>
<li class="chapter" data-level="8.13.1" data-path="logistic-regression.html"><a href="logistic-regression.html#activity-31"><i class="fa fa-check"></i><b>8.13.1</b> Activity</a></li>
<li class="chapter" data-level="8.13.2" data-path="logistic-regression.html"><a href="logistic-regression.html#an-answer"><i class="fa fa-check"></i><b>8.13.2</b> (An) Answer</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="complex-surveys.html"><a href="complex-surveys.html"><i class="fa fa-check"></i><b>9</b> Complex surveys</a>
<ul>
<li class="chapter" data-level="9.1" data-path="complex-surveys.html"><a href="complex-surveys.html#readings"><i class="fa fa-check"></i><b>9.1</b> Readings</a></li>
<li class="chapter" data-level="9.2" data-path="complex-surveys.html"><a href="complex-surveys.html#the-dataset-4"><i class="fa fa-check"></i><b>9.2</b> The dataset</a></li>
<li class="chapter" data-level="9.3" data-path="complex-surveys.html"><a href="complex-surveys.html#the-components-of-a-survey-design"><i class="fa fa-check"></i><b>9.3</b> The components of a survey design</a></li>
<li class="chapter" data-level="9.4" data-path="complex-surveys.html"><a href="complex-surveys.html#describing-the-data"><i class="fa fa-check"></i><b>9.4</b> Describing the data</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="complex-surveys.html"><a href="complex-surveys.html#activity-32"><i class="fa fa-check"></i><b>9.4.1</b> Activity</a></li>
<li class="chapter" data-level="9.4.2" data-path="complex-surveys.html"><a href="complex-surveys.html#answer-33"><i class="fa fa-check"></i><b>9.4.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="complex-surveys.html"><a href="complex-surveys.html#fitting-a-glm"><i class="fa fa-check"></i><b>9.5</b> Fitting a GLM</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="complex-surveys.html"><a href="complex-surveys.html#activity-33"><i class="fa fa-check"></i><b>9.5.1</b> Activity</a></li>
<li class="chapter" data-level="9.5.2" data-path="complex-surveys.html"><a href="complex-surveys.html#answer-34"><i class="fa fa-check"></i><b>9.5.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="complex-surveys.html"><a href="complex-surveys.html#slopes"><i class="fa fa-check"></i><b>9.6</b> Slopes</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="complex-surveys.html"><a href="complex-surveys.html#activity-34"><i class="fa fa-check"></i><b>9.6.1</b> Activity</a></li>
<li class="chapter" data-level="9.6.2" data-path="complex-surveys.html"><a href="complex-surveys.html#answer-35"><i class="fa fa-check"></i><b>9.6.2</b> Answer</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="complex-surveys.html"><a href="complex-surveys.html#diagnostics-1"><i class="fa fa-check"></i><b>9.7</b> Diagnostics</a></li>
<li class="chapter" data-level="9.8" data-path="complex-surveys.html"><a href="complex-surveys.html#another-worked-example-the-european-social-survey"><i class="fa fa-check"></i><b>9.8</b> Another worked example: the European Social Survey</a>
<ul>
<li class="chapter" data-level="9.8.1" data-path="complex-surveys.html"><a href="complex-surveys.html#set-up-the-survey-object"><i class="fa fa-check"></i><b>9.8.1</b> Set up the survey object</a></li>
<li class="chapter" data-level="9.8.2" data-path="complex-surveys.html"><a href="complex-surveys.html#try-the-analysis"><i class="fa fa-check"></i><b>9.8.2</b> Try the analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multilevel-models.html"><a href="multilevel-models.html"><i class="fa fa-check"></i><b>10</b> Multilevel models</a></li>
<li class="chapter" data-level="11" data-path="mediation-analysis.html"><a href="mediation-analysis.html"><i class="fa fa-check"></i><b>11</b> Mediation analysis</a>
<ul>
<li class="chapter" data-level="11.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#simulated-example"><i class="fa fa-check"></i><b>11.1</b> Simulated Example</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="mediation-analysis.html"><a href="mediation-analysis.html#make-up-some-data"><i class="fa fa-check"></i><b>11.1.1</b> Make up some data</a></li>
<li class="chapter" data-level="11.1.2" data-path="mediation-analysis.html"><a href="mediation-analysis.html#analyse-it"><i class="fa fa-check"></i><b>11.1.2</b> Analyse it</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>12</b> References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using R for social research</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="linear-regression" class="section level1" number="5">
<h1><span class="header-section-number">Chapter 5</span> Linear regression</h1>
<p>By the end of this chapter you will:</p>
<ul>
<li>Know how fit and compare regression models using R (three commands: <code>lm</code>, <code>summary</code>, <code>anova</code>).</li>
<li>Understand how to interpret the output from these commands.</li>
<li>Have explored some more examples of tidyverse analyses.</li>
</ul>
<p>Next chapter, we will explore how to check model assumptions, which may or may not hold for the models we fit here.</p>
<div id="before-we-begin" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Before we begin</h2>
<p>Download the <a href="./prestige.csv">prestige dataset</a>, create an R Markdown file, and ensure they are both saved in a folder you will find again. I recommend writing down any questions you have as you go, perhaps in your Markdown file, so that you can discuss them with whoever else you have roped into learning R.</p>
</div>
<div id="the-dataset" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> The dataset</h2>
<p>We will use a dataset on occupational prestige from Canada, 1971, which is used by Fox and Weisberg (2019). Each row in the dataset describes an occupation, and aggregated data about that occupation.</p>
<table>
<colgroup>
<col width="53%" />
<col width="46%" />
</colgroup>
<thead>
<tr class="header">
<th>Variable name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>occ</td>
<td>Occupation</td>
</tr>
<tr class="even">
<td>education</td>
<td>Average years of education for people in job</td>
</tr>
<tr class="odd">
<td>income</td>
<td>Average income in dollars</td>
</tr>
<tr class="even">
<td>women</td>
<td>Percentage of women in occupation</td>
</tr>
<tr class="odd">
<td>prestige</td>
<td>A Pineo-Porter prestige score for the occupation with a possible range of 0-100 (higher = more prestigious)</td>
</tr>
<tr class="even">
<td>type</td>
<td>“bc” = blue collar <br> “wc” = white collar <br> “prof” = professional, managerial, or technical</td>
</tr>
</tbody>
</table>
<p>I’m going to read it in as <code>dat</code> but feel free to choose any name you desire.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="linear-regression.html#cb144-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;prestige.csv&quot;</span>)</span></code></pre></div>
<p>Here are the top 5 rows:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="linear-regression.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##                   occ education income women prestige type
## 1  gov administrators     13.11  12351 11.16     68.8 prof
## 2    general managers     12.26  25879  4.02     69.1 prof
## 3         accountants     12.77   9271 15.70     63.4 prof
## 4 purchasing officers     11.42   8865  9.11     56.8 prof
## 5            chemists     14.62   8403 11.68     73.5 prof</code></pre>
<p>Spend some time checking that you understand each row.</p>
<p>Our challenge for this tutorial is to work out what predicts the prestige of occupations.</p>
</div>
<div id="interlude-on-methodology" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Interlude on methodology</h2>
<p>The objective of this tutorial is simply to understand linear regression; however, I think it’s worth commenting briefly on methodology.</p>
<p>It is important to develop research questions and (if possible, directional) statistical hypotheses <em>before</em> obtaining data, based on prior evidence and theory.</p>
<p>These days, analysis plans are often published before any data are obtained. This is to avoid “data dredging” (also known as “p-hacking”) which makes it likely to find results by “capitalising on chance” that have no hope of replicating or generalising beyond the sample. Looking at graphs of data counts as data dredging; you can’t create hypotheses from hindsight. See this page from the <a href="https://www.cos.io/initiatives/prereg">Center for Open Science</a> for more info.</p>
</div>
<div id="descriptives" class="section level2 tabset" number="5.4">
<h2><span class="header-section-number">5.4</span> Descriptives</h2>
<p>I’ll include <code>tidyverse</code> for <code>ggplot</code>, pipes, etc., as they will come in handy later:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="linear-regression.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>The base R <code>summary</code> command is a quick way to obtain a summary of all variables; give it the data frame you wish to summarise as follows:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="linear-regression.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code></pre></div>
<pre><code>##      occ              education          income          women       
##  Length:102         Min.   : 6.380   Min.   :  611   Min.   : 0.000  
##  Class :character   1st Qu.: 8.445   1st Qu.: 4106   1st Qu.: 3.592  
##  Mode  :character   Median :10.540   Median : 5930   Median :13.600  
##                     Mean   :10.738   Mean   : 6798   Mean   :28.979  
##                     3rd Qu.:12.648   3rd Qu.: 8187   3rd Qu.:52.203  
##                     Max.   :15.970   Max.   :25879   Max.   :97.510  
##     prestige         type          
##  Min.   :14.80   Length:102        
##  1st Qu.:35.23   Class :character  
##  Median :43.60   Mode  :character  
##  Mean   :46.83                     
##  3rd Qu.:59.27                     
##  Max.   :87.20</code></pre>
<p>There are a variety of ways to create what is often known as “Table 1,” so called because it is usually the first table in quantitative journal articles.</p>
<p>Here is one, in the <code>tableone</code> package:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="linear-regression.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tableone)</span>
<span id="cb150-2"><a href="linear-regression.html#cb150-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3"><a href="linear-regression.html#cb150-3" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb150-4"><a href="linear-regression.html#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>occ) <span class="sc">%&gt;%</span></span>
<span id="cb150-5"><a href="linear-regression.html#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">CreateTableOne</span>(<span class="at">data =</span> .)</span></code></pre></div>
<pre><code>##                        
##                         Overall          
##   n                         102          
##   education (mean (SD))   10.74 (2.73)   
##   income (mean (SD))    6797.90 (4245.92)
##   women (mean (SD))       28.98 (31.72)  
##   prestige (mean (SD))    46.83 (17.20)  
##   type (%)                               
##      bc                      44 (44.9)   
##      prof                    31 (31.6)   
##      wc                      23 (23.5)</code></pre>
<p>The <code>select</code> line says to remove the <code>occ</code> (occupation) variable (can you see why I did that?). The <code>data = .</code> option is there because <code>CreateTableOne</code> doesn’t understand <code>%&gt;%</code> plumbing. The <code>.</code> represents the output from the previous line so connects the information flow correctly.</p>
<p>You will also usually want to create scatterplots of relationships between continuous variables, similar to what we did with the Gapminder dataset. Which leads onto the following activity.</p>
<div id="activity-11" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Activity</h3>
<p>Create the following scatterplots:</p>
<ol style="list-style-type: lower-alpha">
<li>prestige against education</li>
<li>prestige against income</li>
</ol>
<p>Describe the relationship you see.</p>
</div>
<div id="answer-14" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Answer</h3>
<p><strong>a. prestige against education</strong></p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="linear-regression.html#cb152-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb152-2"><a href="linear-regression.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> prestige)) <span class="sc">+</span></span>
<span id="cb152-3"><a href="linear-regression.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb152-4"><a href="linear-regression.html#cb152-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Average years of education&quot;</span>,</span>
<span id="cb152-5"><a href="linear-regression.html#cb152-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pineo-Porter prestige&quot;</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-113-1.png" width="672" /></p>
<p>There appears to be a linear association between education and prestige; more education is associated with higher prestige.</p>
<p><strong>b. prestige against income</strong></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="linear-regression.html#cb153-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb153-2"><a href="linear-regression.html#cb153-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> income, <span class="at">y =</span> prestige)) <span class="sc">+</span></span>
<span id="cb153-3"><a href="linear-regression.html#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb153-4"><a href="linear-regression.html#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Average income (dollars)&quot;</span>,</span>
<span id="cb153-5"><a href="linear-regression.html#cb153-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;Pineo-Porter prestige&quot;</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-114-1.png" width="672" /></p>
<p>Up to around $10000, there seems to be a linear correlation between income and prestige, after which the relationship flattens out, i.e., more income does not lead to higher prestige. (At least, that’s what I see!)</p>
</div>
</div>
<div id="prep-to-understand-the-simplest-regression-model" class="section level2 tabset" number="5.5">
<h2><span class="header-section-number">5.5</span> Prep to understand the simplest regression model</h2>
<div id="activity-12" class="section level3" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Activity</h3>
<p>The simplest regression model we will explore in a moment just models the mean of the outcome variable. So that we can see how it works, first calculate the mean and SD of prestige.</p>
</div>
<div id="answer-15" class="section level3" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Answer</h3>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="linear-regression.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat<span class="sc">$</span>prestige)</span></code></pre></div>
<pre><code>## [1] 46.83333</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="linear-regression.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(dat<span class="sc">$</span>prestige)</span></code></pre></div>
<pre><code>## [1] 17.20449</code></pre>
</div>
</div>
<div id="the-simplest-regression-model-intercept-only-model" class="section level2 tabset" number="5.6">
<h2><span class="header-section-number">5.6</span> The simplest regression model: intercept-only model</h2>
<p>The command for fitting a regression model is called <code>lm</code>, which is short for <em>linear model</em>. It wants a formula, describing the model to be fitted, and the name of a data frame containing your data.</p>
<p>Here is how to fit the intercept-only model:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="linear-regression.html#cb158-1" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> prestige <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> dat)</span></code></pre></div>
<p>The left-hand side of <code>~</code> (tilde) is the <em>outcome</em> or <em>response</em> variable we want to explain/predict. The right-hand side lists predictors. Here <code>1</code> denotes the intercept.</p>
<p>Since the first two parameters of <code>lm</code> are formula and data (check <code>?lm</code>), this can be abbreviated to:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="linear-regression.html#cb159-1" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> <span class="dv">1</span>, dat)</span></code></pre></div>
<p>As ever, since we have saved the result in a variable, nothing has visibly happened. You could have a peek at the result with:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="linear-regression.html#cb160-1" aria-hidden="true" tabindex="-1"></a>mod0</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ 1, data = dat)
## 
## Coefficients:
## (Intercept)  
##       46.83</code></pre>
<p>There is a LOT more info in the object which you can see with this structure command, <code>str</code>:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="linear-regression.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mod0)</span></code></pre></div>
<p>If you run this you will see why we usually prefer to use <code>summary</code> on the output; this pulls out useful info and presents it in a straightforward way:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="linear-regression.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod0)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ 1, data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -32.033 -11.608  -3.233  12.442  40.367 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   46.833      1.703   27.49   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 17.2 on 101 degrees of freedom</code></pre>
<p>The estimate for the intercept is 46.833, the same as the mean of prestige we calculated above.</p>
<p>There is other information:</p>
<ul>
<li>The <strong>standard error (SE)</strong>, which provides information on the precision of the estimate: the smaller the SE, the more precise the estimate of the population mean.</li>
<li>The <strong>t-value</strong>, which is equal to the estimate divided by the SE. This is used to test whether the estimate is different to zero, which isn’t particularly informative for the intercept; it’s more so when we get to slopes in a moment.</li>
<li>The <strong>p-value</strong> is calculated from the distribution of <em>t</em> under the assumption that the population estimate is 0 and helps us interpret the <em>t</em>. R presents it here as “&lt;2e-16.” This says that <em>p</em> is less than 0.0000000000000002, or <span class="math inline">\(2 \times 10^{-16}\)</span>. So, for what it’s worth, and using the usual not-entirely-correct applied stats vernacular: the intercept, here mean prestige, is statistically significantly greater than zero.</li>
<li>We will get to the <strong>residual standard error</strong> later, but for now observe that it is the same as the SD of prestige.</li>
</ul>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="linear-regression.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(dat<span class="sc">$</span>prestige)</span></code></pre></div>
<pre><code>## [1] 17.20449</code></pre>
<p>Okay, so you have calculated the mean and SD of a variable in an absurdly convolved way, alongside a statistical test that probably isn’t any use.</p>
<p>Why have I done this to you?</p>
<p>Two reasons:</p>
<ol style="list-style-type: decimal">
<li>It is useful to see what models do for the simplest possible specification – increasingly useful as the models become more complicated.</li>
<li>The intercept-only model can be compared with more complex models, i.e., models with more predictors, to see if adding predictors actually explains more variance.</li>
</ol>
<div id="activity-13" class="section level3" number="5.6.1">
<h3><span class="header-section-number">5.6.1</span> Activity</h3>
<p>Try fitting the intercept-only model again for the education variable. Compare the result with its mean and SD.</p>
</div>
<div id="answer-16" class="section level3" number="5.6.2">
<h3><span class="header-section-number">5.6.2</span> Answer</h3>
<p>The mean is:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="linear-regression.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(dat<span class="sc">$</span>education)</span></code></pre></div>
<pre><code>## [1] 10.73804</code></pre>
<p>The SD:</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="linear-regression.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(dat<span class="sc">$</span>education)</span></code></pre></div>
<pre><code>## [1] 2.728444</code></pre>
<p>Fit the model:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="linear-regression.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(education <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> dat) <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="linear-regression.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = education ~ 1, data = dat)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -4.358 -2.293 -0.198  1.909  5.232 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  10.7380     0.2702   39.75   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 2.728 on 101 degrees of freedom</code></pre>
<p>(Here I have used a pipe – again do whatever makes most sense!)</p>
</div>
</div>
<div id="adding-a-slope-to-the-regression-model" class="section level2 tabset" number="5.7">
<h2><span class="header-section-number">5.7</span> Adding a slope to the regression model</h2>
<p>So that was a silly model.</p>
<p>Next we are going to add years of education as a predictor to see if it explains any of the variation in prestige. Before doing so, here is a picture of the relationship from earlier.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="linear-regression.html#cb173-1" aria-hidden="true" tabindex="-1"></a>plot_ed_prestige <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> education,</span>
<span id="cb173-2"><a href="linear-regression.html#cb173-2" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y =</span> prestige)) <span class="sc">+</span></span>
<span id="cb173-3"><a href="linear-regression.html#cb173-3" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">geom_point</span>()</span>
<span id="cb173-4"><a href="linear-regression.html#cb173-4" aria-hidden="true" tabindex="-1"></a>plot_ed_prestige</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-126-1.png" width="672" /></p>
<p>I am confident that there is a positive relationship between education and prestige, using the <a href="https://www.johndcook.com/blog/2009/08/31/the-iot-test/">interocular trauma test</a>, but it is instructive to see the intercept-only model prediction overlaid on this graph.</p>
<p>To extract the coefficients from a model, we use <code>coef</code>:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="linear-regression.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod0)</span></code></pre></div>
<pre><code>## (Intercept) 
##    46.83333</code></pre>
<p>In this case, there only is one estimate, so this is equivalent to:</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="linear-regression.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod0)[<span class="dv">1</span>]</span></code></pre></div>
<pre><code>## (Intercept) 
##    46.83333</code></pre>
<p>But usually there will be more than one coefficient in a model.</p>
<p>Since we saved the earlier plot, it is easy to add on a horizontal line for the intercept-only model:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="linear-regression.html#cb178-1" aria-hidden="true" tabindex="-1"></a>plot_ed_prestige <span class="sc">+</span></span>
<span id="cb178-2"><a href="linear-regression.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">coef</span>(mod0)[<span class="dv">1</span>])</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-129-1.png" width="672" /></p>
<p>Now let’s fit the surely better model:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="linear-regression.html#cb179-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> education, <span class="at">data =</span> dat)</span>
<span id="cb179-2"><a href="linear-regression.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ 1 + education, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -26.0397  -6.5228   0.6611   6.7430  18.1636 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -10.732      3.677  -2.919  0.00434 ** 
## education      5.361      0.332  16.148  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 9.103 on 100 degrees of freedom
## Multiple R-squared:  0.7228, Adjusted R-squared:   0.72 
## F-statistic: 260.8 on 1 and 100 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>(Note: <code>prestige ~ 1 + education</code> is equivalent to <code>prestige ~ education</code>; R puts the intercept in by default. Try both to see!)</p>
<p>We can plot the the predicted mean prestige for each year of education using the model’s coefficients…</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="linear-regression.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod1)</span></code></pre></div>
<pre><code>## (Intercept)   education 
##  -10.731982    5.360878</code></pre>
<p>… with <code>geom_abline</code> (pronounced “A B line,” named after a base R function <code>abline</code> where <em>a</em> is the intercept and <em>b</em> is the slope) like so:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="linear-regression.html#cb183-1" aria-hidden="true" tabindex="-1"></a>plot_ed_prestige <span class="sc">+</span></span>
<span id="cb183-2"><a href="linear-regression.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(mod1)[<span class="dv">1</span>],</span>
<span id="cb183-3"><a href="linear-regression.html#cb183-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">coef</span>(mod1)[<span class="dv">2</span>])</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-132-1.png" width="672" /></p>
<p>The <strong>intercept</strong> is -10.732. This is clearly no longer the mean of prestige (scroll up and you will see that the measure is defined as a number between 0-100); rather, <strong>the intercept is the predicted mean of the outcome variable where other predictors are zero</strong> so it depends on what other predictors are present in the model.</p>
<p>Here’s another picture, stretched to show where the intercept is:</p>
<p><img src="R-notes_files/figure-html/unnamed-chunk-133-1.png" width="672" /></p>
<p>It is not uncommon for the intercept to be substantively nonsense, but statistically necessary to ensure accurate slopes. We will see later how to make the intercept more interpretable, without changing the slope estimates.</p>
<p>The <strong>slope for education</strong> is 5.361. This means that for every unit increase in education, the prestige score increases by 5.361. The units for education are years, so we should say something like: every year increase in education is associated with 5.4 more prestige points. Is this a big effect do you reckon?</p>
<p>As before, the <em>t</em>’s and <em>p</em>’s are present. Now the p-value for education is actually useful. The value is <code>&lt; 2e-16</code>, i.e., less than <span class="math inline">\(2 \times 10^{-16}\)</span>. This means the sample-estimate of the slope we got would be very unlikely if the population slope were zero. Or, in the usual applied stats vernacular: there is a statistically significant relationship between education and prestige. (Keep a look out for how results are summarised in the literature you are exploring – again I urge you to look at journal articles in your field to get ideas for write-up aesthetics.)</p>
<p>The <span class="math inline">\(R^2\)</span> is also useful. The <code>summary</code> command presents <span class="math inline">\(R^2\)</span> as a proportion; it represents the proportion of the variance in the outcome variable explained by the predictors. Generally we use the adjusted <span class="math inline">\(R^2\)</span> because this adjusts for the number of predictors in the model and reduces bias in the estimate. If <span class="math inline">\(R^2\)</span> were 0 then that would mean that the predictors don’t explain any variance in the outcome. If it were 1, that would mean that the predictors explain all the variance – statistically, knowing the outcome variable does not add any further information.</p>
<div id="activity-14" class="section level3" number="5.7.1">
<h3><span class="header-section-number">5.7.1</span> Activity</h3>
<p>Use a regression model with prestige as the outcome variable and average income as a predictor. Describe the relationship according to the model and whether it is statistically significant.</p>
<p>It will help to check above to see what units the income is measured in.</p>
</div>
<div id="answer-17" class="section level3" number="5.7.2">
<h3><span class="header-section-number">5.7.2</span> Answer</h3>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="linear-regression.html#cb184-1" aria-hidden="true" tabindex="-1"></a>mod_income <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> income, <span class="at">data =</span> dat)</span>
<span id="cb184-2"><a href="linear-regression.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_income)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ income, data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -33.007  -8.378  -2.378   8.432  32.084 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) 2.714e+01  2.268e+00   11.97   &lt;2e-16 ***
## income      2.897e-03  2.833e-04   10.22   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 12.09 on 100 degrees of freedom
## Multiple R-squared:  0.5111, Adjusted R-squared:  0.5062 
## F-statistic: 104.5 on 1 and 100 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The slope for income is “statistically significant” at the traditional 5% level, with a very small <span class="math inline">\(p\)</span>. But what did you make of that slope estimate, <code>2.897e-03</code>? This is equivalent to <span class="math inline">\(2.897 \times 10^{-3}\)</span> or about 0.0029. So for every unit increase in income, the prestige score goes up by 0.0029 on a scale from 0-100. The income units here are the Canadian dollar. We probably don’t expect much of an increase in prestige for one extra dollar income!</p>
<p>Here’s the coefficient:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="linear-regression.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod_income)[<span class="dv">2</span>]</span></code></pre></div>
<pre><code>##      income 
## 0.002896799</code></pre>
<p>We might expect 1000 dollars more salary to have more of an impact:</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="linear-regression.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod_income)[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">1000</span></span></code></pre></div>
<pre><code>##   income 
## 2.896799</code></pre>
<p>So $1000 more salary is associated with about 2.9 more prestige points.</p>
<p>Another way to do this is as follows.</p>
<p>First transform the salary so it is in thousands of dollars rather than single dollars. I’ll <code>mutate</code> the data frame to add a new variable called <code>income_1000s</code>:</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="linear-regression.html#cb190-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb190-2"><a href="linear-regression.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">income_1000s =</span> income<span class="sc">/</span><span class="dv">1000</span>)</span></code></pre></div>
<p>Now fit the model again using this new variable as the predictor.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="linear-regression.html#cb191-1" aria-hidden="true" tabindex="-1"></a>mod_income1000s <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> income_1000s, <span class="at">data =</span> dat)</span>
<span id="cb191-2"><a href="linear-regression.html#cb191-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_income1000s)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ income_1000s, data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -33.007  -8.378  -2.378   8.432  32.084 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   27.1412     2.2677   11.97   &lt;2e-16 ***
## income_1000s   2.8968     0.2833   10.22   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 12.09 on 100 degrees of freedom
## Multiple R-squared:  0.5111, Adjusted R-squared:  0.5062 
## F-statistic: 104.5 on 1 and 100 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Note how the <em>t</em> and <em>p</em> haven’t changed; however, now the estimate for income is easier to interpret.</p>
</div>
</div>
<div id="residuals" class="section level2 tabset" number="5.8">
<h2><span class="header-section-number">5.8</span> Residuals</h2>
<p>Residuals are important for understanding regression fits. They are calculated for each data point and a given model as the difference between the actual value of the outcome variable and the model prediction. There are pictures coming up which will illustrate.</p>
<p>R gives us model predictions using the <code>predict</code> command and also automatically calculates residuals using <code>resid</code>.</p>
<p>Let’s first do it for the intercept-only model.</p>
<p>The code below says:</p>
<ul>
<li>select the variables prestige and education (this is to keep things neat and tidy)</li>
<li>add variables <code>predict0</code> and <code>resid0</code> which consist of the predictions and residuals, respectively, for <code>mod0</code></li>
<li>save it all in <code>dat_for_resids</code></li>
</ul>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="linear-regression.html#cb193-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb193-2"><a href="linear-regression.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prestige, education) <span class="sc">%&gt;%</span></span>
<span id="cb193-3"><a href="linear-regression.html#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predict0  =</span> <span class="fu">predict</span>(mod0),</span>
<span id="cb193-4"><a href="linear-regression.html#cb193-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">residual0 =</span> <span class="fu">resid</span>(mod0))</span>
<span id="cb193-5"><a href="linear-regression.html#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat_for_resids, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    prestige education predict0 residual0
## 1      68.8     13.11 46.83333 21.966667
## 2      69.1     12.26 46.83333 22.266667
## 3      63.4     12.77 46.83333 16.566667
## 4      56.8     11.42 46.83333  9.966667
## 5      73.5     14.62 46.83333 26.666667
## 6      77.6     15.64 46.83333 30.766667
## 7      72.6     15.09 46.83333 25.766667
## 8      78.1     15.44 46.83333 31.266667
## 9      73.1     14.52 46.83333 26.266667
## 10     68.8     14.64 46.83333 21.966667</code></pre>
<p>Since it’s the intercept-only model, the prediction is always the mean; that’s why <code>predict0</code> says 46.83333, 46.83333, 46.83333, 46.83333, 46.83333…</p>
<p>Look at the first residual, 21.97. That is calculated as the actual value of prestige minus the model-predicted value: <span class="math inline">\(68.8 - 46.83\)</span>.</p>
<p>Here is a picture showing the residuals; hopefully this highlights that they just measure how far each data point is from the model prediction:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb195-1"><a href="linear-regression.html#cb195-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="sc">%&gt;%</span></span>
<span id="cb195-2"><a href="linear-regression.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> prestige)) <span class="sc">+</span></span>
<span id="cb195-3"><a href="linear-regression.html#cb195-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> education, <span class="at">yend =</span> predict0)) <span class="sc">+</span></span>
<span id="cb195-4"><a href="linear-regression.html#cb195-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb195-5"><a href="linear-regression.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">coef</span>(mod0))</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-140-1.png" width="672" /></p>
<p>Now let’s calculate predictions and residuals again for the more sensible model, <code>mod1</code>.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="linear-regression.html#cb196-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="ot">&lt;-</span> dat_for_resids  <span class="sc">%&gt;%</span></span>
<span id="cb196-2"><a href="linear-regression.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predict1  =</span> <span class="fu">predict</span>(mod1),</span>
<span id="cb196-3"><a href="linear-regression.html#cb196-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">residual1 =</span> <span class="fu">resid</span>(mod1))</span>
<span id="cb196-4"><a href="linear-regression.html#cb196-4" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="sc">%&gt;%</span></span>
<span id="cb196-5"><a href="linear-regression.html#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prestige, predict1, residual1, residual0) <span class="sc">%&gt;%</span></span>
<span id="cb196-6"><a href="linear-regression.html#cb196-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code></pre></div>
<pre><code>##    prestige predict1 residual1 residual0
## 1      68.8 59.54913  9.250875 21.966667
## 2      69.1 54.99238 14.107621 22.266667
## 3      63.4 57.72643  5.673573 16.566667
## 4      56.8 50.48924  6.310758  9.966667
## 5      73.5 67.64405  5.855950 26.666667
## 6      77.6 73.11215  4.487854 30.766667
## 7      72.6 70.16366  2.436337 25.766667
## 8      78.1 72.03997  6.060030 31.266667
## 9      73.1 67.10796  5.992037 26.266667
## 10     68.8 67.75127  1.048732 21.966667</code></pre>
<p>Here is the plot:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb198-1"><a href="linear-regression.html#cb198-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="sc">%&gt;%</span></span>
<span id="cb198-2"><a href="linear-regression.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> prestige)) <span class="sc">+</span></span>
<span id="cb198-3"><a href="linear-regression.html#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> education, <span class="at">yend =</span> predict1)) <span class="sc">+</span></span>
<span id="cb198-4"><a href="linear-regression.html#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb198-5"><a href="linear-regression.html#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(mod1)[<span class="dv">1</span>],</span>
<span id="cb198-6"><a href="linear-regression.html#cb198-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">coef</span>(mod1)[<span class="dv">2</span>])</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<div id="activity-15" class="section level3" number="5.8.1">
<h3><span class="header-section-number">5.8.1</span> Activity</h3>
<p>The second model clearly describes the data better than the intercept-only model, but can you explain why, solely in terms of the residuals?</p>
</div>
<div id="answer-18" class="section level3" number="5.8.2">
<h3><span class="header-section-number">5.8.2</span> Answer</h3>
<p>The residuals seem smaller. Intuitively, roughly, that’s what is going on.
Are <em>all</em> the residuals smaller? We can work out the length of the residual (i.e., the distance between model prediction and actual data), ignoring the sign, by using “absolute” function, <code>abs</code>, and then take the difference:</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="linear-regression.html#cb199-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="ot">&lt;-</span> dat_for_resids <span class="sc">%&gt;%</span></span>
<span id="cb199-2"><a href="linear-regression.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resid_diff =</span> <span class="fu">abs</span>(residual1) <span class="sc">-</span> <span class="fu">abs</span>(residual0),</span>
<span id="cb199-3"><a href="linear-regression.html#cb199-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">intercept_better =</span> resid_diff <span class="sc">&gt;=</span> <span class="dv">0</span>)</span></code></pre></div>
<p>I have also added a variable called <code>intercept_better</code> if the intercept-only model has a smaller residual for that observation than the more complex model.</p>
<p>Have a look:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="linear-regression.html#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(dat_for_resids)</span></code></pre></div>
<p>The answer is… no, not all residuals are smaller for the complex model.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="linear-regression.html#cb201-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="sc">%&gt;%</span></span>
<span id="cb201-2"><a href="linear-regression.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(intercept_better) <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="linear-regression.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
## # Groups:   intercept_better [2]
##   intercept_better     n
##   &lt;lgl&gt;            &lt;int&gt;
## 1 FALSE               73
## 2 TRUE                29</code></pre>
<p>For 29 observations, the intercept-only model has smaller residuals than the model with a slope for education.</p>
<p>This makes sense if we look again at the graph for the intercept-only model, this time with the lines coloured by whether the intercept-only model is better. I have also added a dashed line for the model with a slope for education.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb203-1"><a href="linear-regression.html#cb203-1" aria-hidden="true" tabindex="-1"></a>dat_for_resids <span class="sc">%&gt;%</span></span>
<span id="cb203-2"><a href="linear-regression.html#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> prestige, <span class="at">colour =</span> intercept_better)) <span class="sc">+</span></span>
<span id="cb203-3"><a href="linear-regression.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> education, <span class="at">yend =</span> predict0)) <span class="sc">+</span></span>
<span id="cb203-4"><a href="linear-regression.html#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb203-5"><a href="linear-regression.html#cb203-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">coef</span>(mod0)) <span class="sc">+</span></span>
<span id="cb203-6"><a href="linear-regression.html#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">colour =</span> <span class="st">&quot;Intercept-only better&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-7"><a href="linear-regression.html#cb203-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(mod1)[<span class="dv">1</span>],</span>
<span id="cb203-8"><a href="linear-regression.html#cb203-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">coef</span>(mod1)[<span class="dv">2</span>],</span>
<span id="cb203-9"><a href="linear-regression.html#cb203-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-146-1.png" width="672" /></p>
<p>So it’s not quite true that all the residuals are smaller in the more complex model. Most are, though.</p>
<p>One way to combine all the residuals is to square them first (to remove the sign, i.e., whether the residual is positive or negative), and sum them together. This is called the <strong>residual sum of squares</strong> and, it turns out, is what the regression model minimises for any particular dataset.</p>
<p>Here’s the arithmetic for the intercept-only model:</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="linear-regression.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(dat_for_resids<span class="sc">$</span>residual0<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 29895.43</code></pre>
<p>And here’s the arithmetic for the model with a predictor for education:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="linear-regression.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(dat_for_resids<span class="sc">$</span>residual1<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 8286.99</code></pre>
<p>So the residual sum of squares are smaller for the latter model.</p>
</div>
</div>
<div id="comparing-models" class="section level2" number="5.9">
<h2><span class="header-section-number">5.9</span> Comparing models</h2>
<p>Here is a reminder of two of the models we fitted:</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="linear-regression.html#cb208-1" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> <span class="dv">1</span>,             <span class="at">data =</span> dat)</span>
<span id="cb208-2"><a href="linear-regression.html#cb208-2" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> education, <span class="at">data =</span> dat)</span></code></pre></div>
<p>To compare these, use <code>anova</code>, with the least complex model first:</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="linear-regression.html#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod0, mod1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: prestige ~ 1
## Model 2: prestige ~ 1 + education
##   Res.Df   RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    101 29895                                  
## 2    100  8287  1     21608 260.75 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>This only works for <em>nested</em> models, where the smaller model’s predictors are also included in the larger model. This is true here, since the larger model is the same as the intercept-only model with the addition of a slope for education.</p>
<p>The <code>anova</code> command has calculated the residual sum of squares (RSS) for us. There is also a p-value; since it is far smaller than 0.05, we can conclude that the more complex model explains statistically significantly more variance.</p>
<p>We would usually write this as (something like): the model with education as a predictor explains prestige better than the intercept-only model, <span class="math inline">\(F(1,100) = 260.8\)</span>, <span class="math inline">\(p &lt; .001\)</span>. (Generally when the p-value is very small, we use the less-than in this fashion.)</p>
</div>
<div id="regression-with-two-or-more-predictors" class="section level2 tabset" number="5.10">
<h2><span class="header-section-number">5.10</span> Regression with two or more predictors</h2>
<p>Linear regression models can include arbitrary numbers of predictors – in social science, often a dozen or more. They become increasingly challenging to visualise in higher dimensions, so let’s start with two predictors, education and income.</p>
<p>When you run the code below, a window will pop up with an interactive 3D plot.</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="linear-regression.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb211-2"><a href="linear-regression.html#cb211-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgl)</span>
<span id="cb211-3"><a href="linear-regression.html#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter3d</span>(prestige <span class="sc">~</span> education <span class="sc">+</span> income, <span class="at">data =</span> dat, <span class="at">surface =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<script>/*
* Copyright (C) 2009 Apple Inc. All Rights Reserved.
*
* Redistribution and use in source and binary forms, with or without
* modification, are permitted provided that the following conditions
* are met:
* 1. Redistributions of source code must retain the above copyright
*    notice, this list of conditions and the following disclaimer.
* 2. Redistributions in binary form must reproduce the above copyright
*    notice, this list of conditions and the following disclaimer in the
*    documentation and/or other materials provided with the distribution.
*
* THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS'' AND ANY
* EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
* PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
* EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
* PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
* PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
* (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
* OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
* Copyright (2016) Duncan Murdoch - fixed CanvasMatrix4.ortho,
* cleaned up.
*/
/*
CanvasMatrix4 class
This class implements a 4x4 matrix. It has functions which
duplicate the functionality of the OpenGL matrix stack and
glut functions.
IDL:
[
Constructor(in CanvasMatrix4 matrix),           // copy passed matrix into new CanvasMatrix4
Constructor(in sequence<float> array)           // create new CanvasMatrix4 with 16 floats (row major)
Constructor()                                   // create new CanvasMatrix4 with identity matrix
]
interface CanvasMatrix4 {
attribute float m11;
attribute float m12;
attribute float m13;
attribute float m14;
attribute float m21;
attribute float m22;
attribute float m23;
attribute float m24;
attribute float m31;
attribute float m32;
attribute float m33;
attribute float m34;
attribute float m41;
attribute float m42;
attribute float m43;
attribute float m44;
void load(in CanvasMatrix4 matrix);                 // copy the values from the passed matrix
void load(in sequence<float> array);                // copy 16 floats into the matrix
sequence<float> getAsArray();                       // return the matrix as an array of 16 floats
WebGLFloatArray getAsCanvasFloatArray();           // return the matrix as a WebGLFloatArray with 16 values
void makeIdentity();                                // replace the matrix with identity
void transpose();                                   // replace the matrix with its transpose
void invert();                                      // replace the matrix with its inverse
void translate(in float x, in float y, in float z); // multiply the matrix by passed translation values on the right
void scale(in float x, in float y, in float z);     // multiply the matrix by passed scale values on the right
void rotate(in float angle,                         // multiply the matrix by passed rotation values on the right
in float x, in float y, in float z);    // (angle is in degrees)
void multRight(in CanvasMatrix matrix);             // multiply the matrix by the passed matrix on the right
void multLeft(in CanvasMatrix matrix);              // multiply the matrix by the passed matrix on the left
void ortho(in float left, in float right,           // multiply the matrix by the passed ortho values on the right
in float bottom, in float top,
in float near, in float far);
void frustum(in float left, in float right,         // multiply the matrix by the passed frustum values on the right
in float bottom, in float top,
in float near, in float far);
void perspective(in float fovy, in float aspect,    // multiply the matrix by the passed perspective values on the right
in float zNear, in float zFar);
void lookat(in float eyex, in float eyey, in float eyez,    // multiply the matrix by the passed lookat
in float ctrx, in float ctry, in float ctrz,    // values on the right
in float upx, in float upy, in float upz);
}
*/
CanvasMatrix4 = function(m)
{
if (typeof m == 'object') {
if ("length" in m && m.length >= 16) {
this.load(m[0], m[1], m[2], m[3], m[4], m[5], m[6], m[7], m[8], m[9], m[10], m[11], m[12], m[13], m[14], m[15]);
return;
}
else if (m instanceof CanvasMatrix4) {
this.load(m);
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.load = function()
{
if (arguments.length == 1 && typeof arguments[0] == 'object') {
var matrix = arguments[0];
if ("length" in matrix && matrix.length == 16) {
this.m11 = matrix[0];
this.m12 = matrix[1];
this.m13 = matrix[2];
this.m14 = matrix[3];
this.m21 = matrix[4];
this.m22 = matrix[5];
this.m23 = matrix[6];
this.m24 = matrix[7];
this.m31 = matrix[8];
this.m32 = matrix[9];
this.m33 = matrix[10];
this.m34 = matrix[11];
this.m41 = matrix[12];
this.m42 = matrix[13];
this.m43 = matrix[14];
this.m44 = matrix[15];
return;
}
if (arguments[0] instanceof CanvasMatrix4) {
this.m11 = matrix.m11;
this.m12 = matrix.m12;
this.m13 = matrix.m13;
this.m14 = matrix.m14;
this.m21 = matrix.m21;
this.m22 = matrix.m22;
this.m23 = matrix.m23;
this.m24 = matrix.m24;
this.m31 = matrix.m31;
this.m32 = matrix.m32;
this.m33 = matrix.m33;
this.m34 = matrix.m34;
this.m41 = matrix.m41;
this.m42 = matrix.m42;
this.m43 = matrix.m43;
this.m44 = matrix.m44;
return;
}
}
this.makeIdentity();
};
CanvasMatrix4.prototype.getAsArray = function()
{
return [
this.m11, this.m12, this.m13, this.m14,
this.m21, this.m22, this.m23, this.m24,
this.m31, this.m32, this.m33, this.m34,
this.m41, this.m42, this.m43, this.m44
];
};
CanvasMatrix4.prototype.getAsWebGLFloatArray = function()
{
return new WebGLFloatArray(this.getAsArray());
};
CanvasMatrix4.prototype.makeIdentity = function()
{
this.m11 = 1;
this.m12 = 0;
this.m13 = 0;
this.m14 = 0;
this.m21 = 0;
this.m22 = 1;
this.m23 = 0;
this.m24 = 0;
this.m31 = 0;
this.m32 = 0;
this.m33 = 1;
this.m34 = 0;
this.m41 = 0;
this.m42 = 0;
this.m43 = 0;
this.m44 = 1;
};
CanvasMatrix4.prototype.transpose = function()
{
var tmp = this.m12;
this.m12 = this.m21;
this.m21 = tmp;
tmp = this.m13;
this.m13 = this.m31;
this.m31 = tmp;
tmp = this.m14;
this.m14 = this.m41;
this.m41 = tmp;
tmp = this.m23;
this.m23 = this.m32;
this.m32 = tmp;
tmp = this.m24;
this.m24 = this.m42;
this.m42 = tmp;
tmp = this.m34;
this.m34 = this.m43;
this.m43 = tmp;
};
CanvasMatrix4.prototype.invert = function()
{
// Calculate the 4x4 determinant
// If the determinant is zero,
// then the inverse matrix is not unique.
var det = this._determinant4x4();
if (Math.abs(det) < 1e-8)
return null;
this._makeAdjoint();
// Scale the adjoint matrix to get the inverse
this.m11 /= det;
this.m12 /= det;
this.m13 /= det;
this.m14 /= det;
this.m21 /= det;
this.m22 /= det;
this.m23 /= det;
this.m24 /= det;
this.m31 /= det;
this.m32 /= det;
this.m33 /= det;
this.m34 /= det;
this.m41 /= det;
this.m42 /= det;
this.m43 /= det;
this.m44 /= det;
};
CanvasMatrix4.prototype.translate = function(x,y,z)
{
if (x === undefined)
x = 0;
if (y === undefined)
y = 0;
if (z === undefined)
z = 0;
var matrix = new CanvasMatrix4();
matrix.m41 = x;
matrix.m42 = y;
matrix.m43 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.scale = function(x,y,z)
{
if (x === undefined)
x = 1;
if (z === undefined) {
if (y === undefined) {
y = x;
z = x;
}
else
z = 1;
}
else if (y === undefined)
y = x;
var matrix = new CanvasMatrix4();
matrix.m11 = x;
matrix.m22 = y;
matrix.m33 = z;
this.multRight(matrix);
};
CanvasMatrix4.prototype.rotate = function(angle,x,y,z)
{
// angles are in degrees. Switch to radians
angle = angle / 180 * Math.PI;
angle /= 2;
var sinA = Math.sin(angle);
var cosA = Math.cos(angle);
var sinA2 = sinA * sinA;
// normalize
var length = Math.sqrt(x * x + y * y + z * z);
if (length === 0) {
// bad vector, just use something reasonable
x = 0;
y = 0;
z = 1;
} else if (length != 1) {
x /= length;
y /= length;
z /= length;
}
var mat = new CanvasMatrix4();
// optimize case where axis is along major axis
if (x == 1 && y === 0 && z === 0) {
mat.m11 = 1;
mat.m12 = 0;
mat.m13 = 0;
mat.m21 = 0;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 2 * sinA * cosA;
mat.m31 = 0;
mat.m32 = -2 * sinA * cosA;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y == 1 && z === 0) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 0;
mat.m13 = -2 * sinA * cosA;
mat.m21 = 0;
mat.m22 = 1;
mat.m23 = 0;
mat.m31 = 2 * sinA * cosA;
mat.m32 = 0;
mat.m33 = 1 - 2 * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else if (x === 0 && y === 0 && z == 1) {
mat.m11 = 1 - 2 * sinA2;
mat.m12 = 2 * sinA * cosA;
mat.m13 = 0;
mat.m21 = -2 * sinA * cosA;
mat.m22 = 1 - 2 * sinA2;
mat.m23 = 0;
mat.m31 = 0;
mat.m32 = 0;
mat.m33 = 1;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
} else {
var x2 = x*x;
var y2 = y*y;
var z2 = z*z;
mat.m11 = 1 - 2 * (y2 + z2) * sinA2;
mat.m12 = 2 * (x * y * sinA2 + z * sinA * cosA);
mat.m13 = 2 * (x * z * sinA2 - y * sinA * cosA);
mat.m21 = 2 * (y * x * sinA2 - z * sinA * cosA);
mat.m22 = 1 - 2 * (z2 + x2) * sinA2;
mat.m23 = 2 * (y * z * sinA2 + x * sinA * cosA);
mat.m31 = 2 * (z * x * sinA2 + y * sinA * cosA);
mat.m32 = 2 * (z * y * sinA2 - x * sinA * cosA);
mat.m33 = 1 - 2 * (x2 + y2) * sinA2;
mat.m14 = mat.m24 = mat.m34 = 0;
mat.m41 = mat.m42 = mat.m43 = 0;
mat.m44 = 1;
}
this.multRight(mat);
};
CanvasMatrix4.prototype.multRight = function(mat)
{
var m11 = (this.m11 * mat.m11 + this.m12 * mat.m21 +
this.m13 * mat.m31 + this.m14 * mat.m41);
var m12 = (this.m11 * mat.m12 + this.m12 * mat.m22 +
this.m13 * mat.m32 + this.m14 * mat.m42);
var m13 = (this.m11 * mat.m13 + this.m12 * mat.m23 +
this.m13 * mat.m33 + this.m14 * mat.m43);
var m14 = (this.m11 * mat.m14 + this.m12 * mat.m24 +
this.m13 * mat.m34 + this.m14 * mat.m44);
var m21 = (this.m21 * mat.m11 + this.m22 * mat.m21 +
this.m23 * mat.m31 + this.m24 * mat.m41);
var m22 = (this.m21 * mat.m12 + this.m22 * mat.m22 +
this.m23 * mat.m32 + this.m24 * mat.m42);
var m23 = (this.m21 * mat.m13 + this.m22 * mat.m23 +
this.m23 * mat.m33 + this.m24 * mat.m43);
var m24 = (this.m21 * mat.m14 + this.m22 * mat.m24 +
this.m23 * mat.m34 + this.m24 * mat.m44);
var m31 = (this.m31 * mat.m11 + this.m32 * mat.m21 +
this.m33 * mat.m31 + this.m34 * mat.m41);
var m32 = (this.m31 * mat.m12 + this.m32 * mat.m22 +
this.m33 * mat.m32 + this.m34 * mat.m42);
var m33 = (this.m31 * mat.m13 + this.m32 * mat.m23 +
this.m33 * mat.m33 + this.m34 * mat.m43);
var m34 = (this.m31 * mat.m14 + this.m32 * mat.m24 +
this.m33 * mat.m34 + this.m34 * mat.m44);
var m41 = (this.m41 * mat.m11 + this.m42 * mat.m21 +
this.m43 * mat.m31 + this.m44 * mat.m41);
var m42 = (this.m41 * mat.m12 + this.m42 * mat.m22 +
this.m43 * mat.m32 + this.m44 * mat.m42);
var m43 = (this.m41 * mat.m13 + this.m42 * mat.m23 +
this.m43 * mat.m33 + this.m44 * mat.m43);
var m44 = (this.m41 * mat.m14 + this.m42 * mat.m24 +
this.m43 * mat.m34 + this.m44 * mat.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.multLeft = function(mat)
{
var m11 = (mat.m11 * this.m11 + mat.m12 * this.m21 +
mat.m13 * this.m31 + mat.m14 * this.m41);
var m12 = (mat.m11 * this.m12 + mat.m12 * this.m22 +
mat.m13 * this.m32 + mat.m14 * this.m42);
var m13 = (mat.m11 * this.m13 + mat.m12 * this.m23 +
mat.m13 * this.m33 + mat.m14 * this.m43);
var m14 = (mat.m11 * this.m14 + mat.m12 * this.m24 +
mat.m13 * this.m34 + mat.m14 * this.m44);
var m21 = (mat.m21 * this.m11 + mat.m22 * this.m21 +
mat.m23 * this.m31 + mat.m24 * this.m41);
var m22 = (mat.m21 * this.m12 + mat.m22 * this.m22 +
mat.m23 * this.m32 + mat.m24 * this.m42);
var m23 = (mat.m21 * this.m13 + mat.m22 * this.m23 +
mat.m23 * this.m33 + mat.m24 * this.m43);
var m24 = (mat.m21 * this.m14 + mat.m22 * this.m24 +
mat.m23 * this.m34 + mat.m24 * this.m44);
var m31 = (mat.m31 * this.m11 + mat.m32 * this.m21 +
mat.m33 * this.m31 + mat.m34 * this.m41);
var m32 = (mat.m31 * this.m12 + mat.m32 * this.m22 +
mat.m33 * this.m32 + mat.m34 * this.m42);
var m33 = (mat.m31 * this.m13 + mat.m32 * this.m23 +
mat.m33 * this.m33 + mat.m34 * this.m43);
var m34 = (mat.m31 * this.m14 + mat.m32 * this.m24 +
mat.m33 * this.m34 + mat.m34 * this.m44);
var m41 = (mat.m41 * this.m11 + mat.m42 * this.m21 +
mat.m43 * this.m31 + mat.m44 * this.m41);
var m42 = (mat.m41 * this.m12 + mat.m42 * this.m22 +
mat.m43 * this.m32 + mat.m44 * this.m42);
var m43 = (mat.m41 * this.m13 + mat.m42 * this.m23 +
mat.m43 * this.m33 + mat.m44 * this.m43);
var m44 = (mat.m41 * this.m14 + mat.m42 * this.m24 +
mat.m43 * this.m34 + mat.m44 * this.m44);
this.m11 = m11;
this.m12 = m12;
this.m13 = m13;
this.m14 = m14;
this.m21 = m21;
this.m22 = m22;
this.m23 = m23;
this.m24 = m24;
this.m31 = m31;
this.m32 = m32;
this.m33 = m33;
this.m34 = m34;
this.m41 = m41;
this.m42 = m42;
this.m43 = m43;
this.m44 = m44;
};
CanvasMatrix4.prototype.ortho = function(left, right, bottom, top, near, far)
{
var tx = (left + right) / (left - right);
var ty = (top + bottom) / (bottom - top);
var tz = (far + near) / (near - far);
var matrix = new CanvasMatrix4();
matrix.m11 = 2 / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = 0;
matrix.m32 = 0;
matrix.m33 = -2 / (far - near);
matrix.m34 = 0;
matrix.m41 = tx;
matrix.m42 = ty;
matrix.m43 = tz;
matrix.m44 = 1;
this.multRight(matrix);
};
CanvasMatrix4.prototype.frustum = function(left, right, bottom, top, near, far)
{
var matrix = new CanvasMatrix4();
var A = (right + left) / (right - left);
var B = (top + bottom) / (top - bottom);
var C = -(far + near) / (far - near);
var D = -(2 * far * near) / (far - near);
matrix.m11 = (2 * near) / (right - left);
matrix.m12 = 0;
matrix.m13 = 0;
matrix.m14 = 0;
matrix.m21 = 0;
matrix.m22 = 2 * near / (top - bottom);
matrix.m23 = 0;
matrix.m24 = 0;
matrix.m31 = A;
matrix.m32 = B;
matrix.m33 = C;
matrix.m34 = -1;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = D;
matrix.m44 = 0;
this.multRight(matrix);
};
CanvasMatrix4.prototype.perspective = function(fovy, aspect, zNear, zFar)
{
var top = Math.tan(fovy * Math.PI / 360) * zNear;
var bottom = -top;
var left = aspect * bottom;
var right = aspect * top;
this.frustum(left, right, bottom, top, zNear, zFar);
};
CanvasMatrix4.prototype.lookat = function(eyex, eyey, eyez, centerx, centery, centerz, upx, upy, upz)
{
var matrix = new CanvasMatrix4();
// Make rotation matrix
// Z vector
var zx = eyex - centerx;
var zy = eyey - centery;
var zz = eyez - centerz;
var mag = Math.sqrt(zx * zx + zy * zy + zz * zz);
if (mag) {
zx /= mag;
zy /= mag;
zz /= mag;
}
// Y vector
var yx = upx;
var yy = upy;
var yz = upz;
// X vector = Y cross Z
xx =  yy * zz - yz * zy;
xy = -yx * zz + yz * zx;
xz =  yx * zy - yy * zx;
// Recompute Y = Z cross X
yx = zy * xz - zz * xy;
yy = -zx * xz + zz * xx;
yx = zx * xy - zy * xx;
// cross product gives area of parallelogram, which is < 1.0 for
// non-perpendicular unit-length vectors; so normalize x, y here
mag = Math.sqrt(xx * xx + xy * xy + xz * xz);
if (mag) {
xx /= mag;
xy /= mag;
xz /= mag;
}
mag = Math.sqrt(yx * yx + yy * yy + yz * yz);
if (mag) {
yx /= mag;
yy /= mag;
yz /= mag;
}
matrix.m11 = xx;
matrix.m12 = xy;
matrix.m13 = xz;
matrix.m14 = 0;
matrix.m21 = yx;
matrix.m22 = yy;
matrix.m23 = yz;
matrix.m24 = 0;
matrix.m31 = zx;
matrix.m32 = zy;
matrix.m33 = zz;
matrix.m34 = 0;
matrix.m41 = 0;
matrix.m42 = 0;
matrix.m43 = 0;
matrix.m44 = 1;
matrix.translate(-eyex, -eyey, -eyez);
this.multRight(matrix);
};
// Support functions
CanvasMatrix4.prototype._determinant2x2 = function(a, b, c, d)
{
return a * d - b * c;
};
CanvasMatrix4.prototype._determinant3x3 = function(a1, a2, a3, b1, b2, b3, c1, c2, c3)
{
return a1 * this._determinant2x2(b2, b3, c2, c3) -
b1 * this._determinant2x2(a2, a3, c2, c3) +
c1 * this._determinant2x2(a2, a3, b2, b3);
};
CanvasMatrix4.prototype._determinant4x4 = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
return a1 * this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4) -
b1 * this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4) +
c1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4) -
d1 * this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
};
CanvasMatrix4.prototype._makeAdjoint = function()
{
var a1 = this.m11;
var b1 = this.m12;
var c1 = this.m13;
var d1 = this.m14;
var a2 = this.m21;
var b2 = this.m22;
var c2 = this.m23;
var d2 = this.m24;
var a3 = this.m31;
var b3 = this.m32;
var c3 = this.m33;
var d3 = this.m34;
var a4 = this.m41;
var b4 = this.m42;
var c4 = this.m43;
var d4 = this.m44;
// Row column labeling reversed since we transpose rows & columns
this.m11  =   this._determinant3x3(b2, b3, b4, c2, c3, c4, d2, d3, d4);
this.m21  = - this._determinant3x3(a2, a3, a4, c2, c3, c4, d2, d3, d4);
this.m31  =   this._determinant3x3(a2, a3, a4, b2, b3, b4, d2, d3, d4);
this.m41  = - this._determinant3x3(a2, a3, a4, b2, b3, b4, c2, c3, c4);
this.m12  = - this._determinant3x3(b1, b3, b4, c1, c3, c4, d1, d3, d4);
this.m22  =   this._determinant3x3(a1, a3, a4, c1, c3, c4, d1, d3, d4);
this.m32  = - this._determinant3x3(a1, a3, a4, b1, b3, b4, d1, d3, d4);
this.m42  =   this._determinant3x3(a1, a3, a4, b1, b3, b4, c1, c3, c4);
this.m13  =   this._determinant3x3(b1, b2, b4, c1, c2, c4, d1, d2, d4);
this.m23  = - this._determinant3x3(a1, a2, a4, c1, c2, c4, d1, d2, d4);
this.m33  =   this._determinant3x3(a1, a2, a4, b1, b2, b4, d1, d2, d4);
this.m43  = - this._determinant3x3(a1, a2, a4, b1, b2, b4, c1, c2, c4);
this.m14  = - this._determinant3x3(b1, b2, b3, c1, c2, c3, d1, d2, d3);
this.m24  =   this._determinant3x3(a1, a2, a3, c1, c2, c3, d1, d2, d3);
this.m34  = - this._determinant3x3(a1, a2, a3, b1, b2, b3, d1, d2, d3);
this.m44  =   this._determinant3x3(a1, a2, a3, b1, b2, b3, c1, c2, c3);
};</script>
<script>// To generate the help pages for this library, use
// jsdoc --destination ../../../doc/rglwidgetClass --template ~/node_modules/jsdoc-baseline rglClass.src.js
// To validate, use
// setwd(".../inst/htmlwidgets/lib/rglClass")
// hints <- js::jshint(readLines("rglClass.src.js"))
// hints[, c("line", "reason")]
/**
* The class of an rgl widget
* @class
*/
rglwidgetClass = function() {
this.canvas = null;
this.userMatrix = new CanvasMatrix4();
this.types = [];
this.prMatrix = new CanvasMatrix4();
this.mvMatrix = new CanvasMatrix4();
this.vp = null;
this.prmvMatrix = null;
this.origs = null;
this.gl = null;
this.scene = null;
this.select = {state: "inactive", subscene: null, region: {p1: {x:0, y:0}, p2: {x:0, y:0}}};
this.drawing = false;
};
/**
* Multiply matrix by vector
* @returns {number[]}
* @param M {number[][]} Left operand
* @param v {number[]} Right operand
*/
rglwidgetClass.prototype.multMV = function(M, v) {
return [ M.m11 * v[0] + M.m12 * v[1] + M.m13 * v[2] + M.m14 * v[3],
M.m21 * v[0] + M.m22 * v[1] + M.m23 * v[2] + M.m24 * v[3],
M.m31 * v[0] + M.m32 * v[1] + M.m33 * v[2] + M.m34 * v[3],
M.m41 * v[0] + M.m42 * v[1] + M.m43 * v[2] + M.m44 * v[3]
];
};
/**
* Multiply row vector by Matrix
* @returns {number[]}
* @param v {number[]} left operand
* @param M {number[][]} right operand
*/
rglwidgetClass.prototype.multVM = function(v, M) {
return [ M.m11 * v[0] + M.m21 * v[1] + M.m31 * v[2] + M.m41 * v[3],
M.m12 * v[0] + M.m22 * v[1] + M.m32 * v[2] + M.m42 * v[3],
M.m13 * v[0] + M.m23 * v[1] + M.m33 * v[2] + M.m43 * v[3],
M.m14 * v[0] + M.m24 * v[1] + M.m34 * v[2] + M.m44 * v[3]
];
};
/**
* Euclidean length of a vector
* @returns {number}
* @param v {number[]}
*/
rglwidgetClass.prototype.vlen = function(v) {
return Math.sqrt(this.dotprod(v, v));
};
/**
* Dot product of two vectors
* @instance rglwidgetClass
* @returns {number}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.dotprod = function(a, b) {
return a[0]*b[0] + a[1]*b[1] + a[2]*b[2];
};
/**
* Cross product of two vectors
* @returns {number[]}
* @param a {number[]}
* @param b {number[]}
*/
rglwidgetClass.prototype.xprod = function(a, b) {
return [a[1]*b[2] - a[2]*b[1],
a[2]*b[0] - a[0]*b[2],
a[0]*b[1] - a[1]*b[0]];
};
/**
* Bind vectors or matrices by columns
* @returns {number[][]}
* @param a {number[]|number[][]}
* @param b {number[]|number[][]}
*/
rglwidgetClass.prototype.cbind = function(a, b) {
if (b.length < a.length)
b = this.repeatToLen(b, a.length);
else if (a.length < b.length)
a = this.repeatToLen(a, b.length);
return a.map(function(currentValue, index, array) {
return currentValue.concat(b[index]);
});
};
/**
* Swap elements
* @returns {any[]}
* @param a {any[]}
* @param i {number} Element to swap
* @param j {number} Other element to swap
*/
rglwidgetClass.prototype.swap = function(a, i, j) {
var temp = a[i];
a[i] = a[j];
a[j] = temp;
};
/**
* Flatten a matrix into a vector
* @returns {any[]}
* @param a {any[][]}
*/
rglwidgetClass.prototype.flatten = function(arr, result) {
var value;
if (typeof result === "undefined") result = [];
for (var i = 0, length = arr.length; i < length; i++) {
value = arr[i];
if (Array.isArray(value)) {
this.flatten(value, result);
} else {
result.push(value);
}
}
return result;
};
/**
* set element of 1d or 2d array as if it was flattened.
* Column major, zero based!
* @returns {any[]|any[][]}
* @param {any[]|any[][]} a - array
* @param {number} i - element
* @param {any} value
*/
rglwidgetClass.prototype.setElement = function(a, i, value) {
if (Array.isArray(a[0])) {
var dim = a.length,
col = Math.floor(i/dim),
row = i % dim;
a[row][col] = value;
} else {
a[i] = value;
}
};
/**
* Transpose an array
* @returns {any[][]}
* @param {any[][]} a
*/
rglwidgetClass.prototype.transpose = function(a) {
var newArray = [],
n = a.length,
m = a[0].length,
i;
for(i = 0; i < m; i++){
newArray.push([]);
}
for(i = 0; i < n; i++){
for(var j = 0; j < m; j++){
newArray[j].push(a[i][j]);
}
}
return newArray;
};
/**
* Calculate sum of squares of a numeric vector
* @returns {number}
* @param {number[]} x
*/
rglwidgetClass.prototype.sumsq = function(x) {
var result = 0, i;
for (i=0; i < x.length; i++)
result += x[i]*x[i];
return result;
};
/**
* Convert a matrix to a CanvasMatrix4
* @returns {CanvasMatrix4}
* @param {number[][]|number[]} mat
*/
rglwidgetClass.prototype.toCanvasMatrix4 = function(mat) {
if (mat instanceof CanvasMatrix4)
return mat;
var result = new CanvasMatrix4();
mat = this.flatten(this.transpose(mat));
result.load(mat);
return result;
};
/**
* Convert an R-style numeric colour string to an rgb vector
* @returns {number[]}
* @param {string} s
*/
rglwidgetClass.prototype.stringToRgb = function(s) {
s = s.replace("#", "");
var bigint = parseInt(s, 16);
return [((bigint >> 16) & 255)/255,
((bigint >> 8) & 255)/255,
(bigint & 255)/255];
};
/**
* Take a component-by-component product of two 3 vectors
* @returns {number[]}
* @param {number[]} x
* @param {number[]} y
*/
rglwidgetClass.prototype.componentProduct = function(x, y) {
if (typeof y === "undefined") {
this.alertOnce("Bad arg to componentProduct");
}
var result = new Float32Array(3), i;
for (i = 0; i<3; i++)
result[i] = x[i]*y[i];
return result;
};
/**
* Get next higher power of two
* @returns { number }
* @param { number } value - input value
*/
rglwidgetClass.prototype.getPowerOfTwo = function(value) {
var pow = 1;
while(pow<value) {
pow *= 2;
}
return pow;
};
/**
* Unique entries
* @returns { any[] }
* @param { any[] } arr - An array
*/
rglwidgetClass.prototype.unique = function(arr) {
arr = [].concat(arr);
return arr.filter(function(value, index, self) {
return self.indexOf(value) === index;
});
};
/**
* Shallow compare of arrays
* @returns { boolean }
* @param { any[] } a - An array
* @param { any[] } b - Another array
*/
rglwidgetClass.prototype.equalArrays = function(a, b) {
return a === b || (a && b &&
a.length === b.length &&
a.every(function(v, i) {return v === b[i];}));
};
/**
* Repeat an array to a desired length
* @returns {any[]}
* @param {any | any[]} arr The input array
* @param {number} len The desired output length
*/
rglwidgetClass.prototype.repeatToLen = function(arr, len) {
arr = [].concat(arr);
while (arr.length < len/2)
arr = arr.concat(arr);
return arr.concat(arr.slice(0, len - arr.length));
};
/**
* Give a single alert message, not to be repeated.
* @param {string} msg  The message to give.
*/
rglwidgetClass.prototype.alertOnce = function(msg) {
if (typeof this.alerted !== "undefined")
return;
this.alerted = true;
alert(msg);
};
rglwidgetClass.prototype.f_is_lit = 1;
rglwidgetClass.prototype.f_is_smooth = 2;
rglwidgetClass.prototype.f_has_texture = 4;
rglwidgetClass.prototype.f_depth_sort = 8;
rglwidgetClass.prototype.f_fixed_quads = 16;
rglwidgetClass.prototype.f_is_transparent = 32;
rglwidgetClass.prototype.f_is_lines = 64;
rglwidgetClass.prototype.f_sprites_3d = 128;
rglwidgetClass.prototype.f_sprite_3d = 256;
rglwidgetClass.prototype.f_is_subscene = 512;
rglwidgetClass.prototype.f_is_clipplanes = 1024;
rglwidgetClass.prototype.f_fixed_size = 2048;
rglwidgetClass.prototype.f_is_points = 4096;
rglwidgetClass.prototype.f_is_twosided = 8192;
rglwidgetClass.prototype.f_fat_lines = 16384;
rglwidgetClass.prototype.f_is_brush = 32768;
/**
* Which list does a particular id come from?
* @returns { string }
* @param {number} id The id to look up.
*/
rglwidgetClass.prototype.whichList = function(id) {
var obj = this.getObj(id),
flags = obj.flags;
if (obj.type === "light")
return "lights";
if (flags & this.f_is_subscene)
return "subscenes";
if (flags & this.f_is_clipplanes)
return "clipplanes";
if (flags & this.f_is_transparent)
return "transparent";
return "opaque";
};
/**
* Get an object by id number.
* @returns { Object }
* @param {number} id
*/
rglwidgetClass.prototype.getObj = function(id) {
if (typeof id !== "number") {
this.alertOnce("getObj id is "+typeof id);
}
return this.scene.objects[id];
};
/**
* Get ids of a particular type from a subscene or the whole scene
* @returns { number[] }
* @param {string} type What type of object?
* @param {number} subscene  Which subscene?  If not given, find in the whole scene
*/
rglwidgetClass.prototype.getIdsByType = function(type, subscene) {
var
result = [], i, self = this;
if (typeof subscene === "undefined") {
Object.keys(this.scene.objects).forEach(
function(key) {
key = parseInt(key, 10);
if (self.getObj(key).type === type)
result.push(key);
});
} else {
ids = this.getObj(subscene).objects;
for (i=0; i < ids.length; i++) {
if (this.getObj(ids[i]).type === type) {
result.push(ids[i]);
}
}
}
return result;
};
/**
* Get a particular material property for an id
* @returns { any }
* @param {number} id  Which object?
* @param {string} property Which material property?
*/
rglwidgetClass.prototype.getMaterial = function(id, property) {
var obj = this.getObj(id), mat;
if (typeof obj.material === "undefined")
console.error("material undefined");
mat = obj.material[property];
if (typeof mat === "undefined")
mat = this.scene.material[property];
return mat;
};
/**
* Is a particular id in a subscene?
* @returns { boolean }
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.inSubscene = function(id, subscene) {
return this.getObj(subscene).objects.indexOf(id) > -1;
};
/**
* Add an id to a subscene.
* @param {number} id Which id?
* @param {number} subscene Which subscene id?
*/
rglwidgetClass.prototype.addToSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
ids = [id],
obj = this.getObj(id), i;
if (typeof obj != "undefined" && typeof (obj.newIds) !== "undefined") {
ids = ids.concat(obj.newIds);
}
thesub.objects = [].concat(thesub.objects);
for (i = 0; i < ids.length; i++) {
id = ids[i];
if (thesub.objects.indexOf(id) == -1) {
thelist = this.whichList(id);
thesub.objects.push(id);
thesub[thelist].push(id);
}
}
};
/**
* Delete an id from a subscene
* @param { number } id - the id to add
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.delFromSubscene = function(id, subscene) {
var thelist,
thesub = this.getObj(subscene),
obj = this.getObj(id),
ids = [id], i;
if (typeof obj !== "undefined" && typeof (obj.newIds) !== "undefined")
ids = ids.concat(obj.newIds);
thesub.objects = [].concat(thesub.objects); // It might be a scalar
for (j=0; j<ids.length;j++) {
id = ids[j];
i = thesub.objects.indexOf(id);
if (i > -1) {
thesub.objects.splice(i, 1);
thelist = this.whichList(id);
i = thesub[thelist].indexOf(id);
thesub[thelist].splice(i, 1);
}
}
};
/**
* Set the ids in a subscene
* @param { number[] } ids - the ids to set
* @param { number } subsceneid - the id of the subscene
*/
rglwidgetClass.prototype.setSubsceneEntries = function(ids, subsceneid) {
var sub = this.getObj(subsceneid);
sub.objects = ids;
this.initSubscene(subsceneid);
};
/**
* Get the ids in a subscene
* @returns {number[]}
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getSubsceneEntries = function(subscene) {
return this.getObj(subscene).objects;
};
/**
* Get the ids of the subscenes within a subscene
* @returns { number[] }
* @param { number } subscene - the id of the subscene
*/
rglwidgetClass.prototype.getChildSubscenes = function(subscene) {
return this.getObj(subscene).subscenes;
};
/**
* Start drawing
* @returns { boolean } Previous state
*/
rglwidgetClass.prototype.startDrawing = function() {
var value = this.drawing;
this.drawing = true;
return value;
};
/**
* Stop drawing and check for context loss
* @param { boolean } saved - Previous state
*/
rglwidgetClass.prototype.stopDrawing = function(saved) {
this.drawing = saved;
if (!saved && this.gl && this.gl.isContextLost())
this.restartCanvas();
};
/**
* Generate the vertex shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getVertexShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userVertexShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
nclipplanes = this.countClipplanes(),
fixed_size = flags & this.f_fixed_size,
is_points = flags & this.f_is_points,
is_twosided = flags & this.f_is_twosided,
fat_lines = flags & this.f_fat_lines,
is_brush = flags & this.f_is_brush,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
result = "  /* ****** "+type+" object "+id+" vertex shader ****** */\n"+
"  attribute vec3 aPos;\n"+
"  attribute vec4 aCol;\n"+
" uniform mat4 mvMatrix;\n"+
" uniform mat4 prMatrix;\n"+
" varying vec4 vCol;\n"+
" varying vec4 vPosition;\n";
if ((is_lit && !fixed_quads && !is_brush) || sprite_3d)
result = result + "  attribute vec3 aNorm;\n"+
" uniform mat4 normMatrix;\n"+
" varying vec3 vNormal;\n";
if (has_texture || type === "text")
result = result + " attribute vec2 aTexcoord;\n"+
" varying vec2 vTexcoord;\n";
if (fixed_size)
result = result + "  uniform vec2 textScale;\n";
if (fixed_quads)
result = result + "  attribute vec2 aOfs;\n";
else if (sprite_3d)
result = result + "  uniform vec3 uOrig;\n"+
"  uniform float uSize;\n"+
"  uniform mat4 usermat;\n";
if (is_twosided)
result = result + "  attribute vec3 aPos1;\n"+
"  attribute vec3 aPos2;\n"+
"  varying float normz;\n";
if (fat_lines) {
result = result +   "  attribute vec3 aNext;\n"+
"  attribute vec2 aPoint;\n"+
"  varying vec2 vPoint;\n"+
"  varying float vLength;\n"+
"  uniform float uAspect;\n"+
"  uniform float uLwd;\n";
}
result = result + "  void main(void) {\n";
if ((nclipplanes || (!fixed_quads && !sprite_3d)) && !is_brush)
result = result + "    vPosition = mvMatrix * vec4(aPos, 1.);\n";
if (!fixed_quads && !sprite_3d && !is_brush)
result = result + "    gl_Position = prMatrix * vPosition;\n";
if (is_points) {
var size = this.getMaterial(id, "size");
result = result + "    gl_PointSize = "+size.toFixed(1)+";\n";
}
result = result + "    vCol = aCol;\n";
if (is_lit && !fixed_quads && !sprite_3d && !is_brush)
result = result + "    vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n";
if (has_texture || type == "text")
result = result + "    vTexcoord = aTexcoord;\n";
if (fixed_size)
result = result + "    vec4 pos = prMatrix * mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w;\n"+
"   gl_Position = pos + vec4(aOfs*textScale, 0.,0.);\n";
if (type == "sprites" && !fixed_size)
result = result + "    vec4 pos = mvMatrix * vec4(aPos, 1.);\n"+
"   pos = pos/pos.w + vec4(aOfs, 0., 0.);\n"+
"   gl_Position = prMatrix*pos;\n";
if (sprite_3d)
result = result + "   vNormal = normalize((normMatrix * vec4(aNorm, 1.)).xyz);\n"+
"   vec4 pos = mvMatrix * vec4(uOrig, 1.);\n"+
"   vPosition = pos/pos.w + vec4(uSize*(vec4(aPos, 1.)*usermat).xyz,0.);\n"+
"   gl_Position = prMatrix * vPosition;\n";
if (is_twosided)
result = result + "   vec4 pos1 = prMatrix*(mvMatrix*vec4(aPos1, 1.));\n"+
"   pos1 = pos1/pos1.w - gl_Position/gl_Position.w;\n"+
"   vec4 pos2 = prMatrix*(mvMatrix*vec4(aPos2, 1.));\n"+
"   pos2 = pos2/pos2.w - gl_Position/gl_Position.w;\n"+
"   normz = pos1.x*pos2.y - pos1.y*pos2.x;\n";
if (fat_lines) 
/* This code was inspired by Matt Deslauriers' code in https://mattdesl.svbtle.com/drawing-lines-is-hard */
result = result + "   vec2 aspectVec = vec2(uAspect, 1.0);\n"+
"   mat4 projViewModel = prMatrix * mvMatrix;\n"+
"   vec4 currentProjected = projViewModel * vec4(aPos, 1.0);\n"+
"   currentProjected = currentProjected/currentProjected.w;\n"+
"   vec4 nextProjected = projViewModel * vec4(aNext, 1.0);\n"+
"   vec2 currentScreen = currentProjected.xy * aspectVec;\n"+
"   vec2 nextScreen = (nextProjected.xy / nextProjected.w) * aspectVec;\n"+
"   float len = uLwd;\n"+
"   vec2 dir = vec2(1.0, 0.0);\n"+
"   vPoint = aPoint;\n"+
"   vLength = length(nextScreen - currentScreen)/2.0;\n"+
"   vLength = vLength/(vLength + len);\n"+
"   if (vLength > 0.0) {\n"+
"     dir = normalize(nextScreen - currentScreen);\n"+
"   }\n"+
"   vec2 normal = vec2(-dir.y, dir.x);\n"+
"   dir.x /= uAspect;\n"+
"   normal.x /= uAspect;\n"+
"   vec4 offset = vec4(len*(normal*aPoint.x*aPoint.y - dir), 0.0, 0.0);\n"+
"   gl_Position = currentProjected + offset;\n";
if (is_brush)
result = result + "   gl_Position = vec4(aPos, 1.);\n";
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Generate the fragment shader for an object
* @returns {string}
* @param { number } id - Id of object
*/
rglwidgetClass.prototype.getFragmentShader = function(id) {
var obj = this.getObj(id),
userShader = obj.userFragmentShader,
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
sprites_3d = flags & this.f_sprites_3d,
is_twosided = (flags & this.f_is_twosided) > 0,
fat_lines = flags & this.f_fat_lines,
is_transparent = flags & this.f_is_transparent,
nclipplanes = this.countClipplanes(), i,
texture_format, nlights,
result;
if (type === "clipplanes" || sprites_3d) return;
if (typeof userShader !== "undefined") return userShader;
if (has_texture)
texture_format = this.getMaterial(id, "textype");
result = "/* ****** "+type+" object "+id+" fragment shader ****** */\n"+
"#ifdef GL_ES\n"+
"#ifdef GL_FRAGMENT_PRECISION_HIGH\n"+
"  precision highp float;\n"+
"#else\n"+
"  precision mediump float;\n"+
"#endif\n"+
"#endif\n"+
"  varying vec4 vCol; // carries alpha\n"+
"  varying vec4 vPosition;\n";
if (has_texture || type === "text")
result = result + "  varying vec2 vTexcoord;\n"+
" uniform sampler2D uSampler;\n";
if (is_lit && !fixed_quads)
result = result + "  varying vec3 vNormal;\n";
for (i = 0; i < nclipplanes; i++)
result = result + "  uniform vec4 vClipplane"+i+";\n";
if (is_lit) {
nlights = this.countLights();
if (nlights)
result = result + "  uniform mat4 mvMatrix;\n";
else
is_lit = false;
}
if (is_lit) {
result = result + "   uniform vec3 emission;\n"+
"   uniform float shininess;\n";
for (i=0; i < nlights; i++) {
result = result + "   uniform vec3 ambient" + i + ";\n"+
"   uniform vec3 specular" + i +"; // light*material\n"+
"   uniform vec3 diffuse" + i + ";\n"+
"   uniform vec3 lightDir" + i + ";\n"+
"   uniform bool viewpoint" + i + ";\n"+
"   uniform bool finite" + i + ";\n";
}
}
if (is_twosided)
result = result + "   uniform bool front;\n"+
"   varying float normz;\n";
if (fat_lines)
result = result + "   varying vec2 vPoint;\n"+
"   varying float vLength;\n";
result = result + "  void main(void) {\n";
if (fat_lines) {
result = result + "    vec2 point = vPoint;\n"+
"    bool neg = point.y < 0.0;\n"+
"    point.y = neg ? "+
"      (point.y + vLength)/(1.0 - vLength) :\n"+
"     -(point.y - vLength)/(1.0 - vLength);\n";
if (is_transparent && type == "linestrip")
result = result+"    if (neg && length(point) <= 1.0) discard;\n";
result = result + "    point.y = min(point.y, 0.0);\n"+
"    if (length(point) > 1.0) discard;\n";
}
for (i=0; i < nclipplanes;i++)
result = result + "    if (dot(vPosition, vClipplane"+i+") < 0.0) discard;\n";
if (fixed_quads) {
result = result +   "    vec3 n = vec3(0., 0., 1.);\n";
} else if (is_lit) {
result = result +   "    vec3 n = normalize(vNormal);\n";
}
if (is_twosided) {
result = result +   "    if ((normz <= 0.) != front) discard;\n";
}
if (is_lit) {
result = result + "    vec3 eye = normalize(-vPosition.xyz);\n"+
"   vec3 lightdir;\n"+
"   vec4 colDiff;\n"+
"   vec3 halfVec;\n"+
"   vec4 lighteffect = vec4(emission, 0.);\n"+
"   vec3 col;\n"+
"   float nDotL;\n";
if (!fixed_quads) {
result = result +   "   n = -faceforward(n, n, eye);\n";
}
for (i=0; i < nlights; i++) {
result = result + "   colDiff = vec4(vCol.rgb * diffuse" + i + ", vCol.a);\n"+
"   lightdir = lightDir" + i + ";\n"+
"   if (!viewpoint" + i +")\n"+
"     lightdir = (mvMatrix * vec4(lightdir, 1.)).xyz;\n"+
"   if (!finite" + i + ") {\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   } else {\n"+
"     lightdir = normalize(lightdir - vPosition.xyz);\n"+
"     halfVec = normalize(lightdir + eye);\n"+
"   }\n"+
"    col = ambient" + i + ";\n"+
"   nDotL = dot(n, lightdir);\n"+
"   col = col + max(nDotL, 0.) * colDiff.rgb;\n"+
"   col = col + pow(max(dot(halfVec, n), 0.), shininess) * specular" + i + ";\n"+
"   lighteffect = lighteffect + vec4(col, colDiff.a);\n";
}
} else {
result = result +   "   vec4 colDiff = vCol;\n"+
"    vec4 lighteffect = colDiff;\n";
}
if (type === "text")
result = result +   "    vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n";
if (has_texture) {
result = result + {
rgb:            "   vec4 textureColor = lighteffect*vec4(texture2D(uSampler, vTexcoord).rgb, 1.);\n",
rgba:           "   vec4 textureColor = lighteffect*texture2D(uSampler, vTexcoord);\n",
alpha:          "   vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.), textureColor.rgb)/3.;\n"+
"   textureColor =  vec4(lighteffect.rgb, lighteffect.a*luminance);\n",
luminance:      "   vec4 textureColor = vec4(lighteffect.rgb*dot(texture2D(uSampler, vTexcoord).rgb, vec3(1.,1.,1.))/3., lighteffect.a);\n",
"luminance.alpha":"    vec4 textureColor = texture2D(uSampler, vTexcoord);\n"+
"   float luminance = dot(vec3(1.,1.,1.),textureColor.rgb)/3.;\n"+
"   textureColor = vec4(lighteffect.rgb*luminance, lighteffect.a*textureColor.a);\n"
}[texture_format]+
"   gl_FragColor = textureColor;\n";
} else if (type === "text") {
result = result +   "    if (textureColor.a < 0.1)\n"+
"     discard;\n"+
"   else\n"+
"     gl_FragColor = textureColor;\n";
} else
result = result +   "   gl_FragColor = lighteffect;\n";
//if (fat_lines)
//  result = result +   "   gl_FragColor = vec4(0.0, abs(point.x), abs(point.y), 1.0);"
result = result + "  }\n";
// console.log(result);
return result;
};
/**
* Call gl functions to create and compile shader
* @returns {Object}
* @param { number } shaderType - gl code for shader type
* @param { string } code - code for the shader
*/
rglwidgetClass.prototype.getShader = function(shaderType, code) {
var gl = this.gl, shader;
shader = gl.createShader(shaderType);
gl.shaderSource(shader, code);
gl.compileShader(shader);
if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS) && !gl.isContextLost())
alert(gl.getShaderInfoLog(shader));
return shader;
};
/**
* Handle a texture after its image has been loaded
* @param { Object } texture - the gl texture object
* @param { Object } textureCanvas - the canvas holding the image
*/
rglwidgetClass.prototype.handleLoadedTexture = function(texture, textureCanvas) {
var gl = this.gl || this.initGL();
gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, true);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, textureCanvas);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_NEAREST);
gl.generateMipmap(gl.TEXTURE_2D);
gl.bindTexture(gl.TEXTURE_2D, null);
};
/**
* Get maximum dimension of texture in current browser.
* @returns {number}
*/
rglwidgetClass.prototype.getMaxTexSize = function() {
var gl = this.gl || this.initGL();  
return Math.min(4096, gl.getParameter(gl.MAX_TEXTURE_SIZE));
};
/**
* Load an image to a texture
* @param { string } uri - The image location
* @param { Object } texture - the gl texture object
*/
rglwidgetClass.prototype.loadImageToTexture = function(uri, texture) {
var canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
image = new Image(),
self = this;
image.onload = function() {
var w = image.width,
h = image.height,
canvasX = self.getPowerOfTwo(w),
canvasY = self.getPowerOfTwo(h),
gl = self.gl || self.initGL(),
maxTexSize = self.getMaxTexSize();
while (canvasX > 1 && canvasY > 1 && (canvasX > maxTexSize || canvasY > maxTexSize)) {
canvasX /= 2;
canvasY /= 2;
}
canvas.width = canvasX;
canvas.height = canvasY;
ctx.imageSmoothingEnabled = true;
ctx.drawImage(image, 0, 0, canvasX, canvasY);
self.handleLoadedTexture(texture, canvas);
self.drawScene();
};
image.src = uri;
};
/**
* Draw text to the texture canvas
* @returns { Object } object with text measurements
* @param { string } text - the text
* @param { number } cex - expansion
* @param { string } family - font family
* @param { number } font - font number
*/
rglwidgetClass.prototype.drawTextToCanvas = function(text, cex, family, font) {
var canvasX, canvasY,
textY,
scaling = 20,
textColour = "white",
backgroundColour = "rgba(0,0,0,0)",
canvas = this.textureCanvas,
ctx = canvas.getContext("2d"),
i, textHeight = 0, textHeights = [], width, widths = [], 
offsetx, offsety = 0, line, lines = [], offsetsx = [],
offsetsy = [], lineoffsetsy = [], fontStrings = [],
maxTexSize = this.getMaxTexSize(),
getFontString = function(i) {
textHeights[i] = scaling*cex[i];
var fontString = textHeights[i] + "px",
family0 = family[i],
font0 = font[i];
if (family0 === "sans")
family0 = "sans-serif";
else if (family0 === "mono")
family0 = "monospace";
fontString = fontString + " " + family0;
if (font0 === 2 || font0 === 4)
fontString = "bold " + fontString;
if (font0 === 3 || font0 === 4)
fontString = "italic " + fontString;
return fontString;
};
cex = this.repeatToLen(cex, text.length);
family = this.repeatToLen(family, text.length);
font = this.repeatToLen(font, text.length);
canvasX = 1;
line = -1;
offsetx = maxTexSize;
for (i = 0; i < text.length; i++)  {
ctx.font = fontStrings[i] = getFontString(i);
width = widths[i] = ctx.measureText(text[i]).width;
if (offsetx + width > maxTexSize) {
line += 1;
offsety = lineoffsetsy[line] = offsety + 2*textHeight;
if (offsety > maxTexSize)
console.error("Too many strings for texture.");
textHeight = 0;
offsetx = 0;
}
textHeight = Math.max(textHeight, textHeights[i]);
offsetsx[i] = offsetx;
offsetx += width;
canvasX = Math.max(canvasX, offsetx);
lines[i] = line;
}
offsety = lineoffsetsy[line] = offsety + 2*textHeight;
for (i = 0; i < text.length; i++) {
offsetsy[i] = lineoffsetsy[lines[i]];
}
canvasX = this.getPowerOfTwo(canvasX);
canvasY = this.getPowerOfTwo(offsety);
canvas.width = canvasX;
canvas.height = canvasY;
ctx.fillStyle = backgroundColour;
ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
ctx.textBaseline = "alphabetic";
for(i = 0; i < text.length; i++) {
ctx.font = fontStrings[i];
ctx.fillStyle = textColour;
ctx.textAlign = "left";
ctx.fillText(text[i], offsetsx[i],  offsetsy[i]);
}
return {canvasX:canvasX, canvasY:canvasY,
widths:widths, textHeights:textHeights,
offsetsx:offsetsx, offsetsy:offsetsy};
};
/**
* Set the gl viewport and scissor test
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setViewport = function(id) {
var gl = this.gl || this.initGL(),
vp = this.getObj(id).par3d.viewport,
x = vp.x*this.canvas.width,
y = vp.y*this.canvas.height,
width = vp.width*this.canvas.width,
height = vp.height*this.canvas.height;
this.vp = {x:x, y:y, width:width, height:height};
gl.viewport(x, y, width, height);
gl.scissor(x, y, width, height);
gl.enable(gl.SCISSOR_TEST);
};
/**
* Set the projection matrix for a subscene
* @param { number } id - id of subscene
*/
rglwidgetClass.prototype.setprMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.projection;
if (embedding === "replace")
this.prMatrix.makeIdentity();
else
this.setprMatrix(subscene.parent);
if (embedding === "inherit")
return;
// This is based on the Frustum::enclose code from geom.cpp
var bbox = subscene.par3d.bbox,
scale = subscene.par3d.scale,
ranges = [(bbox[1]-bbox[0])*scale[0]/2,
(bbox[3]-bbox[2])*scale[1]/2,
(bbox[5]-bbox[4])*scale[2]/2],
radius = Math.sqrt(this.sumsq(ranges))*1.1; // A bit bigger to handle labels
if (radius <= 0) radius = 1;
var observer = subscene.par3d.observer,
distance = observer[2],
FOV = subscene.par3d.FOV, ortho = FOV === 0,
t = ortho ? 1 : Math.tan(FOV*Math.PI/360),
near = distance - radius,
far = distance + radius,
hlen,
aspect = this.vp.width/this.vp.height,
z = subscene.par3d.zoom,
userProjection = subscene.par3d.userProjection;
if (far < 0.0)
far = 1.0;
if (near < far/100.0)
near = far/100.0;
hlen = t*near;
if (ortho) {
if (aspect > 1)
this.prMatrix.ortho(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.ortho(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
} else {
if (aspect > 1)
this.prMatrix.frustum(-hlen*aspect*z, hlen*aspect*z,
-hlen*z, hlen*z, near, far);
else
this.prMatrix.frustum(-hlen*z, hlen*z,
-hlen*z/aspect, hlen*z/aspect,
near, far);
}
this.prMatrix.multRight(userProjection);
};
/**
* Set the model-view matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmvMatrix = function(id) {
var observer = this.getObj(id).par3d.observer;
this.mvMatrix.makeIdentity();
this.setmodelMatrix(id);
this.mvMatrix.translate(-observer[0], -observer[1], -observer[2]);
};
/**
* Set the model matrix for a subscene
* @param { number } id - id of the subscene
*/
rglwidgetClass.prototype.setmodelMatrix = function(id) {
var subscene = this.getObj(id),
embedding = subscene.embeddings.model;
if (embedding !== "inherit") {
var scale = subscene.par3d.scale,
bbox = subscene.par3d.bbox,
center = [(bbox[0]+bbox[1])/2,
(bbox[2]+bbox[3])/2,
(bbox[4]+bbox[5])/2];
this.mvMatrix.translate(-center[0], -center[1], -center[2]);
this.mvMatrix.scale(scale[0], scale[1], scale[2]);
this.mvMatrix.multRight( subscene.par3d.userMatrix );
}
if (embedding !== "replace")
this.setmodelMatrix(subscene.parent);
};
/**
* Set the normals matrix for a subscene
* @param { number } subsceneid - id of the subscene
*/
rglwidgetClass.prototype.setnormMatrix = function(subsceneid) {
var self = this,
recurse = function(id) {
var sub = self.getObj(id),
embedding = sub.embeddings.model;
if (embedding !== "inherit") {
var scale = sub.par3d.scale;
self.normMatrix.scale(1/scale[0], 1/scale[1], 1/scale[2]);
self.normMatrix.multRight(sub.par3d.userMatrix);
}
if (embedding !== "replace")
recurse(sub.parent);
};
self.normMatrix.makeIdentity();
recurse(subsceneid);
};
/**
* Set the combined projection-model-view matrix
*/
rglwidgetClass.prototype.setprmvMatrix = function() {
this.prmvMatrix = new CanvasMatrix4( this.mvMatrix );
this.prmvMatrix.multRight( this.prMatrix );
};
/**
* Count clipping planes in a scene
* @returns {number}
*/
rglwidgetClass.prototype.countClipplanes = function() {
return this.countObjs("clipplanes");
};
/**
* Count lights in a scene
* @returns { number }
*/
rglwidgetClass.prototype.countLights = function() {
return this.countObjs("light");
};
/**
* Count objects of specific type in a scene
* @returns { number }
* @param { string } type - Type of object to count
*/
rglwidgetClass.prototype.countObjs = function(type) {
var self = this,
bound = 0;
Object.keys(this.scene.objects).forEach(
function(key) {
if (self.getObj(parseInt(key, 10)).type === type)
bound = bound + 1;
});
return bound;
};
/**
* Initialize a subscene
* @param { number } id - id of subscene.
*/
rglwidgetClass.prototype.initSubscene = function(id) {
var sub = this.getObj(id),
i, obj;
if (sub.type !== "subscene")
return;
sub.par3d.userMatrix = this.toCanvasMatrix4(sub.par3d.userMatrix);
sub.par3d.userProjection = this.toCanvasMatrix4(sub.par3d.userProjection);
sub.par3d.userProjection.transpose();
sub.par3d.listeners = [].concat(sub.par3d.listeners);
sub.backgroundId = undefined;
sub.subscenes = [];
sub.clipplanes = [];
sub.transparent = [];
sub.opaque = [];
sub.lights = [];
for (i=0; i < sub.objects.length; i++) {
obj = this.getObj(sub.objects[i]);
if (typeof obj === "undefined") {
sub.objects.splice(i, 1);
i--;
} else if (obj.type === "background")
sub.backgroundId = obj.id;
else
sub[this.whichList(obj.id)].push(obj.id);
}
};
/**
* Copy object
* @param { number } id - id of object to copy
* @param { string } reuse - Document id of scene to reuse
*/
rglwidgetClass.prototype.copyObj = function(id, reuse) {
var obj = this.getObj(id),
prev = document.getElementById(reuse);
if (prev !== null) {
prev = prev.rglinstance;
var
prevobj = prev.getObj(id),
fields = ["flags", "type",
"colors", "vertices", "centers",
"normals", "offsets",
"texts", "cex", "family", "font", "adj",
"material",
"radii",
"texcoords",
"userMatrix", "ids",
"dim",
"par3d", "userMatrix",
"viewpoint", "finite",
"pos"],
i;
for (i = 0; i < fields.length; i++) {
if (typeof prevobj[fields[i]] !== "undefined")
obj[fields[i]] = prevobj[fields[i]];
}
} else
console.warn("copyObj failed");
};
/**
* Update the triangles used to display a plane
* @param { number } id - id of the plane
* @param { Object } bbox - bounding box in which to display the plane
*/
rglwidgetClass.prototype.planeUpdateTriangles = function(id, bbox) {
var perms = [[0,0,1], [1,2,2], [2,1,0]],
x, xrow, elem, A, d, nhits, i, j, k, u, v, w, intersect, which, v0, v2, vx, reverse,
face1 = [], face2 = [], normals = [],
obj = this.getObj(id),
nPlanes = obj.normals.length;
obj.bbox = bbox;
obj.vertices = [];
obj.initialized = false;
for (elem = 0; elem < nPlanes; elem++) {
//    Vertex Av = normal.getRecycled(elem);
x = [];
A = obj.normals[elem];
d = obj.offsets[elem][0];
nhits = 0;
for (i=0; i<3; i++)
for (j=0; j<2; j++)
for (k=0; k<2; k++) {
u = perms[0][i];
v = perms[1][i];
w = perms[2][i];
if (A[w] !== 0.0) {
intersect = -(d + A[u]*bbox[j+2*u] + A[v]*bbox[k+2*v])/A[w];
if (bbox[2*w] < intersect && intersect < bbox[1+2*w]) {
xrow = [];
xrow[u] = bbox[j+2*u];
xrow[v] = bbox[k+2*v];
xrow[w] = intersect;
x.push(xrow);
face1[nhits] = j + 2*u;
face2[nhits] = k + 2*v;
nhits++;
}
}
}
if (nhits > 3) {
/* Re-order the intersections so the triangles work */
for (i=0; i<nhits-2; i++) {
which = 0; /* initialize to suppress warning */
for (j=i+1; j<nhits; j++) {
if (face1[i] == face1[j] || face1[i] == face2[j] ||
face2[i] == face1[j] || face2[i] == face2[j] ) {
which = j;
break;
}
}
if (which > i+1) {
this.swap(x, i+1, which);
this.swap(face1, i+1, which);
this.swap(face2, i+1, which);
}
}
}
if (nhits >= 3) {
/* Put in order so that the normal points out the FRONT of the faces */
v0 = [x[0][0] - x[1][0] , x[0][1] - x[1][1], x[0][2] - x[1][2]];
v2 = [x[2][0] - x[1][0] , x[2][1] - x[1][1], x[2][2] - x[1][2]];
/* cross-product */
vx = this.xprod(v0, v2);
reverse = this.dotprod(vx, A) > 0;
for (i=0; i<nhits-2; i++) {
obj.vertices.push(x[0]);
normals.push(A);
for (j=1; j<3; j++) {
obj.vertices.push(x[i + (reverse ? 3-j : j)]);
normals.push(A);
}
}
}
}
obj.pnormals = normals;
};
rglwidgetClass.prototype.getAdj = function (pos, offset, text) {
switch(pos) {
case 1: return [0.5, 1 + offset];
case 2: return [1 + offset/text.length, 0.5];
case 3: return [0.5, -offset];
case 4: return [-offset/text.length, 0.5];
}
}
/**
* Initialize object for display
* @param { number } id - id of object to initialize
*/
rglwidgetClass.prototype.initObj = function(id) {
var obj = this.getObj(id),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
is_transparent = obj.is_transparent,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
is_brush = flags & this.f_is_brush,
gl = this.gl || this.initGL(),
polygon_offset,
texinfo, drawtype, nclipplanes, f, nrows, oldrows,
i,j,v,v1,v2, mat, uri, matobj, pass, passes, pmode,
dim, nx, nz, attr;
if (typeof id !== "number") {
this.alertOnce("initObj id is "+typeof id);
}
obj.initialized = true;
if (type === "bboxdeco" || type === "subscene")
return;
if (type === "light") {
obj.ambient = new Float32Array(obj.colors[0].slice(0,3));
obj.diffuse = new Float32Array(obj.colors[1].slice(0,3));
obj.specular = new Float32Array(obj.colors[2].slice(0,3));
obj.lightDir = new Float32Array(obj.vertices[0]);
return;
}
if (type === "clipplanes") {
obj.vClipplane = this.flatten(this.cbind(obj.normals, obj.offsets));
return;
}
if (type === "background" && typeof obj.ids !== "undefined") {
obj.quad = this.flatten([].concat(obj.ids));
return;
}
polygon_offset = this.getMaterial(id, "polygon_offset");
if (polygon_offset[0] != 0 || polygon_offset[1] != 0)
obj.polygon_offset = polygon_offset;
if (is_transparent) {
depth_sort = ["triangles", "quads", "surface",
"spheres", "sprites", "text"].indexOf(type) >= 0;
}
if (is_brush)
this.initSelection(id);
if (typeof obj.vertices === "undefined")
obj.vertices = [];
v = obj.vertices;
obj.vertexCount = v.length;
if (!obj.vertexCount) return;
if (is_twosided) {
if (typeof obj.userAttributes === "undefined")
obj.userAttributes = {};
v1 = Array(v.length);
v2 = Array(v.length);
if (obj.type == "triangles" || obj.type == "quads") {
if (obj.type == "triangles")
nrow = 3;
else
nrow = 4;
for (i=0; i<Math.floor(v.length/nrow); i++)
for (j=0; j<nrow; j++) {
v1[nrow*i + j] = v[nrow*i + ((j+1) % nrow)];
v2[nrow*i + j] = v[nrow*i + ((j+2) % nrow)];
}
} else if (obj.type == "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz && j+1 < nx) {
v2[j + nx*i] = v[j + nx*(i+1)];
v1[j + nx*i] = v[j+1 + nx*(i+1)];
} else if (i+1 < nz) {
v2[j + nx*i] = v[j-1 + nx*i];
v1[j + nx*i] = v[j + nx*(i+1)];
} else {
v2[j + nx*i] = v[j + nx*(i-1)];
v1[j + nx*i] = v[j-1 + nx*(i-1)];
}
}
}
}
obj.userAttributes.aPos1 = v1;
obj.userAttributes.aPos2 = v2;
}
if (!sprites_3d) {
if (gl.isContextLost()) return;
obj.prog = gl.createProgram();
gl.attachShader(obj.prog, this.getShader( gl.VERTEX_SHADER,
this.getVertexShader(id) ));
gl.attachShader(obj.prog, this.getShader( gl.FRAGMENT_SHADER,
this.getFragmentShader(id) ));
//  Force aPos to location 0, aCol to location 1
gl.bindAttribLocation(obj.prog, 0, "aPos");
gl.bindAttribLocation(obj.prog, 1, "aCol");
gl.linkProgram(obj.prog);
var linked = gl.getProgramParameter(obj.prog, gl.LINK_STATUS);
if (!linked) {
// An error occurred while linking
var lastError = gl.getProgramInfoLog(obj.prog);
console.warn("Error in program linking:" + lastError);
gl.deleteProgram(obj.prog);
return;
}
}
if (type === "text") {
texinfo = this.drawTextToCanvas(obj.texts,
this.flatten(obj.cex),
this.flatten(obj.family),
this.flatten(obj.family));
}
if (fixed_quads && !sprites_3d) {
obj.ofsLoc = gl.getAttribLocation(obj.prog, "aOfs");
}
if (sprite_3d) {
obj.origLoc = gl.getUniformLocation(obj.prog, "uOrig");
obj.sizeLoc = gl.getUniformLocation(obj.prog, "uSize");
obj.usermatLoc = gl.getUniformLocation(obj.prog, "usermat");
}
if (has_texture || type == "text") {
if (!obj.texture)
obj.texture = gl.createTexture();
obj.texLoc = gl.getAttribLocation(obj.prog, "aTexcoord");
obj.sampler = gl.getUniformLocation(obj.prog, "uSampler");
}
if (has_texture) {
mat = obj.material;
if (typeof mat.uri !== "undefined")
uri = mat.uri;
else if (typeof mat.uriElementId === "undefined") {
matobj = this.getObj(mat.uriId);
if (typeof matobj !== "undefined") {
uri = matobj.material.uri;
} else {
uri = "";
}
} else
uri = document.getElementById(mat.uriElementId).rglinstance.getObj(mat.uriId).material.uri;
this.loadImageToTexture(uri, obj.texture);
}
if (type === "text") {
this.handleLoadedTexture(obj.texture, this.textureCanvas);
}
var stride = 3, nc, cofs, nofs, radofs, oofs, tofs, vnew, fnew,
nextofs = -1, pointofs = -1, alias, colors, key, selection, filter, adj, pos, offset;
obj.alias = undefined;
colors = obj.colors;
j = this.scene.crosstalk.id.indexOf(id);
if (j >= 0) {
key = this.scene.crosstalk.key[j];
options = this.scene.crosstalk.options[j];
colors = colors.slice(0); 
for (i = 0; i < v.length; i++)
colors[i] = obj.colors[i % obj.colors.length].slice(0);
if ( (selection = this.scene.crosstalk.selection) &&
(selection.length || !options.selectedIgnoreNone) )
for (i = 0; i < v.length; i++) {
if (!selection.includes(key[i])) {
if (options.deselectedColor)
colors[i] = options.deselectedColor.slice(0);
colors[i][3] = colors[i][3]*options.deselectedFade;   /* default: mostly transparent if not selected */
} else if (options.selectedColor)
colors[i] = options.selectedColor.slice(0);
}
if ( (filter = this.scene.crosstalk.filter) )
for (i = 0; i < v.length; i++) 
if (!filter.includes(key[i])) {
if (options.filteredColor)
colors[i] = options.filteredColor.slice(0);
colors[i][3] = colors[i][3]*options.filteredFade;   /* default: completely hidden if filtered */
}
}  
nc = obj.colorCount = colors.length;
if (nc > 1) {
cofs = stride;
stride = stride + 4;
v = this.cbind(v, colors);
} else {
cofs = -1;
obj.onecolor = this.flatten(colors);
}
if (typeof obj.normals !== "undefined") {
nofs = stride;
stride = stride + 3;
v = this.cbind(v, typeof obj.pnormals !== "undefined" ? obj.pnormals : obj.normals);
} else
nofs = -1;
if (typeof obj.radii !== "undefined") {
radofs = stride;
stride = stride + 1;
// FIXME:  always concat the radii?
if (obj.radii.length === v.length) {
v = this.cbind(v, obj.radii);
} else if (obj.radii.length === 1) {
v = v.map(function(row, i, arr) { return row.concat(obj.radii[0]);});
}
} else
radofs = -1;
// Add default indices
f = Array(v.length);
for (i = 0; i < v.length; i++)
f[i] = i;
obj.f = [f,f];
if (type == "sprites" && !sprites_3d) {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
fnew = new Array(4*v.length);
alias = new Array(v.length);
var rescale = fixed_size ? 72 : 1,
size = obj.radii, s = rescale*size[0]/2;
last = v.length;
f = obj.f[0];
for (i=0; i < v.length; i++) {
if (size.length > 1)
s = rescale*size[i]/2;
vnew[i]  = v[i].concat([0,0,-s,-s]);
fnew[4*i] = f[i];
vnew[last]= v[i].concat([1,0, s,-s]);
fnew[4*i+1] = last++;
vnew[last]= v[i].concat([1,1, s, s]);
fnew[4*i+2] = last++;
vnew[last]= v[i].concat([0,1,-s, s]);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (type === "text") {
tofs = stride;
stride += 2;
oofs = stride;
stride += 2;
vnew = new Array(4*v.length);
f = obj.f[0];
fnew = new Array(4*f.length);
alias = new Array(v.length);
last = v.length;
adj = this.flatten(obj.adj);
if (typeof obj.pos !== "undefined") {
pos = this.flatten(obj.pos);
offset = adj[0];
}
for (i=0; i < v.length; i++) {
if (typeof pos !== "undefined")
adj = this.getAdj(pos[i % pos.length], offset, obj.texts[i]);
vnew[i]  = v[i].concat([0,-0.5]).concat(adj);
fnew[4*i] = f[i];
vnew[last] = v[i].concat([1,-0.5]).concat(adj);
fnew[4*i+1] = last++;
vnew[last] = v[i].concat([1, 1.5]).concat(adj);
fnew[4*i+2] = last++;
vnew[last] = v[i].concat([0, 1.5]).concat(adj);
fnew[4*i+3] = last++;
alias[i] = [last-3, last-2, last-1];
for (j=0; j < 4; j++) {
v1 = vnew[fnew[4*i+j]];
v1[tofs+2] = 2*(v1[tofs]-v1[tofs+2])*texinfo.widths[i];
v1[tofs+3] = 2*(v1[tofs+1]-v1[tofs+3])*texinfo.textHeights[i];
v1[tofs] = (texinfo.offsetsx[i] + v1[tofs]*texinfo.widths[i])/texinfo.canvasX;
v1[tofs+1] = 1.0-(texinfo.offsetsy[i] -
v1[tofs+1]*texinfo.textHeights[i])/texinfo.canvasY;
vnew[fnew[4*i+j]] = v1;
}
}
v = vnew;
obj.vertexCount = v.length;
obj.f = [fnew, fnew];
} else if (typeof obj.texcoords !== "undefined") {
tofs = stride;
stride += 2;
oofs = -1;
v = this.cbind(v, obj.texcoords);
} else {
tofs = -1;
oofs = -1;
}
obj.alias = alias;
if (typeof obj.userAttributes !== "undefined") {
obj.userAttribOffsets = {};
obj.userAttribLocations = {};
obj.userAttribSizes = {};
for (attr in obj.userAttributes) {
obj.userAttribLocations[attr] = gl.getAttribLocation(obj.prog, attr);
if (obj.userAttribLocations[attr] >= 0) { // Attribute may not have been used
obj.userAttribOffsets[attr] = stride;
v = this.cbind(v, obj.userAttributes[attr]);
stride = v[0].length;
obj.userAttribSizes[attr] = stride - obj.userAttribOffsets[attr];
}
}
}
if (typeof obj.userUniforms !== "undefined") {
obj.userUniformLocations = {};
for (attr in obj.userUniforms)
obj.userUniformLocations[attr] = gl.getUniformLocation(obj.prog, attr);
}
if (sprites_3d) {
obj.userMatrix = new CanvasMatrix4(obj.userMatrix);
obj.objects = this.flatten([].concat(obj.ids));
is_lit = false;
for (i=0; i < obj.objects.length; i++)
this.initObj(obj.objects[i]);
}
if (is_lit && !fixed_quads) {
obj.normLoc = gl.getAttribLocation(obj.prog, "aNorm");
}
nclipplanes = this.countClipplanes();
if (nclipplanes && !sprites_3d) {
obj.clipLoc = [];
for (i=0; i < nclipplanes; i++)
obj.clipLoc[i] = gl.getUniformLocation(obj.prog,"vClipplane" + i);
}
if (is_lit) {
obj.emissionLoc = gl.getUniformLocation(obj.prog, "emission");
obj.emission = new Float32Array(this.stringToRgb(this.getMaterial(id, "emission")));
obj.shininessLoc = gl.getUniformLocation(obj.prog, "shininess");
obj.shininess = this.getMaterial(id, "shininess");
obj.nlights = this.countLights();
obj.ambientLoc = [];
obj.ambient = new Float32Array(this.stringToRgb(this.getMaterial(id, "ambient")));
obj.specularLoc = [];
obj.specular = new Float32Array(this.stringToRgb(this.getMaterial(id, "specular")));
obj.diffuseLoc = [];
obj.lightDirLoc = [];
obj.viewpointLoc = [];
obj.finiteLoc = [];
for (i=0; i < obj.nlights; i++) {
obj.ambientLoc[i] = gl.getUniformLocation(obj.prog, "ambient" + i);
obj.specularLoc[i] = gl.getUniformLocation(obj.prog, "specular" + i);
obj.diffuseLoc[i] = gl.getUniformLocation(obj.prog, "diffuse" + i);
obj.lightDirLoc[i] = gl.getUniformLocation(obj.prog, "lightDir" + i);
obj.viewpointLoc[i] = gl.getUniformLocation(obj.prog, "viewpoint" + i);
obj.finiteLoc[i] = gl.getUniformLocation(obj.prog, "finite" + i);
}
}
obj.passes = is_twosided + 1;
obj.pmode = new Array(obj.passes);
for (pass = 0; pass < obj.passes; pass++) {
if (type === "triangles" || type === "quads" || type === "surface")
pmode = this.getMaterial(id, (pass === 0) ? "front" : "back");
else pmode = "filled";
obj.pmode[pass] = pmode;
}
obj.f.length = obj.passes;
for (pass = 0; pass < obj.passes; pass++) {
f = fnew = obj.f[pass];
pmode = obj.pmode[pass];
if (pmode === "culled")
f = [];
else if (pmode === "points") {
// stay with default
} else if ((type === "quads" || type === "text" ||
type === "sprites") && !sprites_3d) {
nrows = Math.floor(obj.vertexCount/4);
if (pmode === "filled") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[4*i];
fnew[6*i+1] = f[4*i + 1];
fnew[6*i+2] = f[4*i + 2];
fnew[6*i+3] = f[4*i];
fnew[6*i+4] = f[4*i + 2];
fnew[6*i+5] = f[4*i + 3];
}
} else {
fnew = Array(8*nrows);
for (i=0; i < nrows; i++) {
fnew[8*i] = f[4*i];
fnew[8*i+1] = f[4*i + 1];
fnew[8*i+2] = f[4*i + 1];
fnew[8*i+3] = f[4*i + 2];
fnew[8*i+4] = f[4*i + 2];
fnew[8*i+5] = f[4*i + 3];
fnew[8*i+6] = f[4*i + 3];
fnew[8*i+7] = f[4*i];
}
}
} else if (type === "triangles") {
nrows = Math.floor(obj.vertexCount/3);
if (pmode === "filled") {
fnew = Array(3*nrows);
for (i=0; i < fnew.length; i++) {
fnew[i] = f[i];
}
} else if (pmode === "lines") {
fnew = Array(6*nrows);
for (i=0; i < nrows; i++) {
fnew[6*i] = f[3*i];
fnew[6*i + 1] = f[3*i + 1];
fnew[6*i + 2] = f[3*i + 1];
fnew[6*i + 3] = f[3*i + 2];
fnew[6*i + 4] = f[3*i + 2];
fnew[6*i + 5] = f[3*i];
}
}
} else if (type === "spheres") {
// default
} else if (type === "surface") {
dim = obj.dim[0];
nx = dim[0];
nz = dim[1];
if (pmode === "filled") {
fnew = [];
for (j=0; j<nx-1; j++) {
for (i=0; i<nz-1; i++) {
fnew.push(f[j + nx*i],
f[j + nx*(i+1)],
f[j + 1 + nx*(i+1)],
f[j + nx*i],
f[j + 1 + nx*(i+1)],
f[j + 1 + nx*i]);
}
}
} else if (pmode === "lines") {
fnew = [];
for (j=0; j<nx; j++) {
for (i=0; i<nz; i++) {
if (i+1 < nz)
fnew.push(f[j + nx*i],
f[j + nx*(i+1)]);
if (j+1 < nx)
fnew.push(f[j + nx*i],
f[j+1 + nx*i]);
}
}
}
}
obj.f[pass] = fnew;
if (depth_sort) {
drawtype = "DYNAMIC_DRAW";
} else {
drawtype = "STATIC_DRAW";
}
}
if (fat_lines) {
alias = undefined;
obj.nextLoc = gl.getAttribLocation(obj.prog, "aNext");
obj.pointLoc = gl.getAttribLocation(obj.prog, "aPoint");
obj.aspectLoc = gl.getUniformLocation(obj.prog, "uAspect");
obj.lwdLoc = gl.getUniformLocation(obj.prog, "uLwd");
// Expand vertices to turn each segment into a pair of triangles
for (pass = 0; pass < obj.passes; pass++) {
f = obj.f[pass];    
oldrows = f.length;
if (obj.pmode[pass] === "lines") 
break;
}
if (type === "linestrip") 
nrows = 4*(oldrows - 1); 
else
nrows = 2*oldrows;
vnew = new Array(nrows);
fnew = new Array(1.5*nrows);
var fnext = new Array(nrows),
fpt = new Array(nrows), 
pt, start, gap = type === "linestrip" ? 3 : 1;
// We're going to turn each pair of vertices into 4 new ones, with the "next" and "pt" attributes
// added.
// We do this by copying the originals in the first pass, adding the new attributes, then in a 
// second pass add new vertices at the end.
for (i = 0; i < v.length; i++) {
vnew[i] = v[i].concat([0,0,0,0,0]); 
}
nextofs = stride;
pointofs = stride + 3;
stride = stride + 5;
// Now add the extras
last = v.length - 1;
ind = 0;
alias = new Array(f.length);
for (i = 0; i < f.length; i++)
alias[i] = [];
for (i = 0; i < f.length - 1; i++) {
if (type !== "linestrip" && i % 2 == 1)
continue;
k = ++last;
vnew[k] = vnew[f[i]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i+1]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = -1;
fnew[ind] = k;
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+1] = last;
alias[f[i]].push(last-1, last);
last++;
k = last;
vnew[k] = vnew[f[i+1]].slice();
for (j=0; j<3; j++)
vnew[k][nextofs + j] = vnew[f[i]][j];
vnew[k][pointofs] = -1;
vnew[k][pointofs+1] = 1;
fnew[ind+2] = k;
fnew[ind+3] = fnew[ind+1];
last++;
vnew[last] = vnew[k].slice();
vnew[last][pointofs] = 1;
fnew[ind+4] = last;
fnew[ind+5] = fnew[ind+2];
ind += 6;
alias[f[i+1]].push(last-1, last);
}
vnew.length = last+1;
v = vnew;
obj.vertexCount = v.length;
if (typeof alias !== "undefined" && typeof obj.alias !== "undefined") {  // Already have aliases from previous section?
var oldalias = obj.alias, newalias = Array(obj.alias.length);
for (i = 0; i < newalias.length; i++) {
newalias[i] = oldalias[i].slice();
for (j = 0; j < oldalias[i].length; j++)
Array.prototype.push.apply(newalias[i], alias[oldalias[j]]); // pushes each element 
}
obj.alias = newalias;
} else
obj.alias = alias;
for (pass = 0; pass < obj.passes; pass++)
if (type === "lines" || type === "linestrip" || obj.pmode[pass] == "lines") {
obj.f[pass] = fnew;
}
if (depth_sort) 
drawtype = "DYNAMIC_DRAW";
else
drawtype = "STATIC_DRAW";
}
for (pass = 0; pass < obj.passes; pass++) {
if (obj.vertexCount > 65535) {
if (this.index_uint) {
obj.f[pass] = new Uint32Array(obj.f[pass]);
obj.index_uint = true;
} else
this.alertOnce("Object has "+obj.vertexCount+" vertices, not supported in this browser.");
} else {
obj.f[pass] = new Uint16Array(obj.f[pass]);
obj.index_uint = false;
}
}
if (stride !== v[0].length) {
this.alertOnce("problem in stride calculation");
}
obj.vOffsets = {vofs:0, cofs:cofs, nofs:nofs, radofs:radofs, oofs:oofs, tofs:tofs,
nextofs:nextofs, pointofs:pointofs, stride:stride};
obj.values = new Float32Array(this.flatten(v));
if (type !== "spheres" && !sprites_3d) {
obj.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW); //
obj.ibuf = Array(obj.passes);
obj.ibuf[0] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[0]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[0], gl[drawtype]);
if (is_twosided) {
obj.ibuf[1] = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[1]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, obj.f[1], gl[drawtype]);
}
}
if (!sprites_3d) {
obj.mvMatLoc = gl.getUniformLocation(obj.prog, "mvMatrix");
obj.prMatLoc = gl.getUniformLocation(obj.prog, "prMatrix");
}
if (fixed_size) {
obj.textScaleLoc = gl.getUniformLocation(obj.prog, "textScale");
}
if (is_lit && !sprites_3d) {
obj.normMatLoc = gl.getUniformLocation(obj.prog, "normMatrix");
}
if (is_twosided) {
obj.frontLoc = gl.getUniformLocation(obj.prog, "front");
}
};
/**
* Set gl depth test based on object's material
* @param { number } id - object to use
*/
rglwidgetClass.prototype.setDepthTest = function(id) {
var gl = this.gl || this.initGL(),
tests = {never: gl.NEVER,
less:  gl.LESS,
equal: gl.EQUAL,
lequal:gl.LEQUAL,
greater: gl.GREATER,
notequal: gl.NOTEQUAL,
gequal: gl.GEQUAL,
always: gl.ALWAYS},
test = tests[this.getMaterial(id, "depth_test")];
gl.depthFunc(test);
};
rglwidgetClass.prototype.mode4type = {points : "POINTS",
linestrip : "LINE_STRIP",
abclines : "LINES",
lines : "LINES",
sprites : "TRIANGLES",
planes : "TRIANGLES",
text : "TRIANGLES",
quads : "TRIANGLES",
surface : "TRIANGLES",
triangles : "TRIANGLES"};
/**
* Sort objects from back to front
* @returns { number[] }
* @param { Object } obj - object to sort
*/
rglwidgetClass.prototype.depthSort = function(obj) {
var n = obj.centers.length,
depths = new Float32Array(n),
result = new Array(n),
compare = function(i,j) { return depths[j] - depths[i]; },
z, w;
for(i=0; i<n; i++) {
z = this.prmvMatrix.m13*obj.centers[i][0] +
this.prmvMatrix.m23*obj.centers[i][1] +
this.prmvMatrix.m33*obj.centers[i][2] +
this.prmvMatrix.m43;
w = this.prmvMatrix.m14*obj.centers[i][0] +
this.prmvMatrix.m24*obj.centers[i][1] +
this.prmvMatrix.m34*obj.centers[i][2] +
this.prmvMatrix.m44;
depths[i] = z/w;
result[i] = i;
}
result.sort(compare);
return result;
};
rglwidgetClass.prototype.disableArrays = function(obj, enabled) {
var gl = this.gl || this.initGL(),
objLocs = ["normLoc", "texLoc", "ofsLoc", "pointLoc", "nextLoc"],
thisLocs = ["posLoc", "colLoc"], i, attr;
for (i = 0; i < objLocs.length; i++) 
if (enabled[objLocs[i]]) gl.disableVertexAttribArray(obj[objLocs[i]]);
for (i = 0; i < thisLocs.length; i++)
if (enabled[thisLocs[i]]) gl.disableVertexAttribArray(this[objLocs[i]]);
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.disableVertexAttribArray( obj.userAttribLocations[attr] );
}
}
}
/**
* Draw an object in a subscene
* @param { number } id - object to draw
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawObj = function(id, subsceneid) {
var obj = this.getObj(id),
subscene = this.getObj(subsceneid),
flags = obj.flags,
type = obj.type,
is_lit = flags & this.f_is_lit,
has_texture = flags & this.f_has_texture,
fixed_quads = flags & this.f_fixed_quads,
is_transparent = flags & this.f_is_transparent,
depth_sort = flags & this.f_depth_sort,
sprites_3d = flags & this.f_sprites_3d,
sprite_3d = flags & this.f_sprite_3d,
is_lines = flags & this.f_is_lines,
fat_lines = flags & this.f_fat_lines,
is_points = flags & this.f_is_points,
fixed_size = flags & this.f_fixed_size,
is_twosided = (flags & this.f_is_twosided) > 0,
gl = this.gl || this.initGL(),
mat,
sphereMV, baseofs, ofs, sscale, i, count, light,
pass, mode, pmode, attr,
enabled = {};
if (typeof id !== "number") {
this.alertOnce("drawObj id is "+typeof id);
}
if (type === "planes") {
if (obj.bbox !== subscene.par3d.bbox || !obj.initialized) {
this.planeUpdateTriangles(id, subscene.par3d.bbox);
}
}
if (!obj.initialized)
this.initObj(id);
if (type === "clipplanes") {
count = obj.offsets.length;
var IMVClip = [];
for (i=0; i < count; i++) {
IMVClip[i] = this.multMV(this.invMatrix, obj.vClipplane.slice(4*i, 4*(i+1)));
}
obj.IMVClip = IMVClip;
return;
}
if (type === "light" || type === "bboxdeco" || !obj.vertexCount)
return;
if (!is_transparent &&
obj.someHidden) {
is_transparent = true;
depth_sort = ["triangles", "quads", "surface",
"spheres", "sprites", "text"].indexOf(type) >= 0;
}        
this.setDepthTest(id);
if (sprites_3d) {
var norigs = obj.vertices.length,
savenorm = new CanvasMatrix4(this.normMatrix);
this.origs = obj.vertices;
this.usermat = new Float32Array(obj.userMatrix.getAsArray());
this.radii = obj.radii;
this.normMatrix = subscene.spriteNormmat;
for (this.iOrig=0; this.iOrig < norigs; this.iOrig++) {
for (i=0; i < obj.objects.length; i++) {
this.drawObj(obj.objects[i], subsceneid);
}
}
this.normMatrix = savenorm;
return;
} else {
gl.useProgram(obj.prog);
}
if (typeof obj.polygon_offset !== "undefined") {
gl.polygonOffset(obj.polygon_offset[0],
obj.polygon_offset[1]);
gl.enable(gl.POLYGON_OFFSET_FILL);
}
if (sprite_3d) {
gl.uniform3fv(obj.origLoc, new Float32Array(this.origs[this.iOrig]));
if (this.radii.length > 1) {
gl.uniform1f(obj.sizeLoc, this.radii[this.iOrig][0]);
} else {
gl.uniform1f(obj.sizeLoc, this.radii[0][0]);
}
gl.uniformMatrix4fv(obj.usermatLoc, false, this.usermat);
}
if (type === "spheres") {
gl.bindBuffer(gl.ARRAY_BUFFER, this.sphere.buf);
} else {
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
}
gl.uniformMatrix4fv( obj.prMatLoc, false, new Float32Array(this.prMatrix.getAsArray()) );
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(this.mvMatrix.getAsArray()) );
var clipcheck = 0,
clipplaneids = subscene.clipplanes,
clip, j;
for (i=0; i < clipplaneids.length; i++) {
clip = this.getObj(clipplaneids[i]);
for (j=0; j < clip.offsets.length; j++) {
gl.uniform4fv(obj.clipLoc[clipcheck + j], clip.IMVClip[j]);
}
clipcheck += clip.offsets.length;
}
if (typeof obj.clipLoc !== "undefined")
for (i=clipcheck; i < obj.clipLoc.length; i++)
gl.uniform4f(obj.clipLoc[i], 0,0,0,0);
if (is_lit) {
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(this.normMatrix.getAsArray()) );
gl.uniform3fv( obj.emissionLoc, obj.emission);
gl.uniform1f( obj.shininessLoc, obj.shininess);
for (i=0; i < subscene.lights.length; i++) {
light = this.getObj(subscene.lights[i]);
if (!light.initialized) this.initObj(subscene.lights[i]);
gl.uniform3fv( obj.ambientLoc[i], this.componentProduct(light.ambient, obj.ambient));
gl.uniform3fv( obj.specularLoc[i], this.componentProduct(light.specular, obj.specular));
gl.uniform3fv( obj.diffuseLoc[i], light.diffuse);
gl.uniform3fv( obj.lightDirLoc[i], light.lightDir);
gl.uniform1i( obj.viewpointLoc[i], light.viewpoint);
gl.uniform1i( obj.finiteLoc[i], light.finite);
}
for (i=subscene.lights.length; i < obj.nlights; i++) {
gl.uniform3f( obj.ambientLoc[i], 0,0,0);
gl.uniform3f( obj.specularLoc[i], 0,0,0);
gl.uniform3f( obj.diffuseLoc[i], 0,0,0);
}
}
if (fixed_size) {
gl.uniform2f( obj.textScaleLoc, 0.75/this.vp.width, 0.75/this.vp.height);
}
gl.enableVertexAttribArray( this.posLoc );
enabled.posLoc = true;
var nc = obj.colorCount;
count = obj.vertexCount;
if (type === "spheres") {
subscene = this.getObj(subsceneid);
var scale = subscene.par3d.scale,
scount = count, indices;
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.enableVertexAttribArray(obj.normLoc );
enabled.normLoc = true;
gl.vertexAttribPointer(obj.normLoc,  3, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,  0);
gl.disableVertexAttribArray( this.colLoc );
var sphereNorm = new CanvasMatrix4();
sphereNorm.scale(scale[0], scale[1], scale[2]);
sphereNorm.multRight(this.normMatrix);
gl.uniformMatrix4fv( obj.normMatLoc, false, new Float32Array(sphereNorm.getAsArray()) );
if (nc == 1) {
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
}
if (has_texture) {
gl.enableVertexAttribArray( obj.texLoc );
enabled.texLoc = true;
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*this.sphere.vOffsets.stride,
4*this.sphere.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (depth_sort)
indices = this.depthSort(obj);
for (i = 0; i < scount; i++) {
sphereMV = new CanvasMatrix4();
if (depth_sort) {
baseofs = indices[i]*obj.vOffsets.stride;
} else {
baseofs = i*obj.vOffsets.stride;
}
ofs = baseofs + obj.vOffsets.radofs;
sscale = obj.values[ofs];
sphereMV.scale(sscale/scale[0], sscale/scale[1], sscale/scale[2]);
sphereMV.translate(obj.values[baseofs],
obj.values[baseofs+1],
obj.values[baseofs+2]);
sphereMV.multRight(this.mvMatrix);
gl.uniformMatrix4fv( obj.mvMatLoc, false, new Float32Array(sphereMV.getAsArray()) );
if (nc > 1) {
ofs = baseofs + obj.vOffsets.cofs;
gl.vertexAttrib4f( this.colLoc, obj.values[ofs],
obj.values[ofs+1],
obj.values[ofs+2],
obj.values[ofs+3] );
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this.sphere.ibuf);
gl.drawElements(gl.TRIANGLES, this.sphere.sphereCount, gl.UNSIGNED_SHORT, 0);
}
this.disableArrays(obj, enabled);
if (typeof obj.polygon_offset !== "undefined") 
gl.disable(gl.POLYGON_OFFSET_FILL);
return;
} else {
if (obj.colorCount === 1) {
gl.disableVertexAttribArray( this.colLoc );
gl.vertexAttrib4fv( this.colLoc, new Float32Array(obj.onecolor));
} else {
gl.enableVertexAttribArray( this.colLoc );
enabled.colLoc = true;
gl.vertexAttribPointer(this.colLoc, 4, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.cofs);
}
}
if (is_lit && obj.vOffsets.nofs > 0) {
gl.enableVertexAttribArray( obj.normLoc );
enabled.normLoc = true;
gl.vertexAttribPointer(obj.normLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nofs);
}
if (has_texture || type === "text") {
gl.enableVertexAttribArray( obj.texLoc );
enabled.texLoc = true;
gl.vertexAttribPointer(obj.texLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.tofs);
gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, obj.texture);
gl.uniform1i( obj.sampler, 0);
}
if (fixed_quads) {
gl.enableVertexAttribArray( obj.ofsLoc );
enabled.ofsLoc = true;
gl.vertexAttribPointer(obj.ofsLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.oofs);
}
if (typeof obj.userAttributes !== "undefined") {
for (attr in obj.userAttribSizes) {  // Not all attributes may have been used
gl.enableVertexAttribArray( obj.userAttribLocations[attr] );
gl.vertexAttribPointer( obj.userAttribLocations[attr], obj.userAttribSizes[attr],
gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.userAttribOffsets[attr]);
}
}
if (typeof obj.userUniforms !== "undefined") {
for (attr in obj.userUniformLocations) {
var loc = obj.userUniformLocations[attr];
if (loc !== null) {
var uniform = obj.userUniforms[attr];
if (typeof uniform.length === "undefined")
gl.uniform1f(loc, uniform);
else if (typeof uniform[0].length === "undefined") {
uniform = new Float32Array(uniform);
switch(uniform.length) {
case 2: gl.uniform2fv(loc, uniform); break;
case 3: gl.uniform3fv(loc, uniform); break;
case 4: gl.uniform4fv(loc, uniform); break;
default: console.warn("bad uniform length");
}
} else if (uniform.length == 4 && uniform[0].length == 4)
gl.uniformMatrix4fv(loc, false, new Float32Array(uniform.getAsArray()));
else
console.warn("unsupported uniform matrix");
}
}
}
for (pass = 0; pass < obj.passes; pass++) {
pmode = obj.pmode[pass];
if (pmode === "culled")
continue;
mode = fat_lines && (is_lines || pmode == "lines") ? "TRIANGLES" : this.mode4type[type];
if (depth_sort && pmode == "filled") {// Don't try depthsorting on wireframe or points
var faces = this.depthSort(obj),
nfaces = faces.length,
frowsize = Math.floor(obj.f[pass].length/nfaces);
if (type !== "spheres") {
var f = obj.index_uint ? new Uint32Array(obj.f[pass].length) : new Uint16Array(obj.f[pass].length);
for (i=0; i<nfaces; i++) {
for (j=0; j<frowsize; j++) {
f[frowsize*i + j] = obj.f[pass][frowsize*faces[i] + j];
}
}
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, f, gl.DYNAMIC_DRAW);
}
}
if (is_twosided)
gl.uniform1i(obj.frontLoc, pass !== 0);
if (type !== "spheres") 
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, obj.ibuf[pass]);
if (type === "sprites" || type === "text" || type === "quads") {
count = count * 6/4;
} else if (type === "surface") {
count = obj.f[pass].length;
}
count = obj.f[pass].length;
if (!is_lines && pmode === "lines" && !fat_lines) {
mode = "LINES";
} else if (pmode === "points") {
mode = "POINTS";
}
if ((is_lines || pmode === "lines") && fat_lines) {
gl.enableVertexAttribArray(obj.pointLoc);
enabled.pointLoc = true;
gl.vertexAttribPointer(obj.pointLoc, 2, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.pointofs);
gl.enableVertexAttribArray(obj.nextLoc );
enabled.nextLoc = true;
gl.vertexAttribPointer(obj.nextLoc, 3, gl.FLOAT, false, 4*obj.vOffsets.stride, 4*obj.vOffsets.nextofs);
gl.uniform1f(obj.aspectLoc, this.vp.width/this.vp.height);
gl.uniform1f(obj.lwdLoc, this.getMaterial(id, "lwd")/this.vp.height);
}
gl.vertexAttribPointer(this.posLoc,  3, gl.FLOAT, false, 4*obj.vOffsets.stride,  4*obj.vOffsets.vofs);
gl.drawElements(gl[mode], count, obj.index_uint ? gl.UNSIGNED_INT : gl.UNSIGNED_SHORT, 0);
this.disableArrays(obj, enabled);
}
if (typeof obj.polygon_offset !== "undefined") 
gl.disable(gl.POLYGON_OFFSET_FILL);
};
/**
* Draw the background for a subscene
* @param { number } id - id of background object
* @param { number } subsceneid - id of subscene
*/
rglwidgetClass.prototype.drawBackground = function(id, subsceneid) {
var gl = this.gl || this.initGL(),
obj = this.getObj(id),
bg, i;
if (!obj.initialized)
this.initObj(id);
if (obj.colors.length) {
bg = obj.colors[0];
gl.clearColor(bg[0], bg[1], bg[2], bg[3]);
gl.depthMask(true);
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
}
if (typeof obj.quad !== "undefined") {
this.prMatrix.makeIdentity();
this.mvMatrix.makeIdentity();
gl.disable(gl.BLEND);
gl.disable(gl.DEPTH_TEST);
gl.depthMask(false);
for (i=0; i < obj.quad.length; i++)
this.drawObj(obj.quad[i], subsceneid);
}
};
/**
* Draw a subscene
* @param { number } subsceneid - id of subscene
* @param { boolean } opaquePass - is this the opaque drawing pass?
*/
rglwidgetClass.prototype.drawSubscene = function(subsceneid, opaquePass) {
var gl = this.gl || this.initGL(),
sub = this.getObj(subsceneid),
objects = this.scene.objects,
subids = sub.objects,
subscene_has_faces = false,
subscene_needs_sorting = false,
flags, i, obj;
if (sub.par3d.skipRedraw)
return;
for (i=0; i < subids.length; i++) {
obj = objects[subids[i]];
flags = obj.flags;
if (typeof flags !== "undefined") {
subscene_has_faces |= (flags & this.f_is_lit)
& !(flags & this.f_fixed_quads);
obj.is_transparent = (flags & this.f_is_transparent) || obj.someHidden;
subscene_needs_sorting |= (flags & this.f_depth_sort) || obj.is_transparent;
}
}
this.setViewport(subsceneid);
if (typeof sub.backgroundId !== "undefined" && opaquePass)
this.drawBackground(sub.backgroundId, subsceneid);
if (subids.length) {
this.setprMatrix(subsceneid);
this.setmvMatrix(subsceneid);
if (subscene_has_faces) {
this.setnormMatrix(subsceneid);
if ((sub.flags & this.f_sprites_3d) &&
typeof sub.spriteNormmat === "undefined") {
sub.spriteNormmat = new CanvasMatrix4(this.normMatrix);
}
}
if (subscene_needs_sorting)
this.setprmvMatrix();
var clipids = sub.clipplanes;
if (typeof clipids === "undefined") {
console.warn("bad clipids");
}
if (clipids.length > 0) {
this.invMatrix = new CanvasMatrix4(this.mvMatrix);
this.invMatrix.invert();
for (i = 0; i < clipids.length; i++)
this.drawObj(clipids[i], subsceneid);
}
subids = sub.opaque.concat(sub.transparent);
if (opaquePass) {
gl.enable(gl.DEPTH_TEST);
gl.depthMask(true);
gl.disable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
if (!this.getObj(subids[i]).is_transparent) 
this.drawObj(subids[i], subsceneid);
}
} else {
gl.depthMask(false);
gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA,
gl.ONE, gl.ONE);
gl.enable(gl.BLEND);
for (i = 0; i < subids.length; i++) {
if (this.getObj(subids[i]).is_transparent)
this.drawObj(subids[i], subsceneid);
}
}
subids = sub.subscenes;
for (i = 0; i < subids.length; i++) {
this.drawSubscene(subids[i], opaquePass);
}
}
};
/**
* Respond to brush change
*/
rglwidgetClass.prototype.selectionChanged = function() {
var i, j, k, id, subid = this.select.subscene, subscene,
objids, obj,
p1 = this.select.region.p1, p2 = this.select.region.p2,
filter, selection = [], handle, keys, xmin, x, xmax, ymin, y, ymax, z, v,
someHidden;
if (!subid)
return;
subscene = this.getObj(subid);
objids = subscene.objects;
filter = this.scene.crosstalk.filter;
this.setmvMatrix(subid);
this.setprMatrix(subid);
this.setprmvMatrix();
xmin = Math.min(p1.x, p2.x);
xmax = Math.max(p1.x, p2.x);
ymin = Math.min(p1.y, p2.y);
ymax = Math.max(p1.y, p2.y);
for (i = 0; i < objids.length; i++) {
id = objids[i];
j = this.scene.crosstalk.id.indexOf(id);
if (j >= 0) {
keys = this.scene.crosstalk.key[j];
obj = this.getObj(id);
someHidden = false;
for (k = 0; k < keys.length; k++) {
if (filter && filter.indexOf(keys[k]) < 0) {
someHidden = true;
continue;
}
v = [].concat(obj.vertices[k]).concat(1.0);
v = this.multVM(v, this.prmvMatrix);
x = v[0]/v[3];
y = v[1]/v[3];
z = v[2]/v[3];
if (xmin <= x && x <= xmax && ymin <= y && y <= ymax && -1.0 <= z && z <= 1.0) {
selection.push(keys[k]);
} else
someHidden = true;
}
obj.someHidden = someHidden && (filter || selection.length);
obj.initialized = false;
/* Who should we notify?  Only shared data in the current subscene, or everyone? */
if (!this.equalArrays(selection, this.scene.crosstalk.selection)) {
handle = this.scene.crosstalk.sel_handle[j];
handle.set(selection, {rglSubsceneId: this.select.subscene});
}
}
}
};
/**
* Respond to selection or filter change from crosstalk
* @param { Object } event - crosstalk event
* @param { boolean } filter - filter or selection?
*/
rglwidgetClass.prototype.selection = function(event, filter) {
var i, j, ids, obj, keys, crosstalk = this.scene.crosstalk,
selection, someHidden;
// Record the message and find out if this event makes some objects have mixed values:
crosstalk = this.scene.crosstalk;
if (filter) {
filter = crosstalk.filter = event.value;
selection = crosstalk.selection;
} else {  
selection = crosstalk.selection = event.value;
filter = crosstalk.filter;
}
ids = crosstalk.id;
for (i = 0; i < ids.length ; i++) {
obj = this.getObj(ids[i]);
obj.initialized = false;
keys = crosstalk.key[i];
someHidden = false;
for (j = 0; j < keys.length && !someHidden; j++) {
if ((filter && filter.indexOf(keys[j]) < 0) ||
(selection.length && selection.indexOf(keys[j]) < 0))
someHidden = true;
}
obj.someHidden = someHidden;
}
this.drawScene();
};
/**
* Clear the selection brush
* @param { number } except - Subscene that should ignore this request
*/
rglwidgetClass.prototype.clearBrush = function(except) {
if (this.select.subscene != except) {
this.select.state = "inactive";
this.delFromSubscene(this.scene.brushId, this.select.subscene);
}
this.drawScene();
};
/**
* Compute mouse coordinates relative to current canvas
* @returns { Object }
* @param { Object } event - event object from mouse click
*/
rglwidgetClass.prototype.relMouseCoords = function(event) {
var totalOffsetX = 0,
totalOffsetY = 0,
currentElement = this.canvas;
do {
totalOffsetX += currentElement.offsetLeft;
totalOffsetY += currentElement.offsetTop;
currentElement = currentElement.offsetParent;
}
while(currentElement);
var canvasX = event.pageX - totalOffsetX,
canvasY = event.pageY - totalOffsetY;
return {x:canvasX, y:canvasY};
};
/**
* Set mouse handlers for the scene
*/
rglwidgetClass.prototype.setMouseHandlers = function() {
var self = this, activeSubscene, handler,
handlers = {}, drag = 0;
handlers.rotBase = 0;
this.screenToVector = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
radius = Math.max(width, height)/2.0,
cx = width/2.0,
cy = height/2.0,
px = (x-cx)/radius,
py = (y-cy)/radius,
plen = Math.sqrt(px*px+py*py);
if (plen > 1.e-6) {
px = px/plen;
py = py/plen;
}
var angle = (Math.SQRT2 - plen)/Math.SQRT2*Math.PI/2,
z = Math.sin(angle),
zlen = Math.sqrt(1.0 - z*z);
px = px * zlen;
py = py * zlen;
return [px, py, z];
};
handlers.trackballdown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.rotBase = this.screenToVector(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.trackballmove = function(x,y) {
var rotCurrent = this.screenToVector(x,y),
rotBase = handlers.rotBase,
dot = rotBase[0]*rotCurrent[0] +
rotBase[1]*rotCurrent[1] +
rotBase[2]*rotCurrent[2],
angle = Math.acos( dot/this.vlen(rotBase)/this.vlen(rotCurrent) )*180.0/Math.PI,
axis = this.xprod(rotBase, rotCurrent),
objects = this.scene.objects,
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
l = activeModel.par3d.listeners,
i;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(angle, axis[0], axis[1], axis[2]);
}
this.drawScene();
};
handlers.trackballend = 0;
this.clamp = function(x, lo, hi) {
return Math.max(lo, Math.min(x, hi));
};
this.screenToPolar = function(x,y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height,
r = Math.min(width, height)/2,
dx = this.clamp(x - width/2, -r, r),
dy = this.clamp(y - height/2, -r, r);
return [Math.asin(dx/r), Math.asin(-dy/r)];
};
handlers.polardown = function(x,y) {
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
handlers.dragBase = this.screenToPolar(x, y);
this.saveMat = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
activeSub.camBase = [-Math.atan2(activeSub.saveMat.m13, activeSub.saveMat.m11),
Math.atan2(activeSub.saveMat.m32, activeSub.saveMat.m22)];
}
};
handlers.polarmove = function(x,y) {
var dragCurrent = this.screenToPolar(x,y),
activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
objects = this.scene.objects,
l = activeModel.par3d.listeners,
i, changepos = [];
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
for (j=0; j<2; j++)
changepos[j] = -(dragCurrent[j] - handlers.dragBase[j]);
activeSub.par3d.userMatrix.makeIdentity();
activeSub.par3d.userMatrix.rotate(changepos[0]*180/Math.PI, 0,-1,0);
activeSub.par3d.userMatrix.multRight(objects[l[i]].saveMat);
activeSub.par3d.userMatrix.rotate(changepos[1]*180/Math.PI, -1,0,0);
}
this.drawScene();
};
handlers.polarend = 0;
handlers.axisdown = function(x,y) {
handlers.rotBase = this.screenToVector(x, this.canvas.height/2);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.saveMat = new CanvasMatrix4(activeSub.par3d.userMatrix);
}
};
handlers.axismove = function(x,y) {
var rotCurrent = this.screenToVector(x, this.canvas.height/2),
rotBase = handlers.rotBase,
angle = (rotCurrent[0] - rotBase[0])*180/Math.PI,
rotMat = new CanvasMatrix4();
rotMat.rotate(angle, handlers.axis[0], handlers.axis[1], handlers.axis[2]);
var activeSub = this.getObj(activeSubscene),
activeModel = this.getObj(this.useid(activeSub.id, "model")),
i, l = activeModel.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.userMatrix.load(activeSub.saveMat);
activeSub.par3d.userMatrix.multLeft(rotMat);
}
this.drawScene();
};
handlers.axisend = 0;
handlers.y0zoom = 0;
handlers.zoom0 = 0;
handlers.zoomdown = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
handlers.y0zoom = y;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.zoom0 = Math.log(activeSub.par3d.zoom);
}
};
handlers.zoommove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.zoom = Math.exp(activeSub.zoom0 + (y-handlers.y0zoom)/this.canvas.height);
}
this.drawScene();
};
handlers.zoomend = 0;
handlers.y0fov = 0;
handlers.fovdown = function(x, y) {
handlers.y0fov = y;
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.fov0 = activeSub.par3d.FOV;
}
};
handlers.fovmove = function(x, y) {
var activeSub = this.getObj(activeSubscene),
activeProjection = this.getObj(this.useid(activeSub.id, "projection")),
i, l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = this.getObj(l[i]);
activeSub.par3d.FOV = Math.max(1, Math.min(179, activeSub.fov0 +
180*(y-handlers.y0fov)/this.canvas.height));
}
this.drawScene();
};
handlers.fovend = 0;
handlers.selectingdown = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height, 
p = {x: 2.0*x/width - 1.0, y: 2.0*y/height - 1.0};
this.select.region = {p1: p, p2: p};
if (this.select.subscene && this.select.subscene != activeSubscene)
this.delFromSubscene(this.scene.brushId, this.select.subscene);
this.select.subscene = activeSubscene;
this.addToSubscene(this.scene.brushId, activeSubscene);
this.select.state = "changing";
if (typeof this.scene.brushId !== "undefined")
this.getObj(this.scene.brushId).initialized = false;
this.drawScene();
};
handlers.selectingmove = function(x, y) {
var viewport = this.getObj(activeSubscene).par3d.viewport,
width = viewport.width*this.canvas.width,
height = viewport.height*this.canvas.height;
if (this.select.state === "inactive") 
return;
this.select.region.p2 = {x: 2.0*x/width - 1.0, y: 2.0*y/height - 1.0};
if (typeof this.scene.brushId !== "undefined")
this.getObj(this.scene.brushId).initialized = false;
this.drawScene();
};
handlers.selectingend = 0;
this.canvas.onmousedown = function ( ev ){
if (!ev.which) // Use w3c defns in preference to MS
switch (ev.button) {
case 0: ev.which = 1; break;
case 1:
case 4: ev.which = 2; break;
case 2: ev.which = 3;
}
drag = ["left", "middle", "right"][ev.which-1];
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height-coords.y;
activeSubscene = self.whichSubscene(coords);
var sub = self.getObj(activeSubscene), f;
handler = sub.par3d.mouseMode[drag];
switch (handler) {
case "xAxis":
handler = "axis";
handlers.axis = [1.0, 0.0, 0.0];
break;
case "yAxis":
handler = "axis";
handlers.axis = [0.0, 1.0, 0.0];
break;
case "zAxis":
handler = "axis";
handlers.axis = [0.0, 0.0, 1.0];
break;
}
f = handlers[handler + "down"];
if (f) {
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
ev.preventDefault();
} else
console.warn("Mouse handler '" + handler + "' is not implemented.");
};
this.canvas.onmouseup = function ( ev ){
if ( drag === 0 ) return;
var f = handlers[handler + "end"];
if (f) {
f.call(self);
ev.preventDefault();
}
drag = 0;
};
this.canvas.onmouseout = this.canvas.onmouseup;
this.canvas.onmousemove = function ( ev ) {
if ( drag === 0 ) return;
var f = handlers[handler + "move"];
if (f) {
var coords = self.relMouseCoords(ev);
coords.y = self.canvas.height - coords.y;
coords = self.translateCoords(activeSubscene, coords);
f.call(self, coords.x, coords.y);
}
};
handlers.wheelHandler = function(ev) {
var del = 1.02, i;
if (ev.shiftKey) del = 1.002;
var ds = ((ev.detail || ev.wheelDelta) > 0) ? del : (1 / del);
if (typeof activeSubscene === "undefined")
activeSubscene = self.scene.rootSubscene;
var activeSub = self.getObj(activeSubscene),
activeProjection = self.getObj(self.useid(activeSub.id, "projection")),
l = activeProjection.par3d.listeners;
for (i = 0; i < l.length; i++) {
activeSub = self.getObj(l[i]);
activeSub.par3d.zoom *= ds;
}
self.drawScene();
ev.preventDefault();
};
this.canvas.addEventListener("DOMMouseScroll", handlers.wheelHandler, false);
this.canvas.addEventListener("mousewheel", handlers.wheelHandler, false);
};
/**
* Find a particular subscene by inheritance
* @returns { number } id of subscene to use
* @param { number } subsceneid - child subscene
* @param { string } type - type of inheritance:  "projection" or "model"
*/
rglwidgetClass.prototype.useid = function(subsceneid, type) {
var sub = this.getObj(subsceneid);
if (sub.embeddings[type] === "inherit")
return(this.useid(sub.parent, type));
else
return subsceneid;
};
/**
* Check whether point is in viewport of subscene
* @returns {boolean}
* @param { Object } coords - screen coordinates of point
* @param { number } subsceneid - subscene to check
*/
rglwidgetClass.prototype.inViewport = function(coords, subsceneid) {
var viewport = this.getObj(subsceneid).par3d.viewport,
x0 = coords.x - viewport.x*this.canvas.width,
y0 = coords.y - viewport.y*this.canvas.height;
return 0 <= x0 && x0 <= viewport.width*this.canvas.width &&
0 <= y0 && y0 <= viewport.height*this.canvas.height;
};
/**
* Find which subscene contains a point
* @returns { number } subscene id
* @param { Object } coords - coordinates of point
*/
rglwidgetClass.prototype.whichSubscene = function(coords) {
var self = this,
recurse = function(subsceneid) {
var subscenes = self.getChildSubscenes(subsceneid), i, id;
for (i=0; i < subscenes.length; i++) {
id = recurse(subscenes[i]);
if (typeof(id) !== "undefined")
return(id);
}
if (self.inViewport(coords, subsceneid))
return(subsceneid);
else
return undefined;
},
rootid = this.scene.rootSubscene,
result = recurse(rootid);
if (typeof(result) === "undefined")
result = rootid;
return result;
};
/**
* Translate from window coordinates to viewport coordinates
* @returns { Object } translated coordinates
* @param { number } subsceneid - which subscene to use?
* @param { Object } coords - point to translate
*/
rglwidgetClass.prototype.translateCoords = function(subsceneid, coords) {
var viewport = this.getObj(subsceneid).par3d.viewport;
return {x: coords.x - viewport.x*this.canvas.width,
y: coords.y - viewport.y*this.canvas.height};
};
/**
* Initialize the sphere object
*/
rglwidgetClass.prototype.initSphere = function() {
var verts = this.scene.sphereVerts,
reuse = verts.reuse, result;
if (typeof reuse !== "undefined") {
var prev = document.getElementById(reuse).rglinstance.sphere;
result = {values: prev.values, vOffsets: prev.vOffsets, it: prev.it};
} else
result = {values: new Float32Array(this.flatten(this.cbind(this.transpose(verts.vb),
this.transpose(verts.texcoords)))),
it: new Uint16Array(this.flatten(this.transpose(verts.it))),
vOffsets: {vofs:0, cofs:-1, nofs:-1, radofs:-1, oofs:-1,
tofs:3, nextofs:-1, pointofs:-1, stride:5}};
result.sphereCount = result.it.length;
this.sphere = result;
};
/**
* Set the vertices in the selection box object
*/
rglwidgetClass.prototype.initSelection = function(id) {
if (typeof this.select.region === "undefined")
return;
var obj = this.getObj(id),
width = this.canvas.width,
height = this.canvas.height, 
p1 = this.select.region.p1,
p2 = this.select.region.p2;
obj.vertices = [[p1.x, p1.y, 0.0],
[p2.x, p1.y, 0.0],
[p2.x, p2.y, 0.0],
[p1.x, p2.y, 0.0],
[p1.x, p1.y, 0.0]];
};
/**
* Do the gl part of initializing the sphere
*/
rglwidgetClass.prototype.initSphereGL = function() {
var gl = this.gl || this.initGL(), sphere = this.sphere;
if (gl.isContextLost()) return;
sphere.buf = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, sphere.buf);
gl.bufferData(gl.ARRAY_BUFFER, sphere.values, gl.STATIC_DRAW);
sphere.ibuf = gl.createBuffer();
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, sphere.ibuf);
gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, sphere.it, gl.STATIC_DRAW);
return;
};
/**
* Initialize the DOM object
* @param { Object } el - the DOM object
* @param { Object } x - the scene data sent by JSON from R
*/
rglwidgetClass.prototype.initialize = function(el, x) {
this.textureCanvas = document.createElement("canvas");
this.textureCanvas.style.display = "block";
this.scene = x;
this.normMatrix = new CanvasMatrix4();
this.saveMat = {};
this.distance = null;
this.posLoc = 0;
this.colLoc = 1;
if (el) {
el.rglinstance = this;
this.el = el;
this.webGLoptions = el.rglinstance.scene.webGLoptions;
this.initCanvas();
}
if (typeof Shiny !== "undefined") {
var self = this;
Shiny.addCustomMessageHandler("shinyGetPar3d",
function(message) {
var i, param, 
subscene = self.getObj(message.subscene),
parameters = [].concat(message.parameters),
result = {tag: message.tag, subscene: message.subscene};
if (typeof subscene !== "undefined") {
for (i = 0; i < parameters.length; i++) {
param = parameters[i];
result[param] = subscene.par3d[param];
};
} else {
console.log("subscene "+message.subscene+" undefined.")
}
Shiny.setInputValue("par3d:shinyPar3d", result, {priority: "event"});
});
Shiny.addCustomMessageHandler("shinySetPar3d",
function(message) {
var param = message.parameter, 
subscene = self.getObj(message.subscene);
if (typeof subscene !== "undefined") {
subscene.par3d[param] = message.value;
subscene.initialized = false;
self.drawScene();
} else {
console.log("subscene "+message.subscene+" undefined.")
}
})
}
};
/**
* Restart the WebGL canvas
*/
rglwidgetClass.prototype.restartCanvas = function() {
var newcanvas = document.createElement("canvas"),
self = this;
newcanvas.width = this.el.width;
newcanvas.height = this.el.height;
newcanvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
newcanvas.addEventListener("webglcontextlost",
this.onContextLost, false);
while (this.el.firstChild) {
this.el.removeChild(this.el.firstChild);
}
this.el.appendChild(newcanvas);
this.canvas = newcanvas;
this.setMouseHandlers();
if (this.gl) 
Object.keys(this.scene.objects).forEach(function(key){
self.getObj(parseInt(key, 10)).texture = undefined; 
});
this.gl = null;
};
/**
* Initialize the WebGL canvas
*/
rglwidgetClass.prototype.initCanvas = function() {
this.restartCanvas();
var objs = this.scene.objects,
self = this;
Object.keys(objs).forEach(function(key){
var id = parseInt(key, 10),
obj = self.getObj(id);
if (typeof obj.reuse !== "undefined")
self.copyObj(id, obj.reuse);
});
Object.keys(objs).forEach(function(key){
self.initSubscene(parseInt(key, 10));
});
this.setMouseHandlers();
this.initSphere();
this.onContextRestored = function(event) {
self.initGL();
self.drawScene();
};
this.onContextLost = function(event) {
if (!self.drawing)
this.gl = null;
event.preventDefault();
};
this.initGL0();
this.lazyLoadScene = function() {
if (typeof self.slide === "undefined")
self.slide = self.getSlide();
if (self.isInBrowserViewport()) {
if (!self.gl || self.gl.isContextLost())
self.initGL();
self.drawScene();
}
};
window.addEventListener("DOMContentLoaded", this.lazyLoadScene, false);
window.addEventListener("load", this.lazyLoadScene, false);
window.addEventListener("resize", this.lazyLoadScene, false);
window.addEventListener("scroll", this.lazyLoadScene, false);
this.slide = this.getSlide();
if (this.slide) {
if (typeof this.slide.rgl === "undefined")
this.slide.rgl = [this];
else
this.slide.rgl.push(this);
if (this.scene.context.rmarkdown) 
if (this.scene.context.rmarkdown === "ioslides_presentation") {
this.slide.setAttribute("slideenter", "this.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window);})");
} else if (this.scene.context.rmarkdown === "slidy_presentation") {
// This method would also work in ioslides, but it gets triggered
// something like 5 times per slide for every slide change, so
// you'd need a quicker function than lazyLoadScene.
var MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver,
observer = new MutationObserver(function(mutations) {
mutations.forEach(function(mutation) {
self.slide.rgl.forEach(function(scene) { scene.lazyLoadScene.call(window); });});});
observer.observe(this.slide, { attributes: true, attributeFilter:["class"] });
}
}
};
/**
* Start the writeWebGL scene. This is only used by writeWebGL; rglwidget has
no debug element and does the drawing in rglwidget.js.
*/
rglwidgetClass.prototype.start = function() {
if (typeof this.prefix !== "undefined") {
this.debugelement = document.getElementById(this.prefix + "debug");
this.debug("");
}
this.drag = 0;
this.drawScene();
};
/**
* Display a debug message
* @param { string } msg - The message to display
* @param { Object } [img] - Image to insert before message
*/
rglwidgetClass.prototype.debug = function(msg, img) {
if (typeof this.debugelement !== "undefined" && this.debugelement !== null) {
this.debugelement.innerHTML = msg;
if (typeof img !== "undefined") {
this.debugelement.insertBefore(img, this.debugelement.firstChild);
}
} else if (msg !== "")
alert(msg);
};
/**
* Get the snapshot image of this scene
* @returns { Object } The img DOM element
*/
rglwidgetClass.prototype.getSnapshot = function() {
var img;
if (typeof this.scene.snapshot !== "undefined") {
img = document.createElement("img");
img.src = this.scene.snapshot;
img.alt = "Snapshot";
}
return img;
};
/**
* Initial test for WebGL
*/
rglwidgetClass.prototype.initGL0 = function() {
if (!window.WebGLRenderingContext){
alert("Your browser does not support WebGL. See http://get.webgl.org");
return;
}
};
/**
* If we are in an ioslides or slidy presentation, get the
* DOM element of the current slide
* @returns { Object }
*/
rglwidgetClass.prototype.getSlide = function() {
var result = this.el, done = false;
while (result && !done && this.scene.context.rmarkdown) {
switch(this.scene.context.rmarkdown) {
case "ioslides_presentation":
if (result.tagName === "SLIDE") return result;
break;
case "slidy_presentation":
if (result.tagName === "DIV" && result.classList.contains("slide"))
return result;
break;
default: return null;
}
result = result.parentElement;
}
return null;
};
/**
* Is this scene visible in the browser?
* @returns { boolean }
*/
rglwidgetClass.prototype.isInBrowserViewport = function() {
var rect = this.canvas.getBoundingClientRect(),
windHeight = (window.innerHeight || document.documentElement.clientHeight),
windWidth = (window.innerWidth || document.documentElement.clientWidth);
if (this.scene.context && this.scene.context.rmarkdown !== null) {
if (this.slide)
return (this.scene.context.rmarkdown === "ioslides_presentation" &&
this.slide.classList.contains("current")) ||
(this.scene.context.rmarkdown === "slidy_presentation" &&
!this.slide.classList.contains("hidden"));
}
return (
rect.top >= -windHeight &&
rect.left >= -windWidth &&
rect.bottom <= 2*windHeight &&
rect.right <= 2*windWidth);
};
/**
* Initialize WebGL
* @returns { Object } the WebGL context
*/
rglwidgetClass.prototype.initGL = function() {
var self = this;
if (this.gl) {
if (!this.drawing && this.gl.isContextLost())
this.restartCanvas();
else
return this.gl;
}
// if (!this.isInBrowserViewport()) return; Return what??? At this point we know this.gl is null.
this.canvas.addEventListener("webglcontextrestored",
this.onContextRestored, false);
this.canvas.addEventListener("webglcontextlost",
this.onContextLost, false);
this.gl = this.canvas.getContext("webgl", this.webGLoptions) ||
this.canvas.getContext("experimental-webgl", this.webGLoptions);
this.index_uint = this.gl.getExtension("OES_element_index_uint");
var save = this.startDrawing();
this.initSphereGL();
Object.keys(this.scene.objects).forEach(function(key){
self.initObj(parseInt(key, 10));
});
this.stopDrawing(save);
return this.gl;
};
/**
* Resize the display to match element
* @param { Object } el - DOM element to match
*/
rglwidgetClass.prototype.resize = function(el) {
this.canvas.width = el.width;
this.canvas.height = el.height;
};
/**
* Draw the whole scene
*/
rglwidgetClass.prototype.drawScene = function() {
var gl = this.gl || this.initGL(),
wasDrawing = this.startDrawing();
if (!wasDrawing) {
if (this.select.state !== "inactive")
this.selectionChanged();
gl.enable(gl.DEPTH_TEST);
gl.depthFunc(gl.LEQUAL);
gl.clearDepth(1.0);
gl.clearColor(1,1,1,1);
gl.depthMask(true); // Must be true before clearing depth buffer
gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);
this.drawSubscene(this.scene.rootSubscene, true);
this.drawSubscene(this.scene.rootSubscene, false);
}
this.stopDrawing(wasDrawing);
};
/**
* Change the displayed subset
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The subset control data.
*/
rglwidgetClass.prototype.subsetSetter = function(el, control) {
if (typeof control.subscenes === "undefined" ||
control.subscenes === null)
control.subscenes = this.scene.rootSubscene;
var value = Math.round(control.value),
subscenes = [].concat(control.subscenes),
fullset = [].concat(control.fullset),
i, j, entries, subsceneid,
adds = [], deletes = [],
ismissing = function(x) {
return fullset.indexOf(x) < 0;
},
tointeger = function(x) {
return parseInt(x, 10);
};
if (isNaN(value))
value = control.value = 0;
if (control.accumulate)
for (i=0; i <= value; i++)
adds = adds.concat(control.subsets[i]);
else
adds = adds.concat(control.subsets[value]);
deletes = fullset.filter(function(x) { return adds.indexOf(x) < 0; });
for (i = 0; i < subscenes.length; i++) {
subsceneid = subscenes[i];
if (typeof this.getObj(subsceneid) === "undefined")
this.alertOnce("typeof object is undefined");
for (j = 0; j < adds.length; j++)
this.addToSubscene(adds[j], subsceneid);
for (j = 0; j < deletes.length; j++)
this.delFromSubscene(deletes[j], subsceneid);
}
};
/**
* Change the requested property
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The property setter control data.
*/
rglwidgetClass.prototype.propertySetter = function(el, control)  {
var value = control.value,
values = [].concat(control.values),
svals = [].concat(control.param),
direct = values[0] === null,
entries = [].concat(control.entries),
ncol = entries.length,
nrow = values.length/ncol,
properties = this.repeatToLen(control.properties, ncol),
objids = this.repeatToLen(control.objids, ncol),
property, objid = objids[0],
obj = this.getObj(objid),
propvals, i, v1, v2, p, entry, gl, needsBinding,
newprop, newid,
getPropvals = function() {
if (property === "userMatrix")
return obj.par3d.userMatrix.getAsArray();
else if (property === "scale" || property === "FOV" || property === "zoom")
return [].concat(obj.par3d[property]);
else
return [].concat(obj[property]);
};
putPropvals = function(newvals) {
if (newvals.length == 1)
newvals = newvals[0];
if (property === "userMatrix")
obj.par3d.userMatrix.load(newvals);
else if (property === "scale" || property === "FOV" || property === "zoom")
obj.par3d[property] = newvals;
else
obj[property] = newvals;
};
if (direct && typeof value === "undefined")
return;
if (control.interp) {
values = values.slice(0, ncol).concat(values).
concat(values.slice(ncol*(nrow-1), ncol*nrow));
svals = [-Infinity].concat(svals).concat(Infinity);
for (i = 1; i < svals.length; i++) {
if (value <= svals[i]) {
if (svals[i] === Infinity)
p = 1;
else
p = (svals[i] - value)/(svals[i] - svals[i-1]);
break;
}
}
} else if (!direct) {
value = Math.round(value);
}
for (j=0; j<entries.length; j++) {
entry = entries[j];
newprop = properties[j];
newid = objids[j];
if (newprop !== property || newid != objid) {
if (typeof property !== "undefined")
putPropvals(propvals);
property = newprop;
objid = newid;
obj = this.getObj(objid);
propvals = getPropvals();
}
if (control.interp) {
v1 = values[ncol*(i-1) + j];
v2 = values[ncol*i + j];
this.setElement(propvals, entry, p*v1 + (1-p)*v2);
} else if (!direct) {
this.setElement(propvals, entry, values[ncol*value + j]);
} else {
this.setElement(propvals, entry, value[j]);
}
}
putPropvals(propvals);
needsBinding = [];
for (j=0; j < entries.length; j++) {
if (properties[j] === "values" &&
needsBinding.indexOf(objids[j]) === -1) {
needsBinding.push(objids[j]);
}
}
for (j=0; j < needsBinding.length; j++) {
gl = this.gl || this.initGL();
obj = this.getObj(needsBinding[j]);
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertices
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The vertext setter control data.
*/
rglwidgetClass.prototype.vertexSetter = function(el, control)  {
var svals = [].concat(control.param),
j, k, p, a, propvals, stride, ofs, obj, entry,
attrib,
ofss    = {x:"vofs", y:"vofs", z:"vofs",
red:"cofs", green:"cofs", blue:"cofs",
alpha:"cofs", radii:"radofs",
nx:"nofs", ny:"nofs", nz:"nofs",
ox:"oofs", oy:"oofs", oz:"oofs",
ts:"tofs", tt:"tofs"},
pos     = {x:0, y:1, z:2,
red:0, green:1, blue:2,
alpha:3,radii:0,
nx:0, ny:1, nz:2,
ox:0, oy:1, oz:2,
ts:0, tt:1},
values = control.values,
direct = values === null,
ncol,
interp = control.interp,
vertices = [].concat(control.vertices),
attributes = [].concat(control.attributes),
value = control.value, newval, aliases, alias;
ncol = Math.max(vertices.length, attributes.length);
if (!ncol)
return;
vertices = this.repeatToLen(vertices, ncol);
attributes = this.repeatToLen(attributes, ncol);
if (direct)
interp = false;
/* JSON doesn't pass Infinity */
svals[0] = -Infinity;
svals[svals.length - 1] = Infinity;
for (j = 1; j < svals.length; j++) {
if (value <= svals[j]) {
if (interp) {
if (svals[j] === Infinity)
p = 1;
else
p = (svals[j] - value)/(svals[j] - svals[j-1]);
} else {
if (svals[j] - value > value - svals[j-1])
j = j - 1;
}
break;
}
}
obj = this.getObj(control.objid);
// First, make sure color attributes vary in original
if (typeof obj.vOffsets !== "undefined") {
varies = true;
for (k = 0; k < ncol; k++) {
attrib = attributes[k];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0) {
switch(attrib) {
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(control.objid);
}
propvals = obj.values;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
for (k=0; k<ncol; k++) {
if (direct) {
newval = value;
} else if (interp) {
newval = p*values[j-1][k] + (1-p)*values[j][k];
} else {
newval = values[j][k];
}       
attrib = attributes[k];
vertex = vertices[k];
alias = aliases[vertex];
if (obj.type === "planes" || obj.type === "clipplanes") {
ofs = ["nx", "ny", "nz", "offset"].indexOf(attrib);
if (ofs >= 0) {
if (ofs < 3) {
if (obj.normals[vertex][ofs] != newval) {  // Assume no aliases here...
obj.normals[vertex][ofs] = newval;
obj.initialized = false;
}
} else {
if (obj.offsets[vertex][0] != newval) {
obj.offsets[vertex][0] = newval;
obj.initialized = false;
}
}
continue;
}
}
// Not a plane setting...
ofs = obj.vOffsets[ofss[attrib]];
if (ofs < 0)
this.alertOnce("Attribute '"+attrib+"' not found in object "+control.objid);
else {
stride = obj.vOffsets.stride;
ofs = ofs + pos[attrib];
entry = vertex*stride + ofs;
propvals[entry] = newval;
if (typeof alias !== "undefined")
for (a = 0; a < alias.length; a++)
propvals[alias[a]*stride + ofs] = newval;
}
}
if (typeof obj.buf !== "undefined") {
var gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, propvals, gl.STATIC_DRAW);
}
};
/**
* Change the requested vertex properties by age
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The age setter control data.
*/
rglwidgetClass.prototype.ageSetter = function(el, control) {
var objids = [].concat(control.objids),
nobjs = objids.length,
time = control.value,
births = [].concat(control.births),
ages = [].concat(control.ages),
steps = births.length,
j = Array(steps),
p = Array(steps),
i, k, age, j0, propvals, stride, ofs, objid, obj,
attrib, dim, varies, alias, aliases, a, d,
attribs = ["colors", "alpha", "radii", "vertices",
"normals", "origins", "texcoords",
"x", "y", "z",
"red", "green", "blue"],
ofss    = ["cofs", "cofs", "radofs", "vofs",
"nofs", "oofs", "tofs",
"vofs", "vofs", "vofs",
"cofs", "cofs", "cofs"],
dims    = [3,1,1,3,
3,2,2,
1,1,1,
1,1,1],
pos     = [0,3,0,0,
0,0,0,
0,1,2,
0,1,2];
/* Infinity doesn't make it through JSON */
ages[0] = -Infinity;
ages[ages.length-1] = Infinity;
for (i = 0; i < steps; i++) {
if (births[i] !== null) {  // NA in R becomes null
age = time - births[i];
for (j0 = 1; age > ages[j0]; j0++);
if (ages[j0] == Infinity)
p[i] = 1;
else if (ages[j0] > ages[j0-1])
p[i] = (ages[j0] - age)/(ages[j0] - ages[j0-1]);
else
p[i] = 0;
j[i] = j0;
}
}
// First, make sure color attributes vary in original
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
varies = true;
if (typeof obj.vOffsets === "undefined")
continue;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs < 0) {
switch(attribs[k]) {
case "colors":
case "alpha":
case "red":
case "green":
case "blue":
obj.colors = [obj.colors[0], obj.colors[0]];
break;
}
varies = false;
}
}
}
if (!varies)
this.initObj(objid);
}
for (l = 0; l < nobjs; l++) {
objid = objids[l];
obj = this.getObj(objid);
if (typeof obj.vOffsets === "undefined")
continue;
aliases = obj.alias;
if (typeof aliases === "undefined")
aliases = [];
propvals = obj.values;
stride = obj.vOffsets.stride;
for (k = 0; k < attribs.length; k++) {
attrib = control[attribs[k]];
if (typeof attrib !== "undefined") {
ofs = obj.vOffsets[ofss[k]];
if (ofs >= 0) {
dim = dims[k];
ofs = ofs + pos[k];
for (i = 0; i < steps; i++) {
alias = aliases[i];
if (births[i] !== null) {
for (d=0; d < dim; d++) {
propvals[i*stride + ofs + d] = p[i]*attrib[dim*(j[i]-1) + d] + (1-p[i])*attrib[dim*j[i] + d];
if (typeof alias !== "undefined")
for (a=0; a < alias.length; a++)
propvals[alias[a]*stride + ofs + d] = propvals[i*stride + ofs + d];
}
}
}
} else
this.alertOnce("\'"+attribs[k]+"\' property not found in object "+objid);
}
}
obj.values = propvals;
if (typeof obj.buf !== "undefined") {
gl = this.gl || this.initGL();
gl.bindBuffer(gl.ARRAY_BUFFER, obj.buf);
gl.bufferData(gl.ARRAY_BUFFER, obj.values, gl.STATIC_DRAW);
}
}
};
/**
* Bridge to old style control
* @param { Object } el - Element of the control; not used.
* @param { Object } control - The bridge control data.
*/
rglwidgetClass.prototype.oldBridge = function(el, control) {
var attrname, global = window[control.prefix + "rgl"];
if (global)
for (attrname in global)
this[attrname] = global[attrname];
window[control.prefix + "rgl"] = this;
};
/**
* Set up a player control
* @param { Object } el - The player control element
* @param { Object } control - The player data.
*/
rglwidgetClass.prototype.Player = function(el, control) {
var
self = this,
components = [].concat(control.components),
buttonLabels = [].concat(control.buttonLabels),
Tick = function() { /* "this" will be a timer */
var i,
nominal = this.value,
slider = this.Slider,
labels = this.outputLabels,
output = this.Output,
step;
if (typeof slider !== "undefined" && nominal != slider.value)
slider.value = nominal;
if (typeof output !== "undefined") {
step = Math.round((nominal - output.sliderMin)/output.sliderStep);
if (labels !== null) {
output.innerHTML = labels[step];
} else {
step = step*output.sliderStep + output.sliderMin;
output.innerHTML = step.toPrecision(output.outputPrecision);
}
}
for (i=0; i < this.actions.length; i++) {
this.actions[i].value = nominal;
}
self.applyControls(el, this.actions, false);
self.drawScene();
},
OnSliderInput = function() { /* "this" will be the slider */
this.rgltimer.value = Number(this.value);
this.rgltimer.Tick();
},
addSlider = function(min, max, step, value) {
var slider = document.createElement("input");
slider.type = "range";
slider.min = min;
slider.max = max;
slider.step = step;
slider.value = value;
slider.oninput = OnSliderInput;
slider.sliderActions = control.actions;
slider.sliderScene = this;
slider.className = "rgl-slider";
slider.id = el.id + "-slider";
el.rgltimer.Slider = slider;
slider.rgltimer = el.rgltimer;
el.appendChild(slider);
},
addLabel = function(labels, min, step, precision) {
var output = document.createElement("output");
output.sliderMin = min;
output.sliderStep = step;
output.outputPrecision = precision;
output.className = "rgl-label";
output.id = el.id + "-label";
el.rgltimer.Output = output;
el.rgltimer.outputLabels = labels;
el.appendChild(output);
},
addButton = function(which, label, active) {
var button = document.createElement("input"),
onclicks = {Reverse: function() { this.rgltimer.reverse();},
Play: function() { this.rgltimer.play();
this.value = this.rgltimer.enabled ? this.inactiveValue : this.activeValue; },
Slower: function() { this.rgltimer.slower(); },
Faster: function() { this.rgltimer.faster(); },
Reset: function() { this.rgltimer.reset(); },
Step:  function() { this.rgltimer.step(); }
};
button.rgltimer = el.rgltimer;
button.type = "button";
button.value = label;
button.activeValue = label;
button.inactiveValue = active;
if (which === "Play")
button.rgltimer.PlayButton = button;
button.onclick = onclicks[which];
button.className = "rgl-button";
button.id = el.id + "-" + which;
el.appendChild(button);
};
if (typeof control.reinit !== "undefined" && control.reinit !== null) {
control.actions.reinit = control.reinit;
}
el.rgltimer = new rgltimerClass(Tick, control.start, control.interval, control.stop,
control.step, control.value, control.rate, control.loop, control.actions);
for (var i=0; i < components.length; i++) {
switch(components[i]) {
case "Slider": addSlider(control.start, control.stop,
control.step, control.value);
break;
case "Label": addLabel(control.labels, control.start,
control.step, control.precision);
break;
default:
addButton(components[i], buttonLabels[i], control.pause);
}
}
el.rgltimer.Tick();
};
/**
* Apply all registered controls
* @param { Object } el - DOM element of the control
* @param { Object } x - List of actions to apply
* @param { boolean } [draw=true] - Whether to redraw after applying
*/
rglwidgetClass.prototype.applyControls = function(el, x, draw) {
var self = this, reinit = x.reinit, i, control, type;
for (i = 0; i < x.length; i++) {
control = x[i];
type = control.type;
self[type](el, control);
}
if (typeof reinit !== "undefined" && reinit !== null) {
reinit = [].concat(reinit);
for (i = 0; i < reinit.length; i++)
self.getObj(reinit[i]).initialized = false;
}
if (typeof draw === "undefined" || draw)
self.drawScene();
};
/**
* Handler for scene change
* @param { Object } message - What sort of scene change to do?
*/
rglwidgetClass.prototype.sceneChangeHandler = function(message) {
var self = document.getElementById(message.elementId).rglinstance,
objs = message.objects, mat = message.material,
root = message.rootSubscene,
initSubs = message.initSubscenes,
redraw = message.redrawScene,
skipRedraw = message.skipRedraw,
deletes, subs, allsubs = [], i,j;
if (typeof message.delete !== "undefined") {
deletes = [].concat(message.delete);
if (typeof message.delfromSubscenes !== "undefined")
subs = [].concat(message.delfromSubscenes);
else
subs = [];
for (i = 0; i < deletes.length; i++) {
for (j = 0; j < subs.length; j++) {
self.delFromSubscene(deletes[i], subs[j]);
}
delete self.scene.objects[deletes[i]];
}
}
if (typeof objs !== "undefined") {
Object.keys(objs).forEach(function(key){
key = parseInt(key, 10);
self.scene.objects[key] = objs[key];
self.initObj(key);
var obj = self.getObj(key),
subs = [].concat(obj.inSubscenes), k;
allsubs = allsubs.concat(subs);
for (k = 0; k < subs.length; k++)
self.addToSubscene(key, subs[k]);
});
}
if (typeof mat !== "undefined") {
self.scene.material = mat;
}
if (typeof root !== "undefined") {
self.scene.rootSubscene = root;
}
if (typeof initSubs !== "undefined")
allsubs = allsubs.concat(initSubs);
allsubs = self.unique(allsubs);
for (i = 0; i < allsubs.length; i++) {
self.initSubscene(allsubs[i]);
}
if (typeof skipRedraw !== "undefined") {
root = self.getObj(self.scene.rootSubscene);
root.par3d.skipRedraw = skipRedraw;
}
if (redraw)
self.drawScene();
};
/**
* Set mouse mode for a subscene
* @param { string } mode - name of mode
* @param { number } button - button number (1 to 3)
* @param { number } subscene - subscene id number
* @param { number } stayActive - if truthy, don't clear brush
*/
rglwidgetClass.prototype.setMouseMode = function(mode, button, subscene, stayActive) {
var sub = this.getObj(subscene),
which = ["left", "right", "middle"][button - 1];
if (!stayActive && sub.par3d.mouseMode[which] === "selecting")
this.clearBrush(null);
sub.par3d.mouseMode[which] = mode;
};
/**
* The class of an rgl timer object
* @class
*/
/**
* Construct an rgltimerClass object
* @constructor
* @param { function } Tick - action when timer fires
* @param { number } startTime - nominal start time in seconds
* @param { number } interval - seconds between updates
* @param { number } stopTime - nominal stop time in seconds
* @param { number } stepSize - nominal step size
* @param { number } value - current nominal time
* @param { number } rate - nominal units per second
* @param { string } loop - "none", "cycle" or "oscillate"
* @param { Object } actions - list of actions
*/
rgltimerClass = function(Tick, startTime, interval, stopTime, stepSize, value, rate, loop, actions) {
this.enabled = false;
this.timerId = 0;
/** nominal start time in seconds */
this.startTime = startTime;   
/** current nominal time */      
this.value = value;
/** seconds between updates */                 
this.interval = interval;
/** nominal stop time */           
this.stopTime = stopTime;
/** nominal step size */           
this.stepSize = stepSize;
/** nominal units per second */           
this.rate = rate;
/** "none", "cycle", or "oscillate" */                   
this.loop = loop;
/** real world start time */                   
this.realStart = undefined;
/** multiplier for fast-forward or reverse */         
this.multiplier = 1;                
this.actions = actions;
this.Tick = Tick;
};
/**
* Start playing timer object
*/
rgltimerClass.prototype.play = function() {
if (this.enabled) {
this.enabled = false;
window.clearInterval(this.timerId);
this.timerId = 0;
return;
}
var tick = function(self) {
var now = new Date();
self.value = self.multiplier*self.rate*(now - self.realStart)/1000 + self.startTime;
self.forceToRange();
if (typeof self.Tick !== "undefined") {
self.Tick(self.value);
}
};
this.realStart = new Date() - 1000*(this.value - this.startTime)/this.rate/this.multiplier;
this.timerId = window.setInterval(tick, 1000*this.interval, this);
this.enabled = true;
};
/**
* Force value into legal range
*/
rgltimerClass.prototype.forceToRange = function() {
if (this.value > this.stopTime + this.stepSize/2 || this.value < this.startTime - this.stepSize/2) {
if (!this.loop) {
this.reset();
} else {
var cycle = this.stopTime - this.startTime + this.stepSize,
newval = (this.value - this.startTime) % cycle + this.startTime;
if (newval < this.startTime) {
newval += cycle;
}
this.realStart += (this.value - newval)*1000/this.multiplier/this.rate;
this.value = newval;
}
}
};
/**
* Reset to start values
*/
rgltimerClass.prototype.reset = function() {
this.value = this.startTime;
this.newmultiplier(1);
if (typeof this.Tick !== "undefined") {
this.Tick(this.value);
}
if (this.enabled)
this.play();  /* really pause... */
if (typeof this.PlayButton !== "undefined")
this.PlayButton.value = "Play";
};
/**
* Increase the multiplier to play faster
*/
rgltimerClass.prototype.faster = function() {
this.newmultiplier(Math.SQRT2*this.multiplier);
};
/**
* Decrease the multiplier to play slower
*/
rgltimerClass.prototype.slower = function() {
this.newmultiplier(this.multiplier/Math.SQRT2);
};
/**
* Change sign of multiplier to reverse direction
*/
rgltimerClass.prototype.reverse = function() {
this.newmultiplier(-this.multiplier);
};
/**
* Set multiplier for play speed
* @param { number } newmult - new value
*/
rgltimerClass.prototype.newmultiplier = function(newmult) {
if (newmult != this.multiplier) {
this.realStart += 1000*(this.value - this.startTime)/this.rate*(1/this.multiplier - 1/newmult);
this.multiplier = newmult;
}
};
/**
* Take one step
*/
rgltimerClass.prototype.step = function() {
this.value += this.rate*this.multiplier;
this.forceToRange();
if (typeof this.Tick !== "undefined")
this.Tick(this.value);
};</script>
<div id="unnamed_chunk_151div" class="rglWebGL">

</div>
<script type="text/javascript">
var unnamed_chunk_151div = document.getElementById("unnamed_chunk_151div"),
unnamed_chunk_151rgl = new rglwidgetClass();
unnamed_chunk_151div.width = 673;
unnamed_chunk_151div.height = 481;
unnamed_chunk_151rgl.initialize(unnamed_chunk_151div,
{"material":{"color":"#008B8B","alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0]},"rootSubscene":1,"objects":{"10":{"id":10,"type":"text","material":{"lit":false},"vertices":[[0,-0.05,0]],"colors":[[0.5450981,0,0.5450981,1]],"texts":[["6"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-0.05,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"11":{"id":11,"type":"text","material":{"lit":false},"vertices":[[1,-0.05,0]],"colors":[[0.5450981,0,0.5450981,1]],"texts":[["20"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[1,-0.05,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"12":{"id":12,"type":"text","material":{"lit":false},"vertices":[[0,-0.1,0]],"colors":[[0,0.5450981,0.5450981,1]],"texts":[["600"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-0.1,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"13":{"id":13,"type":"text","material":{"lit":false},"vertices":[[0,-0.1,1]],"colors":[[0,0.5450981,0.5450981,1]],"texts":[["30000"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-0.1,1]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"14":{"id":14,"type":"text","material":{"lit":false},"vertices":[[-0.05,0,-0.05]],"colors":[[0,0,0,1]],"texts":[["10"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.05,0,-0.05]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"15":{"id":15,"type":"text","material":{"lit":false},"vertices":[[-0.05,1,-0.05]],"colors":[[0,0,0,1]],"texts":[["90"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.05,1,-0.05]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"16":{"id":16,"type":"spheres","material":{},"vertices":[[0.5078571,0.735,0.3996939],[0.4471429,0.73875,0.8598299],[0.4835714,0.6675,0.294932],[0.3871429,0.585,0.2811224],[0.6157143,0.79375,0.2654082],[0.6885715,0.845,0.3547619],[0.6492857,0.7825,0.2604762],[0.6742857,0.85125,0.4613265],[0.6085714,0.78875,0.3665646],[0.6171429,0.735,0.3545238],[0.4564286,0.65,0.1803401],[0.45,0.625,0.2196939],[0.5592857,0.5475,0.2661565],[0.6028572,0.6525,0.2533673],[0.5971429,0.81125,0.2314626],[0.5864286,0.56375,0.195102],[0.6978571,0.90375,0.6347959],[0.5821428,0.60125,0.187483],[0.6585714,0.60375,0.3058844],[0.6071429,0.785,0.1389796],[0.7121429,0.9325,0.4040816],[0.5442857,0.62,0.1717007],[0.6485714,0.70125,0.2528571],[0.7114286,0.965,0.8404081],[0.71,0.70875,0.4747619],[0.6221429,0.73,0.5747619],[0.4614286,0.68375,0.1365306],[0.2464286,0.31125,0.09812925],[0.5442857,0.77625,0.1527891],[0.6578571,0.74125,0.3344218],[0.485,0.71875,0.1557823],[0.3635714,0.59,0.1903742],[0.4792857,0.595,0.2368027],[0.3885714,0.55125,0.2587075],[0.3992857,0.45,0.1168707],[0.3921429,0.39875,0.08666667],[0.38,0.4925,0.127483],[0.3314286,0.40375,0.06285714],[0.3828571,0.47125,0.1268708],[0.2264286,0.26125,0.1415306],[0.435,0.28375,0.08217687],[0.36,0.35875,0.07826531],[0.23,0.32625,0.1670408],[0.2907143,0.34,0.1067687],[0.3221429,0.35125,0.08710884],[0.3714286,0.2425,0.1408503],[0.3664286,0.51375,0.1514286],[0.3878571,0.32125,0.192483],[0.3571429,0.32,0.1181973],[0.2742857,0.39375,0.2340816],[0.3664286,0.3775,0.2782313],[0.2892857,0.20625,0.06782313],[0.2585714,0.06,0.01081633],[0.2807143,0.16625,0.06020408],[0.4,0.46625,0.2561565],[0.3635714,0.46375,0.217415],[0.3592857,0.51375,0.2502041],[0.2478571,0.41875,0.2821428],[0.3521429,0.52,0.2820068],[0.1242857,0.24625,0.08557823],[0.1785714,0.1275,0.1132653],[0.3264286,0.56125,0.2472449],[0.2471429,0.19875,0.0003741496],[0.095,0.135,0.08163265],[0.07928571,0.09125,0.09768707],[0.1128571,0.12625,0.1014286],[0.06,0.42625,0.1035034],[0.1857143,0.14375,0.03591837],[0.2057143,0.31625,0.2129252],[0.11,0.36125,0.122415],[0.1171429,0.19,0.1542177],[0.1171429,0.31,0.1542177],[0.1014286,0.165,0.04387755],[0.04928571,0.29125,0.1307143],[0.05285714,0.235,0.09812925],[0.2921429,0.40625,0.2531633],[0.2007143,0.4275,0.2070068],[0.1714286,0.32375,0.2028912],[0.1371429,0.3975,0.199898],[0.1735714,0.32375,0.1772449],[0.1985714,0.42125,0.2031633],[0.1971429,0.51,0.1136735],[0.3064286,0.34,0.164932],[0.02714286,0.2275,0.07642857],[0.15,0.35125,0.1767007],[0.2928571,0.50375,0.2420408],[0.04785714,0.21625,0.1393197],[0.2178571,0.38625,0.262449],[0.2807143,0.5025,0.2226871],[0.16,0.51375,0.2816327],[0.06571428,0.36125,0.1598299],[0.04285714,0.3275,0.1822789],[0.1292857,0.24875,0.1343197],[0.1664286,0.41125,0.2152381],[0.1085714,0.20625,0.112585],[0.4478571,0.70125,0.4568707],[0.1778571,0.48625,0.2804422],[0.1128571,0.32375,0.1687755],[0.1378571,0.18875,0.1232653],[0.1692857,0.20125,0.1412585],[0.2857143,0.4025,0.1993878],[0.1821429,0.315,0.102619]],"colors":[[1,1,0,1]],"radii":[[0.01490131]],"centers":[[0.5078571,0.735,0.3996939],[0.4471429,0.73875,0.8598299],[0.4835714,0.6675,0.294932],[0.3871429,0.585,0.2811224],[0.6157143,0.79375,0.2654082],[0.6885715,0.845,0.3547619],[0.6492857,0.7825,0.2604762],[0.6742857,0.85125,0.4613265],[0.6085714,0.78875,0.3665646],[0.6171429,0.735,0.3545238],[0.4564286,0.65,0.1803401],[0.45,0.625,0.2196939],[0.5592857,0.5475,0.2661565],[0.6028572,0.6525,0.2533673],[0.5971429,0.81125,0.2314626],[0.5864286,0.56375,0.195102],[0.6978571,0.90375,0.6347959],[0.5821428,0.60125,0.187483],[0.6585714,0.60375,0.3058844],[0.6071429,0.785,0.1389796],[0.7121429,0.9325,0.4040816],[0.5442857,0.62,0.1717007],[0.6485714,0.70125,0.2528571],[0.7114286,0.965,0.8404081],[0.71,0.70875,0.4747619],[0.6221429,0.73,0.5747619],[0.4614286,0.68375,0.1365306],[0.2464286,0.31125,0.09812925],[0.5442857,0.77625,0.1527891],[0.6578571,0.74125,0.3344218],[0.485,0.71875,0.1557823],[0.3635714,0.59,0.1903742],[0.4792857,0.595,0.2368027],[0.3885714,0.55125,0.2587075],[0.3992857,0.45,0.1168707],[0.3921429,0.39875,0.08666667],[0.38,0.4925,0.127483],[0.3314286,0.40375,0.06285714],[0.3828571,0.47125,0.1268708],[0.2264286,0.26125,0.1415306],[0.435,0.28375,0.08217687],[0.36,0.35875,0.07826531],[0.23,0.32625,0.1670408],[0.2907143,0.34,0.1067687],[0.3221429,0.35125,0.08710884],[0.3714286,0.2425,0.1408503],[0.3664286,0.51375,0.1514286],[0.3878571,0.32125,0.192483],[0.3571429,0.32,0.1181973],[0.2742857,0.39375,0.2340816],[0.3664286,0.3775,0.2782313],[0.2892857,0.20625,0.06782313],[0.2585714,0.06,0.01081633],[0.2807143,0.16625,0.06020408],[0.4,0.46625,0.2561565],[0.3635714,0.46375,0.217415],[0.3592857,0.51375,0.2502041],[0.2478571,0.41875,0.2821428],[0.3521429,0.52,0.2820068],[0.1242857,0.24625,0.08557823],[0.1785714,0.1275,0.1132653],[0.3264286,0.56125,0.2472449],[0.2471429,0.19875,0.0003741496],[0.095,0.135,0.08163265],[0.07928571,0.09125,0.09768707],[0.1128571,0.12625,0.1014286],[0.06,0.42625,0.1035034],[0.1857143,0.14375,0.03591837],[0.2057143,0.31625,0.2129252],[0.11,0.36125,0.122415],[0.1171429,0.19,0.1542177],[0.1171429,0.31,0.1542177],[0.1014286,0.165,0.04387755],[0.04928571,0.29125,0.1307143],[0.05285714,0.235,0.09812925],[0.2921429,0.40625,0.2531633],[0.2007143,0.4275,0.2070068],[0.1714286,0.32375,0.2028912],[0.1371429,0.3975,0.199898],[0.1735714,0.32375,0.1772449],[0.1985714,0.42125,0.2031633],[0.1971429,0.51,0.1136735],[0.3064286,0.34,0.164932],[0.02714286,0.2275,0.07642857],[0.15,0.35125,0.1767007],[0.2928571,0.50375,0.2420408],[0.04785714,0.21625,0.1393197],[0.2178571,0.38625,0.262449],[0.2807143,0.5025,0.2226871],[0.16,0.51375,0.2816327],[0.06571428,0.36125,0.1598299],[0.04285714,0.3275,0.1822789],[0.1292857,0.24875,0.1343197],[0.1664286,0.41125,0.2152381],[0.1085714,0.20625,0.112585],[0.4478571,0.70125,0.4568707],[0.1778571,0.48625,0.2804422],[0.1128571,0.32375,0.1687755],[0.1378571,0.18875,0.1232653],[0.1692857,0.20125,0.1412585],[0.2857143,0.4025,0.1993878],[0.1821429,0.315,0.102619]],"ignoreExtent":false,"flags":3},"17":{"id":17,"type":"lines","material":{"lit":false},"vertices":[[0,0,0],[1,0,0]],"colors":[[0.5450981,0,0.5450981,1]],"centers":[[0.5,0,0]],"ignoreExtent":false,"flags":64},"18":{"id":18,"type":"lines","material":{"lit":false},"vertices":[[0,0,0],[0,1,0]],"colors":[[0,0,0,1]],"centers":[[0,0.5,0]],"ignoreExtent":false,"flags":64},"19":{"id":19,"type":"lines","material":{"lit":false},"vertices":[[0,0,0],[0,0,1]],"colors":[[0,0.5450981,0.5450981,1]],"centers":[[0,0,0.5]],"ignoreExtent":false,"flags":64},"20":{"id":20,"type":"text","material":{"lit":false},"vertices":[[1,0,0]],"colors":[[0.5450981,0,0.5450981,1]],"texts":[["education"]],"cex":[[1]],"adj":[[1,0.5]],"centers":[[1,0,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"21":{"id":21,"type":"text","material":{"lit":false},"vertices":[[0,1.05,0]],"colors":[[0,0,0,1]],"texts":[["prestige"]],"cex":[[1]],"adj":[[1,0.5]],"centers":[[0,1.05,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"22":{"id":22,"type":"text","material":{"lit":false},"vertices":[[0,0,1]],"colors":[[0,0.5450981,0.5450981,1]],"texts":[["income"]],"cex":[[1]],"adj":[[1,0.5]],"centers":[[0,0,1]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"5":{"id":5,"type":"light","vertices":[[0,0,1]],"colors":[[1,1,1,1],[1,1,1,1],[1,1,1,1]],"viewpoint":true,"finite":false},"4":{"id":4,"type":"background","material":{},"colors":[[0.2980392,0.2980392,0.2980392,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"6":{"id":6,"type":"background","material":{"lit":false,"back":"lines","fog":false},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"none","flags":0},"9":{"id":9,"type":"background","material":{"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"exp2","flags":0},"1":{"id":1,"type":"subscene","par3d":{"antialias":1,"FOV":60,"ignoreExtent":false,"listeners":1,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,1.878164],"modelMatrix":[[1,0,0,-0.475],[0,0.9659258,-0.258819,-0.3358757],[0,0.258819,0.9659258,-2.459918],[0,0,0,1]],"projMatrix":[[1.237179,0,0,0],[0,1.732051,0,0],[0,0,-2,-2.817246],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.9659258,-0.258819,0],[0,0.258819,0.9659258,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-0.05,1,-0.1,1.05,-0.05,1],"windowRect":[100,100,772,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN","activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[9,10,11,12,13,14,15,16,17,18,19,20,21,22,5],"subscenes":[],"flags":2643}},"width":673,"height":481,"sphereVerts":{"vb":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1],[0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1950903,-0.3826834,-0.5555702,-0.7071068,-0.8314696,-0.9238795,-0.9807853,-1,-0.9807853,-0.9238795,-0.8314696,-0.7071068,-0.5555702,-0.3826834,-0.1950903,-0,-0,-0.18024,-0.3535534,-0.51328,-0.6532815,-0.7681778,-0.8535534,-0.9061274,-0.9238795,-0.9061274,-0.8535534,-0.7681778,-0.6532815,-0.51328,-0.3535534,-0.18024,-0,-0,-0.1379497,-0.2705981,-0.3928475,-0.5,-0.5879378,-0.6532815,-0.6935199,-0.7071068,-0.6935199,-0.6532815,-0.5879378,-0.5,-0.3928475,-0.2705981,-0.1379497,-0,-0,-0.07465783,-0.1464466,-0.2126075,-0.2705981,-0.3181896,-0.3535534,-0.3753303,-0.3826834,-0.3753303,-0.3535534,-0.3181896,-0.2705981,-0.2126075,-0.1464466,-0.07465783,-0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.07465783,0.1464466,0.2126075,0.2705981,0.3181896,0.3535534,0.3753303,0.3826834,0.3753303,0.3535534,0.3181896,0.2705981,0.2126075,0.1464466,0.07465783,0,0,0.1379497,0.2705981,0.3928475,0.5,0.5879378,0.6532815,0.6935199,0.7071068,0.6935199,0.6532815,0.5879378,0.5,0.3928475,0.2705981,0.1379497,0,0,0.18024,0.3535534,0.51328,0.6532815,0.7681778,0.8535534,0.9061274,0.9238795,0.9061274,0.8535534,0.7681778,0.6532815,0.51328,0.3535534,0.18024,0,0,0.1950903,0.3826834,0.5555702,0.7071068,0.8314696,0.9238795,0.9807853,1,0.9807853,0.9238795,0.8314696,0.7071068,0.5555702,0.3826834,0.1950903,0]],"it":[[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270],[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,255,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,272,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288],[18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271,273,274,275,276,277,278,279,280,281,282,283,284,285,286,287,288,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,256,257,258,259,260,261,262,263,264,265,266,267,268,269,270,271]],"material":[],"normals":null,"texcoords":[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.0625,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.1875,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.25,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.3125,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.4375,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.5625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.625,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.6875,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.75,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.8125,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.875,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,0.9375,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1,0,0.0625,0.125,0.1875,0.25,0.3125,0.375,0.4375,0.5,0.5625,0.625,0.6875,0.75,0.8125,0.875,0.9375,1]],"meshColor":"vertices"},"context":{"shiny":false,"rmarkdown":null},"crosstalk":{"key":[],"group":[],"id":[],"options":[]}});
unnamed_chunk_151rgl.prefix = "unnamed_chunk_151";
</script>
<p id="unnamed_chunk_151debug">
You must enable Javascript to view this page properly.
</p>
<script>unnamed_chunk_151rgl.start();</script>
<p>Now, let’s fit a model to those data.</p>
<div id="activity-16" class="section level3" number="5.10.1">
<h3><span class="header-section-number">5.10.1</span> Activity</h3>
<p>We have seen how to fit an intercept-only model and to add a predictor to that.</p>
<ol style="list-style-type: lower-alpha">
<li>Can you work out how to model prestige as an outcome variable with predictors of education and income (using the version scaled to thousands)?</li>
</ol>
<p>Don’t worry about interpreting the slopes just yet.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li>Is this model a better fit than the intercept-only model?</li>
</ol>
</div>
<div id="answer-19" class="section level3" number="5.10.2">
<h3><span class="header-section-number">5.10.2</span> Answer</h3>
<p><strong>a. Can you work out how to model prestige as an outcome variable with predictors of education and income (using the version scaled to thousands)?</strong></p>
<p>Hopefully that was straightforward; just use <code>+</code> again:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="linear-regression.html#cb212-1" aria-hidden="true" tabindex="-1"></a>mod_both <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> education <span class="sc">+</span> income_1000s, <span class="at">data =</span> dat)</span>
<span id="cb212-2"><a href="linear-regression.html#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_both)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ education + income_1000s, data = dat)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -19.4040  -5.3308   0.0154   4.9803  17.6889 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   -6.8478     3.2190  -2.127   0.0359 *  
## education      4.1374     0.3489  11.858  &lt; 2e-16 ***
## income_1000s   1.3612     0.2242   6.071 2.36e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.81 on 99 degrees of freedom
## Multiple R-squared:  0.798,  Adjusted R-squared:  0.7939 
## F-statistic: 195.6 on 2 and 99 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Both predictors were statistically significant. Interpretation coming below…</p>
<p><strong>b. Is this model a better fit than the intercept-only model?</strong></p>
<p>We already have the intercept-only model as <code>mod0</code> so comparing models is done by:</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="linear-regression.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod0, mod_both)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: prestige ~ 1
## Model 2: prestige ~ education + income_1000s
##   Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
## 1    101 29895.4                                  
## 2     99  6038.9  2     23857 195.55 &lt; 2.2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The model with two predictors explains more variation than the intercept-only model, <span class="math inline">\(F(2,99) = 195.6, p &lt; .001\)</span></p>
</div>
</div>
<div id="interpreting-regression-models-with-two-or-more-predictors" class="section level2" number="5.11">
<h2><span class="header-section-number">5.11</span> Interpreting regression models with two or more predictors</h2>
<p>Okay, so we have fitted a model now; I’ve called it <code>mod_both</code>. We can easily visualise this using:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="linear-regression.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">scatter3d</span>(prestige <span class="sc">~</span> education <span class="sc">+</span> income, <span class="at">data =</span> dat, <span class="at">surface =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="unnamed_chunk_154div" class="rglWebGL">

</div>
<script type="text/javascript">
var unnamed_chunk_154div = document.getElementById("unnamed_chunk_154div"),
unnamed_chunk_154rgl = new rglwidgetClass();
unnamed_chunk_154div.width = 673;
unnamed_chunk_154div.height = 481;
unnamed_chunk_154rgl.initialize(unnamed_chunk_154div,
{"material":{"color":["#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#00FFFF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#FF00FF","#00FFFF","#00FFFF"],"alpha":1,"lit":true,"ambient":"#000000","specular":"#FFFFFF","emission":"#000000","shininess":50,"smooth":true,"front":"filled","back":"filled","size":3,"lwd":1,"fog":true,"point_antialias":false,"line_antialias":false,"texture":null,"textype":"rgb","texmipmap":false,"texminfilter":"linear","texmagfilter":"linear","texenvmap":false,"depth_mask":true,"depth_test":"less","isTransparent":false,"polygon_offset":[0,0]},"rootSubscene":1,"objects":{"26":{"id":26,"type":"text","material":{"lit":false},"vertices":[[0,-0.05,0]],"colors":[[0.5450981,0,0.5450981,1]],"texts":[["6"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-0.05,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"27":{"id":27,"type":"text","material":{"lit":false},"vertices":[[1,-0.05,0]],"colors":[[0.5450981,0,0.5450981,1]],"texts":[["20"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[1,-0.05,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"28":{"id":28,"type":"text","material":{"lit":false},"vertices":[[0,-0.1,0]],"colors":[[0,0.5450981,0.5450981,1]],"texts":[["600"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-0.1,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"29":{"id":29,"type":"text","material":{"lit":false},"vertices":[[0,-0.1,1]],"colors":[[0,0.5450981,0.5450981,1]],"texts":[["30000"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[0,-0.1,1]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"30":{"id":30,"type":"text","material":{"lit":false},"vertices":[[-0.05,0,-0.05]],"colors":[[0,0,0,1]],"texts":[["10"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.05,0,-0.05]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"31":{"id":31,"type":"text","material":{"lit":false},"vertices":[[-0.05,1,-0.05]],"colors":[[0,0,0,1]],"texts":[["90"]],"cex":[[1]],"adj":[[0.5,0.5]],"centers":[[-0.05,1,-0.05]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"32":{"id":32,"type":"spheres","material":{},"vertices":[[0.5078571,0.735,0.3996939],[0.4471429,0.73875,0.8598299],[0.4835714,0.6675,0.294932],[0.3871429,0.585,0.2811224],[0.6157143,0.79375,0.2654082],[0.6885715,0.845,0.3547619],[0.6492857,0.7825,0.2604762],[0.6742857,0.85125,0.4613265],[0.6085714,0.78875,0.3665646],[0.6171429,0.735,0.3545238],[0.4564286,0.65,0.1803401],[0.45,0.625,0.2196939],[0.5592857,0.5475,0.2661565],[0.6028572,0.6525,0.2533673],[0.5971429,0.81125,0.2314626],[0.5864286,0.56375,0.195102],[0.6978571,0.90375,0.6347959],[0.5821428,0.60125,0.187483],[0.6585714,0.60375,0.3058844],[0.6071429,0.785,0.1389796],[0.7121429,0.9325,0.4040816],[0.5442857,0.62,0.1717007],[0.6485714,0.70125,0.2528571],[0.7114286,0.965,0.8404081],[0.71,0.70875,0.4747619],[0.6221429,0.73,0.5747619],[0.4614286,0.68375,0.1365306],[0.2464286,0.31125,0.09812925],[0.5442857,0.77625,0.1527891],[0.6578571,0.74125,0.3344218],[0.485,0.71875,0.1557823],[0.3635714,0.59,0.1903742],[0.4792857,0.595,0.2368027],[0.3885714,0.55125,0.2587075],[0.3992857,0.45,0.1168707],[0.3921429,0.39875,0.08666667],[0.38,0.4925,0.127483],[0.3314286,0.40375,0.06285714],[0.3828571,0.47125,0.1268708],[0.2264286,0.26125,0.1415306],[0.435,0.28375,0.08217687],[0.36,0.35875,0.07826531],[0.23,0.32625,0.1670408],[0.2907143,0.34,0.1067687],[0.3221429,0.35125,0.08710884],[0.3714286,0.2425,0.1408503],[0.3664286,0.51375,0.1514286],[0.3878571,0.32125,0.192483],[0.3571429,0.32,0.1181973],[0.2742857,0.39375,0.2340816],[0.3664286,0.3775,0.2782313],[0.2892857,0.20625,0.06782313],[0.2585714,0.06,0.01081633],[0.2807143,0.16625,0.06020408],[0.4,0.46625,0.2561565],[0.3635714,0.46375,0.217415],[0.3592857,0.51375,0.2502041],[0.2478571,0.41875,0.2821428],[0.3521429,0.52,0.2820068],[0.1242857,0.24625,0.08557823],[0.1785714,0.1275,0.1132653],[0.3264286,0.56125,0.2472449],[0.2471429,0.19875,0.0003741496],[0.095,0.135,0.08163265],[0.07928571,0.09125,0.09768707],[0.1128571,0.12625,0.1014286],[0.06,0.42625,0.1035034],[0.1857143,0.14375,0.03591837],[0.2057143,0.31625,0.2129252],[0.11,0.36125,0.122415],[0.1171429,0.19,0.1542177],[0.1171429,0.31,0.1542177],[0.1014286,0.165,0.04387755],[0.04928571,0.29125,0.1307143],[0.05285714,0.235,0.09812925],[0.2921429,0.40625,0.2531633],[0.2007143,0.4275,0.2070068],[0.1714286,0.32375,0.2028912],[0.1371429,0.3975,0.199898],[0.1735714,0.32375,0.1772449],[0.1985714,0.42125,0.2031633],[0.1971429,0.51,0.1136735],[0.3064286,0.34,0.164932],[0.02714286,0.2275,0.07642857],[0.15,0.35125,0.1767007],[0.2928571,0.50375,0.2420408],[0.04785714,0.21625,0.1393197],[0.2178571,0.38625,0.262449],[0.2807143,0.5025,0.2226871],[0.16,0.51375,0.2816327],[0.06571428,0.36125,0.1598299],[0.04285714,0.3275,0.1822789],[0.1292857,0.24875,0.1343197],[0.1664286,0.41125,0.2152381],[0.1085714,0.20625,0.112585],[0.4478571,0.70125,0.4568707],[0.1778571,0.48625,0.2804422],[0.1128571,0.32375,0.1687755],[0.1378571,0.18875,0.1232653],[0.1692857,0.20125,0.1412585],[0.2857143,0.4025,0.1993878],[0.1821429,0.315,0.102619]],"colors":[[1,1,0,1]],"radii":[[0.01490131]],"centers":[[0.5078571,0.735,0.3996939],[0.4471429,0.73875,0.8598299],[0.4835714,0.6675,0.294932],[0.3871429,0.585,0.2811224],[0.6157143,0.79375,0.2654082],[0.6885715,0.845,0.3547619],[0.6492857,0.7825,0.2604762],[0.6742857,0.85125,0.4613265],[0.6085714,0.78875,0.3665646],[0.6171429,0.735,0.3545238],[0.4564286,0.65,0.1803401],[0.45,0.625,0.2196939],[0.5592857,0.5475,0.2661565],[0.6028572,0.6525,0.2533673],[0.5971429,0.81125,0.2314626],[0.5864286,0.56375,0.195102],[0.6978571,0.90375,0.6347959],[0.5821428,0.60125,0.187483],[0.6585714,0.60375,0.3058844],[0.6071429,0.785,0.1389796],[0.7121429,0.9325,0.4040816],[0.5442857,0.62,0.1717007],[0.6485714,0.70125,0.2528571],[0.7114286,0.965,0.8404081],[0.71,0.70875,0.4747619],[0.6221429,0.73,0.5747619],[0.4614286,0.68375,0.1365306],[0.2464286,0.31125,0.09812925],[0.5442857,0.77625,0.1527891],[0.6578571,0.74125,0.3344218],[0.485,0.71875,0.1557823],[0.3635714,0.59,0.1903742],[0.4792857,0.595,0.2368027],[0.3885714,0.55125,0.2587075],[0.3992857,0.45,0.1168707],[0.3921429,0.39875,0.08666667],[0.38,0.4925,0.127483],[0.3314286,0.40375,0.06285714],[0.3828571,0.47125,0.1268708],[0.2264286,0.26125,0.1415306],[0.435,0.28375,0.08217687],[0.36,0.35875,0.07826531],[0.23,0.32625,0.1670408],[0.2907143,0.34,0.1067687],[0.3221429,0.35125,0.08710884],[0.3714286,0.2425,0.1408503],[0.3664286,0.51375,0.1514286],[0.3878571,0.32125,0.192483],[0.3571429,0.32,0.1181973],[0.2742857,0.39375,0.2340816],[0.3664286,0.3775,0.2782313],[0.2892857,0.20625,0.06782313],[0.2585714,0.06,0.01081633],[0.2807143,0.16625,0.06020408],[0.4,0.46625,0.2561565],[0.3635714,0.46375,0.217415],[0.3592857,0.51375,0.2502041],[0.2478571,0.41875,0.2821428],[0.3521429,0.52,0.2820068],[0.1242857,0.24625,0.08557823],[0.1785714,0.1275,0.1132653],[0.3264286,0.56125,0.2472449],[0.2471429,0.19875,0.0003741496],[0.095,0.135,0.08163265],[0.07928571,0.09125,0.09768707],[0.1128571,0.12625,0.1014286],[0.06,0.42625,0.1035034],[0.1857143,0.14375,0.03591837],[0.2057143,0.31625,0.2129252],[0.11,0.36125,0.122415],[0.1171429,0.19,0.1542177],[0.1171429,0.31,0.1542177],[0.1014286,0.165,0.04387755],[0.04928571,0.29125,0.1307143],[0.05285714,0.235,0.09812925],[0.2921429,0.40625,0.2531633],[0.2007143,0.4275,0.2070068],[0.1714286,0.32375,0.2028912],[0.1371429,0.3975,0.199898],[0.1735714,0.32375,0.1772449],[0.1985714,0.42125,0.2031633],[0.1971429,0.51,0.1136735],[0.3064286,0.34,0.164932],[0.02714286,0.2275,0.07642857],[0.15,0.35125,0.1767007],[0.2928571,0.50375,0.2420408],[0.04785714,0.21625,0.1393197],[0.2178571,0.38625,0.262449],[0.2807143,0.5025,0.2226871],[0.16,0.51375,0.2816327],[0.06571428,0.36125,0.1598299],[0.04285714,0.3275,0.1822789],[0.1292857,0.24875,0.1343197],[0.1664286,0.41125,0.2152381],[0.1085714,0.20625,0.112585],[0.4478571,0.70125,0.4568707],[0.1778571,0.48625,0.2804422],[0.1128571,0.32375,0.1687755],[0.1378571,0.18875,0.1232653],[0.1692857,0.20125,0.1412585],[0.2857143,0.4025,0.1993878],[0.1821429,0.315,0.102619]],"ignoreExtent":false,"flags":3},"33":{"id":33,"type":"lines","material":{"lit":false},"vertices":[[0,0,0],[1,0,0]],"colors":[[0.5450981,0,0.5450981,1]],"centers":[[0.5,0,0]],"ignoreExtent":false,"flags":64},"34":{"id":34,"type":"lines","material":{"lit":false},"vertices":[[0,0,0],[0,1,0]],"colors":[[0,0,0,1]],"centers":[[0,0.5,0]],"ignoreExtent":false,"flags":64},"35":{"id":35,"type":"lines","material":{"lit":false},"vertices":[[0,0,0],[0,0,1]],"colors":[[0,0.5450981,0.5450981,1]],"centers":[[0,0,0.5]],"ignoreExtent":false,"flags":64},"36":{"id":36,"type":"text","material":{"lit":false},"vertices":[[1,0,0]],"colors":[[0.5450981,0,0.5450981,1]],"texts":[["education"]],"cex":[[1]],"adj":[[1,0.5]],"centers":[[1,0,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"37":{"id":37,"type":"text","material":{"lit":false},"vertices":[[0,1.05,0]],"colors":[[0,0,0,1]],"texts":[["prestige"]],"cex":[[1]],"adj":[[1,0.5]],"centers":[[0,1.05,0]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"38":{"id":38,"type":"text","material":{"lit":false},"vertices":[[0,0,1]],"colors":[[0,0.5450981,0.5450981,1]],"texts":[["income"]],"cex":[[1]],"adj":[[1,0.5]],"centers":[[0,0,1]],"family":[["sans"]],"font":[[1]],"ignoreExtent":false,"flags":2064},"39":{"id":39,"type":"surface","material":{"alpha":0.4980392,"lit":false,"isTransparent":true},"vertices":[[0,0.1099198,0],[0.04,0.138882,0],[0.08,0.1678441,0],[0.12,0.1968062,0],[0.16,0.2257683,0],[0.2,0.2547304,0],[0.24,0.2836925,0],[0.28,0.3126546,0],[0.32,0.3416167,0],[0.36,0.3705788,0],[0.4,0.3995409,0],[0.44,0.4285031,0],[0.48,0.4574652,0],[0.52,0.4864273,0],[0.56,0.5153894,0],[0.6,0.5443515,0],[0.64,0.5733136,0],[0.68,0.6022757,0],[0.72,0.6312378,0],[0.76,0.6601999,0],[0.8,0.6891621,0],[0.84,0.7181242,0],[0.88,0.7470863,0],[0.92,0.7760484,0],[0.96,0.8050105,0],[1,0.8339726,0],[0,0.129929,0.04],[0.04,0.1588911,0.04],[0.08,0.1878532,0.04],[0.12,0.2168153,0.04],[0.16,0.2457774,0.04],[0.2,0.2747395,0.04],[0.24,0.3037016,0.04],[0.28,0.3326637,0.04],[0.32,0.3616259,0.04],[0.36,0.390588,0.04],[0.4,0.4195501,0.04],[0.44,0.4485122,0.04],[0.48,0.4774743,0.04],[0.52,0.5064364,0.04],[0.56,0.5353985,0.04],[0.6,0.5643606,0.04],[0.64,0.5933228,0.04],[0.68,0.6222848,0.04],[0.72,0.651247,0.04],[0.76,0.6802091,0.04],[0.8,0.7091712,0.04],[0.84,0.7381333,0.04],[0.88,0.7670954,0.04],[0.92,0.7960575,0.04],[0.96,0.8250197,0.04],[1,0.8539817,0.04],[0,0.1499381,0.08],[0.04,0.1789002,0.08],[0.08,0.2078623,0.08],[0.12,0.2368245,0.08],[0.16,0.2657866,0.08],[0.2,0.2947487,0.08],[0.24,0.3237108,0.08],[0.28,0.3526729,0.08],[0.32,0.381635,0.08],[0.36,0.4105971,0.08],[0.4,0.4395592,0.08],[0.44,0.4685213,0.08],[0.48,0.4974834,0.08],[0.52,0.5264456,0.08],[0.56,0.5554076,0.08],[0.6,0.5843698,0.08],[0.64,0.6133319,0.08],[0.68,0.642294,0.08],[0.72,0.6712561,0.08],[0.76,0.7002182,0.08],[0.8,0.7291803,0.08],[0.84,0.7581424,0.08],[0.88,0.7871045,0.08],[0.92,0.8160667,0.08],[0.96,0.8450288,0.08],[1,0.8739909,0.08],[0,0.1699473,0.12],[0.04,0.1989094,0.12],[0.08,0.2278715,0.12],[0.12,0.2568336,0.12],[0.16,0.2857957,0.12],[0.2,0.3147578,0.12],[0.24,0.3437199,0.12],[0.28,0.372682,0.12],[0.32,0.4016441,0.12],[0.36,0.4306062,0.12],[0.4,0.4595684,0.12],[0.44,0.4885305,0.12],[0.48,0.5174926,0.12],[0.52,0.5464547,0.12],[0.56,0.5754168,0.12],[0.6,0.6043789,0.12],[0.64,0.633341,0.12],[0.68,0.6623031,0.12],[0.72,0.6912652,0.12],[0.76,0.7202274,0.12],[0.8,0.7491895,0.12],[0.84,0.7781516,0.12],[0.88,0.8071137,0.12],[0.92,0.8360758,0.12],[0.96,0.8650379,0.12],[1,0.894,0.12],[0,0.1899564,0.16],[0.04,0.2189185,0.16],[0.08,0.2478806,0.16],[0.12,0.2768427,0.16],[0.16,0.3058048,0.16],[0.2,0.334767,0.16],[0.24,0.3637291,0.16],[0.28,0.3926912,0.16],[0.32,0.4216533,0.16],[0.36,0.4506154,0.16],[0.4,0.4795775,0.16],[0.44,0.5085396,0.16],[0.48,0.5375017,0.16],[0.52,0.5664638,0.16],[0.56,0.595426,0.16],[0.6,0.624388,0.16],[0.64,0.6533502,0.16],[0.68,0.6823123,0.16],[0.72,0.7112744,0.16],[0.76,0.7402365,0.16],[0.8,0.7691986,0.16],[0.84,0.7981607,0.16],[0.88,0.8271228,0.16],[0.92,0.8560849,0.16],[0.96,0.885047,0.16],[1,0.9140092,0.16],[0,0.2099655,0.2],[0.04,0.2389276,0.2],[0.08,0.2678897,0.2],[0.12,0.2968519,0.2],[0.16,0.325814,0.2],[0.2,0.3547761,0.2],[0.24,0.3837382,0.2],[0.28,0.4127003,0.2],[0.32,0.4416624,0.2],[0.36,0.4706245,0.2],[0.4,0.4995866,0.2],[0.44,0.5285487,0.2],[0.48,0.5575109,0.2],[0.52,0.586473,0.2],[0.56,0.6154351,0.2],[0.6,0.6443972,0.2],[0.64,0.6733593,0.2],[0.68,0.7023214,0.2],[0.72,0.7312835,0.2],[0.76,0.7602456,0.2],[0.8,0.7892078,0.2],[0.84,0.8181698,0.2],[0.88,0.847132,0.2],[0.92,0.8760941,0.2],[0.96,0.9050562,0.2],[1,0.9340183,0.2],[0,0.2299747,0.24],[0.04,0.2589368,0.24],[0.08,0.2878989,0.24],[0.12,0.316861,0.24],[0.16,0.3458231,0.24],[0.2,0.3747852,0.24],[0.24,0.4037473,0.24],[0.28,0.4327095,0.24],[0.32,0.4616716,0.24],[0.36,0.4906337,0.24],[0.4,0.5195958,0.24],[0.44,0.5485579,0.24],[0.48,0.57752,0.24],[0.52,0.6064821,0.24],[0.56,0.6354442,0.24],[0.6,0.6644063,0.24],[0.64,0.6933684,0.24],[0.68,0.7223306,0.24],[0.72,0.7512926,0.24],[0.76,0.7802548,0.24],[0.8,0.8092169,0.24],[0.84,0.838179,0.24],[0.88,0.8671411,0.24],[0.92,0.8961032,0.24],[0.96,0.9250653,0.24],[1,0.9540274,0.24],[0,0.2499838,0.28],[0.04,0.2789459,0.28],[0.08,0.307908,0.28],[0.12,0.3368701,0.28],[0.16,0.3658322,0.28],[0.2,0.3947943,0.28],[0.24,0.4237565,0.28],[0.28,0.4527186,0.28],[0.32,0.4816807,0.28],[0.36,0.5106428,0.28],[0.4,0.5396049,0.28],[0.44,0.568567,0.28],[0.48,0.5975291,0.28],[0.52,0.6264912,0.28],[0.56,0.6554534,0.28],[0.6,0.6844155,0.28],[0.64,0.7133776,0.28],[0.68,0.7423397,0.28],[0.72,0.7713018,0.28],[0.76,0.8002639,0.28],[0.8,0.829226,0.28],[0.84,0.8581882,0.28],[0.88,0.8871502,0.28],[0.92,0.9161124,0.28],[0.96,0.9450744,0.28],[1,0.9740366,0.28],[0,0.2699929,0.32],[0.04,0.2989551,0.32],[0.08,0.3279172,0.32],[0.12,0.3568793,0.32],[0.16,0.3858414,0.32],[0.2,0.4148035,0.32],[0.24,0.4437656,0.32],[0.28,0.4727277,0.32],[0.32,0.5016899,0.32],[0.36,0.5306519,0.32],[0.4,0.5596141,0.32],[0.44,0.5885761,0.32],[0.48,0.6175383,0.32],[0.52,0.6465004,0.32],[0.56,0.6754625,0.32],[0.6,0.7044246,0.32],[0.64,0.7333867,0.32],[0.68,0.7623488,0.32],[0.72,0.7913109,0.32],[0.76,0.820273,0.32],[0.8,0.8492352,0.32],[0.84,0.8781973,0.32],[0.88,0.9071594,0.32],[0.92,0.9361215,0.32],[0.96,0.9650836,0.32],[1,0.9940457,0.32],[0,0.2900021,0.36],[0.04,0.3189642,0.36],[0.08,0.3479263,0.36],[0.12,0.3768884,0.36],[0.16,0.4058505,0.36],[0.2,0.4348126,0.36],[0.24,0.4637747,0.36],[0.28,0.4927368,0.36],[0.32,0.521699,0.36],[0.36,0.5506611,0.36],[0.4,0.5796232,0.36],[0.44,0.6085853,0.36],[0.48,0.6375474,0.36],[0.52,0.6665095,0.36],[0.56,0.6954716,0.36],[0.6,0.7244337,0.36],[0.64,0.7533959,0.36],[0.68,0.782358,0.36],[0.72,0.8113201,0.36],[0.76,0.8402822,0.36],[0.8,0.8692443,0.36],[0.84,0.8982064,0.36],[0.88,0.9271685,0.36],[0.92,0.9561306,0.36],[0.96,0.9850928,0.36],[1,1.014055,0.36],[0,0.3100112,0.4],[0.04,0.3389733,0.4],[0.08,0.3679354,0.4],[0.12,0.3968976,0.4],[0.16,0.4258597,0.4],[0.2,0.4548218,0.4],[0.24,0.4837839,0.4],[0.28,0.512746,0.4],[0.32,0.5417081,0.4],[0.36,0.5706702,0.4],[0.4,0.5996323,0.4],[0.44,0.6285945,0.4],[0.48,0.6575565,0.4],[0.52,0.6865187,0.4],[0.56,0.7154807,0.4],[0.6,0.7444429,0.4],[0.64,0.773405,0.4],[0.68,0.8023671,0.4],[0.72,0.8313292,0.4],[0.76,0.8602913,0.4],[0.8,0.8892534,0.4],[0.84,0.9182156,0.4],[0.88,0.9471776,0.4],[0.92,0.9761398,0.4],[0.96,1.005102,0.4],[1,1.034064,0.4],[0,0.3300204,0.44],[0.04,0.3589825,0.44],[0.08,0.3879446,0.44],[0.12,0.4169067,0.44],[0.16,0.4458688,0.44],[0.2,0.4748309,0.44],[0.24,0.503793,0.44],[0.28,0.5327551,0.44],[0.32,0.5617173,0.44],[0.36,0.5906793,0.44],[0.4,0.6196415,0.44],[0.44,0.6486036,0.44],[0.48,0.6775657,0.44],[0.52,0.7065278,0.44],[0.56,0.7354899,0.44],[0.6,0.764452,0.44],[0.64,0.7934141,0.44],[0.68,0.8223763,0.44],[0.72,0.8513383,0.44],[0.76,0.8803005,0.44],[0.8,0.9092626,0.44],[0.84,0.9382247,0.44],[0.88,0.9671868,0.44],[0.92,0.9961489,0.44],[0.96,1.025111,0.44],[1,1.054073,0.44],[0,0.3500295,0.48],[0.04,0.3789916,0.48],[0.08,0.4079537,0.48],[0.12,0.4369158,0.48],[0.16,0.465878,0.48],[0.2,0.4948401,0.48],[0.24,0.5238022,0.48],[0.28,0.5527643,0.48],[0.32,0.5817264,0.48],[0.36,0.6106885,0.48],[0.4,0.6396506,0.48],[0.44,0.6686127,0.48],[0.48,0.6975748,0.48],[0.52,0.7265369,0.48],[0.56,0.7554991,0.48],[0.6,0.7844611,0.48],[0.64,0.8134233,0.48],[0.68,0.8423854,0.48],[0.72,0.8713475,0.48],[0.76,0.9003096,0.48],[0.8,0.9292717,0.48],[0.84,0.9582338,0.48],[0.88,0.9871959,0.48],[0.92,1.016158,0.48],[0.96,1.04512,0.48],[1,1.074082,0.48],[0,0.3700386,0.52],[0.04,0.3990007,0.52],[0.08,0.4279628,0.52],[0.12,0.456925,0.52],[0.16,0.4858871,0.52],[0.2,0.5148492,0.52],[0.24,0.5438113,0.52],[0.28,0.5727734,0.52],[0.32,0.6017355,0.52],[0.36,0.6306976,0.52],[0.4,0.6596597,0.52],[0.44,0.6886219,0.52],[0.48,0.717584,0.52],[0.52,0.7465461,0.52],[0.56,0.7755082,0.52],[0.6,0.8044703,0.52],[0.64,0.8334324,0.52],[0.68,0.8623945,0.52],[0.72,0.8913566,0.52],[0.76,0.9203187,0.52],[0.8,0.9492809,0.52],[0.84,0.9782429,0.52],[0.88,1.007205,0.52],[0.92,1.036167,0.52],[0.96,1.065129,0.52],[1,1.094091,0.52],[0,0.3900478,0.56],[0.04,0.4190099,0.56],[0.08,0.447972,0.56],[0.12,0.4769341,0.56],[0.16,0.5058962,0.56],[0.2,0.5348583,0.56],[0.24,0.5638204,0.56],[0.28,0.5927826,0.56],[0.32,0.6217446,0.56],[0.36,0.6507068,0.56],[0.4,0.6796689,0.56],[0.44,0.708631,0.56],[0.48,0.7375931,0.56],[0.52,0.7665552,0.56],[0.56,0.7955173,0.56],[0.6,0.8244795,0.56],[0.64,0.8534415,0.56],[0.68,0.8824037,0.56],[0.72,0.9113657,0.56],[0.76,0.9403279,0.56],[0.8,0.96929,0.56],[0.84,0.9982521,0.56],[0.88,1.027214,0.56],[0.92,1.056176,0.56],[0.96,1.085138,0.56],[1,1.114101,0.56],[0,0.4100569,0.6],[0.04,0.439019,0.6],[0.08,0.4679811,0.6],[0.12,0.4969432,0.6],[0.16,0.5259054,0.6],[0.2,0.5548674,0.6],[0.24,0.5838296,0.6],[0.28,0.6127917,0.6],[0.32,0.6417538,0.6],[0.36,0.6707159,0.6],[0.4,0.699678,0.6],[0.44,0.7286401,0.6],[0.48,0.7576022,0.6],[0.52,0.7865644,0.6],[0.56,0.8155265,0.6],[0.6,0.8444886,0.6],[0.64,0.8734507,0.6],[0.68,0.9024128,0.6],[0.72,0.9313749,0.6],[0.76,0.960337,0.6],[0.8,0.9892991,0.6],[0.84,1.018261,0.6],[0.88,1.047223,0.6],[0.92,1.076185,0.6],[0.96,1.105148,0.6],[1,1.13411,0.6],[0,0.430066,0.64],[0.04,0.4590282,0.64],[0.08,0.4879903,0.64],[0.12,0.5169524,0.64],[0.16,0.5459145,0.64],[0.2,0.5748766,0.64],[0.24,0.6038387,0.64],[0.28,0.6328008,0.64],[0.32,0.661763,0.64],[0.36,0.690725,0.64],[0.4,0.7196872,0.64],[0.44,0.7486492,0.64],[0.48,0.7776114,0.64],[0.52,0.8065735,0.64],[0.56,0.8355356,0.64],[0.6,0.8644977,0.64],[0.64,0.8934598,0.64],[0.68,0.9224219,0.64],[0.72,0.9513841,0.64],[0.76,0.9803461,0.64],[0.8,1.009308,0.64],[0.84,1.03827,0.64],[0.88,1.067232,0.64],[0.92,1.096195,0.64],[0.96,1.125157,0.64],[1,1.154119,0.64],[0,0.4500752,0.68],[0.04,0.4790373,0.68],[0.08,0.5079994,0.68],[0.12,0.5369615,0.68],[0.16,0.5659236,0.68],[0.2,0.5948858,0.68],[0.24,0.6238478,0.68],[0.28,0.65281,0.68],[0.32,0.6817721,0.68],[0.36,0.7107342,0.68],[0.4,0.7396963,0.68],[0.44,0.7686584,0.68],[0.48,0.7976205,0.68],[0.52,0.8265826,0.68],[0.56,0.8555447,0.68],[0.6,0.8845068,0.68],[0.64,0.913469,0.68],[0.68,0.9424311,0.68],[0.72,0.9713932,0.68],[0.76,1.000355,0.68],[0.8,1.029317,0.68],[0.84,1.05828,0.68],[0.88,1.087242,0.68],[0.92,1.116204,0.68],[0.96,1.145166,0.68],[1,1.174128,0.68],[0,0.4700843,0.72],[0.04,0.4990464,0.72],[0.08,0.5280085,0.72],[0.12,0.5569707,0.72],[0.16,0.5859328,0.72],[0.2,0.6148949,0.72],[0.24,0.643857,0.72],[0.28,0.6728191,0.72],[0.32,0.7017812,0.72],[0.36,0.7307433,0.72],[0.4,0.7597054,0.72],[0.44,0.7886676,0.72],[0.48,0.8176296,0.72],[0.52,0.8465918,0.72],[0.56,0.8755538,0.72],[0.6,0.904516,0.72],[0.64,0.9334781,0.72],[0.68,0.9624402,0.72],[0.72,0.9914023,0.72],[0.76,1.020364,0.72],[0.8,1.049327,0.72],[0.84,1.078289,0.72],[0.88,1.107251,0.72],[0.92,1.136213,0.72],[0.96,1.165175,0.72],[1,1.194137,0.72],[0,0.4900935,0.76],[0.04,0.5190555,0.76],[0.08,0.5480177,0.76],[0.12,0.5769798,0.76],[0.16,0.6059419,0.76],[0.2,0.634904,0.76],[0.24,0.6638661,0.76],[0.28,0.6928282,0.76],[0.32,0.7217904,0.76],[0.36,0.7507524,0.76],[0.4,0.7797146,0.76],[0.44,0.8086767,0.76],[0.48,0.8376388,0.76],[0.52,0.8666009,0.76],[0.56,0.895563,0.76],[0.6,0.9245251,0.76],[0.64,0.9534872,0.76],[0.68,0.9824494,0.76],[0.72,1.011411,0.76],[0.76,1.040374,0.76],[0.8,1.069336,0.76],[0.84,1.098298,0.76],[0.88,1.12726,0.76],[0.92,1.156222,0.76],[0.96,1.185184,0.76],[1,1.214146,0.76],[0,0.5101026,0.8],[0.04,0.5390647,0.8],[0.08,0.5680268,0.8],[0.12,0.5969889,0.8],[0.16,0.6259511,0.8],[0.2,0.6549131,0.8],[0.24,0.6838753,0.8],[0.28,0.7128374,0.8],[0.32,0.7417995,0.8],[0.36,0.7707616,0.8],[0.4,0.7997237,0.8],[0.44,0.8286858,0.8],[0.48,0.857648,0.8],[0.52,0.88661,0.8],[0.56,0.9155722,0.8],[0.6,0.9445342,0.8],[0.64,0.9734964,0.8],[0.68,1.002458,0.8],[0.72,1.031421,0.8],[0.76,1.060383,0.8],[0.8,1.089345,0.8],[0.84,1.118307,0.8],[0.88,1.147269,0.8],[0.92,1.176231,0.8],[0.96,1.205193,0.8],[1,1.234155,0.8],[0,0.5301117,0.84],[0.04,0.5590739,0.84],[0.08,0.5880359,0.84],[0.12,0.6169981,0.84],[0.16,0.6459602,0.84],[0.2,0.6749223,0.84],[0.24,0.7038844,0.84],[0.28,0.7328465,0.84],[0.32,0.7618086,0.84],[0.36,0.7907707,0.84],[0.4,0.8197328,0.84],[0.44,0.848695,0.84],[0.48,0.8776571,0.84],[0.52,0.9066192,0.84],[0.56,0.9355813,0.84],[0.6,0.9645434,0.84],[0.64,0.9935055,0.84],[0.68,1.022468,0.84],[0.72,1.05143,0.84],[0.76,1.080392,0.84],[0.8,1.109354,0.84],[0.84,1.138316,0.84],[0.88,1.167278,0.84],[0.92,1.19624,0.84],[0.96,1.225202,0.84],[1,1.254164,0.84],[0,0.5501209,0.88],[0.04,0.579083,0.88],[0.08,0.6080451,0.88],[0.12,0.6370072,0.88],[0.16,0.6659693,0.88],[0.2,0.6949314,0.88],[0.24,0.7238935,0.88],[0.28,0.7528557,0.88],[0.32,0.7818177,0.88],[0.36,0.8107799,0.88],[0.4,0.839742,0.88],[0.44,0.8687041,0.88],[0.48,0.8976662,0.88],[0.52,0.9266283,0.88],[0.56,0.9555904,0.88],[0.6,0.9845526,0.88],[0.64,1.013515,0.88],[0.68,1.042477,0.88],[0.72,1.071439,0.88],[0.76,1.100401,0.88],[0.8,1.129363,0.88],[0.84,1.158325,0.88],[0.88,1.187287,0.88],[0.92,1.216249,0.88],[0.96,1.245211,0.88],[1,1.274174,0.88],[0,0.57013,0.92],[0.04,0.5990921,0.92],[0.08,0.6280543,0.92],[0.12,0.6570163,0.92],[0.16,0.6859785,0.92],[0.2,0.7149405,0.92],[0.24,0.7439027,0.92],[0.28,0.7728648,0.92],[0.32,0.8018269,0.92],[0.36,0.830789,0.92],[0.4,0.8597511,0.92],[0.44,0.8887132,0.92],[0.48,0.9176753,0.92],[0.52,0.9466375,0.92],[0.56,0.9755996,0.92],[0.6,1.004562,0.92],[0.64,1.033524,0.92],[0.68,1.062486,0.92],[0.72,1.091448,0.92],[0.76,1.12041,0.92],[0.8,1.149372,0.92],[0.84,1.178334,0.92],[0.88,1.207296,0.92],[0.92,1.236259,0.92],[0.96,1.265221,0.92],[1,1.294183,0.92],[0,0.5901392,0.96],[0.04,0.6191013,0.96],[0.08,0.6480634,0.96],[0.12,0.6770255,0.96],[0.16,0.7059876,0.96],[0.2,0.7349497,0.96],[0.24,0.7639118,0.96],[0.28,0.7928739,0.96],[0.32,0.8218361,0.96],[0.36,0.8507981,0.96],[0.4,0.8797603,0.96],[0.44,0.9087223,0.96],[0.48,0.9376845,0.96],[0.52,0.9666466,0.96],[0.56,0.9956087,0.96],[0.6,1.024571,0.96],[0.64,1.053533,0.96],[0.68,1.082495,0.96],[0.72,1.111457,0.96],[0.76,1.140419,0.96],[0.8,1.169381,0.96],[0.84,1.198344,0.96],[0.88,1.227306,0.96],[0.92,1.256268,0.96],[0.96,1.28523,0.96],[1,1.314192,0.96],[0,0.6101483,1],[0.04,0.6391104,1],[0.08,0.6680725,1],[0.12,0.6970346,1],[0.16,0.7259967,1],[0.2,0.7549589,1],[0.24,0.7839209,1],[0.28,0.8128831,1],[0.32,0.8418452,1],[0.36,0.8708073,1],[0.4,0.8997694,1],[0.44,0.9287315,1],[0.48,0.9576936,1],[0.52,0.9866557,1],[0.56,1.015618,1],[0.6,1.04458,1],[0.64,1.073542,1],[0.68,1.102504,1],[0.72,1.131466,1],[0.76,1.160428,1],[0.8,1.189391,1],[0.84,1.218353,1],[0.88,1.247315,1],[0.92,1.276277,1],[0.96,1.305239,1],[1,1.334201,1]],"colors":[[0,0,1,0.4980392]],"dim":[[26,26]],"centers":[[0.02,0.1344055,0.02],[0.06,0.1633676,0.02],[0.09999999,0.1923297,0.02],[0.14,0.2212918,0.02],[0.18,0.2502539,0.02],[0.22,0.279216,0.02],[0.26,0.3081781,0.02],[0.3,0.3371403,0.02],[0.34,0.3661023,0.02],[0.38,0.3950644,0.02],[0.42,0.4240266,0.02],[0.46,0.4529887,0.02],[0.5,0.4819508,0.02],[0.54,0.5109129,0.02],[0.58,0.539875,0.02],[0.62,0.5688371,0.02],[0.66,0.5977992,0.02],[0.7,0.6267614,0.02],[0.74,0.6557235,0.02],[0.78,0.6846856,0.02],[0.82,0.7136477,0.02],[0.86,0.7426098,0.02],[0.9,0.7715719,0.02],[0.94,0.800534,0.02],[0.98,0.8294961,0.02],[0.02,0.1544146,0.06],[0.06,0.1833767,0.06],[0.09999999,0.2123388,0.06],[0.14,0.2413009,0.06],[0.18,0.270263,0.06],[0.22,0.2992252,0.06],[0.26,0.3281873,0.06],[0.3,0.3571494,0.06],[0.34,0.3861115,0.06],[0.38,0.4150736,0.06],[0.42,0.4440357,0.06],[0.46,0.4729978,0.06],[0.5,0.5019599,0.06],[0.54,0.5309221,0.06],[0.58,0.5598841,0.06],[0.62,0.5888463,0.06],[0.66,0.6178084,0.06],[0.7,0.6467705,0.06],[0.74,0.6757326,0.06],[0.78,0.7046947,0.06],[0.82,0.7336568,0.06],[0.86,0.762619,0.06],[0.9,0.791581,0.06],[0.94,0.8205432,0.06],[0.98,0.8495053,0.06],[0.02,0.1744237,0.1],[0.06,0.2033858,0.1],[0.09999999,0.232348,0.1],[0.14,0.2613101,0.1],[0.18,0.2902722,0.1],[0.22,0.3192343,0.1],[0.26,0.3481964,0.1],[0.3,0.3771585,0.1],[0.34,0.4061206,0.1],[0.38,0.4350827,0.1],[0.42,0.4640449,0.1],[0.46,0.4930069,0.1],[0.5,0.5219691,0.1],[0.54,0.5509312,0.1],[0.58,0.5798933,0.1],[0.62,0.6088554,0.1],[0.66,0.6378176,0.1],[0.7,0.6667796,0.1],[0.74,0.6957417,0.1],[0.78,0.7247038,0.1],[0.82,0.7536659,0.1],[0.86,0.7826281,0.1],[0.9,0.8115902,0.1],[0.94,0.8405523,0.1],[0.98,0.8695144,0.1],[0.02,0.1944329,0.14],[0.06,0.223395,0.14],[0.09999999,0.2523571,0.14],[0.14,0.2813192,0.14],[0.18,0.3102813,0.14],[0.22,0.3392434,0.14],[0.26,0.3682055,0.14],[0.3,0.3971677,0.14],[0.34,0.4261298,0.14],[0.38,0.4550919,0.14],[0.42,0.484054,0.14],[0.46,0.5130161,0.14],[0.5,0.5419782,0.14],[0.54,0.5709403,0.14],[0.58,0.5999025,0.14],[0.62,0.6288645,0.14],[0.66,0.6578267,0.14],[0.7,0.6867887,0.14],[0.74,0.7157509,0.14],[0.78,0.744713,0.14],[0.82,0.7736751,0.14],[0.86,0.8026372,0.14],[0.9,0.8315992,0.14],[0.94,0.8605614,0.14],[0.98,0.8895235,0.14],[0.02,0.214442,0.18],[0.06,0.2434041,0.18],[0.09999999,0.2723662,0.18],[0.14,0.3013284,0.18],[0.18,0.3302904,0.18],[0.22,0.3592525,0.18],[0.26,0.3882147,0.18],[0.3,0.4171768,0.18],[0.34,0.4461389,0.18],[0.38,0.475101,0.18],[0.42,0.5040631,0.18],[0.46,0.5330252,0.18],[0.5,0.5619873,0.18],[0.54,0.5909495,0.18],[0.58,0.6199116,0.18],[0.62,0.6488737,0.18],[0.66,0.6778358,0.18],[0.7,0.706798,0.18],[0.74,0.73576,0.18],[0.78,0.7647221,0.18],[0.82,0.7936842,0.18],[0.86,0.8226463,0.18],[0.9,0.8516085,0.18],[0.94,0.8805706,0.18],[0.98,0.9095327,0.18],[0.02,0.2344511,0.22],[0.06,0.2634133,0.22],[0.09999999,0.2923754,0.22],[0.14,0.3213375,0.22],[0.18,0.3502996,0.22],[0.22,0.3792617,0.22],[0.26,0.4082238,0.22],[0.3,0.4371859,0.22],[0.34,0.466148,0.22],[0.38,0.4951102,0.22],[0.42,0.5240723,0.22],[0.46,0.5530344,0.22],[0.5,0.5819965,0.22],[0.54,0.6109586,0.22],[0.58,0.6399207,0.22],[0.62,0.6688828,0.22],[0.66,0.6978449,0.22],[0.7,0.7268071,0.22],[0.74,0.7557692,0.22],[0.78,0.7847313,0.22],[0.82,0.8136934,0.22],[0.86,0.8426555,0.22],[0.9,0.8716176,0.22],[0.94,0.9005797,0.22],[0.98,0.9295418,0.22],[0.02,0.2544603,0.26],[0.06,0.2834224,0.26],[0.09999999,0.3123845,0.26],[0.14,0.3413466,0.26],[0.18,0.3703087,0.26],[0.22,0.3992708,0.26],[0.26,0.428233,0.26],[0.3,0.4571951,0.26],[0.34,0.4861572,0.26],[0.38,0.5151193,0.26],[0.42,0.5440814,0.26],[0.46,0.5730435,0.26],[0.5,0.6020057,0.26],[0.54,0.6309677,0.26],[0.58,0.6599299,0.26],[0.62,0.6888919,0.26],[0.66,0.717854,0.26],[0.7,0.7468162,0.26],[0.74,0.7757783,0.26],[0.78,0.8047404,0.26],[0.82,0.8337025,0.26],[0.86,0.8626646,0.26],[0.9,0.8916268,0.26],[0.94,0.9205889,0.26],[0.98,0.949551,0.26],[0.02,0.2744694,0.3],[0.06,0.3034316,0.3],[0.09999999,0.3323936,0.3],[0.14,0.3613558,0.3],[0.18,0.3903179,0.3],[0.22,0.41928,0.3],[0.26,0.4482421,0.3],[0.3,0.4772042,0.3],[0.34,0.5061663,0.3],[0.38,0.5351284,0.3],[0.42,0.5640905,0.3],[0.46,0.5930526,0.3],[0.5,0.6220148,0.3],[0.54,0.6509769,0.3],[0.58,0.679939,0.3],[0.62,0.7089011,0.3],[0.66,0.7378632,0.3],[0.7,0.7668253,0.3],[0.74,0.7957873,0.3],[0.78,0.8247495,0.3],[0.82,0.8537116,0.3],[0.86,0.8826737,0.3],[0.9,0.9116359,0.3],[0.94,0.940598,0.3],[0.98,0.9695601,0.3],[0.02,0.2944786,0.34],[0.06,0.3234407,0.34],[0.09999999,0.3524028,0.34],[0.14,0.3813649,0.34],[0.18,0.410327,0.34],[0.22,0.4392892,0.34],[0.26,0.4682512,0.34],[0.3,0.4972133,0.34],[0.34,0.5261754,0.34],[0.38,0.5551376,0.34],[0.42,0.5840997,0.34],[0.46,0.6130618,0.34],[0.5,0.6420239,0.34],[0.54,0.670986,0.34],[0.58,0.6999481,0.34],[0.62,0.7289102,0.34],[0.66,0.7578723,0.34],[0.7,0.7868344,0.34],[0.74,0.8157966,0.34],[0.78,0.8447587,0.34],[0.82,0.8737208,0.34],[0.86,0.9026829,0.34],[0.9,0.9316449,0.34],[0.94,0.9606071,0.34],[0.98,0.9895692,0.34],[0.02,0.3144877,0.38],[0.06,0.3434498,0.38],[0.09999999,0.3724119,0.38],[0.14,0.401374,0.38],[0.18,0.4303362,0.38],[0.22,0.4592982,0.38],[0.26,0.4882604,0.38],[0.3,0.5172225,0.38],[0.34,0.5461846,0.38],[0.38,0.5751467,0.38],[0.42,0.6041088,0.38],[0.46,0.6330709,0.38],[0.5,0.662033,0.38],[0.54,0.6909952,0.38],[0.58,0.7199573,0.38],[0.62,0.7489194,0.38],[0.66,0.7778815,0.38],[0.7,0.8068436,0.38],[0.74,0.8358057,0.38],[0.78,0.8647678,0.38],[0.82,0.8937299,0.38],[0.86,0.922692,0.38],[0.9,0.9516541,0.38],[0.94,0.9806163,0.38],[0.98,1.009578,0.38],[0.02,0.3344969,0.42],[0.06,0.363459,0.42],[0.09999999,0.3924211,0.42],[0.14,0.4213832,0.42],[0.18,0.4503453,0.42],[0.22,0.4793074,0.42],[0.26,0.5082695,0.42],[0.3,0.5372316,0.42],[0.34,0.5661938,0.42],[0.38,0.5951558,0.42],[0.42,0.624118,0.42],[0.46,0.65308,0.42],[0.5,0.6820421,0.42],[0.54,0.7110043,0.42],[0.58,0.7399664,0.42],[0.62,0.7689285,0.42],[0.66,0.7978906,0.42],[0.7,0.8268527,0.42],[0.74,0.8558149,0.42],[0.78,0.8847769,0.42],[0.82,0.9137391,0.42],[0.86,0.9427012,0.42],[0.9,0.9716633,0.42],[0.94,1.000625,0.42],[0.98,1.029588,0.42],[0.02,0.354506,0.46],[0.06,0.3834681,0.46],[0.09999999,0.4124302,0.46],[0.14,0.4413923,0.46],[0.18,0.4703544,0.46],[0.22,0.4993165,0.46],[0.26,0.5282786,0.46],[0.3,0.5572408,0.46],[0.34,0.5862029,0.46],[0.38,0.615165,0.46],[0.42,0.6441271,0.46],[0.46,0.6730892,0.46],[0.5,0.7020513,0.46],[0.54,0.7310134,0.46],[0.58,0.7599756,0.46],[0.62,0.7889376,0.46],[0.66,0.8178997,0.46],[0.7,0.8468618,0.46],[0.74,0.875824,0.46],[0.78,0.9047861,0.46],[0.82,0.9337482,0.46],[0.86,0.9627103,0.46],[0.9,0.9916724,0.46],[0.94,1.020635,0.46],[0.98,1.049597,0.46],[0.02,0.3745151,0.5],[0.06,0.4034773,0.5],[0.09999999,0.4324393,0.5],[0.14,0.4614015,0.5],[0.18,0.4903636,0.5],[0.22,0.5193257,0.5],[0.26,0.5482878,0.5],[0.3,0.5772499,0.5],[0.34,0.606212,0.5],[0.38,0.6351741,0.5],[0.42,0.6641362,0.5],[0.46,0.6930984,0.5],[0.5,0.7220604,0.5],[0.54,0.7510226,0.5],[0.58,0.7799847,0.5],[0.62,0.8089468,0.5],[0.66,0.8379089,0.5],[0.7,0.866871,0.5],[0.74,0.8958331,0.5],[0.78,0.9247952,0.5],[0.82,0.9537573,0.5],[0.86,0.9827194,0.5],[0.9,1.011682,0.5],[0.94,1.040644,0.5],[0.98,1.069606,0.5],[0.02,0.3945243,0.54],[0.06,0.4234864,0.54],[0.09999999,0.4524485,0.54],[0.14,0.4814106,0.54],[0.18,0.5103727,0.54],[0.22,0.5393348,0.54],[0.26,0.5682969,0.54],[0.3,0.597259,0.54],[0.34,0.6262211,0.54],[0.38,0.6551833,0.54],[0.42,0.6841454,0.54],[0.46,0.7131075,0.54],[0.5,0.7420696,0.54],[0.54,0.7710317,0.54],[0.58,0.7999939,0.54],[0.62,0.8289559,0.54],[0.66,0.857918,0.54],[0.7,0.8868802,0.54],[0.74,0.9158422,0.54],[0.78,0.9448044,0.54],[0.82,0.9737665,0.54],[0.86,1.002729,0.54],[0.9,1.031691,0.54],[0.94,1.060653,0.54],[0.98,1.089615,0.54],[0.02,0.4145334,0.58],[0.06,0.4434955,0.58],[0.09999999,0.4724576,0.58],[0.14,0.5014197,0.58],[0.18,0.5303819,0.58],[0.22,0.559344,0.58],[0.26,0.5883061,0.58],[0.3,0.6172681,0.58],[0.34,0.6462303,0.58],[0.38,0.6751924,0.58],[0.42,0.7041545,0.58],[0.46,0.7331166,0.58],[0.5,0.7620787,0.58],[0.54,0.7910408,0.58],[0.58,0.820003,0.58],[0.62,0.8489651,0.58],[0.66,0.8779272,0.58],[0.7,0.9068893,0.58],[0.74,0.9358514,0.58],[0.78,0.9648135,0.58],[0.82,0.9937756,0.58],[0.86,1.022738,0.58],[0.9,1.0517,0.58],[0.94,1.080662,0.58],[0.98,1.109624,0.58],[0.02,0.4345425,0.62],[0.06,0.4635046,0.62],[0.09999999,0.4924667,0.62],[0.14,0.5214289,0.62],[0.18,0.550391,0.62],[0.22,0.5793531,0.62],[0.26,0.6083152,0.62],[0.3,0.6372773,0.62],[0.34,0.6662394,0.62],[0.38,0.6952016,0.62],[0.42,0.7241637,0.62],[0.46,0.7531257,0.62],[0.5,0.7820878,0.62],[0.54,0.8110499,0.62],[0.58,0.8400121,0.62],[0.62,0.8689742,0.62],[0.66,0.8979363,0.62],[0.7,0.9268984,0.62],[0.74,0.9558606,0.62],[0.78,0.9848226,0.62],[0.82,1.013785,0.62],[0.86,1.042747,0.62],[0.9,1.071709,0.62],[0.94,1.100671,0.62],[0.98,1.129633,0.62],[0.02,0.4545517,0.66],[0.06,0.4835138,0.66],[0.09999999,0.5124759,0.66],[0.14,0.541438,0.66],[0.18,0.5704001,0.66],[0.22,0.5993623,0.66],[0.26,0.6283243,0.66],[0.3,0.6572865,0.66],[0.34,0.6862485,0.66],[0.38,0.7152107,0.66],[0.42,0.7441728,0.66],[0.46,0.7731349,0.66],[0.5,0.802097,0.66],[0.54,0.8310592,0.66],[0.58,0.8600212,0.66],[0.62,0.8889832,0.66],[0.66,0.9179454,0.66],[0.7,0.9469075,0.66],[0.74,0.9758697,0.66],[0.78,1.004832,0.66],[0.82,1.033794,0.66],[0.86,1.062756,0.66],[0.9,1.091718,0.66],[0.94,1.12068,0.66],[0.98,1.149642,0.66],[0.02,0.4745608,0.7],[0.06,0.5035229,0.7],[0.09999999,0.532485,0.7],[0.14,0.5614471,0.7],[0.18,0.5904093,0.7],[0.22,0.6193714,0.7],[0.26,0.6483335,0.7],[0.3,0.6772956,0.7],[0.34,0.7062577,0.7],[0.38,0.7352198,0.7],[0.42,0.764182,0.7],[0.46,0.793144,0.7],[0.5,0.8221061,0.7],[0.54,0.8510683,0.7],[0.58,0.8800303,0.7],[0.62,0.9089925,0.7],[0.66,0.9379546,0.7],[0.7,0.9669167,0.7],[0.74,0.9958788,0.7],[0.78,1.024841,0.7],[0.82,1.053803,0.7],[0.86,1.082765,0.7],[0.9,1.111727,0.7],[0.94,1.140689,0.7],[0.98,1.169652,0.7],[0.02,0.49457,0.74],[0.06,0.5235321,0.74],[0.09999999,0.5524942,0.74],[0.14,0.5814563,0.74],[0.18,0.6104184,0.74],[0.22,0.6393805,0.74],[0.26,0.6683426,0.74],[0.3,0.6973047,0.74],[0.34,0.7262669,0.74],[0.38,0.7552289,0.74],[0.42,0.7841911,0.74],[0.46,0.8131532,0.74],[0.5,0.8421153,0.74],[0.54,0.8710774,0.74],[0.58,0.9000396,0.74],[0.62,0.9290016,0.74],[0.66,0.9579637,0.74],[0.7,0.9869258,0.74],[0.74,1.015888,0.74],[0.78,1.04485,0.74],[0.82,1.073812,0.74],[0.86,1.102774,0.74],[0.9,1.131736,0.74],[0.94,1.160698,0.74],[0.98,1.189661,0.74],[0.02,0.5145791,0.78],[0.06,0.5435412,0.78],[0.09999999,0.5725033,0.78],[0.14,0.6014654,0.78],[0.18,0.6304275,0.78],[0.22,0.6593897,0.78],[0.26,0.6883518,0.78],[0.3,0.7173139,0.78],[0.34,0.7462759,0.78],[0.38,0.775238,0.78],[0.42,0.8042002,0.78],[0.46,0.8331623,0.78],[0.5,0.8621244,0.78],[0.54,0.8910865,0.78],[0.58,0.9200487,0.78],[0.62,0.9490108,0.78],[0.66,0.9779729,0.78],[0.7,1.006935,0.78],[0.74,1.035897,0.78],[0.78,1.064859,0.78],[0.82,1.093821,0.78],[0.86,1.122783,0.78],[0.9,1.151746,0.78],[0.94,1.180708,0.78],[0.98,1.20967,0.78],[0.02,0.5345882,0.82],[0.06,0.5635504,0.82],[0.09999999,0.5925124,0.82],[0.14,0.6214746,0.82],[0.18,0.6504366,0.82],[0.22,0.6793988,0.82],[0.26,0.7083609,0.82],[0.3,0.737323,0.82],[0.34,0.7662851,0.82],[0.38,0.7952473,0.82],[0.42,0.8242093,0.82],[0.46,0.8531715,0.82],[0.5,0.8821335,0.82],[0.54,0.9110956,0.82],[0.58,0.9400578,0.82],[0.62,0.9690199,0.82],[0.66,0.997982,0.82],[0.7,1.026944,0.82],[0.74,1.055906,0.82],[0.78,1.084868,0.82],[0.82,1.11383,0.82],[0.86,1.142793,0.82],[0.9,1.171755,0.82],[0.94,1.200717,0.82],[0.98,1.229679,0.82],[0.02,0.5545974,0.86],[0.06,0.5835595,0.86],[0.09999999,0.6125216,0.86],[0.14,0.6414837,0.86],[0.18,0.6704458,0.86],[0.22,0.6994079,0.86],[0.26,0.7283701,0.86],[0.3,0.7573321,0.86],[0.34,0.7862942,0.86],[0.38,0.8152564,0.86],[0.42,0.8442185,0.86],[0.46,0.8731806,0.86],[0.5,0.9021427,0.86],[0.54,0.9311048,0.86],[0.58,0.9600669,0.86],[0.62,0.989029,0.86],[0.66,1.017991,0.86],[0.7,1.046953,0.86],[0.74,1.075915,0.86],[0.78,1.104877,0.86],[0.82,1.13384,0.86],[0.86,1.162802,0.86],[0.9,1.191764,0.86],[0.94,1.220726,0.86],[0.98,1.249688,0.86],[0.02,0.5746065,0.9],[0.06,0.6035686,0.9],[0.09999999,0.6325307,0.9],[0.14,0.6614928,0.9],[0.18,0.690455,0.9],[0.22,0.719417,0.9],[0.26,0.7483792,0.9],[0.3,0.7773413,0.9],[0.34,0.8063034,0.9],[0.38,0.8352655,0.9],[0.42,0.8642277,0.9],[0.46,0.8931897,0.9],[0.5,0.9221518,0.9],[0.54,0.9511139,0.9],[0.58,0.9800761,0.9],[0.62,1.009038,0.9],[0.66,1.038,0.9],[0.7,1.066962,0.9],[0.74,1.095924,0.9],[0.78,1.124887,0.9],[0.82,1.153849,0.9],[0.86,1.182811,0.9],[0.9,1.211773,0.9],[0.94,1.240735,0.9],[0.98,1.269697,0.9],[0.02,0.5946156,0.94],[0.06,0.6235778,0.94],[0.09999999,0.6525399,0.94],[0.14,0.681502,0.94],[0.18,0.710464,0.94],[0.22,0.7394261,0.94],[0.26,0.7683883,0.94],[0.3,0.7973504,0.94],[0.34,0.8263125,0.94],[0.38,0.8552746,0.94],[0.42,0.8842368,0.94],[0.46,0.9131989,0.94],[0.5,0.942161,0.94],[0.54,0.9711231,0.94],[0.58,1.000085,0.94],[0.62,1.029047,0.94],[0.66,1.058009,0.94],[0.7,1.086972,0.94],[0.74,1.115934,0.94],[0.78,1.144896,0.94],[0.82,1.173858,0.94],[0.86,1.20282,0.94],[0.9,1.231782,0.94],[0.94,1.260744,0.94],[0.98,1.289706,0.94],[0.02,0.6146248,0.98],[0.06,0.6435869,0.98],[0.09999999,0.672549,0.98],[0.14,0.7015111,0.98],[0.18,0.7304732,0.98],[0.22,0.7594354,0.98],[0.26,0.7883975,0.98],[0.3,0.8173596,0.98],[0.34,0.8463216,0.98],[0.38,0.8752837,0.98],[0.42,0.9042459,0.98],[0.46,0.933208,0.98],[0.5,0.9621701,0.98],[0.54,0.9911322,0.98],[0.58,1.020094,0.98],[0.62,1.049057,0.98],[0.66,1.078019,0.98],[0.7,1.106981,0.98],[0.74,1.135943,0.98],[0.78,1.164905,0.98],[0.82,1.193867,0.98],[0.86,1.222829,0.98],[0.9,1.251791,0.98],[0.94,1.280753,0.98],[0.98,1.309716,0.98]],"ignoreExtent":false,"flags":42},"40":{"id":40,"type":"surface","material":{"alpha":0.4980392,"lit":false,"front":"lines","back":"lines","isTransparent":true},"vertices":[[0,0.1099198,0],[0.04,0.138882,0],[0.08,0.1678441,0],[0.12,0.1968062,0],[0.16,0.2257683,0],[0.2,0.2547304,0],[0.24,0.2836925,0],[0.28,0.3126546,0],[0.32,0.3416167,0],[0.36,0.3705788,0],[0.4,0.3995409,0],[0.44,0.4285031,0],[0.48,0.4574652,0],[0.52,0.4864273,0],[0.56,0.5153894,0],[0.6,0.5443515,0],[0.64,0.5733136,0],[0.68,0.6022757,0],[0.72,0.6312378,0],[0.76,0.6601999,0],[0.8,0.6891621,0],[0.84,0.7181242,0],[0.88,0.7470863,0],[0.92,0.7760484,0],[0.96,0.8050105,0],[1,0.8339726,0],[0,0.129929,0.04],[0.04,0.1588911,0.04],[0.08,0.1878532,0.04],[0.12,0.2168153,0.04],[0.16,0.2457774,0.04],[0.2,0.2747395,0.04],[0.24,0.3037016,0.04],[0.28,0.3326637,0.04],[0.32,0.3616259,0.04],[0.36,0.390588,0.04],[0.4,0.4195501,0.04],[0.44,0.4485122,0.04],[0.48,0.4774743,0.04],[0.52,0.5064364,0.04],[0.56,0.5353985,0.04],[0.6,0.5643606,0.04],[0.64,0.5933228,0.04],[0.68,0.6222848,0.04],[0.72,0.651247,0.04],[0.76,0.6802091,0.04],[0.8,0.7091712,0.04],[0.84,0.7381333,0.04],[0.88,0.7670954,0.04],[0.92,0.7960575,0.04],[0.96,0.8250197,0.04],[1,0.8539817,0.04],[0,0.1499381,0.08],[0.04,0.1789002,0.08],[0.08,0.2078623,0.08],[0.12,0.2368245,0.08],[0.16,0.2657866,0.08],[0.2,0.2947487,0.08],[0.24,0.3237108,0.08],[0.28,0.3526729,0.08],[0.32,0.381635,0.08],[0.36,0.4105971,0.08],[0.4,0.4395592,0.08],[0.44,0.4685213,0.08],[0.48,0.4974834,0.08],[0.52,0.5264456,0.08],[0.56,0.5554076,0.08],[0.6,0.5843698,0.08],[0.64,0.6133319,0.08],[0.68,0.642294,0.08],[0.72,0.6712561,0.08],[0.76,0.7002182,0.08],[0.8,0.7291803,0.08],[0.84,0.7581424,0.08],[0.88,0.7871045,0.08],[0.92,0.8160667,0.08],[0.96,0.8450288,0.08],[1,0.8739909,0.08],[0,0.1699473,0.12],[0.04,0.1989094,0.12],[0.08,0.2278715,0.12],[0.12,0.2568336,0.12],[0.16,0.2857957,0.12],[0.2,0.3147578,0.12],[0.24,0.3437199,0.12],[0.28,0.372682,0.12],[0.32,0.4016441,0.12],[0.36,0.4306062,0.12],[0.4,0.4595684,0.12],[0.44,0.4885305,0.12],[0.48,0.5174926,0.12],[0.52,0.5464547,0.12],[0.56,0.5754168,0.12],[0.6,0.6043789,0.12],[0.64,0.633341,0.12],[0.68,0.6623031,0.12],[0.72,0.6912652,0.12],[0.76,0.7202274,0.12],[0.8,0.7491895,0.12],[0.84,0.7781516,0.12],[0.88,0.8071137,0.12],[0.92,0.8360758,0.12],[0.96,0.8650379,0.12],[1,0.894,0.12],[0,0.1899564,0.16],[0.04,0.2189185,0.16],[0.08,0.2478806,0.16],[0.12,0.2768427,0.16],[0.16,0.3058048,0.16],[0.2,0.334767,0.16],[0.24,0.3637291,0.16],[0.28,0.3926912,0.16],[0.32,0.4216533,0.16],[0.36,0.4506154,0.16],[0.4,0.4795775,0.16],[0.44,0.5085396,0.16],[0.48,0.5375017,0.16],[0.52,0.5664638,0.16],[0.56,0.595426,0.16],[0.6,0.624388,0.16],[0.64,0.6533502,0.16],[0.68,0.6823123,0.16],[0.72,0.7112744,0.16],[0.76,0.7402365,0.16],[0.8,0.7691986,0.16],[0.84,0.7981607,0.16],[0.88,0.8271228,0.16],[0.92,0.8560849,0.16],[0.96,0.885047,0.16],[1,0.9140092,0.16],[0,0.2099655,0.2],[0.04,0.2389276,0.2],[0.08,0.2678897,0.2],[0.12,0.2968519,0.2],[0.16,0.325814,0.2],[0.2,0.3547761,0.2],[0.24,0.3837382,0.2],[0.28,0.4127003,0.2],[0.32,0.4416624,0.2],[0.36,0.4706245,0.2],[0.4,0.4995866,0.2],[0.44,0.5285487,0.2],[0.48,0.5575109,0.2],[0.52,0.586473,0.2],[0.56,0.6154351,0.2],[0.6,0.6443972,0.2],[0.64,0.6733593,0.2],[0.68,0.7023214,0.2],[0.72,0.7312835,0.2],[0.76,0.7602456,0.2],[0.8,0.7892078,0.2],[0.84,0.8181698,0.2],[0.88,0.847132,0.2],[0.92,0.8760941,0.2],[0.96,0.9050562,0.2],[1,0.9340183,0.2],[0,0.2299747,0.24],[0.04,0.2589368,0.24],[0.08,0.2878989,0.24],[0.12,0.316861,0.24],[0.16,0.3458231,0.24],[0.2,0.3747852,0.24],[0.24,0.4037473,0.24],[0.28,0.4327095,0.24],[0.32,0.4616716,0.24],[0.36,0.4906337,0.24],[0.4,0.5195958,0.24],[0.44,0.5485579,0.24],[0.48,0.57752,0.24],[0.52,0.6064821,0.24],[0.56,0.6354442,0.24],[0.6,0.6644063,0.24],[0.64,0.6933684,0.24],[0.68,0.7223306,0.24],[0.72,0.7512926,0.24],[0.76,0.7802548,0.24],[0.8,0.8092169,0.24],[0.84,0.838179,0.24],[0.88,0.8671411,0.24],[0.92,0.8961032,0.24],[0.96,0.9250653,0.24],[1,0.9540274,0.24],[0,0.2499838,0.28],[0.04,0.2789459,0.28],[0.08,0.307908,0.28],[0.12,0.3368701,0.28],[0.16,0.3658322,0.28],[0.2,0.3947943,0.28],[0.24,0.4237565,0.28],[0.28,0.4527186,0.28],[0.32,0.4816807,0.28],[0.36,0.5106428,0.28],[0.4,0.5396049,0.28],[0.44,0.568567,0.28],[0.48,0.5975291,0.28],[0.52,0.6264912,0.28],[0.56,0.6554534,0.28],[0.6,0.6844155,0.28],[0.64,0.7133776,0.28],[0.68,0.7423397,0.28],[0.72,0.7713018,0.28],[0.76,0.8002639,0.28],[0.8,0.829226,0.28],[0.84,0.8581882,0.28],[0.88,0.8871502,0.28],[0.92,0.9161124,0.28],[0.96,0.9450744,0.28],[1,0.9740366,0.28],[0,0.2699929,0.32],[0.04,0.2989551,0.32],[0.08,0.3279172,0.32],[0.12,0.3568793,0.32],[0.16,0.3858414,0.32],[0.2,0.4148035,0.32],[0.24,0.4437656,0.32],[0.28,0.4727277,0.32],[0.32,0.5016899,0.32],[0.36,0.5306519,0.32],[0.4,0.5596141,0.32],[0.44,0.5885761,0.32],[0.48,0.6175383,0.32],[0.52,0.6465004,0.32],[0.56,0.6754625,0.32],[0.6,0.7044246,0.32],[0.64,0.7333867,0.32],[0.68,0.7623488,0.32],[0.72,0.7913109,0.32],[0.76,0.820273,0.32],[0.8,0.8492352,0.32],[0.84,0.8781973,0.32],[0.88,0.9071594,0.32],[0.92,0.9361215,0.32],[0.96,0.9650836,0.32],[1,0.9940457,0.32],[0,0.2900021,0.36],[0.04,0.3189642,0.36],[0.08,0.3479263,0.36],[0.12,0.3768884,0.36],[0.16,0.4058505,0.36],[0.2,0.4348126,0.36],[0.24,0.4637747,0.36],[0.28,0.4927368,0.36],[0.32,0.521699,0.36],[0.36,0.5506611,0.36],[0.4,0.5796232,0.36],[0.44,0.6085853,0.36],[0.48,0.6375474,0.36],[0.52,0.6665095,0.36],[0.56,0.6954716,0.36],[0.6,0.7244337,0.36],[0.64,0.7533959,0.36],[0.68,0.782358,0.36],[0.72,0.8113201,0.36],[0.76,0.8402822,0.36],[0.8,0.8692443,0.36],[0.84,0.8982064,0.36],[0.88,0.9271685,0.36],[0.92,0.9561306,0.36],[0.96,0.9850928,0.36],[1,1.014055,0.36],[0,0.3100112,0.4],[0.04,0.3389733,0.4],[0.08,0.3679354,0.4],[0.12,0.3968976,0.4],[0.16,0.4258597,0.4],[0.2,0.4548218,0.4],[0.24,0.4837839,0.4],[0.28,0.512746,0.4],[0.32,0.5417081,0.4],[0.36,0.5706702,0.4],[0.4,0.5996323,0.4],[0.44,0.6285945,0.4],[0.48,0.6575565,0.4],[0.52,0.6865187,0.4],[0.56,0.7154807,0.4],[0.6,0.7444429,0.4],[0.64,0.773405,0.4],[0.68,0.8023671,0.4],[0.72,0.8313292,0.4],[0.76,0.8602913,0.4],[0.8,0.8892534,0.4],[0.84,0.9182156,0.4],[0.88,0.9471776,0.4],[0.92,0.9761398,0.4],[0.96,1.005102,0.4],[1,1.034064,0.4],[0,0.3300204,0.44],[0.04,0.3589825,0.44],[0.08,0.3879446,0.44],[0.12,0.4169067,0.44],[0.16,0.4458688,0.44],[0.2,0.4748309,0.44],[0.24,0.503793,0.44],[0.28,0.5327551,0.44],[0.32,0.5617173,0.44],[0.36,0.5906793,0.44],[0.4,0.6196415,0.44],[0.44,0.6486036,0.44],[0.48,0.6775657,0.44],[0.52,0.7065278,0.44],[0.56,0.7354899,0.44],[0.6,0.764452,0.44],[0.64,0.7934141,0.44],[0.68,0.8223763,0.44],[0.72,0.8513383,0.44],[0.76,0.8803005,0.44],[0.8,0.9092626,0.44],[0.84,0.9382247,0.44],[0.88,0.9671868,0.44],[0.92,0.9961489,0.44],[0.96,1.025111,0.44],[1,1.054073,0.44],[0,0.3500295,0.48],[0.04,0.3789916,0.48],[0.08,0.4079537,0.48],[0.12,0.4369158,0.48],[0.16,0.465878,0.48],[0.2,0.4948401,0.48],[0.24,0.5238022,0.48],[0.28,0.5527643,0.48],[0.32,0.5817264,0.48],[0.36,0.6106885,0.48],[0.4,0.6396506,0.48],[0.44,0.6686127,0.48],[0.48,0.6975748,0.48],[0.52,0.7265369,0.48],[0.56,0.7554991,0.48],[0.6,0.7844611,0.48],[0.64,0.8134233,0.48],[0.68,0.8423854,0.48],[0.72,0.8713475,0.48],[0.76,0.9003096,0.48],[0.8,0.9292717,0.48],[0.84,0.9582338,0.48],[0.88,0.9871959,0.48],[0.92,1.016158,0.48],[0.96,1.04512,0.48],[1,1.074082,0.48],[0,0.3700386,0.52],[0.04,0.3990007,0.52],[0.08,0.4279628,0.52],[0.12,0.456925,0.52],[0.16,0.4858871,0.52],[0.2,0.5148492,0.52],[0.24,0.5438113,0.52],[0.28,0.5727734,0.52],[0.32,0.6017355,0.52],[0.36,0.6306976,0.52],[0.4,0.6596597,0.52],[0.44,0.6886219,0.52],[0.48,0.717584,0.52],[0.52,0.7465461,0.52],[0.56,0.7755082,0.52],[0.6,0.8044703,0.52],[0.64,0.8334324,0.52],[0.68,0.8623945,0.52],[0.72,0.8913566,0.52],[0.76,0.9203187,0.52],[0.8,0.9492809,0.52],[0.84,0.9782429,0.52],[0.88,1.007205,0.52],[0.92,1.036167,0.52],[0.96,1.065129,0.52],[1,1.094091,0.52],[0,0.3900478,0.56],[0.04,0.4190099,0.56],[0.08,0.447972,0.56],[0.12,0.4769341,0.56],[0.16,0.5058962,0.56],[0.2,0.5348583,0.56],[0.24,0.5638204,0.56],[0.28,0.5927826,0.56],[0.32,0.6217446,0.56],[0.36,0.6507068,0.56],[0.4,0.6796689,0.56],[0.44,0.708631,0.56],[0.48,0.7375931,0.56],[0.52,0.7665552,0.56],[0.56,0.7955173,0.56],[0.6,0.8244795,0.56],[0.64,0.8534415,0.56],[0.68,0.8824037,0.56],[0.72,0.9113657,0.56],[0.76,0.9403279,0.56],[0.8,0.96929,0.56],[0.84,0.9982521,0.56],[0.88,1.027214,0.56],[0.92,1.056176,0.56],[0.96,1.085138,0.56],[1,1.114101,0.56],[0,0.4100569,0.6],[0.04,0.439019,0.6],[0.08,0.4679811,0.6],[0.12,0.4969432,0.6],[0.16,0.5259054,0.6],[0.2,0.5548674,0.6],[0.24,0.5838296,0.6],[0.28,0.6127917,0.6],[0.32,0.6417538,0.6],[0.36,0.6707159,0.6],[0.4,0.699678,0.6],[0.44,0.7286401,0.6],[0.48,0.7576022,0.6],[0.52,0.7865644,0.6],[0.56,0.8155265,0.6],[0.6,0.8444886,0.6],[0.64,0.8734507,0.6],[0.68,0.9024128,0.6],[0.72,0.9313749,0.6],[0.76,0.960337,0.6],[0.8,0.9892991,0.6],[0.84,1.018261,0.6],[0.88,1.047223,0.6],[0.92,1.076185,0.6],[0.96,1.105148,0.6],[1,1.13411,0.6],[0,0.430066,0.64],[0.04,0.4590282,0.64],[0.08,0.4879903,0.64],[0.12,0.5169524,0.64],[0.16,0.5459145,0.64],[0.2,0.5748766,0.64],[0.24,0.6038387,0.64],[0.28,0.6328008,0.64],[0.32,0.661763,0.64],[0.36,0.690725,0.64],[0.4,0.7196872,0.64],[0.44,0.7486492,0.64],[0.48,0.7776114,0.64],[0.52,0.8065735,0.64],[0.56,0.8355356,0.64],[0.6,0.8644977,0.64],[0.64,0.8934598,0.64],[0.68,0.9224219,0.64],[0.72,0.9513841,0.64],[0.76,0.9803461,0.64],[0.8,1.009308,0.64],[0.84,1.03827,0.64],[0.88,1.067232,0.64],[0.92,1.096195,0.64],[0.96,1.125157,0.64],[1,1.154119,0.64],[0,0.4500752,0.68],[0.04,0.4790373,0.68],[0.08,0.5079994,0.68],[0.12,0.5369615,0.68],[0.16,0.5659236,0.68],[0.2,0.5948858,0.68],[0.24,0.6238478,0.68],[0.28,0.65281,0.68],[0.32,0.6817721,0.68],[0.36,0.7107342,0.68],[0.4,0.7396963,0.68],[0.44,0.7686584,0.68],[0.48,0.7976205,0.68],[0.52,0.8265826,0.68],[0.56,0.8555447,0.68],[0.6,0.8845068,0.68],[0.64,0.913469,0.68],[0.68,0.9424311,0.68],[0.72,0.9713932,0.68],[0.76,1.000355,0.68],[0.8,1.029317,0.68],[0.84,1.05828,0.68],[0.88,1.087242,0.68],[0.92,1.116204,0.68],[0.96,1.145166,0.68],[1,1.174128,0.68],[0,0.4700843,0.72],[0.04,0.4990464,0.72],[0.08,0.5280085,0.72],[0.12,0.5569707,0.72],[0.16,0.5859328,0.72],[0.2,0.6148949,0.72],[0.24,0.643857,0.72],[0.28,0.6728191,0.72],[0.32,0.7017812,0.72],[0.36,0.7307433,0.72],[0.4,0.7597054,0.72],[0.44,0.7886676,0.72],[0.48,0.8176296,0.72],[0.52,0.8465918,0.72],[0.56,0.8755538,0.72],[0.6,0.904516,0.72],[0.64,0.9334781,0.72],[0.68,0.9624402,0.72],[0.72,0.9914023,0.72],[0.76,1.020364,0.72],[0.8,1.049327,0.72],[0.84,1.078289,0.72],[0.88,1.107251,0.72],[0.92,1.136213,0.72],[0.96,1.165175,0.72],[1,1.194137,0.72],[0,0.4900935,0.76],[0.04,0.5190555,0.76],[0.08,0.5480177,0.76],[0.12,0.5769798,0.76],[0.16,0.6059419,0.76],[0.2,0.634904,0.76],[0.24,0.6638661,0.76],[0.28,0.6928282,0.76],[0.32,0.7217904,0.76],[0.36,0.7507524,0.76],[0.4,0.7797146,0.76],[0.44,0.8086767,0.76],[0.48,0.8376388,0.76],[0.52,0.8666009,0.76],[0.56,0.895563,0.76],[0.6,0.9245251,0.76],[0.64,0.9534872,0.76],[0.68,0.9824494,0.76],[0.72,1.011411,0.76],[0.76,1.040374,0.76],[0.8,1.069336,0.76],[0.84,1.098298,0.76],[0.88,1.12726,0.76],[0.92,1.156222,0.76],[0.96,1.185184,0.76],[1,1.214146,0.76],[0,0.5101026,0.8],[0.04,0.5390647,0.8],[0.08,0.5680268,0.8],[0.12,0.5969889,0.8],[0.16,0.6259511,0.8],[0.2,0.6549131,0.8],[0.24,0.6838753,0.8],[0.28,0.7128374,0.8],[0.32,0.7417995,0.8],[0.36,0.7707616,0.8],[0.4,0.7997237,0.8],[0.44,0.8286858,0.8],[0.48,0.857648,0.8],[0.52,0.88661,0.8],[0.56,0.9155722,0.8],[0.6,0.9445342,0.8],[0.64,0.9734964,0.8],[0.68,1.002458,0.8],[0.72,1.031421,0.8],[0.76,1.060383,0.8],[0.8,1.089345,0.8],[0.84,1.118307,0.8],[0.88,1.147269,0.8],[0.92,1.176231,0.8],[0.96,1.205193,0.8],[1,1.234155,0.8],[0,0.5301117,0.84],[0.04,0.5590739,0.84],[0.08,0.5880359,0.84],[0.12,0.6169981,0.84],[0.16,0.6459602,0.84],[0.2,0.6749223,0.84],[0.24,0.7038844,0.84],[0.28,0.7328465,0.84],[0.32,0.7618086,0.84],[0.36,0.7907707,0.84],[0.4,0.8197328,0.84],[0.44,0.848695,0.84],[0.48,0.8776571,0.84],[0.52,0.9066192,0.84],[0.56,0.9355813,0.84],[0.6,0.9645434,0.84],[0.64,0.9935055,0.84],[0.68,1.022468,0.84],[0.72,1.05143,0.84],[0.76,1.080392,0.84],[0.8,1.109354,0.84],[0.84,1.138316,0.84],[0.88,1.167278,0.84],[0.92,1.19624,0.84],[0.96,1.225202,0.84],[1,1.254164,0.84],[0,0.5501209,0.88],[0.04,0.579083,0.88],[0.08,0.6080451,0.88],[0.12,0.6370072,0.88],[0.16,0.6659693,0.88],[0.2,0.6949314,0.88],[0.24,0.7238935,0.88],[0.28,0.7528557,0.88],[0.32,0.7818177,0.88],[0.36,0.8107799,0.88],[0.4,0.839742,0.88],[0.44,0.8687041,0.88],[0.48,0.8976662,0.88],[0.52,0.9266283,0.88],[0.56,0.9555904,0.88],[0.6,0.9845526,0.88],[0.64,1.013515,0.88],[0.68,1.042477,0.88],[0.72,1.071439,0.88],[0.76,1.100401,0.88],[0.8,1.129363,0.88],[0.84,1.158325,0.88],[0.88,1.187287,0.88],[0.92,1.216249,0.88],[0.96,1.245211,0.88],[1,1.274174,0.88],[0,0.57013,0.92],[0.04,0.5990921,0.92],[0.08,0.6280543,0.92],[0.12,0.6570163,0.92],[0.16,0.6859785,0.92],[0.2,0.7149405,0.92],[0.24,0.7439027,0.92],[0.28,0.7728648,0.92],[0.32,0.8018269,0.92],[0.36,0.830789,0.92],[0.4,0.8597511,0.92],[0.44,0.8887132,0.92],[0.48,0.9176753,0.92],[0.52,0.9466375,0.92],[0.56,0.9755996,0.92],[0.6,1.004562,0.92],[0.64,1.033524,0.92],[0.68,1.062486,0.92],[0.72,1.091448,0.92],[0.76,1.12041,0.92],[0.8,1.149372,0.92],[0.84,1.178334,0.92],[0.88,1.207296,0.92],[0.92,1.236259,0.92],[0.96,1.265221,0.92],[1,1.294183,0.92],[0,0.5901392,0.96],[0.04,0.6191013,0.96],[0.08,0.6480634,0.96],[0.12,0.6770255,0.96],[0.16,0.7059876,0.96],[0.2,0.7349497,0.96],[0.24,0.7639118,0.96],[0.28,0.7928739,0.96],[0.32,0.8218361,0.96],[0.36,0.8507981,0.96],[0.4,0.8797603,0.96],[0.44,0.9087223,0.96],[0.48,0.9376845,0.96],[0.52,0.9666466,0.96],[0.56,0.9956087,0.96],[0.6,1.024571,0.96],[0.64,1.053533,0.96],[0.68,1.082495,0.96],[0.72,1.111457,0.96],[0.76,1.140419,0.96],[0.8,1.169381,0.96],[0.84,1.198344,0.96],[0.88,1.227306,0.96],[0.92,1.256268,0.96],[0.96,1.28523,0.96],[1,1.314192,0.96],[0,0.6101483,1],[0.04,0.6391104,1],[0.08,0.6680725,1],[0.12,0.6970346,1],[0.16,0.7259967,1],[0.2,0.7549589,1],[0.24,0.7839209,1],[0.28,0.8128831,1],[0.32,0.8418452,1],[0.36,0.8708073,1],[0.4,0.8997694,1],[0.44,0.9287315,1],[0.48,0.9576936,1],[0.52,0.9866557,1],[0.56,1.015618,1],[0.6,1.04458,1],[0.64,1.073542,1],[0.68,1.102504,1],[0.72,1.131466,1],[0.76,1.160428,1],[0.8,1.189391,1],[0.84,1.218353,1],[0.88,1.247315,1],[0.92,1.276277,1],[0.96,1.305239,1],[1,1.334201,1]],"colors":[[0,0,0,0.4980392]],"dim":[[26,26]],"centers":[[0.02,0.1344055,0.02],[0.06,0.1633676,0.02],[0.09999999,0.1923297,0.02],[0.14,0.2212918,0.02],[0.18,0.2502539,0.02],[0.22,0.279216,0.02],[0.26,0.3081781,0.02],[0.3,0.3371403,0.02],[0.34,0.3661023,0.02],[0.38,0.3950644,0.02],[0.42,0.4240266,0.02],[0.46,0.4529887,0.02],[0.5,0.4819508,0.02],[0.54,0.5109129,0.02],[0.58,0.539875,0.02],[0.62,0.5688371,0.02],[0.66,0.5977992,0.02],[0.7,0.6267614,0.02],[0.74,0.6557235,0.02],[0.78,0.6846856,0.02],[0.82,0.7136477,0.02],[0.86,0.7426098,0.02],[0.9,0.7715719,0.02],[0.94,0.800534,0.02],[0.98,0.8294961,0.02],[0.02,0.1544146,0.06],[0.06,0.1833767,0.06],[0.09999999,0.2123388,0.06],[0.14,0.2413009,0.06],[0.18,0.270263,0.06],[0.22,0.2992252,0.06],[0.26,0.3281873,0.06],[0.3,0.3571494,0.06],[0.34,0.3861115,0.06],[0.38,0.4150736,0.06],[0.42,0.4440357,0.06],[0.46,0.4729978,0.06],[0.5,0.5019599,0.06],[0.54,0.5309221,0.06],[0.58,0.5598841,0.06],[0.62,0.5888463,0.06],[0.66,0.6178084,0.06],[0.7,0.6467705,0.06],[0.74,0.6757326,0.06],[0.78,0.7046947,0.06],[0.82,0.7336568,0.06],[0.86,0.762619,0.06],[0.9,0.791581,0.06],[0.94,0.8205432,0.06],[0.98,0.8495053,0.06],[0.02,0.1744237,0.1],[0.06,0.2033858,0.1],[0.09999999,0.232348,0.1],[0.14,0.2613101,0.1],[0.18,0.2902722,0.1],[0.22,0.3192343,0.1],[0.26,0.3481964,0.1],[0.3,0.3771585,0.1],[0.34,0.4061206,0.1],[0.38,0.4350827,0.1],[0.42,0.4640449,0.1],[0.46,0.4930069,0.1],[0.5,0.5219691,0.1],[0.54,0.5509312,0.1],[0.58,0.5798933,0.1],[0.62,0.6088554,0.1],[0.66,0.6378176,0.1],[0.7,0.6667796,0.1],[0.74,0.6957417,0.1],[0.78,0.7247038,0.1],[0.82,0.7536659,0.1],[0.86,0.7826281,0.1],[0.9,0.8115902,0.1],[0.94,0.8405523,0.1],[0.98,0.8695144,0.1],[0.02,0.1944329,0.14],[0.06,0.223395,0.14],[0.09999999,0.2523571,0.14],[0.14,0.2813192,0.14],[0.18,0.3102813,0.14],[0.22,0.3392434,0.14],[0.26,0.3682055,0.14],[0.3,0.3971677,0.14],[0.34,0.4261298,0.14],[0.38,0.4550919,0.14],[0.42,0.484054,0.14],[0.46,0.5130161,0.14],[0.5,0.5419782,0.14],[0.54,0.5709403,0.14],[0.58,0.5999025,0.14],[0.62,0.6288645,0.14],[0.66,0.6578267,0.14],[0.7,0.6867887,0.14],[0.74,0.7157509,0.14],[0.78,0.744713,0.14],[0.82,0.7736751,0.14],[0.86,0.8026372,0.14],[0.9,0.8315992,0.14],[0.94,0.8605614,0.14],[0.98,0.8895235,0.14],[0.02,0.214442,0.18],[0.06,0.2434041,0.18],[0.09999999,0.2723662,0.18],[0.14,0.3013284,0.18],[0.18,0.3302904,0.18],[0.22,0.3592525,0.18],[0.26,0.3882147,0.18],[0.3,0.4171768,0.18],[0.34,0.4461389,0.18],[0.38,0.475101,0.18],[0.42,0.5040631,0.18],[0.46,0.5330252,0.18],[0.5,0.5619873,0.18],[0.54,0.5909495,0.18],[0.58,0.6199116,0.18],[0.62,0.6488737,0.18],[0.66,0.6778358,0.18],[0.7,0.706798,0.18],[0.74,0.73576,0.18],[0.78,0.7647221,0.18],[0.82,0.7936842,0.18],[0.86,0.8226463,0.18],[0.9,0.8516085,0.18],[0.94,0.8805706,0.18],[0.98,0.9095327,0.18],[0.02,0.2344511,0.22],[0.06,0.2634133,0.22],[0.09999999,0.2923754,0.22],[0.14,0.3213375,0.22],[0.18,0.3502996,0.22],[0.22,0.3792617,0.22],[0.26,0.4082238,0.22],[0.3,0.4371859,0.22],[0.34,0.466148,0.22],[0.38,0.4951102,0.22],[0.42,0.5240723,0.22],[0.46,0.5530344,0.22],[0.5,0.5819965,0.22],[0.54,0.6109586,0.22],[0.58,0.6399207,0.22],[0.62,0.6688828,0.22],[0.66,0.6978449,0.22],[0.7,0.7268071,0.22],[0.74,0.7557692,0.22],[0.78,0.7847313,0.22],[0.82,0.8136934,0.22],[0.86,0.8426555,0.22],[0.9,0.8716176,0.22],[0.94,0.9005797,0.22],[0.98,0.9295418,0.22],[0.02,0.2544603,0.26],[0.06,0.2834224,0.26],[0.09999999,0.3123845,0.26],[0.14,0.3413466,0.26],[0.18,0.3703087,0.26],[0.22,0.3992708,0.26],[0.26,0.428233,0.26],[0.3,0.4571951,0.26],[0.34,0.4861572,0.26],[0.38,0.5151193,0.26],[0.42,0.5440814,0.26],[0.46,0.5730435,0.26],[0.5,0.6020057,0.26],[0.54,0.6309677,0.26],[0.58,0.6599299,0.26],[0.62,0.6888919,0.26],[0.66,0.717854,0.26],[0.7,0.7468162,0.26],[0.74,0.7757783,0.26],[0.78,0.8047404,0.26],[0.82,0.8337025,0.26],[0.86,0.8626646,0.26],[0.9,0.8916268,0.26],[0.94,0.9205889,0.26],[0.98,0.949551,0.26],[0.02,0.2744694,0.3],[0.06,0.3034316,0.3],[0.09999999,0.3323936,0.3],[0.14,0.3613558,0.3],[0.18,0.3903179,0.3],[0.22,0.41928,0.3],[0.26,0.4482421,0.3],[0.3,0.4772042,0.3],[0.34,0.5061663,0.3],[0.38,0.5351284,0.3],[0.42,0.5640905,0.3],[0.46,0.5930526,0.3],[0.5,0.6220148,0.3],[0.54,0.6509769,0.3],[0.58,0.679939,0.3],[0.62,0.7089011,0.3],[0.66,0.7378632,0.3],[0.7,0.7668253,0.3],[0.74,0.7957873,0.3],[0.78,0.8247495,0.3],[0.82,0.8537116,0.3],[0.86,0.8826737,0.3],[0.9,0.9116359,0.3],[0.94,0.940598,0.3],[0.98,0.9695601,0.3],[0.02,0.2944786,0.34],[0.06,0.3234407,0.34],[0.09999999,0.3524028,0.34],[0.14,0.3813649,0.34],[0.18,0.410327,0.34],[0.22,0.4392892,0.34],[0.26,0.4682512,0.34],[0.3,0.4972133,0.34],[0.34,0.5261754,0.34],[0.38,0.5551376,0.34],[0.42,0.5840997,0.34],[0.46,0.6130618,0.34],[0.5,0.6420239,0.34],[0.54,0.670986,0.34],[0.58,0.6999481,0.34],[0.62,0.7289102,0.34],[0.66,0.7578723,0.34],[0.7,0.7868344,0.34],[0.74,0.8157966,0.34],[0.78,0.8447587,0.34],[0.82,0.8737208,0.34],[0.86,0.9026829,0.34],[0.9,0.9316449,0.34],[0.94,0.9606071,0.34],[0.98,0.9895692,0.34],[0.02,0.3144877,0.38],[0.06,0.3434498,0.38],[0.09999999,0.3724119,0.38],[0.14,0.401374,0.38],[0.18,0.4303362,0.38],[0.22,0.4592982,0.38],[0.26,0.4882604,0.38],[0.3,0.5172225,0.38],[0.34,0.5461846,0.38],[0.38,0.5751467,0.38],[0.42,0.6041088,0.38],[0.46,0.6330709,0.38],[0.5,0.662033,0.38],[0.54,0.6909952,0.38],[0.58,0.7199573,0.38],[0.62,0.7489194,0.38],[0.66,0.7778815,0.38],[0.7,0.8068436,0.38],[0.74,0.8358057,0.38],[0.78,0.8647678,0.38],[0.82,0.8937299,0.38],[0.86,0.922692,0.38],[0.9,0.9516541,0.38],[0.94,0.9806163,0.38],[0.98,1.009578,0.38],[0.02,0.3344969,0.42],[0.06,0.363459,0.42],[0.09999999,0.3924211,0.42],[0.14,0.4213832,0.42],[0.18,0.4503453,0.42],[0.22,0.4793074,0.42],[0.26,0.5082695,0.42],[0.3,0.5372316,0.42],[0.34,0.5661938,0.42],[0.38,0.5951558,0.42],[0.42,0.624118,0.42],[0.46,0.65308,0.42],[0.5,0.6820421,0.42],[0.54,0.7110043,0.42],[0.58,0.7399664,0.42],[0.62,0.7689285,0.42],[0.66,0.7978906,0.42],[0.7,0.8268527,0.42],[0.74,0.8558149,0.42],[0.78,0.8847769,0.42],[0.82,0.9137391,0.42],[0.86,0.9427012,0.42],[0.9,0.9716633,0.42],[0.94,1.000625,0.42],[0.98,1.029588,0.42],[0.02,0.354506,0.46],[0.06,0.3834681,0.46],[0.09999999,0.4124302,0.46],[0.14,0.4413923,0.46],[0.18,0.4703544,0.46],[0.22,0.4993165,0.46],[0.26,0.5282786,0.46],[0.3,0.5572408,0.46],[0.34,0.5862029,0.46],[0.38,0.615165,0.46],[0.42,0.6441271,0.46],[0.46,0.6730892,0.46],[0.5,0.7020513,0.46],[0.54,0.7310134,0.46],[0.58,0.7599756,0.46],[0.62,0.7889376,0.46],[0.66,0.8178997,0.46],[0.7,0.8468618,0.46],[0.74,0.875824,0.46],[0.78,0.9047861,0.46],[0.82,0.9337482,0.46],[0.86,0.9627103,0.46],[0.9,0.9916724,0.46],[0.94,1.020635,0.46],[0.98,1.049597,0.46],[0.02,0.3745151,0.5],[0.06,0.4034773,0.5],[0.09999999,0.4324393,0.5],[0.14,0.4614015,0.5],[0.18,0.4903636,0.5],[0.22,0.5193257,0.5],[0.26,0.5482878,0.5],[0.3,0.5772499,0.5],[0.34,0.606212,0.5],[0.38,0.6351741,0.5],[0.42,0.6641362,0.5],[0.46,0.6930984,0.5],[0.5,0.7220604,0.5],[0.54,0.7510226,0.5],[0.58,0.7799847,0.5],[0.62,0.8089468,0.5],[0.66,0.8379089,0.5],[0.7,0.866871,0.5],[0.74,0.8958331,0.5],[0.78,0.9247952,0.5],[0.82,0.9537573,0.5],[0.86,0.9827194,0.5],[0.9,1.011682,0.5],[0.94,1.040644,0.5],[0.98,1.069606,0.5],[0.02,0.3945243,0.54],[0.06,0.4234864,0.54],[0.09999999,0.4524485,0.54],[0.14,0.4814106,0.54],[0.18,0.5103727,0.54],[0.22,0.5393348,0.54],[0.26,0.5682969,0.54],[0.3,0.597259,0.54],[0.34,0.6262211,0.54],[0.38,0.6551833,0.54],[0.42,0.6841454,0.54],[0.46,0.7131075,0.54],[0.5,0.7420696,0.54],[0.54,0.7710317,0.54],[0.58,0.7999939,0.54],[0.62,0.8289559,0.54],[0.66,0.857918,0.54],[0.7,0.8868802,0.54],[0.74,0.9158422,0.54],[0.78,0.9448044,0.54],[0.82,0.9737665,0.54],[0.86,1.002729,0.54],[0.9,1.031691,0.54],[0.94,1.060653,0.54],[0.98,1.089615,0.54],[0.02,0.4145334,0.58],[0.06,0.4434955,0.58],[0.09999999,0.4724576,0.58],[0.14,0.5014197,0.58],[0.18,0.5303819,0.58],[0.22,0.559344,0.58],[0.26,0.5883061,0.58],[0.3,0.6172681,0.58],[0.34,0.6462303,0.58],[0.38,0.6751924,0.58],[0.42,0.7041545,0.58],[0.46,0.7331166,0.58],[0.5,0.7620787,0.58],[0.54,0.7910408,0.58],[0.58,0.820003,0.58],[0.62,0.8489651,0.58],[0.66,0.8779272,0.58],[0.7,0.9068893,0.58],[0.74,0.9358514,0.58],[0.78,0.9648135,0.58],[0.82,0.9937756,0.58],[0.86,1.022738,0.58],[0.9,1.0517,0.58],[0.94,1.080662,0.58],[0.98,1.109624,0.58],[0.02,0.4345425,0.62],[0.06,0.4635046,0.62],[0.09999999,0.4924667,0.62],[0.14,0.5214289,0.62],[0.18,0.550391,0.62],[0.22,0.5793531,0.62],[0.26,0.6083152,0.62],[0.3,0.6372773,0.62],[0.34,0.6662394,0.62],[0.38,0.6952016,0.62],[0.42,0.7241637,0.62],[0.46,0.7531257,0.62],[0.5,0.7820878,0.62],[0.54,0.8110499,0.62],[0.58,0.8400121,0.62],[0.62,0.8689742,0.62],[0.66,0.8979363,0.62],[0.7,0.9268984,0.62],[0.74,0.9558606,0.62],[0.78,0.9848226,0.62],[0.82,1.013785,0.62],[0.86,1.042747,0.62],[0.9,1.071709,0.62],[0.94,1.100671,0.62],[0.98,1.129633,0.62],[0.02,0.4545517,0.66],[0.06,0.4835138,0.66],[0.09999999,0.5124759,0.66],[0.14,0.541438,0.66],[0.18,0.5704001,0.66],[0.22,0.5993623,0.66],[0.26,0.6283243,0.66],[0.3,0.6572865,0.66],[0.34,0.6862485,0.66],[0.38,0.7152107,0.66],[0.42,0.7441728,0.66],[0.46,0.7731349,0.66],[0.5,0.802097,0.66],[0.54,0.8310592,0.66],[0.58,0.8600212,0.66],[0.62,0.8889832,0.66],[0.66,0.9179454,0.66],[0.7,0.9469075,0.66],[0.74,0.9758697,0.66],[0.78,1.004832,0.66],[0.82,1.033794,0.66],[0.86,1.062756,0.66],[0.9,1.091718,0.66],[0.94,1.12068,0.66],[0.98,1.149642,0.66],[0.02,0.4745608,0.7],[0.06,0.5035229,0.7],[0.09999999,0.532485,0.7],[0.14,0.5614471,0.7],[0.18,0.5904093,0.7],[0.22,0.6193714,0.7],[0.26,0.6483335,0.7],[0.3,0.6772956,0.7],[0.34,0.7062577,0.7],[0.38,0.7352198,0.7],[0.42,0.764182,0.7],[0.46,0.793144,0.7],[0.5,0.8221061,0.7],[0.54,0.8510683,0.7],[0.58,0.8800303,0.7],[0.62,0.9089925,0.7],[0.66,0.9379546,0.7],[0.7,0.9669167,0.7],[0.74,0.9958788,0.7],[0.78,1.024841,0.7],[0.82,1.053803,0.7],[0.86,1.082765,0.7],[0.9,1.111727,0.7],[0.94,1.140689,0.7],[0.98,1.169652,0.7],[0.02,0.49457,0.74],[0.06,0.5235321,0.74],[0.09999999,0.5524942,0.74],[0.14,0.5814563,0.74],[0.18,0.6104184,0.74],[0.22,0.6393805,0.74],[0.26,0.6683426,0.74],[0.3,0.6973047,0.74],[0.34,0.7262669,0.74],[0.38,0.7552289,0.74],[0.42,0.7841911,0.74],[0.46,0.8131532,0.74],[0.5,0.8421153,0.74],[0.54,0.8710774,0.74],[0.58,0.9000396,0.74],[0.62,0.9290016,0.74],[0.66,0.9579637,0.74],[0.7,0.9869258,0.74],[0.74,1.015888,0.74],[0.78,1.04485,0.74],[0.82,1.073812,0.74],[0.86,1.102774,0.74],[0.9,1.131736,0.74],[0.94,1.160698,0.74],[0.98,1.189661,0.74],[0.02,0.5145791,0.78],[0.06,0.5435412,0.78],[0.09999999,0.5725033,0.78],[0.14,0.6014654,0.78],[0.18,0.6304275,0.78],[0.22,0.6593897,0.78],[0.26,0.6883518,0.78],[0.3,0.7173139,0.78],[0.34,0.7462759,0.78],[0.38,0.775238,0.78],[0.42,0.8042002,0.78],[0.46,0.8331623,0.78],[0.5,0.8621244,0.78],[0.54,0.8910865,0.78],[0.58,0.9200487,0.78],[0.62,0.9490108,0.78],[0.66,0.9779729,0.78],[0.7,1.006935,0.78],[0.74,1.035897,0.78],[0.78,1.064859,0.78],[0.82,1.093821,0.78],[0.86,1.122783,0.78],[0.9,1.151746,0.78],[0.94,1.180708,0.78],[0.98,1.20967,0.78],[0.02,0.5345882,0.82],[0.06,0.5635504,0.82],[0.09999999,0.5925124,0.82],[0.14,0.6214746,0.82],[0.18,0.6504366,0.82],[0.22,0.6793988,0.82],[0.26,0.7083609,0.82],[0.3,0.737323,0.82],[0.34,0.7662851,0.82],[0.38,0.7952473,0.82],[0.42,0.8242093,0.82],[0.46,0.8531715,0.82],[0.5,0.8821335,0.82],[0.54,0.9110956,0.82],[0.58,0.9400578,0.82],[0.62,0.9690199,0.82],[0.66,0.997982,0.82],[0.7,1.026944,0.82],[0.74,1.055906,0.82],[0.78,1.084868,0.82],[0.82,1.11383,0.82],[0.86,1.142793,0.82],[0.9,1.171755,0.82],[0.94,1.200717,0.82],[0.98,1.229679,0.82],[0.02,0.5545974,0.86],[0.06,0.5835595,0.86],[0.09999999,0.6125216,0.86],[0.14,0.6414837,0.86],[0.18,0.6704458,0.86],[0.22,0.6994079,0.86],[0.26,0.7283701,0.86],[0.3,0.7573321,0.86],[0.34,0.7862942,0.86],[0.38,0.8152564,0.86],[0.42,0.8442185,0.86],[0.46,0.8731806,0.86],[0.5,0.9021427,0.86],[0.54,0.9311048,0.86],[0.58,0.9600669,0.86],[0.62,0.989029,0.86],[0.66,1.017991,0.86],[0.7,1.046953,0.86],[0.74,1.075915,0.86],[0.78,1.104877,0.86],[0.82,1.13384,0.86],[0.86,1.162802,0.86],[0.9,1.191764,0.86],[0.94,1.220726,0.86],[0.98,1.249688,0.86],[0.02,0.5746065,0.9],[0.06,0.6035686,0.9],[0.09999999,0.6325307,0.9],[0.14,0.6614928,0.9],[0.18,0.690455,0.9],[0.22,0.719417,0.9],[0.26,0.7483792,0.9],[0.3,0.7773413,0.9],[0.34,0.8063034,0.9],[0.38,0.8352655,0.9],[0.42,0.8642277,0.9],[0.46,0.8931897,0.9],[0.5,0.9221518,0.9],[0.54,0.9511139,0.9],[0.58,0.9800761,0.9],[0.62,1.009038,0.9],[0.66,1.038,0.9],[0.7,1.066962,0.9],[0.74,1.095924,0.9],[0.78,1.124887,0.9],[0.82,1.153849,0.9],[0.86,1.182811,0.9],[0.9,1.211773,0.9],[0.94,1.240735,0.9],[0.98,1.269697,0.9],[0.02,0.5946156,0.94],[0.06,0.6235778,0.94],[0.09999999,0.6525399,0.94],[0.14,0.681502,0.94],[0.18,0.710464,0.94],[0.22,0.7394261,0.94],[0.26,0.7683883,0.94],[0.3,0.7973504,0.94],[0.34,0.8263125,0.94],[0.38,0.8552746,0.94],[0.42,0.8842368,0.94],[0.46,0.9131989,0.94],[0.5,0.942161,0.94],[0.54,0.9711231,0.94],[0.58,1.000085,0.94],[0.62,1.029047,0.94],[0.66,1.058009,0.94],[0.7,1.086972,0.94],[0.74,1.115934,0.94],[0.78,1.144896,0.94],[0.82,1.173858,0.94],[0.86,1.20282,0.94],[0.9,1.231782,0.94],[0.94,1.260744,0.94],[0.98,1.289706,0.94],[0.02,0.6146248,0.98],[0.06,0.6435869,0.98],[0.09999999,0.672549,0.98],[0.14,0.7015111,0.98],[0.18,0.7304732,0.98],[0.22,0.7594354,0.98],[0.26,0.7883975,0.98],[0.3,0.8173596,0.98],[0.34,0.8463216,0.98],[0.38,0.8752837,0.98],[0.42,0.9042459,0.98],[0.46,0.933208,0.98],[0.5,0.9621701,0.98],[0.54,0.9911322,0.98],[0.58,1.020094,0.98],[0.62,1.049057,0.98],[0.66,1.078019,0.98],[0.7,1.106981,0.98],[0.74,1.135943,0.98],[0.78,1.164905,0.98],[0.82,1.193867,0.98],[0.86,1.222829,0.98],[0.9,1.251791,0.98],[0.94,1.280753,0.98],[0.98,1.309716,0.98]],"ignoreExtent":false,"flags":42},"41":{"id":41,"type":"lines","material":{"lit":false},"vertices":[[0.5078571,0.735,0.3996939],[0.5078571,0.6775734,0.3996939],[0.4471429,0.73875,0.8598299],[0.4471429,0.8637863,0.8598299],[0.4835714,0.6675,0.294932],[0.4835714,0.6075844,0.294932],[0.3871429,0.585,0.2811224],[0.3871429,0.5308571,0.2811224],[0.6157143,0.79375,0.2654082],[0.6157143,0.6884942,0.2654082],[0.6885715,0.845,0.3547619],[0.6885715,0.7859439,0.3547619],[0.6492857,0.7825,0.2604762],[0.6492857,0.7103345,0.2604762],[0.6742857,0.85125,0.4613265],[0.6742857,0.828907,0.4613265],[0.6085714,0.78875,0.3665646],[0.6085714,0.7339237,0.3665646],[0.6171429,0.735,0.3545238],[0.6171429,0.7341067,0.3545238],[0.4564286,0.65,0.1803401],[0.4564286,0.5306095,0.1803401],[0.45,0.625,0.2196939],[0.45,0.5456407,0.2196939],[0.5592857,0.5475,0.2661565],[0.5592857,0.6480113,0.2661565],[0.6028572,0.6525,0.2533673],[0.6028572,0.6731618,0.2533673],[0.5971429,0.81125,0.2314626],[0.5971429,0.6580669,0.2314626],[0.5864286,0.56375,0.195102],[0.5864286,0.6321207,0.195102],[0.6978571,0.90375,0.6347959],[0.6978571,0.9327482,0.6347959],[0.5821428,0.60125,0.187483],[0.5821428,0.6252063,0.187483],[0.6585714,0.60375,0.3058844],[0.6585714,0.7397724,0.3058844],[0.6071429,0.785,0.1389796],[0.6071429,0.6190448,0.1389796],[0.7121429,0.9325,0.4040816],[0.7121429,0.827682,0.4040816],[0.5442857,0.62,0.1717007],[0.5442857,0.589901,0.1717007],[0.6485714,0.70125,0.2528571],[0.6485714,0.7060061,0.2528571],[0.7114286,0.965,0.8404081],[0.7114286,1.045428,0.8404081],[0.71,0.70875,0.4747619],[0.71,0.8614867,0.4747619],[0.6221429,0.73,0.5747619],[0.6221429,0.8478963,0.5747619],[0.4614286,0.68375,0.1365306],[0.4614286,0.512315,0.1365306],[0.2464286,0.31125,0.09812925],[0.2464286,0.3374342,0.09812925],[0.5442857,0.77625,0.1527891],[0.5442857,0.5804409,0.1527891],[0.6578571,0.74125,0.3344218],[0.6578571,0.7535304,0.3344218],[0.485,0.71875,0.1557823],[0.485,0.5390122,0.1557823],[0.3635714,0.59,0.1903742],[0.3635714,0.4683953,0.1903742],[0.4792857,0.595,0.2368027],[0.4792857,0.5754035,0.2368027],[0.3885714,0.55125,0.2587075],[0.3885714,0.5206789,0.2587075],[0.3992857,0.45,0.1168707],[0.3992857,0.4574858,0.1168707],[0.3921429,0.39875,0.08666667],[0.3921429,0.4372051,0.08666667],[0.38,0.4925,0.127483],[0.38,0.4488305,0.127483],[0.3314286,0.40375,0.06285714],[0.3314286,0.3813345,0.06285714],[0.3828571,0.47125,0.1268708],[0.3828571,0.450593,0.1268708],[0.2264286,0.26125,0.1415306],[0.2264286,0.3446637,0.1415306],[0.435,0.28375,0.08217687],[0.435,0.46599,0.08217687],[0.36,0.35875,0.07826531],[0.36,0.4097294,0.07826531],[0.23,0.32625,0.1670408],[0.23,0.3600105,0.1670408],[0.2907143,0.34,0.1067687],[0.2907143,0.3738211,0.1067687],[0.3221429,0.35125,0.08710884],[0.3221429,0.3867426,0.08710884],[0.3714286,0.2425,0.1408503],[0.3714286,0.4493111,0.1408503],[0.3664286,0.51375,0.1514286],[0.3664286,0.4509823,0.1514286],[0.3878571,0.32125,0.192483],[0.3878571,0.4870344,0.192483],[0.3571429,0.32,0.1181973],[0.3571429,0.4276358,0.1181973],[0.2742857,0.39375,0.2340816],[0.2742857,0.4256115,0.2340816],[0.3664286,0.3775,0.2782313],[0.3664286,0.5144126,0.2782313],[0.2892857,0.20625,0.06782313],[0.2892857,0.353305,0.06782313],[0.2585714,0.06,0.01081633],[0.2585714,0.3025498,0.01081633],[0.2807143,0.16625,0.06020408],[0.2807143,0.3432876,0.06020408],[0.4,0.46625,0.2561565],[0.4,0.5276777,0.2561565],[0.3635714,0.46375,0.217415],[0.3635714,0.4819219,0.217415],[0.3592857,0.51375,0.2502041],[0.3592857,0.4952208,0.2502041],[0.2478571,0.41875,0.2821428],[0.2478571,0.4305174,0.2821428],[0.3521429,0.52,0.2820068],[0.3521429,0.5059577,0.2820068],[0.1242857,0.24625,0.08557823],[0.1242857,0.2427179,0.08557823],[0.1785714,0.1275,0.1132653],[0.1785714,0.2958735,0.1132653],[0.3264286,0.56125,0.2472449],[0.3264286,0.4699503,0.2472449],[0.2471429,0.19875,0.0003741496],[0.2471429,0.2890515,0.0003741496],[0.095,0.135,0.08163265],[0.095,0.2195398,0.08163265],[0.07928571,0.09125,0.09768707],[0.07928571,0.2161927,0.09768707],[0.1128571,0.12625,0.1014286],[0.1128571,0.2423718,0.1014286],[0.06,0.42625,0.1035034],[0.06,0.2051384,0.1035034],[0.1857143,0.14375,0.03591837],[0.1857143,0.2623542,0.03591837],[0.2057143,0.31625,0.2129252],[0.2057143,0.3653791,0.2129252],[0.11,0.36125,0.122415],[0.11,0.2508011,0.122415],[0.1171429,0.19,0.1542177],[0.1171429,0.2718815,0.1542177],[0.1171429,0.31,0.1542177],[0.1171429,0.2718815,0.1542177],[0.1014286,0.165,0.04387755],[0.1014286,0.2053083,0.04387755],[0.04928571,0.29125,0.1307143],[0.04928571,0.2109923,0.1307143],[0.05285714,0.235,0.09812925],[0.05285714,0.1972782,0.09812925],[0.2921429,0.40625,0.2531633],[0.2921429,0.4480861,0.2531633],[0.2007143,0.4275,0.2070068],[0.2007143,0.3587983,0.2070068],[0.1714286,0.32375,0.2028912],[0.1714286,0.3355351,0.2028912],[0.1371429,0.3975,0.199898],[0.1371429,0.3092132,0.199898],[0.1735714,0.32375,0.1772449],[0.1735714,0.3242576,0.1772449],[0.1985714,0.42125,0.2031633],[0.1985714,0.3553241,0.2031633],[0.1971429,0.51,0.1136735],[0.1971429,0.3095244,0.1136735],[0.3064286,0.34,0.164932],[0.3064286,0.4142939,0.164932],[0.02714286,0.2275,0.07642857],[0.02714286,0.1678044,0.07642857],[0.15,0.35125,0.1767007],[0.15,0.3069185,0.1767007],[0.2928571,0.50375,0.2420408],[0.2928571,0.4430396,0.2420408],[0.04785714,0.21625,0.1393197],[0.04785714,0.2142626,0.1393197],[0.2178571,0.38625,0.262449],[0.2178571,0.3989443,0.262449],[0.2807143,0.5025,0.2226871],[0.2807143,0.4245662,0.2226871],[0.16,0.51375,0.2816327],[0.16,0.3666489,0.2816327],[0.06571428,0.36125,0.1598299],[0.06571428,0.2374519,0.1598299],[0.04285714,0.3275,0.1822789],[0.04285714,0.2321318,0.1822789],[0.1292857,0.24875,0.1343197],[0.1292857,0.2707201,0.1343197],[0.1664286,0.41125,0.2152381],[0.1664286,0.3380911,0.2152381],[0.1085714,0.20625,0.112585],[0.1085714,0.2448495,0.112585],[0.4478571,0.70125,0.4568707],[0.4478571,0.6627318,0.4568707],[0.1778571,0.48625,0.2804422],[0.1778571,0.378983,0.2804422],[0.1128571,0.32375,0.1687755],[0.1128571,0.2760607,0.1687755],[0.1378571,0.18875,0.1232653],[0.1378571,0.2713965,0.1232653],[0.1692857,0.20125,0.1412585],[0.1692857,0.3031532,0.1412585],[0.2857143,0.4025,0.1993878],[0.2857143,0.4165315,0.1993878],[0.1821429,0.315,0.102619],[0.1821429,0.2931339,0.102619]],"colors":[[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[0,1,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[1,0,1,1],[0,1,1,1],[0,1,1,1]],"centers":[[0.5078571,0.7062867,0.3996939],[0.4471429,0.8012681,0.8598299],[0.4835714,0.6375422,0.294932],[0.3871429,0.5579286,0.2811224],[0.6157143,0.7411221,0.2654082],[0.6885715,0.8154719,0.3547619],[0.6492857,0.7464173,0.2604762],[0.6742857,0.8400785,0.4613265],[0.6085714,0.7613369,0.3665646],[0.6171429,0.7345533,0.3545238],[0.4564286,0.5903047,0.1803401],[0.45,0.5853204,0.2196939],[0.5592857,0.5977557,0.2661565],[0.6028572,0.6628309,0.2533673],[0.5971429,0.7346585,0.2314626],[0.5864286,0.5979353,0.195102],[0.6978571,0.9182491,0.6347959],[0.5821428,0.6132281,0.187483],[0.6585714,0.6717612,0.3058844],[0.6071429,0.7020224,0.1389796],[0.7121429,0.880091,0.4040816],[0.5442857,0.6049505,0.1717007],[0.6485714,0.7036281,0.2528571],[0.7114286,1.005214,0.8404081],[0.71,0.7851183,0.4747619],[0.6221429,0.7889482,0.5747619],[0.4614286,0.5980325,0.1365306],[0.2464286,0.3243421,0.09812925],[0.5442857,0.6783454,0.1527891],[0.6578571,0.7473902,0.3344218],[0.485,0.6288811,0.1557823],[0.3635714,0.5291976,0.1903742],[0.4792857,0.5852017,0.2368027],[0.3885714,0.5359644,0.2587075],[0.3992857,0.4537429,0.1168707],[0.3921429,0.4179776,0.08666667],[0.38,0.4706653,0.127483],[0.3314286,0.3925423,0.06285714],[0.3828571,0.4609215,0.1268708],[0.2264286,0.3029568,0.1415306],[0.435,0.37487,0.08217687],[0.36,0.3842397,0.07826531],[0.23,0.3431303,0.1670408],[0.2907143,0.3569105,0.1067687],[0.3221429,0.3689963,0.08710884],[0.3714286,0.3459055,0.1408503],[0.3664286,0.4823662,0.1514286],[0.3878571,0.4041422,0.192483],[0.3571429,0.3738179,0.1181973],[0.2742857,0.4096807,0.2340816],[0.3664286,0.4459563,0.2782313],[0.2892857,0.2797775,0.06782313],[0.2585714,0.1812749,0.01081633],[0.2807143,0.2547688,0.06020408],[0.4,0.4969639,0.2561565],[0.3635714,0.472836,0.217415],[0.3592857,0.5044854,0.2502041],[0.2478571,0.4246337,0.2821428],[0.3521429,0.5129788,0.2820068],[0.1242857,0.244484,0.08557823],[0.1785714,0.2116867,0.1132653],[0.3264286,0.5156001,0.2472449],[0.2471429,0.2439007,0.0003741496],[0.095,0.1772699,0.08163265],[0.07928571,0.1537214,0.09768707],[0.1128571,0.1843109,0.1014286],[0.06,0.3156942,0.1035034],[0.1857143,0.2030521,0.03591837],[0.2057143,0.3408145,0.2129252],[0.11,0.3060256,0.122415],[0.1171429,0.2309408,0.1542177],[0.1171429,0.2909408,0.1542177],[0.1014286,0.1851541,0.04387755],[0.04928571,0.2511212,0.1307143],[0.05285714,0.2161391,0.09812925],[0.2921429,0.4271681,0.2531633],[0.2007143,0.3931491,0.2070068],[0.1714286,0.3296425,0.2028912],[0.1371429,0.3533566,0.199898],[0.1735714,0.3240038,0.1772449],[0.1985714,0.388287,0.2031633],[0.1971429,0.4097622,0.1136735],[0.3064286,0.377147,0.164932],[0.02714286,0.1976522,0.07642857],[0.15,0.3290842,0.1767007],[0.2928571,0.4733948,0.2420408],[0.04785714,0.2152563,0.1393197],[0.2178571,0.3925972,0.262449],[0.2807143,0.4635331,0.2226871],[0.16,0.4401995,0.2816327],[0.06571428,0.299351,0.1598299],[0.04285714,0.2798159,0.1822789],[0.1292857,0.259735,0.1343197],[0.1664286,0.3746706,0.2152381],[0.1085714,0.2255498,0.112585],[0.4478571,0.6819909,0.4568707],[0.1778571,0.4326165,0.2804422],[0.1128571,0.2999053,0.1687755],[0.1378571,0.2300732,0.1232653],[0.1692857,0.2522016,0.1412585],[0.2857143,0.4095157,0.1993878],[0.1821429,0.3040669,0.102619]],"ignoreExtent":false,"flags":64},"5":{"id":5,"reuse":"unnamed_chunk_151div"},"9":{"id":9,"reuse":"unnamed_chunk_151div"},"25":{"id":25,"type":"background","material":{"back":"lines"},"colors":[[1,1,1,1]],"centers":[[0,0,0]],"sphere":false,"fogtype":"exp2","flags":0},"1":{"id":1,"type":"subscene","par3d":{"antialias":1,"FOV":60,"ignoreExtent":false,"listeners":1,"mouseMode":{"left":"trackball","right":"zoom","middle":"fov","wheel":"pull"},"observer":[0,0,2.064445],"modelMatrix":[[1,0,0,-0.475],[0,0.9659258,-0.258819,-0.4731343],[0,0.258819,0.9659258,-2.682977],[0,0,0,1]],"projMatrix":[[1.237179,0,0,0],[0,1.732051,0,0],[0,0,-2,-3.096668],[0,0,-1,0]],"skipRedraw":false,"userMatrix":[[1,0,0,0],[0,0.9659258,-0.258819,0],[0,0.258819,0.9659258,0],[0,0,0,1]],"userProjection":[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],"scale":[1,1,1],"viewport":{"x":0,"y":0,"width":1,"height":1},"zoom":1,"bbox":[-0.05,1,-0.1,1.334201,-0.05,1],"windowRect":[100,100,772,580],"family":"sans","font":1,"cex":1,"useFreeType":false,"fontname":"NULL","maxClipPlanes":2147483647,"glVersion":"NaN","activeSubscene":0},"embeddings":{"viewport":"replace","projection":"replace","model":"replace","mouse":"replace"},"objects":[25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,5],"subscenes":[],"flags":2683}},"width":673,"height":481,"sphereVerts":{"reuse":"unnamed_chunk_151div"},"context":{"shiny":false,"rmarkdown":null},"crosstalk":{"key":[],"group":[],"id":[],"options":[]}});
unnamed_chunk_154rgl.prefix = "unnamed_chunk_154";
</script>
<p id="unnamed_chunk_154debug">
You must enable Javascript to view this page properly.
</p>
<script>unnamed_chunk_154rgl.start();</script>
<p>Again, try dragging the graph around. (By default <code>scatter3d</code> fits the same model we did.) The dataset was a cloud of data points and <code>lm</code> has fitted a plane to it, minimising the RSS.</p>
<p>Here are the coefficients, rounded to one decimal place; how do we interpret them…?</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="linear-regression.html#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod_both) <span class="sc">%&gt;%</span></span>
<span id="cb217-2"><a href="linear-regression.html#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>##  (Intercept)    education income_1000s 
##         -6.8          4.1          1.4</code></pre>
<p>Firstly, the intercept is useless again as it is outside the range of valid values for prestige. It represents the level of prestige for occupations with an average zero years of education and zero income. We will deal with it later, but it’s not uncommon just to ignore intercepts when interpreting model fits.</p>
<p>The coefficient for education is 4.1. The interpretation for this is: every year extra education is associated with 4.1 more prestige points, <em>whilst holding income constant</em>.</p>
<p>Similarly for income: an increase in income by $1000 is associated with 1.4 more prestige points, whilst holding education constant.</p>
<p>This demonstrates one of the advantages of a multiple regression model; the predictors now indicate the unique contribution of a predictor <em>whilst holding the other predictors constant</em>, assuming that the model is correct.</p>
<p>We also now have a formula for predicting the mean level of prestige given education and income, which we could apply to other occupations not present in the data (from the same year and country…) to see how well the model works.</p>
<p>The formula is:</p>
<p><span class="math display">\[
\mathtt{prestige} = -6.8 + 4.1 \times \mathtt{education} + 1.4 \times \mathtt{income\_1000s}
\]</span></p>
</div>
<div id="optional-that-pesky-negative-intercept" class="section level2 tabset" number="5.12">
<h2><span class="header-section-number">5.12</span> Optional: that pesky negative intercept</h2>
<p>I’ve complained a couple of times about the intercept. If you really want it to take on a meaningful value, one easy solution which provides the same slope estimates, is simply to shift the predictor variables so that zero represents a value actually present in the data. We can do that by mean-centring the predictors, that is, shifting them so that zero is now the mean.</p>
<p>There’s a command called <code>scale</code> that does this for us, but it is easy to do it “by hand” too. Simply subtract the mean from each value.</p>
<p>I’m going to add two variables, <code>education_c</code> and <code>income_1000s_c</code>, which represent mean centred <code>education</code> and <code>income</code>, and then save the result in a new data frame called <code>dat_centred</code>.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="linear-regression.html#cb219-1" aria-hidden="true" tabindex="-1"></a>dat_centred <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="linear-regression.html#cb219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">education_c    =</span> education <span class="sc">-</span> <span class="fu">mean</span>(education),</span>
<span id="cb219-3"><a href="linear-regression.html#cb219-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">income_1000s_c =</span> income_1000s <span class="sc">-</span> <span class="fu">mean</span>(income_1000s))</span></code></pre></div>
<p>Let’s compare the centred and uncentred variables:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="linear-regression.html#cb220-1" aria-hidden="true" tabindex="-1"></a>dat_centred <span class="sc">%&gt;%</span></span>
<span id="cb220-2"><a href="linear-regression.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(education, education_c, income_1000s, income_1000s_c) <span class="sc">%&gt;%</span></span>
<span id="cb220-3"><a href="linear-regression.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">CreateTableOne</span>(<span class="at">data =</span> .)</span></code></pre></div>
<pre><code>##                             
##                              Overall     
##   n                            102       
##   education (mean (SD))      10.74 (2.73)
##   education_c (mean (SD))     0.00 (2.73)
##   income_1000s (mean (SD))    6.80 (4.25)
##   income_1000s_c (mean (SD))  0.00 (4.25)</code></pre>
<p>As you can see, they have the same SDs. The centred variables both have mean zero, as desired.</p>
<p>Here’s a picture of all pairwise scatterplots:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb222-1"><a href="linear-regression.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;GGally&#39;:
##   method from   
##   +.gg   ggplot2</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb224-1"><a href="linear-regression.html#cb224-1" aria-hidden="true" tabindex="-1"></a>dat_centred <span class="sc">%&gt;%</span></span>
<span id="cb224-2"><a href="linear-regression.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(prestige,</span>
<span id="cb224-3"><a href="linear-regression.html#cb224-3" aria-hidden="true" tabindex="-1"></a>         education, education_c,</span>
<span id="cb224-4"><a href="linear-regression.html#cb224-4" aria-hidden="true" tabindex="-1"></a>         income_1000s, income_1000s_c) <span class="sc">%&gt;%</span></span>
<span id="cb224-5"><a href="linear-regression.html#cb224-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="st">&quot;blank&quot;</span>, <span class="at">progress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-158-1.png" width="768" /></p>
<p>Spend some time with a cup of tea or two to persuade yourself that centring hasn’t affected relationships between key variables, it has just shifted the centred ones so they have a mean of zero.</p>
<div id="activity-17" class="section level3" number="5.12.1">
<h3><span class="header-section-number">5.12.1</span> Activity</h3>
<p>Now fit the model again, using prestige as the outcome variable before but now the centred versions of education and income. What does the intercept represent now?</p>
</div>
<div id="answer-20" class="section level3" number="5.12.2">
<h3><span class="header-section-number">5.12.2</span> Answer</h3>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="linear-regression.html#cb225-1" aria-hidden="true" tabindex="-1"></a>mod_centred <span class="ot">&lt;-</span> <span class="fu">lm</span>(prestige <span class="sc">~</span> education_c <span class="sc">+</span> income_1000s_c,</span>
<span id="cb225-2"><a href="linear-regression.html#cb225-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data =</span> dat_centred)</span>
<span id="cb225-3"><a href="linear-regression.html#cb225-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_centred)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = prestige ~ education_c + income_1000s_c, data = dat_centred)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -19.4040  -5.3308   0.0154   4.9803  17.6889 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     46.8333     0.7733  60.561  &lt; 2e-16 ***
## education_c      4.1374     0.3489  11.858  &lt; 2e-16 ***
## income_1000s_c   1.3612     0.2242   6.071 2.36e-08 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 7.81 on 99 degrees of freedom
## Multiple R-squared:  0.798,  Adjusted R-squared:  0.7939 
## F-statistic: 195.6 on 2 and 99 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>As the table below shows, the slope estimates are identical for the two models. However, now the intercept is interpretable and gives the mean prestige at mean education and mean income.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r fold-hide"><code class="sourceCode r"><span id="cb227-1"><a href="linear-regression.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(<span class="at">Variable                =</span> <span class="fu">names</span>(<span class="fu">coef</span>(mod_both)),</span>
<span id="cb227-2"><a href="linear-regression.html#cb227-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Original coefficients</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">coef</span>(mod_both),</span>
<span id="cb227-3"><a href="linear-regression.html#cb227-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">`</span><span class="at">Centred coefs</span><span class="st">`</span>         <span class="ot">=</span> <span class="fu">coef</span>(mod_centred))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   Variable     `Original coefficients` `Centred coefs`
##   &lt;chr&gt;                          &lt;dbl&gt;           &lt;dbl&gt;
## 1 (Intercept)                    -6.85           46.8 
## 2 education                       4.14            4.14
## 3 income_1000s                    1.36            1.36</code></pre>
</div>
</div>
<div id="finally-confidence-intervals" class="section level2" number="5.13">
<h2><span class="header-section-number">5.13</span> Finally: confidence intervals</h2>
<p>To obtain confidence intervals, just use the <code>confint</code> command on the model:</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="linear-regression.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(mod_centred)</span></code></pre></div>
<pre><code>##                     2.5 %    97.5 %
## (Intercept)    45.2988979 48.367769
## education_c     3.4451272  4.829762
## income_1000s_c  0.9162805  1.806051</code></pre>
<p>There is a version in the <code>car</code> package (“car” is short for “Companion to Applied Regression” – the textbook) which also includes the coefficient.</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="linear-regression.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb231-2"><a href="linear-regression.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="fu">Confint</span>(mod_centred)</span></code></pre></div>
<pre><code>##                 Estimate      2.5 %    97.5 %
## (Intercept)    46.833333 45.2988979 48.367769
## education_c     4.137444  3.4451272  4.829762
## income_1000s_c  1.361166  0.9162805  1.806051</code></pre>
<p>Another way to get the same, in case handy for other scenarios where the <code>car</code> package function is not available:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="linear-regression.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">Estimate =</span> <span class="fu">coef</span>(mod_centred),</span>
<span id="cb233-2"><a href="linear-regression.html#cb233-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">confint</span>(mod_centred))</span></code></pre></div>
<pre><code>##                 Estimate      2.5 %    97.5 %
## (Intercept)    46.833333 45.2988979 48.367769
## education_c     4.137444  3.4451272  4.829762
## income_1000s_c  1.361166  0.9162805  1.806051</code></pre>
</div>
<div id="very-optional-extras" class="section level2" number="5.14">
<h2><span class="header-section-number">5.14</span> Very optional extras</h2>
<div id="making-functions" class="section level3" number="5.14.1">
<h3><span class="header-section-number">5.14.1</span> Making functions</h3>
<p>This is how to make a function in R:</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="linear-regression.html#cb235-1" aria-hidden="true" tabindex="-1"></a>add_one <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb235-2"><a href="linear-regression.html#cb235-2" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb235-3"><a href="linear-regression.html#cb235-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb235-4"><a href="linear-regression.html#cb235-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-5"><a href="linear-regression.html#cb235-5" aria-hidden="true" tabindex="-1"></a><span class="fu">add_one</span>(<span class="dv">41</span>)</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<p>It is not very useful.</p>
<p>Here is an actually useful example that does the following:</p>
<ol style="list-style-type: decimal">
<li>“Pivot” the data frame longer, so that there are multiple rows per occupation – one for each variable – and only two columns: <code>variable</code> and <code>value</code></li>
<li>Group by <code>variable</code></li>
</ol>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="linear-regression.html#cb237-1" aria-hidden="true" tabindex="-1"></a>pivot_all_longer <span class="ot">&lt;-</span> <span class="cf">function</span>(.data) {</span>
<span id="cb237-2"><a href="linear-regression.html#cb237-2" aria-hidden="true" tabindex="-1"></a>  .data <span class="sc">%&gt;%</span></span>
<span id="cb237-3"><a href="linear-regression.html#cb237-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols      =</span> <span class="fu">everything</span>(),</span>
<span id="cb237-4"><a href="linear-regression.html#cb237-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to  =</span> <span class="st">&quot;variable&quot;</span>,</span>
<span id="cb237-5"><a href="linear-regression.html#cb237-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-6"><a href="linear-regression.html#cb237-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(variable)</span>
<span id="cb237-7"><a href="linear-regression.html#cb237-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here it is in action, applied only to numeric variables:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="linear-regression.html#cb238-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb238-2"><a href="linear-regression.html#cb238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb238-3"><a href="linear-regression.html#cb238-3" aria-hidden="true" tabindex="-1"></a>  pivot_all_longer</span></code></pre></div>
<pre><code>## # A tibble: 510 x 2
## # Groups:   variable [5]
##    variable        value
##    &lt;chr&gt;           &lt;dbl&gt;
##  1 education       13.1 
##  2 income       12351   
##  3 women           11.2 
##  4 prestige        68.8 
##  5 income_1000s    12.4 
##  6 education       12.3 
##  7 income       25879   
##  8 women            4.02
##  9 prestige        69.1 
## 10 income_1000s    25.9 
## # ... with 500 more rows</code></pre>
<p>So now there are four times as many rows and two columns.</p>
<p>But why…?!</p>
<p>You can pipe this into the <code>summarise</code> command and easily summarise all numeric variables as follows:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="linear-regression.html#cb240-1" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb240-2"><a href="linear-regression.html#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb240-3"><a href="linear-regression.html#cb240-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_all_longer</span>() <span class="sc">%&gt;%</span></span>
<span id="cb240-4"><a href="linear-regression.html#cb240-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">M        =</span> <span class="fu">mean</span>(value),</span>
<span id="cb240-5"><a href="linear-regression.html#cb240-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Mdn      =</span> <span class="fu">median</span>(value),</span>
<span id="cb240-6"><a href="linear-regression.html#cb240-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">SD       =</span> <span class="fu">sd</span>(value),</span>
<span id="cb240-7"><a href="linear-regression.html#cb240-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">valid_n  =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)),</span>
<span id="cb240-8"><a href="linear-regression.html#cb240-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">n        =</span> <span class="fu">n</span>())</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 5 x 6
##   variable           M     Mdn      SD valid_n     n
##   &lt;chr&gt;          &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;
## 1 education      10.7    10.5     2.73     102   102
## 2 income       6798.   5930.   4246.       102   102
## 3 income_1000s    6.80    5.93    4.25     102   102
## 4 prestige       46.8    43.6    17.2      102   102
## 5 women          29.0    13.6    31.7      102   102</code></pre>
<p>So it’s another way to create a Table 1.</p>
</div>
<div id="another-way-to-make-scatterplots-ggally" class="section level3" number="5.14.2">
<h3><span class="header-section-number">5.14.2</span> Another way to make scatterplots: GGally</h3>
<p>Recall that <code>select</code> is part of tidyverse and selects variables. Here I am using the base R function <code>is.numeric</code> which returns <code>TRUE</code> if a variable is numeric, e.g., not a categorical variable.</p>
<p>The first parameter of <code>ggpairs</code> is a data frame, which the <code>%&gt;%</code> pipe gladly provides.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="linear-regression.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span>
<span id="cb243-2"><a href="linear-regression.html#cb243-2" aria-hidden="true" tabindex="-1"></a>dat <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="linear-regression.html#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb243-4"><a href="linear-regression.html#cb243-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">upper =</span> <span class="st">&quot;blank&quot;</span>,</span>
<span id="cb243-5"><a href="linear-regression.html#cb243-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">progress =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="R-notes_files/figure-html/unnamed-chunk-168-1.png" width="672" /></p>
<p>The wiggly curves on the diagonals are smoothed histograms, also known as density plots.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="p-values-and-confidence-intervals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="linear-regression-diagnostics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["R-notes.pdf", "R-notes.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
